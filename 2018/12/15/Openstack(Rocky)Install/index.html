
<!DOCTYPE html>
<html lang="zh-CN" class="loading">
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>抱着西瓜砸地球的博客</title>

    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="google" content="notranslate" />
    <meta name="keywords" content="Blog,"> 
    <meta name="description" content="OpenStack 是一个云操作系统，通过数据中心可控制大型的计算、存储、网络等资源池。所有的管理通过前端界面管理员就可以完成，同样也可以通过 web 接口让最终用户部署资源。
参考文档: 

官方,"> 
    <meta name="author" content="YongJie-Xie"> 
    <link rel="alternative" href="atom.xml" title="抱着西瓜砸地球的博客" type="application/atom+xml"> 
    <link rel="icon" href="/img/favicon.png"> 
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
    <link rel="stylesheet" href="/css/diaspora.css">
</head>

<body class="loading">
    <div id="loader"></div>
    <div id="single">
    <div id="top" style="display: block;">
    <div class="bar" style="width: 0;"></div>
    <a class="icon-home image-icon" href="javascript:;"></a>
    <div title="播放/暂停" class="icon-play"></div>
    <h3 class="subtitle">Openstack Rocky 部署教程</h3>
    <div class="social">
        <!--<div class="like-icon">-->
            <!--<a href="javascript:;" class="likeThis active"><span class="icon-like"></span><span class="count">76</span></a>-->
        <!--</div>-->
        <div>
            <div class="share">
                <a title="获取二维码" class="icon-scan" href="javascript:;"></a>
            </div>
            <div id="qr"></div>
        </div>
    </div>
    <div class="scrollbar"></div>
</div>
    <div class="section">
        <div class="article">
    <div class='main'>
        <h1 class="title">Openstack Rocky 部署教程</h1>
        <div class="stuff">
            <span>十二月 15, 2018</span>
            
  <ul class="post-tags-list"><li class="post-tags-list-item"><a class="post-tags-list-link" href="/tags/CentOS/">CentOS</a></li><li class="post-tags-list-item"><a class="post-tags-list-link" href="/tags/Openstack/">Openstack</a></li><li class="post-tags-list-item"><a class="post-tags-list-link" href="/tags/Rocky/">Rocky</a></li><li class="post-tags-list-item"><a class="post-tags-list-link" href="/tags/VMware/">VMware</a></li></ul>


        </div>
        <div class="content markdown">
            <p>OpenStack 是一个云操作系统，通过数据中心可控制大型的计算、存储、网络等资源池。所有的管理通过前端界面管理员就可以完成，同样也可以通过 web 接口让最终用户部署资源。</p>
<p>参考文档: </p>
<ol>
<li><a href="https://docs.openstack.org/install-guide/openstack-services.html" target="_blank" rel="noopener">官方部署文档</a></li>
<li><a href="https://docs.openstack.org/mitaka/zh_CN/install-guide-rdo" target="_blank" rel="noopener">官方部署文档中文版 (Mitaka)</a></li>
<li><a href="https://www.cnblogs.com/tssc/p/9857526.html" target="_blank" rel="noopener">天生帅才的全套 Openstack 安装指南</a></li>
</ol>
<p>注意：</p>
<ol>
<li>部署 Openstack 分布式集群需要一定的 Linux 基础</li>
<li>本教程部署的是 Rocky 版本的最小化的 Openstack 集群</li>
<li>至少安装两个节点, 控制节点【Controller】和计算节点【Compute】</li>
<li>至少拥有两个网络, 公共网络【使用 NAT 模式模拟】和私有网络【管理网络, 使用仅主机模式模拟】</li>
<li>本教程所有密码均设为 123456</li>
</ol>
<h2 id="一、准备工作"><a href="#一、准备工作" class="headerlink" title="一、准备工作"></a>一、准备工作</h2><h3 id="0-虚拟机配置"><a href="#0-虚拟机配置" class="headerlink" title="0. 虚拟机配置"></a>0. 虚拟机配置</h3><h4 id="a-虚拟机-Controller-Hostname-openstack-controller"><a href="#a-虚拟机-Controller-Hostname-openstack-controller" class="headerlink" title="a) 虚拟机 Controller (Hostname: openstack.controller)"></a>a) 虚拟机 Controller (Hostname: openstack.controller)</h4><ul>
<li>内存: 4 GB</li>
<li>处理器: 1个1核 (勾选虚拟化 Inter VT-x/EPT 或 AMD-V/RVI)</li>
<li>硬盘: 20G</li>
<li>网络适配器: NAT (192.168.80.11/24 - 192.168.80.2 - 223.5.5.5)</li>
<li>网络适配器2: 仅主机模式 (192.168.10.11/24)</li>
</ul>
<h4 id="b-虚拟机-Compute-Hostname-openstack-compute"><a href="#b-虚拟机-Compute-Hostname-openstack-compute" class="headerlink" title="b) 虚拟机 Compute (Hostname: openstack.compute)"></a>b) 虚拟机 Compute (Hostname: openstack.compute)</h4><ul>
<li>内存: 2 GB</li>
<li>处理器: 1个1核 (勾选虚拟化 Inter VT-x/EPT 或 AMD-V/RVI)</li>
<li>硬盘: 20G</li>
<li>网络适配器: NAT (192.168.80.31/24 - 192.168.80.2 - 223.5.5.5)</li>
<li>网络适配器2: 仅主机模式 (192.168.10.31/24)</li>
</ul>
<h3 id="1-软件工具下载"><a href="#1-软件工具下载" class="headerlink" title="1. 软件工具下载"></a>1. 软件工具下载</h3><ul>
<li><a href="https://my.vmware.com/web/vmware/details?downloadGroup=WKST1413-WIN&amp;productId=686&amp;rPId=25457" target="_blank" rel="noopener">VMware Workstation 14</a></li>
<li><a href="http://mirrors.aliyun.com/centos/7.5.1804/isos/x86_64/CentOS-7-x86_64-Minimal-1804.iso" target="_blank" rel="noopener">CentOS-7-x86_64-Minimal-1804</a></li>
<li><a href="http://www.netsarang.com/download/down_form.html?code=622" target="_blank" rel="noopener">Xshell 6</a> --&gt; 个人免费, License type 选择 Home and school use, 邮箱获取下载链接</li>
<li><a href="http://www.netsarang.com/download/down_form.html?code=623" target="_blank" rel="noopener">Xftp 6</a> --&gt; 同上</li>
</ul>
<h3 id="2-基础环境搭建"><a href="#2-基础环境搭建" class="headerlink" title="2. 基础环境搭建"></a>2. 基础环境搭建</h3><h4 id="a-安装-VMware-Workstation-物理机"><a href="#a-安装-VMware-Workstation-物理机" class="headerlink" title="a) 安装 VMware Workstation (物理机)"></a>a) 安装 VMware Workstation (物理机)</h4><p>过程略</p>
<h4 id="b-安装-Xshell-6-和-Xftp-6-物理机"><a href="#b-安装-Xshell-6-和-Xftp-6-物理机" class="headerlink" title="b) 安装 Xshell 6 和 Xftp 6 (物理机)"></a>b) 安装 Xshell 6 和 Xftp 6 (物理机)</h4><p>过程略</p>
<h4 id="c-VMware-Workstation-安装-CentOS-7"><a href="#c-VMware-Workstation-安装-CentOS-7" class="headerlink" title="c) VMware Workstation 安装 CentOS 7"></a>c) VMware Workstation 安装 CentOS 7</h4><p>参考<a href="https://yongjie-xie.github.io/2018/10/10/CentOSInstall">这里</a></p>
<h2 id="二、系统环境配置"><a href="#二、系统环境配置" class="headerlink" title="二、系统环境配置"></a>二、系统环境配置</h2><p><strong><em>建议配置系统环境前为所有虚拟机拍摄一次快照, 以备不时之需</em></strong></p>
<h3 id="1-配置网络接口-可使用-nmtui-命令打开图形化配置"><a href="#1-配置网络接口-可使用-nmtui-命令打开图形化配置" class="headerlink" title="1. 配置网络接口 (可使用 nmtui 命令打开图形化配置)"></a>1. 配置网络接口 (可使用 nmtui 命令打开图形化配置)</h3><p><strong>网络接口的名称为 ens+数字, 变通一下</strong></p>
<h4 id="a-Controller-节点"><a href="#a-Controller-节点" class="headerlink" title="a) Controller 节点"></a>a) Controller 节点</h4><p>网络适配器</p>
<ul>
<li>IP 地址: 192.168.80.11 (静态IP)</li>
<li>子网掩码: 255.255.255.0 (or /24)</li>
<li>默认网关: 192.168.80.2</li>
<li>DNS1: 192.168.80.2</li>
<li>DNS2: 223.5.5.5<br>网络适配器 2</li>
<li>IP 地址: 192.168.10.11 (静态IP)<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># cat /etc/sysconfig/network-scripts/ifcfg-ens32</span></span><br><span class="line"><span class="attr">TYPE</span>=Ethernet</span><br><span class="line"><span class="attr">PROXY_METHOD</span>=none</span><br><span class="line"><span class="attr">BROWSER_ONLY</span>=<span class="literal">no</span></span><br><span class="line"><span class="attr">BOOTPROTO</span>=none</span><br><span class="line"><span class="attr">DEFROUTE</span>=<span class="literal">yes</span></span><br><span class="line"><span class="attr">IPV4_FAILURE_FATAL</span>=<span class="literal">no</span></span><br><span class="line"><span class="attr">IPV6INIT</span>=<span class="literal">no</span></span><br><span class="line"><span class="attr">IPV6_AUTOCONF</span>=<span class="string">"yes"</span></span><br><span class="line"><span class="attr">IPV6_DEFROUTE</span>=<span class="string">"yes"</span></span><br><span class="line"><span class="attr">IPV6_FAILURE_FATAL</span>=<span class="string">"no"</span></span><br><span class="line"><span class="attr">IPV6_ADDR_GEN_MODE</span>=<span class="string">"stable-privacy"</span></span><br><span class="line"><span class="attr">NAME</span>=ens32</span><br><span class="line"><span class="attr">UUID</span>=b6026ed9-<span class="number">05</span>a0-<span class="number">450</span>a-af4c-<span class="number">218</span>b167e2a64</span><br><span class="line"><span class="attr">DEVICE</span>=ens32</span><br><span class="line"><span class="attr">ONBOOT</span>=<span class="literal">yes</span></span><br><span class="line"><span class="attr">IPADDR</span>=<span class="number">192.168</span>.<span class="number">80.11</span></span><br><span class="line"><span class="attr">PREFIX</span>=<span class="number">24</span></span><br><span class="line"><span class="attr">GATEWAY</span>=<span class="number">192.168</span>.<span class="number">80.2</span></span><br><span class="line"><span class="attr">DNS1</span>=<span class="number">192.168</span>.<span class="number">80.2</span></span><br><span class="line"><span class="attr">DNS2</span>=<span class="number">223.5</span>.<span class="number">5.5</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><img src="https://yongjie-xie.github.io/images/00020.png" alt="Controller ens32" title="Controller ens32"><br><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># cat /etc/sysconfig/network-scripts/ifcfg-ens33</span></span><br><span class="line"><span class="attr">TYPE</span>=Ethernet</span><br><span class="line"><span class="attr">PROXY_METHOD</span>=none</span><br><span class="line"><span class="attr">BROWSER_ONLY</span>=<span class="literal">no</span></span><br><span class="line"><span class="attr">BOOTPROTO</span>=none</span><br><span class="line"><span class="attr">IPADDR</span>=<span class="number">192.168</span>.<span class="number">10.11</span></span><br><span class="line"><span class="attr">PREFIX</span>=<span class="number">24</span></span><br><span class="line"><span class="attr">DEFROUTE</span>=<span class="literal">yes</span></span><br><span class="line"><span class="attr">IPV4_FAILURE_FATAL</span>=<span class="literal">no</span></span><br><span class="line"><span class="attr">IPV6INIT</span>=<span class="literal">no</span></span><br><span class="line"><span class="attr">NAME</span>=ens33</span><br><span class="line"><span class="attr">UUID</span>=c74edb0e-e525-<span class="number">3522</span>-<span class="number">8</span>d9e-<span class="number">59</span>d203378ef8</span><br><span class="line"><span class="attr">DEVICE</span>=ens33</span><br><span class="line"><span class="attr">ONBOOT</span>=<span class="literal">yes</span></span><br><span class="line"><span class="attr">AUTOCONNECT_PRIORITY</span>=-<span class="number">999</span></span><br></pre></td></tr></table></figure></p>
<p><img src="https://yongjie-xie.github.io/images/00021.png" alt="Controller ens33" title="Controller ens33"></p>
<h4 id="b-Compute-节点"><a href="#b-Compute-节点" class="headerlink" title="b) Compute 节点"></a>b) Compute 节点</h4><p>网络适配器</p>
<ul>
<li>IP 地址: 192.168.80.31 (静态IP)</li>
<li>子网掩码: 255.255.255.0 (or /24)</li>
<li>默认网关: 192.168.80.2</li>
<li>DNS1: 192.168.80.2</li>
<li>DNS2: 223.5.5.5<br>网络适配器 2</li>
<li>IP 地址: 192.168.10.31 (静态IP)<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># cat /etc/sysconfig/network-scripts/ifcfg-ens32</span></span><br><span class="line"><span class="attr">TYPE</span>=Ethernet</span><br><span class="line"><span class="attr">PROXY_METHOD</span>=none</span><br><span class="line"><span class="attr">BROWSER_ONLY</span>=<span class="literal">no</span></span><br><span class="line"><span class="attr">BOOTPROTO</span>=none</span><br><span class="line"><span class="attr">DEFROUTE</span>=<span class="literal">yes</span></span><br><span class="line"><span class="attr">IPV4_FAILURE_FATAL</span>=<span class="literal">no</span></span><br><span class="line"><span class="attr">IPV6INIT</span>=<span class="literal">no</span></span><br><span class="line"><span class="attr">IPV6_AUTOCONF</span>=<span class="string">"yes"</span></span><br><span class="line"><span class="attr">IPV6_DEFROUTE</span>=<span class="string">"yes"</span></span><br><span class="line"><span class="attr">IPV6_FAILURE_FATAL</span>=<span class="string">"no"</span></span><br><span class="line"><span class="attr">IPV6_ADDR_GEN_MODE</span>=<span class="string">"stable-privacy"</span></span><br><span class="line"><span class="attr">NAME</span>=ens32</span><br><span class="line"><span class="attr">UUID</span>=b6026ed9-<span class="number">05</span>a0-<span class="number">450</span>a-af4c-<span class="number">218</span>b167e2a64</span><br><span class="line"><span class="attr">DEVICE</span>=ens32</span><br><span class="line"><span class="attr">ONBOOT</span>=<span class="literal">yes</span></span><br><span class="line"><span class="attr">IPADDR</span>=<span class="number">192.168</span>.<span class="number">80.31</span></span><br><span class="line"><span class="attr">PREFIX</span>=<span class="number">24</span></span><br><span class="line"><span class="attr">GATEWAY</span>=<span class="number">192.168</span>.<span class="number">80.2</span></span><br><span class="line"><span class="attr">DNS1</span>=<span class="number">192.168</span>.<span class="number">80.2</span></span><br><span class="line"><span class="attr">DNS2</span>=<span class="number">223.5</span>.<span class="number">5.5</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><img src="https://yongjie-xie.github.io/images/00022.png" alt="Compute ens32" title="Compute ens32"><br><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># cat /etc/sysconfig/network-scripts/ifcfg-ens33</span></span><br><span class="line"><span class="attr">TYPE</span>=Ethernet</span><br><span class="line"><span class="attr">PROXY_METHOD</span>=none</span><br><span class="line"><span class="attr">BROWSER_ONLY</span>=<span class="literal">no</span></span><br><span class="line"><span class="attr">BOOTPROTO</span>=none</span><br><span class="line"><span class="attr">IPADDR</span>=<span class="number">192.168</span>.<span class="number">10.31</span></span><br><span class="line"><span class="attr">PREFIX</span>=<span class="number">24</span></span><br><span class="line"><span class="attr">DEFROUTE</span>=<span class="literal">yes</span></span><br><span class="line"><span class="attr">IPV4_FAILURE_FATAL</span>=<span class="literal">no</span></span><br><span class="line"><span class="attr">IPV6INIT</span>=<span class="literal">no</span></span><br><span class="line"><span class="attr">NAME</span>=ens33</span><br><span class="line"><span class="attr">UUID</span>=<span class="number">6</span>e46fbbc-fbeb-<span class="number">3416</span>-<span class="number">8</span>dc4-ca5b16d2d0da</span><br><span class="line"><span class="attr">DEVICE</span>=ens33</span><br><span class="line"><span class="attr">ONBOOT</span>=<span class="literal">yes</span></span><br><span class="line"><span class="attr">AUTOCONNECT_PRIORITY</span>=-<span class="number">999</span></span><br></pre></td></tr></table></figure></p>
<p><img src="https://yongjie-xie.github.io/images/00023.png" alt="Compute ens33" title="Compute ens33"></p>
<h3 id="2-配置域名解析"><a href="#2-配置域名解析" class="headerlink" title="2. 配置域名解析"></a>2. 配置域名解析</h3><h4 id="a-Controller-节点-1"><a href="#a-Controller-节点-1" class="headerlink" title="a) Controller 节点"></a>a) Controller 节点</h4><p>域名: openstack.controller 或 controller (设置后请勿随意修改)<br>hosts: 添加全部节点的域名解析<br><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# cat /etc/hostname </span><br><span class="line">openstack.controller</span><br><span class="line">[root@openstack ~]# cat /etc/hosts</span><br><span class="line"><span class="number">127.0</span><span class="meta">.0</span><span class="meta">.1</span>   localhost localhost.localdomain localhost4 localhost4.localdomain4</span><br><span class="line">::<span class="number">1</span>         localhost localhost.localdomain localhost6 localhost6.localdomain6</span><br><span class="line"></span><br><span class="line"><span class="number">192.168</span><span class="meta">.10</span><span class="meta">.11</span> openstack.controller controller</span><br><span class="line"><span class="number">192.168</span><span class="meta">.10</span><span class="meta">.31</span> openstack.compute1 compute1</span><br></pre></td></tr></table></figure></p>
<h4 id="b-Compute-节点-1"><a href="#b-Compute-节点-1" class="headerlink" title="b) Compute 节点"></a>b) Compute 节点</h4><p>域名: openstack.compute1 或 compute1 (设置后请勿随意修改)<br>hosts: 添加全部节点的域名解析<br><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# cat /etc/hostname</span><br><span class="line">openstack.compute1</span><br><span class="line">[root@openstack ~]# cat /etc/hosts</span><br><span class="line"><span class="number">127.0</span><span class="meta">.0</span><span class="meta">.1</span>   localhost localhost.localdomain localhost4 localhost4.localdomain4</span><br><span class="line">::<span class="number">1</span>         localhost localhost.localdomain localhost6 localhost6.localdomain6</span><br><span class="line"></span><br><span class="line"><span class="number">192.168</span><span class="meta">.10</span><span class="meta">.11</span> openstack.controller controller</span><br><span class="line"><span class="number">192.168</span><span class="meta">.10</span><span class="meta">.31</span> openstack.compute1 compute1</span><br></pre></td></tr></table></figure></p>
<h3 id="3-验证网络连通性"><a href="#3-验证网络连通性" class="headerlink" title="3. 验证网络连通性"></a>3. 验证网络连通性</h3><p>测试节点与互联网的连接以及节点之间的连接是否均连通</p>
<h4 id="a-Controller-节点-2"><a href="#a-Controller-节点-2" class="headerlink" title="a) Controller 节点"></a>a) Controller 节点</h4><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]#<span class="built_in"> ping </span>-c 4 openstack.org</span><br><span class="line">PING openstack.org (162.242.140.107) 56(84) bytes of data.</span><br><span class="line">64 bytes <span class="keyword">from</span> 162.242.140.107 (162.242.140.107): <span class="attribute">icmp_seq</span>=1 <span class="attribute">ttl</span>=128 <span class="attribute">time</span>=184 ms</span><br><span class="line">64 bytes <span class="keyword">from</span> 162.242.140.107 (162.242.140.107): <span class="attribute">icmp_seq</span>=2 <span class="attribute">ttl</span>=128 <span class="attribute">time</span>=184 ms</span><br><span class="line">64 bytes <span class="keyword">from</span> 162.242.140.107 (162.242.140.107): <span class="attribute">icmp_seq</span>=3 <span class="attribute">ttl</span>=128 <span class="attribute">time</span>=184 ms</span><br><span class="line">64 bytes <span class="keyword">from</span> 162.242.140.107 (162.242.140.107): <span class="attribute">icmp_seq</span>=4 <span class="attribute">ttl</span>=128 <span class="attribute">time</span>=185 ms</span><br><span class="line"></span><br><span class="line">--- openstack.org<span class="built_in"> ping </span>statistics ---</span><br><span class="line">4 packets transmitted, 4 received, 0% packet loss, time 3006ms</span><br><span class="line">rtt min/avg/max/mdev = 184.094/184.711/185.908/0.829 ms</span><br><span class="line">[root@openstack ~]#<span class="built_in"> ping </span>-c 4 compute1</span><br><span class="line">PING openstack.compute1 (192.168.10.31) 56(84) bytes of data.</span><br><span class="line">64 bytes <span class="keyword">from</span> openstack.compute1 (192.168.10.31): <span class="attribute">icmp_seq</span>=1 <span class="attribute">ttl</span>=64 <span class="attribute">time</span>=1.28 ms</span><br><span class="line">64 bytes <span class="keyword">from</span> openstack.compute1 (192.168.10.31): <span class="attribute">icmp_seq</span>=2 <span class="attribute">ttl</span>=64 <span class="attribute">time</span>=0.335 ms</span><br><span class="line">64 bytes <span class="keyword">from</span> openstack.compute1 (192.168.10.31): <span class="attribute">icmp_seq</span>=3 <span class="attribute">ttl</span>=64 <span class="attribute">time</span>=0.322 ms</span><br><span class="line">64 bytes <span class="keyword">from</span> openstack.compute1 (192.168.10.31): <span class="attribute">icmp_seq</span>=4 <span class="attribute">ttl</span>=64 <span class="attribute">time</span>=2.95 ms</span><br><span class="line"></span><br><span class="line">--- openstack.compute1<span class="built_in"> ping </span>statistics ---</span><br><span class="line">4 packets transmitted, 4 received, 0% packet loss, time 3007ms</span><br><span class="line">rtt min/avg/max/mdev = 0.322/1.222/2.954/1.073 ms</span><br></pre></td></tr></table></figure>
<h4 id="b-Compute-节点-2"><a href="#b-Compute-节点-2" class="headerlink" title="b) Compute 节点"></a>b) Compute 节点</h4><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]#<span class="built_in"> ping </span>-c 4 openstack.org</span><br><span class="line">PING openstack.org (162.242.140.107) 56(84) bytes of data.</span><br><span class="line">64 bytes <span class="keyword">from</span> 162.242.140.107 (162.242.140.107): <span class="attribute">icmp_seq</span>=1 <span class="attribute">ttl</span>=128 <span class="attribute">time</span>=184 ms</span><br><span class="line">64 bytes <span class="keyword">from</span> 162.242.140.107 (162.242.140.107): <span class="attribute">icmp_seq</span>=2 <span class="attribute">ttl</span>=128 <span class="attribute">time</span>=184 ms</span><br><span class="line">64 bytes <span class="keyword">from</span> 162.242.140.107 (162.242.140.107): <span class="attribute">icmp_seq</span>=3 <span class="attribute">ttl</span>=128 <span class="attribute">time</span>=184 ms</span><br><span class="line">64 bytes <span class="keyword">from</span> 162.242.140.107 (162.242.140.107): <span class="attribute">icmp_seq</span>=4 <span class="attribute">ttl</span>=128 <span class="attribute">time</span>=184 ms</span><br><span class="line"></span><br><span class="line">--- openstack.org<span class="built_in"> ping </span>statistics ---</span><br><span class="line">4 packets transmitted, 4 received, 0% packet loss, time 6380ms</span><br><span class="line">rtt min/avg/max/mdev = 184.250/184.339/184.453/0.435 ms</span><br><span class="line">[root@openstack ~]#<span class="built_in"> ping </span>-c 4 controller</span><br><span class="line">PING openstack.controller (192.168.10.11) 56(84) bytes of data.</span><br><span class="line">64 bytes <span class="keyword">from</span> openstack.controller (192.168.10.11): <span class="attribute">icmp_seq</span>=1 <span class="attribute">ttl</span>=64 <span class="attribute">time</span>=0.781 ms</span><br><span class="line">64 bytes <span class="keyword">from</span> openstack.controller (192.168.10.11): <span class="attribute">icmp_seq</span>=2 <span class="attribute">ttl</span>=64 <span class="attribute">time</span>=0.537 ms</span><br><span class="line">64 bytes <span class="keyword">from</span> openstack.controller (192.168.10.11): <span class="attribute">icmp_seq</span>=3 <span class="attribute">ttl</span>=64 <span class="attribute">time</span>=0.376 ms</span><br><span class="line">64 bytes <span class="keyword">from</span> openstack.controller (192.168.10.11): <span class="attribute">icmp_seq</span>=4 <span class="attribute">ttl</span>=64 <span class="attribute">time</span>=0.349 ms</span><br><span class="line"></span><br><span class="line">--- openstack.controller<span class="built_in"> ping </span>statistics ---</span><br><span class="line">4 packets transmitted, 4 received, 0% packet loss, time 3002ms</span><br><span class="line">rtt min/avg/max/mdev = 0.349/0.510/0.781/0.174 ms</span><br></pre></td></tr></table></figure>
<h3 id="4-配置-Yum-源-全部节点都需要配置"><a href="#4-配置-Yum-源-全部节点都需要配置" class="headerlink" title="4. 配置 Yum 源 (全部节点都需要配置)"></a>4. 配置 Yum 源 <strong><em>(全部节点都需要配置)</em></strong></h3><p>共四步: 备份, 替换 AliYun 源, 清理所有 Yum 缓存, 重新生成缓存<br><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-attr">[root@openstack ~]</span># <span class="selector-tag">mv</span> /<span class="selector-tag">etc</span>/<span class="selector-tag">yum</span><span class="selector-class">.repos</span><span class="selector-class">.d</span>/<span class="selector-tag">CentOS-Base</span><span class="selector-class">.repo</span> /<span class="selector-tag">etc</span>/<span class="selector-tag">yum</span><span class="selector-class">.repos</span><span class="selector-class">.d</span>/<span class="selector-tag">CentOS-Base</span><span class="selector-class">.repo</span><span class="selector-class">.backup</span></span><br><span class="line"><span class="selector-attr">[root@openstack ~]</span># <span class="selector-tag">wget</span> <span class="selector-tag">-O</span> /<span class="selector-tag">etc</span>/<span class="selector-tag">yum</span><span class="selector-class">.repos</span><span class="selector-class">.d</span>/<span class="selector-tag">epel</span><span class="selector-class">.repo</span> <span class="selector-tag">http</span>:<span class="comment">//mirrors.aliyun.com/repo/epel-7.repo</span></span><br><span class="line"><span class="selector-tag">--2018-12-15</span> <span class="selector-tag">02</span><span class="selector-pseudo">:55</span><span class="selector-pseudo">:53--</span>  <span class="selector-tag">http</span>:<span class="comment">//mirrors.aliyun.com/repo/epel-7.repo</span></span><br><span class="line"><span class="selector-tag">Resolving</span> <span class="selector-tag">mirrors</span><span class="selector-class">.aliyun</span><span class="selector-class">.com</span> (mirrors.aliyun.com)... <span class="selector-tag">175</span><span class="selector-class">.6</span><span class="selector-class">.29</span><span class="selector-class">.217</span>, <span class="selector-tag">175</span><span class="selector-class">.6</span><span class="selector-class">.29</span><span class="selector-class">.216</span>, <span class="selector-tag">175</span><span class="selector-class">.6</span><span class="selector-class">.29</span><span class="selector-class">.213</span>, ...</span><br><span class="line"><span class="selector-tag">Connecting</span> <span class="selector-tag">to</span> <span class="selector-tag">mirrors</span><span class="selector-class">.aliyun</span><span class="selector-class">.com</span> (mirrors.aliyun.com)|<span class="selector-tag">175</span><span class="selector-class">.6</span><span class="selector-class">.29</span><span class="selector-class">.217</span>|<span class="selector-pseudo">:80...</span> <span class="selector-tag">connected</span>.</span><br><span class="line"><span class="selector-tag">HTTP</span> <span class="selector-tag">request</span> <span class="selector-tag">sent</span>, <span class="selector-tag">awaiting</span> <span class="selector-tag">response</span>... <span class="selector-tag">200</span> <span class="selector-tag">OK</span></span><br><span class="line"><span class="selector-tag">Length</span>: <span class="selector-tag">664</span> <span class="selector-attr">[application/octet-stream]</span></span><br><span class="line"><span class="selector-tag">Saving</span> <span class="selector-tag">to</span>: ‘/<span class="selector-tag">etc</span>/<span class="selector-tag">yum</span><span class="selector-class">.repos</span><span class="selector-class">.d</span>/<span class="selector-tag">epel</span><span class="selector-class">.repo</span>’</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">100%</span><span class="selector-attr">[=================================================&gt;]</span> <span class="selector-tag">664</span>         <span class="selector-tag">--</span><span class="selector-class">.-K</span>/<span class="selector-tag">s</span>   <span class="selector-tag">in</span> <span class="selector-tag">0s</span>      </span><br><span class="line"></span><br><span class="line"><span class="selector-tag">2018-12-15</span> <span class="selector-tag">02</span><span class="selector-pseudo">:55</span><span class="selector-pseudo">:54</span> (<span class="number">95.0</span> MB/s) <span class="selector-tag">-</span> ‘/<span class="selector-tag">etc</span>/<span class="selector-tag">yum</span><span class="selector-class">.repos</span><span class="selector-class">.d</span>/<span class="selector-tag">epel</span><span class="selector-class">.repo</span>’ <span class="selector-tag">saved</span> <span class="selector-attr">[664/664]</span></span><br><span class="line"></span><br><span class="line"><span class="selector-attr">[root@openstack ~]</span># <span class="selector-tag">wget</span> <span class="selector-tag">-O</span> /<span class="selector-tag">etc</span>/<span class="selector-tag">yum</span><span class="selector-class">.repos</span><span class="selector-class">.d</span>/<span class="selector-tag">CentOS-Base</span><span class="selector-class">.repo</span> <span class="selector-tag">http</span>:<span class="comment">//mirrors.aliyun.com/repo/Centos-7.repo</span></span><br><span class="line"><span class="selector-tag">--2018-12-15</span> <span class="selector-tag">01</span><span class="selector-pseudo">:50</span><span class="selector-pseudo">:27--</span>  <span class="selector-tag">http</span>:<span class="comment">//mirrors.aliyun.com/repo/Centos-7.repo</span></span><br><span class="line"><span class="selector-tag">Resolving</span> <span class="selector-tag">mirrors</span><span class="selector-class">.aliyun</span><span class="selector-class">.com</span> (mirrors.aliyun.com)... <span class="selector-tag">175</span><span class="selector-class">.6</span><span class="selector-class">.29</span><span class="selector-class">.212</span>, <span class="selector-tag">175</span><span class="selector-class">.6</span><span class="selector-class">.29</span><span class="selector-class">.213</span>, <span class="selector-tag">175</span><span class="selector-class">.6</span><span class="selector-class">.29</span><span class="selector-class">.215</span>, ...</span><br><span class="line"><span class="selector-tag">Connecting</span> <span class="selector-tag">to</span> <span class="selector-tag">mirrors</span><span class="selector-class">.aliyun</span><span class="selector-class">.com</span> (mirrors.aliyun.com)|<span class="selector-tag">175</span><span class="selector-class">.6</span><span class="selector-class">.29</span><span class="selector-class">.212</span>|<span class="selector-pseudo">:80...</span> <span class="selector-tag">connected</span>.</span><br><span class="line"><span class="selector-tag">HTTP</span> <span class="selector-tag">request</span> <span class="selector-tag">sent</span>, <span class="selector-tag">awaiting</span> <span class="selector-tag">response</span>... <span class="selector-tag">200</span> <span class="selector-tag">OK</span></span><br><span class="line"><span class="selector-tag">Length</span>: <span class="selector-tag">2523</span> (<span class="number">2.5</span>K) <span class="selector-attr">[application/octet-stream]</span></span><br><span class="line"><span class="selector-tag">Saving</span> <span class="selector-tag">to</span>: ‘/<span class="selector-tag">etc</span>/<span class="selector-tag">yum</span><span class="selector-class">.repos</span><span class="selector-class">.d</span>/<span class="selector-tag">CentOS-Base</span><span class="selector-class">.repo</span>’</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">100%</span><span class="selector-attr">[=================================================&gt;]</span> <span class="selector-tag">2</span>,<span class="selector-tag">523</span>       <span class="selector-tag">--</span><span class="selector-class">.-K</span>/<span class="selector-tag">s</span>   <span class="selector-tag">in</span> <span class="selector-tag">0s</span>      </span><br><span class="line"></span><br><span class="line"><span class="selector-tag">2018-12-15</span> <span class="selector-tag">01</span><span class="selector-pseudo">:50</span><span class="selector-pseudo">:27</span> (<span class="number">226</span> MB/s) <span class="selector-tag">-</span> ‘/<span class="selector-tag">etc</span>/<span class="selector-tag">yum</span><span class="selector-class">.repos</span><span class="selector-class">.d</span>/<span class="selector-tag">CentOS-Base</span><span class="selector-class">.repo</span>’ <span class="selector-tag">saved</span> <span class="selector-attr">[2523/2523]</span></span><br><span class="line"></span><br><span class="line"><span class="selector-attr">[root@openstack ~]</span># <span class="selector-tag">yum</span> <span class="selector-tag">clean</span> <span class="keyword">all</span></span><br><span class="line"><span class="selector-tag">Loaded</span> <span class="selector-tag">plugins</span>: <span class="selector-tag">fastestmirror</span></span><br><span class="line"><span class="selector-tag">Repodata</span> <span class="selector-tag">is</span> <span class="selector-tag">over</span> <span class="selector-tag">2</span> <span class="selector-tag">weeks</span> <span class="selector-tag">old</span>. <span class="selector-tag">Install</span> <span class="selector-tag">yum-cron</span>? <span class="selector-tag">Or</span> <span class="selector-tag">run</span>: <span class="selector-tag">yum</span> <span class="selector-tag">makecache</span> <span class="selector-tag">fast</span></span><br><span class="line"><span class="selector-tag">Cleaning</span> <span class="selector-tag">repos</span>: <span class="selector-tag">base</span> <span class="selector-tag">extras</span> <span class="selector-tag">updates</span></span><br><span class="line"><span class="selector-tag">Cleaning</span> <span class="selector-tag">up</span> <span class="selector-tag">everything</span></span><br><span class="line"><span class="selector-tag">Maybe</span> <span class="selector-tag">you</span> <span class="selector-tag">want</span>: <span class="selector-tag">rm</span> <span class="selector-tag">-rf</span> /<span class="selector-tag">var</span>/<span class="selector-tag">cache</span>/<span class="selector-tag">yum</span>, <span class="selector-tag">to</span> <span class="selector-tag">also</span> <span class="selector-tag">free</span> <span class="selector-tag">up</span> <span class="selector-tag">space</span> <span class="selector-tag">taken</span> <span class="selector-tag">by</span> <span class="selector-tag">orphaned</span> <span class="selector-tag">data</span> <span class="selector-tag">from</span> <span class="selector-tag">disabled</span> <span class="selector-tag">or</span> <span class="selector-tag">removed</span> <span class="selector-tag">repos</span></span><br><span class="line"><span class="selector-tag">Cleaning</span> <span class="selector-tag">up</span> <span class="selector-tag">list</span> <span class="selector-tag">of</span> <span class="selector-tag">fastest</span> <span class="selector-tag">mirrors</span></span><br><span class="line"><span class="selector-attr">[root@openstack ~]</span># <span class="selector-tag">yum</span> <span class="selector-tag">makecache</span></span><br><span class="line"><span class="selector-tag">Loaded</span> <span class="selector-tag">plugins</span>: <span class="selector-tag">fastestmirror</span></span><br><span class="line"><span class="selector-tag">Loading</span> <span class="selector-tag">mirror</span> <span class="selector-tag">speeds</span> <span class="selector-tag">from</span> <span class="selector-tag">cached</span> <span class="selector-tag">hostfile</span></span><br><span class="line">...</span><br><span class="line">...</span><br><span class="line"><span class="selector-tag">epel</span>                                                                           <span class="selector-tag">12748</span>/<span class="selector-tag">12748</span></span><br><span class="line"><span class="selector-tag">Metadata</span> <span class="selector-tag">Cache</span> <span class="selector-tag">Created</span></span><br></pre></td></tr></table></figure></p>
<h3 id="5-升级软件和系统内核-全部节点都需要配置"><a href="#5-升级软件和系统内核-全部节点都需要配置" class="headerlink" title="5. 升级软件和系统内核 (全部节点都需要配置)"></a>5. 升级软件和系统内核 <strong><em>(全部节点都需要配置)</em></strong></h3><p>等待时间较长, 可以站起来做几个深呼吸, 毕竟安装才刚开始...疯狂狗头狗头<br><strong>!!!升级完成后必须重启系统!!!</strong><br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# yum -y upgrade</span><br><span class="line">Loaded plugins: fastestmirror</span><br><span class="line">Loading<span class="built_in"> mirror </span>speeds <span class="keyword">from</span> cached hostfile</span><br><span class="line"><span class="built_in">..</span>.</span><br><span class="line"><span class="built_in">..</span>.</span><br><span class="line">Replaced:</span><br><span class="line">  grub2.x86_64 1:2.02-0.65.el7.centos.2     grub2-tools.x86_64 1:2.02-0.65.el7.centos.2    </span><br><span class="line"></span><br><span class="line">Complete!</span><br><span class="line">[root@openstack ~]# reboot</span><br></pre></td></tr></table></figure></p>
<h3 id="6-关闭-Firewalld、SELinux-全部节点都需要配置"><a href="#6-关闭-Firewalld、SELinux-全部节点都需要配置" class="headerlink" title="6. 关闭 Firewalld、SELinux (全部节点都需要配置)"></a>6. 关闭 Firewalld、SELinux <strong><em>(全部节点都需要配置)</em></strong></h3><p>Firewalld</p>
<ul>
<li>停止 Firewalld 服务 (systemctl stop firewalld)</li>
<li>禁用 Firewalld 开机自启 (systemctl disable firewalld)</li>
<li>屏蔽 Firewalld 服务 (systemctl mask firewalld)<br>SELinux</li>
<li>停止 SELinux (setenforce 0)</li>
<li>禁用 SELinux (sed -i &#39;s#SELINUX=enforcing#SELINUX=disabled#g&#39; /etc/sysconfig/selinux)<figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]<span class="comment"># systemctl stop firewalld</span></span><br><span class="line">[root@openstack ~]<span class="comment"># systemctl disable firewalld</span></span><br><span class="line">Removed <span class="keyword">symlink</span> /etc/systemd/<span class="keyword">system</span>/multi-user.target.wants/firewalld.service.</span><br><span class="line">Removed <span class="keyword">symlink</span> /etc/systemd/<span class="keyword">system</span>/dbus-org.fedoraproject.FirewallD1.service.</span><br><span class="line">[root@openstack ~]<span class="comment"># systemctl mask firewalld</span></span><br><span class="line">Created <span class="keyword">symlink</span> from /etc/systemd/<span class="keyword">system</span>/firewalld.service to /dev/null.</span><br><span class="line">[root@openstack ~]<span class="comment"># setenforce 0</span></span><br><span class="line">[root@openstack ~]<span class="comment"># sed -i 's#SELINUX=enforcing#SELINUX=disabled#g' /etc/sysconfig/selinux</span></span><br><span class="line">[root@openstack ~]<span class="comment"># cat /etc/sysconfig/selinux</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># This file controls the state of SELinux on the system.</span></span><br><span class="line"><span class="comment"># SELINUX= can take one of these three values:</span></span><br><span class="line"><span class="comment">#     enforcing - SELinux security policy is enforced.</span></span><br><span class="line"><span class="comment">#     permissive - SELinux prints warnings instead of enforcing.</span></span><br><span class="line"><span class="comment">#     disabled - No SELinux policy is loaded.</span></span><br><span class="line">SELINUX=disabled</span><br><span class="line"><span class="comment"># SELINUXTYPE= can take one of three two values:</span></span><br><span class="line"><span class="comment">#     targeted - Targeted processes are protected,</span></span><br><span class="line"><span class="comment">#     minimum - Modification of targeted policy. Only selected processes are protected. </span></span><br><span class="line"><span class="comment">#     mls - Multi Level Security protection.</span></span><br><span class="line">SELINUXTYPE=targeted</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="7-配置时间同步服务"><a href="#7-配置时间同步服务" class="headerlink" title="7. 配置时间同步服务"></a>7. 配置时间同步服务</h3><h4 id="a-Controller-节点-3"><a href="#a-Controller-节点-3" class="headerlink" title="a) Controller 节点"></a>a) Controller 节点</h4><p>设置时区 (timedatectl set-timezone Asia/Shanghai)<br>安装 chrony (yum install -y chrony)<br>配置 chrony</p>
<ul>
<li>设置 AliYun NTP 服务器 (server ntp1.aliyun.com iburst, server ntp2.aliyun.com iburst)</li>
<li>允许其他节点连接 (allow 192.168.10.0/24)</li>
<li>启用 chronyd 开机自启 (systemctl enable chronyd)</li>
<li>重启 chronyd 服务 (systemctl restart chronyd)<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# timedatectl set-timezone Asia/Shanghai</span><br><span class="line">[root@openstack ~]# yum install -y chrony</span><br><span class="line"><span class="built_in">..</span>.</span><br><span class="line"><span class="literal">Nothing</span> <span class="keyword">to</span> <span class="keyword">do</span></span><br><span class="line">[root@openstack ~]# cat /etc/chrony.conf </span><br><span class="line">server ntp1.aliyun.com iburst</span><br><span class="line">server ntp2.aliyun.com iburst</span><br><span class="line">driftfile /var/lib/chrony/drift</span><br><span class="line">makestep 1.0 3</span><br><span class="line">rtcsync</span><br><span class="line">allow 192.168.10.0/24</span><br><span class="line">logdir /var/log/chrony</span><br><span class="line">[root@openstack ~]# systemctl <span class="builtin-name">enable</span> chronyd</span><br><span class="line">[root@openstack ~]# systemctl restart chronyd</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="b-Compute-节点-3"><a href="#b-Compute-节点-3" class="headerlink" title="b) Compute 节点"></a>b) Compute 节点</h4><p>安装 chrony (yum install -y chrony)<br>配置 chrony</p>
<ul>
<li>设置 controller NTP 服务器 (server controller iburst)</li>
<li>启用 chronyd 开机自启 (systemctl enable chronyd)</li>
<li>重启 chronyd 服务 (systemctl restart chronyd)<figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]<span class="comment"># yum install -y chrony</span></span><br><span class="line">...</span><br><span class="line">Nothing to <span class="keyword">do</span></span><br><span class="line">[root@openstack ~]<span class="comment"># vim /etc/chrony.conf</span></span><br><span class="line">[root@openstack ~]<span class="comment"># cat /etc/chrony.conf</span></span><br><span class="line">server controller iburst</span><br><span class="line">driftfile /var/<span class="class"><span class="keyword">lib</span>/<span class="title">chrony</span>/<span class="title">drift</span></span></span><br><span class="line">makestep <span class="number">1.0</span> <span class="number">3</span></span><br><span class="line">rtcsync</span><br><span class="line">logdir /var/log/chrony</span><br><span class="line">[root@openstack ~]<span class="comment"># systemctl enable chronyd</span></span><br><span class="line">[root@openstack ~]<span class="comment"># systemctl restart chronyd</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="8-验证时间同步服务"><a href="#8-验证时间同步服务" class="headerlink" title="8. 验证时间同步服务"></a>8. 验证时间同步服务</h3><h4 id="a-Controller-节点-4"><a href="#a-Controller-节点-4" class="headerlink" title="a) Controller 节点"></a>a) Controller 节点</h4><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# chronyc sources</span><br><span class="line"><span class="number">210</span> Number of sources = <span class="number">2</span></span><br><span class="line">MS Name/IP address         Stratum Poll Reach LastRx Last sample               </span><br><span class="line">===============================================================================</span><br><span class="line">^* <span class="number">120.25</span><span class="number">.115</span><span class="number">.20</span>                 <span class="number">2</span>   <span class="number">6</span>   <span class="number">377</span>     <span class="number">6</span>    <span class="number">-31</span>ms[  <span class="number">-40</span>ms] +/- <span class="number">5503</span>us</span><br><span class="line">^- <span class="number">203.107</span><span class="number">.6</span><span class="number">.88</span>                  <span class="number">2</span>   <span class="number">6</span>   <span class="number">377</span>     <span class="number">4</span>    <span class="number">-34</span>ms[  <span class="number">-34</span>ms] +/-   <span class="number">33</span>ms</span><br></pre></td></tr></table></figure>
<h4 id="b-Compute-节点-4"><a href="#b-Compute-节点-4" class="headerlink" title="b) Compute 节点"></a>b) Compute 节点</h4><p>Name/IP address 列显示为 Controller 节点域名即为设置完成<br><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# chronyc sources</span><br><span class="line">210 Number of sources = 1</span><br><span class="line">MS Name/IP address         Stratum Poll Reach LastRx Last sample               </span><br><span class="line">===============================================================================</span><br><span class="line">^* openstack.controller          3   6    17    56    -23us[<span class="code">+3387us] +</span>/-   24ms</span><br></pre></td></tr></table></figure></p>
<h2 id="三、安装-Openstack-相关软件"><a href="#三、安装-Openstack-相关软件" class="headerlink" title="三、安装 Openstack 相关软件"></a>三、安装 Openstack 相关软件</h2><h3 id="1-安装-Openstack-软件仓库-全部节点都需要安装"><a href="#1-安装-Openstack-软件仓库-全部节点都需要安装" class="headerlink" title="1. 安装 Openstack 软件仓库 (全部节点都需要安装)"></a>1. 安装 Openstack 软件仓库 <strong><em>(全部节点都需要安装)</em></strong></h3><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@openstack</span> ~]<span class="meta"># yum install -y centos-release-openstack-rocky</span></span><br><span class="line">...</span><br><span class="line">Complete!</span><br><span class="line">[root<span class="symbol">@openstack</span> ~]<span class="meta"># yum clean all</span></span><br><span class="line">...</span><br><span class="line">Metadata Cache Created</span><br></pre></td></tr></table></figure>
<h3 id="2-安装-Openstack-相关软件-全部节点都需要安装"><a href="#2-安装-Openstack-相关软件-全部节点都需要安装" class="headerlink" title="2. 安装 Openstack 相关软件 (全部节点都需要安装)"></a>2. 安装 Openstack 相关软件 <strong><em>(全部节点都需要安装)</em></strong></h3><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@openstack</span> ~]<span class="meta"># yum install -y python-openstackclient openstack-selinux</span></span><br><span class="line">...</span><br><span class="line">Complete!</span><br></pre></td></tr></table></figure>
<p><strong><em>建议安装至此再为所有虚拟机拍摄一次快照, 以备不时之需</em></strong></p>
<h2 id="四、安装并配置-MariaDB-数据库"><a href="#四、安装并配置-MariaDB-数据库" class="headerlink" title="四、安装并配置 MariaDB 数据库"></a>四、安装并配置 MariaDB 数据库</h2><h3 id="只需在-Controller-节点安装"><a href="#只需在-Controller-节点安装" class="headerlink" title="(!!!只需在 Controller 节点安装!!!)"></a><strong><em>(!!!只需在 Controller 节点安装!!!)</em></strong></h3><h3 id="1-安装-MariaDB-相关软件包"><a href="#1-安装-MariaDB-相关软件包" class="headerlink" title="1. 安装 MariaDB 相关软件包"></a>1. 安装 MariaDB 相关软件包</h3><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@openstack</span> ~]<span class="meta"># yum install -y mariadb mariadb-server MySQL-python python2-PyMySQL</span></span><br><span class="line">...</span><br><span class="line">Complete!</span><br></pre></td></tr></table></figure>
<h3 id="2-创建-MariaDB-数据库的-Openstack-配置文件"><a href="#2-创建-MariaDB-数据库的-Openstack-配置文件" class="headerlink" title="2. 创建 MariaDB 数据库的 Openstack 配置文件"></a>2. 创建 MariaDB 数据库的 Openstack 配置文件</h3><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># vim /etc/my.cnf.d/mariadb-openstack.cnf</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># cat /etc/my.cnf.d/mariadb-openstack.cnf </span></span><br><span class="line"><span class="section">[mysqld]</span></span><br><span class="line"><span class="attr">bind-address</span> = <span class="number">192.168</span>.<span class="number">10.11</span></span><br><span class="line"><span class="attr">default-storage-engine</span> = innodb</span><br><span class="line"><span class="attr">innodb_file_per_table</span> = <span class="literal">on</span></span><br><span class="line"><span class="attr">max_connections</span> = <span class="number">4096</span></span><br><span class="line"><span class="attr">collation-server</span> = utf8_general_ci</span><br><span class="line"><span class="attr">character-set-server</span> = utf8</span><br><span class="line"><span class="attr">init-connect</span> = <span class="string">'SET NAMES utf8'</span></span><br></pre></td></tr></table></figure>
<h3 id="3-重启-MariaDB-数据库并设置为开机自启"><a href="#3-重启-MariaDB-数据库并设置为开机自启" class="headerlink" title="3. 重启 MariaDB 数据库并设置为开机自启"></a>3. 重启 MariaDB 数据库并设置为开机自启</h3><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]<span class="comment"># systemctl restart mariadb</span></span><br><span class="line">[root@openstack ~]<span class="comment"># systemctl enable mariadb</span></span><br><span class="line">Created symlink from /etc/systemd/system/multi-user.target.wants/mariadb.service to /usr/<span class="class"><span class="keyword">lib</span>/<span class="title">systemd</span>/<span class="title">system</span>/<span class="title">mariadb</span>.<span class="title">service</span>.</span></span><br></pre></td></tr></table></figure>
<h3 id="4-初始化-MariaDB-数据库后再次重新启动"><a href="#4-初始化-MariaDB-数据库后再次重新启动" class="headerlink" title="4. 初始化 MariaDB 数据库后再次重新启动"></a>4. 初始化 MariaDB 数据库后再次重新启动</h3><p>默认密码为空, 生产环境请用 openssl rand -hex 10 命令生成强密码<br><figure class="highlight vbnet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]<span class="meta"># mysql_secure_installation </span></span><br><span class="line"></span><br><span class="line">NOTE: RUNNING ALL PARTS <span class="keyword">OF</span> THIS SCRIPT <span class="keyword">IS</span> RECOMMENDED <span class="keyword">FOR</span> ALL MariaDB</span><br><span class="line">      SERVERS <span class="keyword">IN</span> PRODUCTION USE!  PLEASE READ <span class="keyword">EACH</span> <span class="keyword">STEP</span> CAREFULLY!</span><br><span class="line"></span><br><span class="line"><span class="keyword">In</span> <span class="keyword">order</span> <span class="keyword">to</span> log <span class="keyword">into</span> MariaDB <span class="keyword">to</span> secure it, we<span class="comment">'ll need the current</span></span><br><span class="line">password <span class="keyword">for</span> the root user.  <span class="keyword">If</span> you<span class="comment">'ve just installed MariaDB, and</span></span><br><span class="line">you haven<span class="comment">'t set the root password yet, the password will be blank,</span></span><br><span class="line">so you should just press enter here.</span><br><span class="line"></span><br><span class="line">Enter current password <span class="keyword">for</span> root (enter <span class="keyword">for</span> none): </span><br><span class="line">OK, successfully used password, moving <span class="keyword">on</span>...</span><br><span class="line"></span><br><span class="line">Setting the root password ensures that nobody can log <span class="keyword">into</span> the MariaDB</span><br><span class="line">root user without the proper authorisation.</span><br><span class="line"></span><br><span class="line"><span class="keyword">Set</span> root password? [Y/n] Y</span><br><span class="line"><span class="keyword">New</span> password: </span><br><span class="line">Re-enter <span class="keyword">new</span> password: </span><br><span class="line">Password updated successfully!</span><br><span class="line">Reloading privilege tables..</span><br><span class="line"> ... Success!</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">By</span> <span class="keyword">default</span>, a MariaDB installation has an anonymous user, allowing anyone</span><br><span class="line"><span class="keyword">to</span> log <span class="keyword">into</span> MariaDB without having <span class="keyword">to</span> have a user account created <span class="keyword">for</span></span><br><span class="line">them.  This <span class="keyword">is</span> intended only <span class="keyword">for</span> testing, <span class="keyword">and</span> <span class="keyword">to</span> make the installation</span><br><span class="line">go a bit smoother.  You should remove them before moving <span class="keyword">into</span> a</span><br><span class="line">production environment.</span><br><span class="line"></span><br><span class="line">Remove anonymous users? [Y/n] Y</span><br><span class="line"> ... Success!</span><br><span class="line"></span><br><span class="line">Normally, root should only be allowed <span class="keyword">to</span> connect <span class="keyword">from</span> <span class="comment">'localhost'.  This</span></span><br><span class="line">ensures that someone cannot guess at the root password <span class="keyword">from</span> the network.</span><br><span class="line"></span><br><span class="line">Disallow root login remotely? [Y/n] Y</span><br><span class="line"> ... Success!</span><br><span class="line"></span><br><span class="line"><span class="keyword">By</span> <span class="keyword">default</span>, MariaDB comes <span class="keyword">with</span> a database named <span class="comment">'test' that anyone can</span></span><br><span class="line">access.  This <span class="keyword">is</span> also intended only <span class="keyword">for</span> testing, <span class="keyword">and</span> should be removed</span><br><span class="line">before moving <span class="keyword">into</span> a production environment.</span><br><span class="line"></span><br><span class="line">Remove test database <span class="keyword">and</span> access <span class="keyword">to</span> it? [Y/n] Y</span><br><span class="line"> - Dropping test database...</span><br><span class="line"> ... Success!</span><br><span class="line"> - Removing privileges <span class="keyword">on</span> test database...</span><br><span class="line"> ... Success!</span><br><span class="line"></span><br><span class="line">Reloading the privilege tables will ensure that all changes made so far</span><br><span class="line">will <span class="keyword">take</span> effect immediately.</span><br><span class="line"></span><br><span class="line">Reload privilege tables now? [Y/n] Y</span><br><span class="line"> ... Success!</span><br><span class="line"></span><br><span class="line">Cleaning up...</span><br><span class="line"></span><br><span class="line">All done!  <span class="keyword">If</span> you<span class="comment">'ve completed all of the above steps, your MariaDB</span></span><br><span class="line">installation should now be secure.</span><br><span class="line"></span><br><span class="line">Thanks <span class="keyword">for</span> <span class="keyword">using</span> MariaDB!</span><br><span class="line">[root@openstack ~]<span class="meta"># systemctl restart mariadb</span></span><br></pre></td></tr></table></figure></p>
<h3 id="5-测试-MariaDB-数据库"><a href="#5-测试-MariaDB-数据库" class="headerlink" title="5. 测试 MariaDB 数据库"></a>5. 测试 MariaDB 数据库</h3><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# mysql -p123456</span><br><span class="line">Welcome to the MariaDB monitor.  Commands end with ; or \g.</span><br><span class="line">...</span><br><span class="line">...</span><br><span class="line">MariaDB [(none)]&gt; flush privileges;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; select user,host from mysql.user;</span><br><span class="line"><span class="code">+------+</span>-----------+</span><br><span class="line">| user | host      |</span><br><span class="line"><span class="code">+------+</span>-----------+</span><br><span class="line">| root | 127.0.0.1 |</span><br><span class="line">| root | ::1       |</span><br><span class="line">| root | localhost |</span><br><span class="line"><span class="code">+------+</span>-----------+</span><br><span class="line">3 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; exit</span><br><span class="line">Bye</span><br></pre></td></tr></table></figure>
<h2 id="五、安装并配置-RabbitMQ-消息队列服务"><a href="#五、安装并配置-RabbitMQ-消息队列服务" class="headerlink" title="五、安装并配置 RabbitMQ 消息队列服务"></a>五、安装并配置 RabbitMQ 消息队列服务</h2><h3 id="只需在-Controller-节点安装-1"><a href="#只需在-Controller-节点安装-1" class="headerlink" title="(!!!只需在 Controller 节点安装!!!)"></a><strong><em>(!!!只需在 Controller 节点安装!!!)</em></strong></h3><h3 id="1-安装-RabbitMQ-相关软件包"><a href="#1-安装-RabbitMQ-相关软件包" class="headerlink" title="1. 安装 RabbitMQ 相关软件包"></a>1. 安装 RabbitMQ 相关软件包</h3><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@openstack</span> ~]<span class="meta"># yum install -y rabbitmq-server</span></span><br><span class="line">...</span><br><span class="line">Complete!</span><br></pre></td></tr></table></figure>
<h3 id="2-启动-RabbitMQ-服务并设置为开机自启"><a href="#2-启动-RabbitMQ-服务并设置为开机自启" class="headerlink" title="2. 启动 RabbitMQ 服务并设置为开机自启"></a>2. 启动 RabbitMQ 服务并设置为开机自启</h3><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]<span class="comment"># systemctl start rabbitmq-server</span></span><br><span class="line">[root@openstack ~]<span class="comment"># systemctl enable rabbitmq-server</span></span><br><span class="line">Created symlink from /etc/systemd/system/multi-user.target.wants/rabbitmq-server.service to /usr/<span class="class"><span class="keyword">lib</span>/<span class="title">systemd</span>/<span class="title">system</span>/<span class="title">rabbitmq</span>-<span class="title">server</span>.<span class="title">service</span>.</span></span><br></pre></td></tr></table></figure>
<h3 id="3-创建-RabbitMQ-服务的-Openstack-账号及分配权限"><a href="#3-创建-RabbitMQ-服务的-Openstack-账号及分配权限" class="headerlink" title="3. 创建 RabbitMQ 服务的 Openstack 账号及分配权限"></a>3. 创建 RabbitMQ 服务的 Openstack 账号及分配权限</h3><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# rabbitmqctl add_user openstack 123456</span><br><span class="line">Creating<span class="built_in"> user </span><span class="string">"openstack"</span> <span class="built_in">..</span>.</span><br><span class="line">[root@openstack ~]# rabbitmqctl set_permissions openstack <span class="string">".*"</span> <span class="string">".*"</span> <span class="string">".*"</span></span><br><span class="line">Setting permissions <span class="keyword">for</span><span class="built_in"> user </span><span class="string">"openstack"</span> <span class="keyword">in</span> vhost <span class="string">"/"</span> <span class="built_in">..</span>.</span><br></pre></td></tr></table></figure>
<h2 id="六、安装并配置-Memcached-缓存服务"><a href="#六、安装并配置-Memcached-缓存服务" class="headerlink" title="六、安装并配置 Memcached 缓存服务"></a>六、安装并配置 Memcached 缓存服务</h2><h3 id="只需在-Controller-节点安装-2"><a href="#只需在-Controller-节点安装-2" class="headerlink" title="(!!!只需在 Controller 节点安装!!!)"></a><strong><em>(!!!只需在 Controller 节点安装!!!)</em></strong></h3><h3 id="1-安装-Memcached-相关软件包"><a href="#1-安装-Memcached-相关软件包" class="headerlink" title="1. 安装 Memcached 相关软件包"></a>1. 安装 Memcached 相关软件包</h3><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@openstack</span> ~]<span class="meta"># yum install -y memcached python-memcached</span></span><br><span class="line">...</span><br><span class="line">Complete!</span><br></pre></td></tr></table></figure>
<h3 id="2-启动-Memcached-服务并设置为开机自启"><a href="#2-启动-Memcached-服务并设置为开机自启" class="headerlink" title="2. 启动 Memcached 服务并设置为开机自启"></a>2. 启动 Memcached 服务并设置为开机自启</h3><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]<span class="comment"># systemctl start memcached</span></span><br><span class="line">[root@openstack ~]<span class="comment"># systemctl enable memcached</span></span><br><span class="line">Created symlink from /etc/systemd/system/multi-user.target.wants/memcached.service to /usr/<span class="class"><span class="keyword">lib</span>/<span class="title">systemd</span>/<span class="title">system</span>/<span class="title">memcached</span>.<span class="title">service</span>.</span></span><br></pre></td></tr></table></figure>
<h2 id="七、安装并配置-Etcd-系统发现服务"><a href="#七、安装并配置-Etcd-系统发现服务" class="headerlink" title="七、安装并配置 Etcd 系统发现服务"></a>七、安装并配置 Etcd 系统发现服务</h2><h3 id="只需在-Controller-节点安装-3"><a href="#只需在-Controller-节点安装-3" class="headerlink" title="(!!!只需在 Controller 节点安装!!!)"></a><strong><em>(!!!只需在 Controller 节点安装!!!)</em></strong></h3><h3 id="1-安装-Etcd-相关软件包"><a href="#1-安装-Etcd-相关软件包" class="headerlink" title="1. 安装 Etcd 相关软件包"></a>1. 安装 Etcd 相关软件包</h3><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@openstack</span> ~]<span class="meta"># yum install -y etcd</span></span><br><span class="line">...</span><br><span class="line">Complete!</span><br></pre></td></tr></table></figure>
<h3 id="2-修改-Etcd-的配置文件"><a href="#2-修改-Etcd-的配置文件" class="headerlink" title="2. 修改 Etcd 的配置文件"></a>2. 修改 Etcd 的配置文件</h3><p><strong><em>不能用 controller 取代 192.168.10.11, 无法解析</em></strong><br><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># vim /etc/etcd/etcd.conf</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># cat /etc/etcd/etcd.conf </span></span><br><span class="line"><span class="comment">#[Member]</span></span><br><span class="line"><span class="attr">ETCD_DATA_DIR</span>=<span class="string">"/var/lib/etcd/default.etcd"</span></span><br><span class="line"><span class="attr">ETCD_LISTEN_PEER_URLS</span>=<span class="string">"http://192.168.10.11:2380"</span></span><br><span class="line"><span class="attr">ETCD_LISTEN_CLIENT_URLS</span>=<span class="string">"http://192.168.10.11:2379"</span></span><br><span class="line"><span class="attr">ETCD_NAME</span>=<span class="string">"controller"</span></span><br><span class="line"><span class="comment">#[Clustering]</span></span><br><span class="line"><span class="attr">ETCD_INITIAL_ADVERTISE_PEER_URLS</span>=<span class="string">"http://192.168.10.11:2380"</span></span><br><span class="line"><span class="attr">ETCD_ADVERTISE_CLIENT_URLS</span>=<span class="string">"http://192.168.10.11:2379"</span></span><br><span class="line"><span class="attr">ETCD_INITIAL_CLUSTER</span>=<span class="string">"controller=http://192.168.10.11:2380"</span></span><br><span class="line"><span class="attr">ETCD_INITIAL_CLUSTER_TOKEN</span>=<span class="string">"etcd-cluster-01"</span></span><br><span class="line"><span class="attr">ETCD_INITIAL_CLUSTER_STATE</span>=<span class="string">"new"</span></span><br></pre></td></tr></table></figure></p>
<h3 id="3-启动-Etcd-服务并设置为开机自启"><a href="#3-启动-Etcd-服务并设置为开机自启" class="headerlink" title="3. 启动 Etcd 服务并设置为开机自启"></a>3. 启动 Etcd 服务并设置为开机自启</h3><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]<span class="comment"># systemctl start etcd</span></span><br><span class="line">[root@openstack ~]<span class="comment"># systemctl enable etcd</span></span><br><span class="line">Created symlink from /etc/systemd/system/multi-user.target.wants/etcd.service to /usr/<span class="class"><span class="keyword">lib</span>/<span class="title">systemd</span>/<span class="title">system</span>/<span class="title">etcd</span>.<span class="title">service</span>.</span></span><br></pre></td></tr></table></figure>
<p><strong><em>建议安装至此时, 为 controller 节点再次拍摄一个快照, 以备不时之需</em></strong></p>
<h2 id="八、安装并配置-KeyStone-认证服务"><a href="#八、安装并配置-KeyStone-认证服务" class="headerlink" title="八、安装并配置 KeyStone 认证服务"></a>八、安装并配置 KeyStone 认证服务</h2><h3 id="只需在-Controller-节点安装-4"><a href="#只需在-Controller-节点安装-4" class="headerlink" title="(!!!只需在 Controller 节点安装!!!)"></a><strong><em>(!!!只需在 Controller 节点安装!!!)</em></strong></h3><h3 id="1-创建-keystone-数据库"><a href="#1-创建-keystone-数据库" class="headerlink" title="1. 创建 keystone 数据库"></a>1. 创建 keystone 数据库</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">DATABASE</span> keystone;</span><br><span class="line"><span class="keyword">GRANT</span> ALL <span class="keyword">PRIVILEGES</span> <span class="keyword">ON</span> keystone.* <span class="keyword">TO</span> <span class="string">'keystone'</span>@<span class="string">'localhost'</span> <span class="keyword">IDENTIFIED</span> <span class="keyword">BY</span> <span class="string">'123456'</span>;</span><br><span class="line"><span class="keyword">GRANT</span> ALL <span class="keyword">PRIVILEGES</span> <span class="keyword">ON</span> keystone.* <span class="keyword">TO</span> <span class="string">'keystone'</span>@<span class="string">'%'</span> <span class="keyword">IDENTIFIED</span> <span class="keyword">BY</span> <span class="string">'123456'</span>;</span><br><span class="line"><span class="keyword">flush</span> <span class="keyword">privileges</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# mysql -p123456</span><br><span class="line">Welcome <span class="keyword">to</span> the MariaDB monitor.  Commands <span class="keyword">end</span> <span class="keyword">with</span> ; <span class="keyword">or</span> \g.</span><br><span class="line">...</span><br><span class="line">...</span><br><span class="line">MariaDB [(none)]&gt; <span class="keyword">CREATE</span> DATABASE keystone;</span><br><span class="line">Query OK, <span class="number">1</span> row affected (<span class="number">0.01</span> sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; GRANT ALL PRIVILEGES <span class="keyword">ON</span> keystone.* <span class="keyword">TO</span> <span class="string">'keystone'</span>@<span class="string">'localhost'</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">'123456'</span>;</span><br><span class="line">Query OK, <span class="number">0</span> rows affected (<span class="number">0.01</span> sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; GRANT ALL PRIVILEGES <span class="keyword">ON</span> keystone.* <span class="keyword">TO</span> <span class="string">'keystone'</span>@<span class="string">'%'</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">'123456'</span>;</span><br><span class="line">Query OK, <span class="number">0</span> rows affected (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; flush privileges;</span><br><span class="line">Query OK, <span class="number">0</span> rows affected (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; <span class="keyword">exit</span></span><br><span class="line">Bye</span><br></pre></td></tr></table></figure>
<h3 id="2-安装-KeyStone-相关软件包"><a href="#2-安装-KeyStone-相关软件包" class="headerlink" title="2. 安装 KeyStone 相关软件包"></a>2. 安装 KeyStone 相关软件包</h3><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@openstack</span> ~]<span class="meta"># yum install -y openstack-keystone httpd mod_wsgi python-keystoneclient openstack-utils</span></span><br><span class="line">...</span><br><span class="line">Complete!</span><br></pre></td></tr></table></figure>
<h3 id="3-使用-openstack-utils-快速配置-KeyStone"><a href="#3-使用-openstack-utils-快速配置-KeyStone" class="headerlink" title="3. 使用 openstack-utils 快速配置 KeyStone"></a>3. 使用 openstack-utils 快速配置 KeyStone</h3><p><strong><em>必须确认配置是否正确</em></strong><br><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/keystone/keystone.conf database connection " mysql+pymysql://keystone:123456@controller/keystone"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/keystone/keystone.conf token provider fernet</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># grep '^[a-z]' /etc/keystone/keystone.conf</span></span><br><span class="line"><span class="attr">connection</span> = mysql+pymysql://keystone:<span class="number">123456</span>@controller/keystone</span><br><span class="line"><span class="attr">provider</span> = fernet</span><br></pre></td></tr></table></figure></p>
<h3 id="4-初始化-keystone-数据库"><a href="#4-初始化-keystone-数据库" class="headerlink" title="4. 初始化 keystone 数据库"></a>4. 初始化 keystone 数据库</h3><p><strong><em>必须确认数据库是否初始化正确</em></strong><br><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="meta">@openstack</span> ~]<span class="comment"># su -s /bin/sh -c "keystone-manage db_sync" keystone</span></span><br><span class="line">[root<span class="meta">@openstack</span> ~]<span class="comment"># mysql -ukeystone -p123456 -e "use keystone;show tables;" | wc -l</span></span><br><span class="line">45</span><br><span class="line">[root<span class="meta">@openstack</span> ~]<span class="comment"># mysql -ukeystone -p123456 -e "use keystone;show tables;"</span></span><br><span class="line">+-----------------------------+</span><br><span class="line">|<span class="string"> Tables_in_keystone          </span>|</span><br><span class="line">+-----------------------------+</span><br><span class="line">|<span class="string"> access_token                </span>|</span><br><span class="line">|<span class="string"> application_credential      </span>|</span><br><span class="line">|<span class="string"> application_credential_role </span>|</span><br><span class="line">|<span class="string"> assignment                  </span>|</span><br><span class="line">|<span class="string"> config_register             </span>|</span><br><span class="line">|<span class="string"> consumer                    </span>|</span><br><span class="line">|<span class="string"> credential                  </span>|</span><br><span class="line">|<span class="string"> endpoint                    </span>|</span><br><span class="line">|<span class="string"> endpoint_group              </span>|</span><br><span class="line">|<span class="string"> federated_user              </span>|</span><br><span class="line">|<span class="string"> federation_protocol         </span>|</span><br><span class="line">|<span class="string"> group                       </span>|</span><br><span class="line">|<span class="string"> id_mapping                  </span>|</span><br><span class="line">|<span class="string"> identity_provider           </span>|</span><br><span class="line">|<span class="string"> idp_remote_ids              </span>|</span><br><span class="line">|<span class="string"> implied_role                </span>|</span><br><span class="line">|<span class="string"> limit                       </span>|</span><br><span class="line">|<span class="string"> local_user                  </span>|</span><br><span class="line">|<span class="string"> mapping                     </span>|</span><br><span class="line">|<span class="string"> migrate_version             </span>|</span><br><span class="line">|<span class="string"> nonlocal_user               </span>|</span><br><span class="line">|<span class="string"> password                    </span>|</span><br><span class="line">|<span class="string"> policy                      </span>|</span><br><span class="line">|<span class="string"> policy_association          </span>|</span><br><span class="line">|<span class="string"> project                     </span>|</span><br><span class="line">|<span class="string"> project_endpoint            </span>|</span><br><span class="line">|<span class="string"> project_endpoint_group      </span>|</span><br><span class="line">|<span class="string"> project_tag                 </span>|</span><br><span class="line">|<span class="string"> region                      </span>|</span><br><span class="line">|<span class="string"> registered_limit            </span>|</span><br><span class="line">|<span class="string"> request_token               </span>|</span><br><span class="line">|<span class="string"> revocation_event            </span>|</span><br><span class="line">|<span class="string"> role                        </span>|</span><br><span class="line">|<span class="string"> sensitive_config            </span>|</span><br><span class="line">|<span class="string"> service                     </span>|</span><br><span class="line">|<span class="string"> service_provider            </span>|</span><br><span class="line">|<span class="string"> system_assignment           </span>|</span><br><span class="line">|<span class="string"> token                       </span>|</span><br><span class="line">|<span class="string"> trust                       </span>|</span><br><span class="line">|<span class="string"> trust_role                  </span>|</span><br><span class="line">|<span class="string"> user                        </span>|</span><br><span class="line">|<span class="string"> user_group_membership       </span>|</span><br><span class="line">|<span class="string"> user_option                 </span>|</span><br><span class="line">|<span class="string"> whitelisted_config          </span>|</span><br><span class="line">+-----------------------------+</span><br></pre></td></tr></table></figure></p>
<h3 id="5-初始化-Fernet-令牌库"><a href="#5-初始化-Fernet-令牌库" class="headerlink" title="5. 初始化 Fernet 令牌库"></a>5. 初始化 Fernet 令牌库</h3><p>以下命令无输出<br><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@openstack</span> ~]<span class="meta"># keystone-manage fernet_setup --keystone-user keystone --keystone-group keystone</span></span><br><span class="line">[root<span class="symbol">@openstack</span> ~]<span class="meta"># keystone-manage credential_setup --keystone-user keystone --keystone-group keystone</span></span><br></pre></td></tr></table></figure></p>
<h3 id="6-修改-Apache-Httpd-的主配置文件"><a href="#6-修改-Apache-Httpd-的主配置文件" class="headerlink" title="6. 修改 Apache (Httpd) 的主配置文件"></a>6. 修改 Apache (Httpd) 的主配置文件</h3><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# sed  -i  <span class="string">"s/#ServerName www.example.com:80/ServerName controller/"</span> /etc/httpd/<span class="keyword">conf</span>/httpd.<span class="keyword">conf</span></span><br><span class="line">[root@openstack ~]# <span class="keyword">grep</span> ServerName /etc/httpd/<span class="keyword">conf</span>/httpd.<span class="keyword">conf</span> </span><br><span class="line"># ServerName gives the name <span class="built_in">and</span> port that the server uses <span class="keyword">to</span> identify itself.</span><br><span class="line">ServerName controller</span><br></pre></td></tr></table></figure>
<h3 id="7-修改-Apache-Httpd-的虚拟主机配置文件"><a href="#7-修改-Apache-Httpd-的虚拟主机配置文件" class="headerlink" title="7. 修改 Apache (Httpd) 的虚拟主机配置文件"></a>7. 修改 Apache (Httpd) 的虚拟主机配置文件</h3><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]<span class="meta"># ln -s /usr/share/keystone/wsgi-keystone.conf /etc/httpd/conf.d/</span></span><br><span class="line">[root@openstack ~]<span class="meta"># cat /etc/httpd/conf.d/wsgi-keystone.conf </span></span><br><span class="line">Listen <span class="number">5000</span></span><br><span class="line"></span><br><span class="line"><span class="params">&lt;VirtualHost *:<span class="number">5000</span>&gt;</span></span><br><span class="line">    WSGIDaemonProcess keystone-public processes=<span class="number">5</span> threads=<span class="number">1</span> user=keystone group=keystone display-name=%&#123;GROUP&#125;</span><br><span class="line">    WSGIProcessGroup keystone-public</span><br><span class="line">    WSGIScriptAlias / <span class="meta-keyword">/usr/</span>bin/keystone-wsgi-public</span><br><span class="line">    WSGIApplicationGroup %&#123;GLOBAL&#125;</span><br><span class="line">    WSGIPassAuthorization On</span><br><span class="line">    LimitRequestBody <span class="number">114688</span></span><br><span class="line">    <span class="params">&lt;IfVersion &gt;</span>= <span class="number">2.4</span>&gt;</span><br><span class="line">      ErrorLogFormat <span class="string">"%&#123;cu&#125;t %M"</span></span><br><span class="line">    <span class="params">&lt;/IfVersion&gt;</span></span><br><span class="line">    ErrorLog <span class="meta-keyword">/var/</span>log<span class="meta-keyword">/httpd/</span>keystone.log</span><br><span class="line">    CustomLog <span class="meta-keyword">/var/</span>log<span class="meta-keyword">/httpd/</span>keystone_access.log combined</span><br><span class="line"></span><br><span class="line">    <span class="params">&lt;Directory /usr/bin&gt;</span></span><br><span class="line">        <span class="params">&lt;IfVersion &gt;</span>= <span class="number">2.4</span>&gt;</span><br><span class="line">            Require all granted</span><br><span class="line">        <span class="params">&lt;/IfVersion&gt;</span></span><br><span class="line">        <span class="params">&lt;IfVersion &lt; <span class="number">2.4</span>&gt;</span></span><br><span class="line">            Order allow,deny</span><br><span class="line">            Allow from all</span><br><span class="line">        <span class="params">&lt;/IfVersion&gt;</span></span><br><span class="line">    <span class="params">&lt;/Directory&gt;</span></span><br><span class="line"><span class="params">&lt;/VirtualHost&gt;</span></span><br><span class="line"></span><br><span class="line">Alias /identity <span class="meta-keyword">/usr/</span>bin/keystone-wsgi-public</span><br><span class="line"><span class="params">&lt;Location /identity&gt;</span></span><br><span class="line">    SetHandler wsgi-script</span><br><span class="line">    Options +ExecCGI</span><br><span class="line"></span><br><span class="line">    WSGIProcessGroup keystone-public</span><br><span class="line">    WSGIApplicationGroup %&#123;GLOBAL&#125;</span><br><span class="line">    WSGIPassAuthorization On</span><br><span class="line"><span class="params">&lt;/Location&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="8-启动-Apache-Httpd-服务并设置为开机自启"><a href="#8-启动-Apache-Httpd-服务并设置为开机自启" class="headerlink" title="8. 启动 Apache (Httpd) 服务并设置为开机自启"></a>8. 启动 Apache (Httpd) 服务并设置为开机自启</h3><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]<span class="comment"># systemctl start httpd</span></span><br><span class="line">[root@openstack ~]<span class="comment"># systemctl enable httpd</span></span><br><span class="line">Created symlink from /etc/systemd/system/multi-user.target.wants/httpd.service to /usr/<span class="class"><span class="keyword">lib</span>/<span class="title">systemd</span>/<span class="title">system</span>/<span class="title">httpd</span>.<span class="title">service</span>.</span></span><br></pre></td></tr></table></figure>
<h3 id="9-初始化-KeyStone-认证服务"><a href="#9-初始化-KeyStone-认证服务" class="headerlink" title="9. 初始化 KeyStone 认证服务"></a>9. 初始化 KeyStone 认证服务</h3><p>以下命令无输出<br><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">keystone</span>-manage <span class="keyword">bootstrap </span>--<span class="keyword">bootstrap-password </span><span class="number">123456</span> --<span class="keyword">bootstrap-admin-url </span><span class="string">"http://controller:5000/v3/"</span> --<span class="keyword">bootstrap-internal-url </span><span class="string">"http://controller:5000/v3/"</span> --<span class="keyword">bootstrap-public-url </span><span class="string">"http://controller:5000/v3/"</span> --<span class="keyword">bootstrap-region-id </span>RegionOne</span><br></pre></td></tr></table></figure></p>
<h3 id="10-配置临时管理员账户的相关环境变量"><a href="#10-配置临时管理员账户的相关环境变量" class="headerlink" title="10. 配置临时管理员账户的相关环境变量"></a>10. 配置临时管理员账户的相关环境变量</h3><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# <span class="builtin-name">export</span> <span class="attribute">OS_PROJECT_DOMAIN_NAME</span>=Default</span><br><span class="line">[root@openstack ~]# <span class="builtin-name">export</span> <span class="attribute">OS_PROJECT_NAME</span>=admin</span><br><span class="line">[root@openstack ~]# <span class="builtin-name">export</span> <span class="attribute">OS_USER_DOMAIN_NAME</span>=Default</span><br><span class="line">[root@openstack ~]# <span class="builtin-name">export</span> <span class="attribute">OS_USERNAME</span>=admin</span><br><span class="line">[root@openstack ~]# <span class="builtin-name">export</span> <span class="attribute">OS_PASSWORD</span>=123456</span><br><span class="line">[root@openstack ~]# <span class="builtin-name">export</span> <span class="attribute">OS_AUTH_URL</span>=http://controller:5000/v3</span><br><span class="line">[root@openstack ~]# <span class="builtin-name">export</span> <span class="attribute">OS_IDENTITY_API_VERSION</span>=3</span><br><span class="line">[root@openstack ~]# env | grep OS_</span><br><span class="line"><span class="attribute">OS_USER_DOMAIN_NAME</span>=Default</span><br><span class="line"><span class="attribute">OS_PROJECT_NAME</span>=admin</span><br><span class="line"><span class="attribute">OS_IDENTITY_API_VERSION</span>=3</span><br><span class="line"><span class="attribute">OS_PASSWORD</span>=123456</span><br><span class="line"><span class="attribute">OS_AUTH_URL</span>=http://controller:5000/v3</span><br><span class="line"><span class="attribute">OS_USERNAME</span>=admin</span><br><span class="line"><span class="attribute">OS_PROJECT_DOMAIN_NAME</span>=Default</span><br></pre></td></tr></table></figure>
<h3 id="11-查看-KeyStone-相关实例信息"><a href="#11-查看-KeyStone-相关实例信息" class="headerlink" title="11. 查看 KeyStone 相关实例信息"></a>11. 查看 KeyStone 相关实例信息</h3><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# openstack endpoint list</span><br><span class="line"><span class="code">+----------------------------------+</span>-----------<span class="code">+--------------+</span>--------------<span class="code">+---------+</span>-----------<span class="code">+----------------------------+</span></span><br><span class="line">| ID                               | Region    | Service Name | Service Type | Enabled | Interface | URL                        |</span><br><span class="line"><span class="code">+----------------------------------+</span>-----------<span class="code">+--------------+</span>--------------<span class="code">+---------+</span>-----------<span class="code">+----------------------------+</span></span><br><span class="line">| 498db99146dc43d982449b1c7c6ac16b | RegionOne | keystone     | identity     | True    | public    | http://controller:5000/v3/ |</span><br><span class="line">| 61af677340904813b4a5244da0a036ca | RegionOne | keystone     | identity     | True    | admin     | http://controller:5000/v3/ |</span><br><span class="line">| 9c6d59dfc5cc4f6c8dd55eb1c944e17c | RegionOne | keystone     | identity     | True    | internal  | http://controller:5000/v3/ |</span><br><span class="line"><span class="code">+----------------------------------+</span>-----------<span class="code">+--------------+</span>--------------<span class="code">+---------+</span>-----------<span class="code">+----------------------------+</span></span><br><span class="line">[root@openstack ~]# openstack project list</span><br><span class="line"><span class="code">+----------------------------------+</span>-------+</span><br><span class="line">| ID                               | Name  |</span><br><span class="line"><span class="code">+----------------------------------+</span>-------+</span><br><span class="line">| 81ed22594f0d4148809e9c0e62e039a5 | admin |</span><br><span class="line"><span class="code">+----------------------------------+</span>-------+</span><br><span class="line">[root@openstack ~]# openstack user list</span><br><span class="line"><span class="code">+----------------------------------+</span>-------+</span><br><span class="line">| ID                               | Name  |</span><br><span class="line"><span class="code">+----------------------------------+</span>-------+</span><br><span class="line">| 84e7e67f49ff4d13a7b7334134a13db2 | admin |</span><br><span class="line"><span class="code">+----------------------------------+</span>-------+</span><br></pre></td></tr></table></figure>
<h3 id="12-创建-KeyStone-认证服务实例"><a href="#12-创建-KeyStone-认证服务实例" class="headerlink" title="12. 创建 KeyStone 认证服务实例"></a>12. 创建 KeyStone 认证服务实例</h3><h4 id="a-创建一个名为-example-的-KeyStone-域"><a href="#a-创建一个名为-example-的-KeyStone-域" class="headerlink" title="a) 创建一个名为 example 的 KeyStone 域"></a>a) 创建一个名为 example 的 KeyStone 域</h4><p>KeyStone 的默认域为 default<br><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="meta">@openstack</span> ~]<span class="comment"># openstack domain create --description "An Example Domain" example</span></span><br><span class="line">+-------------+----------------------------------+</span><br><span class="line">|<span class="string"> Field       </span>|<span class="string"> Value                            </span>|</span><br><span class="line">+-------------+----------------------------------+</span><br><span class="line">|<span class="string"> description </span>|<span class="string"> An Example Domain                </span>|</span><br><span class="line">|<span class="string"> enabled     </span>|<span class="string"> True                             </span>|</span><br><span class="line">|<span class="string"> id          </span>|<span class="string"> b10c71f8aebc42358be56b9783a5192d </span>|</span><br><span class="line">|<span class="string"> name        </span>|<span class="string"> example                          </span>|</span><br><span class="line">|<span class="string"> tags        </span>|<span class="string"> []                               </span>|</span><br><span class="line">+-------------+----------------------------------+</span><br></pre></td></tr></table></figure></p>
<h4 id="b-创建一个名为-service-的-KeyStone-项目"><a href="#b-创建一个名为-service-的-KeyStone-项目" class="headerlink" title="b) 创建一个名为 service 的 KeyStone 项目"></a>b) 创建一个名为 service 的 KeyStone 项目</h4><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# openstack project create --domain<span class="built_in"> default </span>--description <span class="string">"Service Project"</span> service</span><br><span class="line">+-------------+----------------------------------+</span><br><span class="line">| Field       | Value                            |</span><br><span class="line">+-------------+----------------------------------+</span><br><span class="line">| description |<span class="built_in"> Service </span>Project                  |</span><br><span class="line">| domain_id   |<span class="built_in"> default </span>                         |</span><br><span class="line">| enabled     | <span class="literal">True</span>                             |</span><br><span class="line">| id          | c86eb3690d2442958aa8d3af93494969 |</span><br><span class="line">| is_domain   | <span class="literal">False</span>                            |</span><br><span class="line">| name        |<span class="built_in"> service </span>                         |</span><br><span class="line">| parent_id   |<span class="built_in"> default </span>                         |</span><br><span class="line">| tags        | []                               |</span><br><span class="line">+-------------+----------------------------------+</span><br></pre></td></tr></table></figure>
<h4 id="c-创建一个名为-myproject-的-KeyStone-项目"><a href="#c-创建一个名为-myproject-的-KeyStone-项目" class="headerlink" title="c) 创建一个名为 myproject 的 KeyStone 项目"></a>c) 创建一个名为 myproject 的 KeyStone 项目</h4><p>常规（非管理员）任务应使用非特权项目和用户<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# openstack project create --domain<span class="built_in"> default </span>--description <span class="string">"Demo Project"</span> myproject</span><br><span class="line">+-------------+----------------------------------+</span><br><span class="line">| Field       | Value                            |</span><br><span class="line">+-------------+----------------------------------+</span><br><span class="line">| description | Demo Project                     |</span><br><span class="line">| domain_id   |<span class="built_in"> default </span>                         |</span><br><span class="line">| enabled     | <span class="literal">True</span>                             |</span><br><span class="line">| id          | fa610dc748fd4bbf9b6a75461a1bc81b |</span><br><span class="line">| is_domain   | <span class="literal">False</span>                            |</span><br><span class="line">| name        | myproject                        |</span><br><span class="line">| parent_id   |<span class="built_in"> default </span>                         |</span><br><span class="line">| tags        | []                               |</span><br><span class="line">+-------------+----------------------------------+</span><br></pre></td></tr></table></figure></p>
<h4 id="d-创建一个名为-myuser-的-KeyStone-用户"><a href="#d-创建一个名为-myuser-的-KeyStone-用户" class="headerlink" title="d) 创建一个名为 myuser 的 KeyStone 用户"></a>d) 创建一个名为 myuser 的 KeyStone 用户</h4><p>常规（非管理员）任务应使用非特权项目和用户<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# openstack<span class="built_in"> user </span>create --domain<span class="built_in"> default </span> <span class="attribute">--password</span>=123456 myuser</span><br><span class="line">+---------------------+----------------------------------+</span><br><span class="line">| Field               | Value                            |</span><br><span class="line">+---------------------+----------------------------------+</span><br><span class="line">| domain_id           |<span class="built_in"> default </span>                         |</span><br><span class="line">| enabled             | <span class="literal">True</span>                             |</span><br><span class="line">| id                  | a2750e3ab9144584962f1e28eaa496ee |</span><br><span class="line">| name                | myuser                           |</span><br><span class="line">| options             | &#123;&#125;                               |</span><br><span class="line">| password_expires_at | None                             |</span><br><span class="line">+---------------------+----------------------------------+</span><br></pre></td></tr></table></figure></p>
<h4 id="e-创建一个名为-myrole-的-KeyStone-角色"><a href="#e-创建一个名为-myrole-的-KeyStone-角色" class="headerlink" title="e) 创建一个名为 myrole 的 KeyStone 角色"></a>e) 创建一个名为 myrole 的 KeyStone 角色</h4><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="meta">@openstack</span> ~]<span class="comment"># openstack role create myrole</span></span><br><span class="line">+-----------+----------------------------------+</span><br><span class="line">|<span class="string"> Field     </span>|<span class="string"> Value                            </span>|</span><br><span class="line">+-----------+----------------------------------+</span><br><span class="line">|<span class="string"> domain_id </span>|<span class="string"> None                             </span>|</span><br><span class="line">|<span class="string"> id        </span>|<span class="string"> 9d7131e5c67d4809ba1684ed7df33e38 </span>|</span><br><span class="line">|<span class="string"> name      </span>|<span class="string"> myrole                           </span>|</span><br><span class="line">+-----------+----------------------------------+</span><br></pre></td></tr></table></figure>
<h4 id="f-将-myrole-角色添加到-myproject-项目和-myuser-用户"><a href="#f-将-myrole-角色添加到-myproject-项目和-myuser-用户" class="headerlink" title="f) 将 myrole 角色添加到 myproject 项目和 myuser 用户"></a>f) 将 myrole 角色添加到 myproject 项目和 myuser 用户</h4><p>以下命令无输出<br><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@openstack</span> ~]<span class="meta"># openstack role add --project myproject --user myuser myrole</span></span><br></pre></td></tr></table></figure></p>
<h3 id="13-测试-KeyStone-认证服务"><a href="#13-测试-KeyStone-认证服务" class="headerlink" title="13. 测试 KeyStone 认证服务"></a>13. 测试 KeyStone 认证服务</h3><h4 id="a-清除临时管理员账户的相关环境变量"><a href="#a-清除临时管理员账户的相关环境变量" class="headerlink" title="a) 清除临时管理员账户的相关环境变量"></a>a) 清除临时管理员账户的相关环境变量</h4><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># unset OS_AUTH_URL OS_PASSWORD</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># env |grep OS_</span></span><br><span class="line"><span class="attr">OS_USER_DOMAIN_NAME</span>=Default</span><br><span class="line"><span class="attr">OS_PROJECT_NAME</span>=admin</span><br><span class="line"><span class="attr">OS_IDENTITY_API_VERSION</span>=<span class="number">3</span></span><br><span class="line"><span class="attr">OS_USERNAME</span>=admin</span><br><span class="line"><span class="attr">OS_PROJECT_DOMAIN_NAME</span>=Default</span><br></pre></td></tr></table></figure>
<h4 id="b-作为-admin-用户-请求身份验证令牌"><a href="#b-作为-admin-用户-请求身份验证令牌" class="headerlink" title="b) 作为 admin 用户, 请求身份验证令牌"></a>b) 作为 admin 用户, 请求身份验证令牌</h4><p>admin 用户的密码为 123456<br><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# openstack --os-auth-url http://controller:5000/v3 --os-project-domain-name Default --os-user-domain-name Default --os-project-name admin --os-username admin token issue</span><br><span class="line">Password: </span><br><span class="line"><span class="code">+------------+</span>-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">| Field      | Value                                                                                                                                                                                   |</span><br><span class="line"><span class="code">+------------+</span>-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">| expires    | 2018-12-15T08:34:03+0000                                                                                                                                                                |</span><br><span class="line">| id         | gAAAAABcFK5ruuw-ptLoJosAYVVgzOLL5vyTc2DJnkXDD5ay9QqLvpiu94TM55iZfgliLaYDclguiNWIDM1UznDg0uj8IxIxqWkBwcmmldRjM0wC9U8rEI7FvjBDoP5R3Oieny3xnVwko5sZvBApOY3<span class="emphasis">_aQWXvSTh4Ou4Bf-6pZlMwNcre1UQ21c |</span></span><br><span class="line"><span class="emphasis">| project_</span>id | 81ed22594f0d4148809e9c0e62e039a5                                                                                                                                                        |</span><br><span class="line">| user<span class="emphasis">_id    | 84e7e67f49ff4d13a7b7334134a13db2                                                                                                                                                        |</span></span><br><span class="line"><span class="emphasis">+------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span></span><br></pre></td></tr></table></figure></p>
<h4 id="c-作为-myuser-用户-请求身份验证令牌"><a href="#c-作为-myuser-用户-请求身份验证令牌" class="headerlink" title="c) 作为 myuser 用户, 请求身份验证令牌"></a>c) 作为 myuser 用户, 请求身份验证令牌</h4><p>myuser 用户的密码为 123456<br><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# openstack --os-auth-url http://controller:5000/v3 --os-project-domain-name Default --os-user-domain-name Default --os-project-name myproject --os-username myuser token issue</span><br><span class="line">Password: </span><br><span class="line"><span class="code">+------------+</span>-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">| Field      | Value                                                                                                                                                                                   |</span><br><span class="line"><span class="code">+------------+</span>-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">| expires    | 2018-12-15T08:36:24+0000                                                                                                                                                                |</span><br><span class="line">| id         | gAAAAABcFK74SBqvGsSE1oh2MF0hzS-AKIQkPDX0cgFN6sJvcaj0TjiSzHNhbmV7SvuP3i<span class="emphasis">_V1GRelXDK7-1N2w4QVGQ9LKr5auaQvQBpEdvdNMN3nDsQ3dLJpy2cbfBLC9Y3akx5MqB_</span>Q3Ah8yNbD7PR0xt3cO28DmY4hR<span class="emphasis">_wy_</span>Wr3Z1BIXNuDa0 |</span><br><span class="line">| project<span class="emphasis">_id | fa610dc748fd4bbf9b6a75461a1bc81b                                                                                                                                                        |</span></span><br><span class="line"><span class="emphasis">| user_</span>id    | a2750e3ab9144584962f1e28eaa496ee                                                                                                                                                        |</span><br><span class="line"><span class="code">+------------+</span>-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br></pre></td></tr></table></figure></p>
<h4 id="d-创建-admin-用户的-OpenStack-客户端环境变量脚本"><a href="#d-创建-admin-用户的-OpenStack-客户端环境变量脚本" class="headerlink" title="d) 创建 admin 用户的 OpenStack 客户端环境变量脚本"></a>d) 创建 admin 用户的 OpenStack 客户端环境变量脚本</h4><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# vim admin-openrc</span><br><span class="line">[root@openstack ~]# cat admin-openrc</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">OS_PROJECT_DOMAIN_NAME</span>=Default</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">OS_USER_DOMAIN_NAME</span>=Default</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">OS_PROJECT_NAME</span>=admin</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">OS_USERNAME</span>=admin</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">OS_PASSWORD</span>=123456</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">OS_AUTH_URL</span>=http://controller:5000/v3</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">OS_IDENTITY_API_VERSION</span>=3</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">OS_IMAGE_API_VERSION</span>=2</span><br></pre></td></tr></table></figure>
<h4 id="e-创建-myuser-用户的-OpenStack-客户端环境变量脚本"><a href="#e-创建-myuser-用户的-OpenStack-客户端环境变量脚本" class="headerlink" title="e) 创建 myuser 用户的 OpenStack 客户端环境变量脚本"></a>e) 创建 myuser 用户的 OpenStack 客户端环境变量脚本</h4><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# vim myuser-openrc</span><br><span class="line">[root@openstack ~]# cat myuser-openrc </span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">OS_PROJECT_DOMAIN_NAME</span>=Default</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">OS_USER_DOMAIN_NAME</span>=Default</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">OS_PROJECT_NAME</span>=myproject</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">OS_USERNAME</span>=myuser</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">OS_PASSWORD</span>=123456</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">OS_AUTH_URL</span>=http://controller:5000/v3</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">OS_IDENTITY_API_VERSION</span>=3</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">OS_IMAGE_API_VERSION</span>=2</span><br></pre></td></tr></table></figure>
<h4 id="f-测试-OpenStack-客户端环境变量脚本-并请求身份验证令牌"><a href="#f-测试-OpenStack-客户端环境变量脚本-并请求身份验证令牌" class="headerlink" title="f) 测试 OpenStack 客户端环境变量脚本, 并请求身份验证令牌"></a>f) 测试 OpenStack 客户端环境变量脚本, 并请求身份验证令牌</h4><p><strong><em>与用命令获取的 user_id 相同即为配置成功</em></strong><br><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# . admin-openrc </span><br><span class="line">[root@openstack ~]# openstack token issue</span><br><span class="line"><span class="code">+------------+</span>-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">| Field      | Value                                                                                                                                                                                   |</span><br><span class="line"><span class="code">+------------+</span>-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">| expires    | 2018-12-15T08:44:35+0000                                                                                                                                                                |</span><br><span class="line">| id         | gAAAAABcFLDjV5xLhA5bPURW3CXC1SaOhCerCMsH2VyABhUWoWWaCR2hDfY3dbA4SpxHEqL<span class="emphasis">_zlA5mUes8s8IXJjKr4B2NItmq-rk-zmtt1hEBqvb8Gix_</span>tXB<span class="emphasis">_mYiyaLVy23FoOVLZeUmIPfFutmYWoPhOG0JwY5m1ZQVDsPydYja81FVftOf6uk |</span></span><br><span class="line"><span class="emphasis">| project_</span>id | 81ed22594f0d4148809e9c0e62e039a5                                                                                                                                                        |</span><br><span class="line">| user<span class="emphasis">_id    | 84e7e67f49ff4d13a7b7334134a13db2                                                                                                                                                        |</span></span><br><span class="line"><span class="emphasis">+------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span></span><br></pre></td></tr></table></figure></p>
<h2 id="九、安装并配置-Glance-镜像服务"><a href="#九、安装并配置-Glance-镜像服务" class="headerlink" title="九、安装并配置 Glance 镜像服务"></a>九、安装并配置 Glance 镜像服务</h2><h3 id="只需在-Controller-节点安装-5"><a href="#只需在-Controller-节点安装-5" class="headerlink" title="(!!!只需在 Controller 节点安装!!!)"></a><strong><em>(!!!只需在 Controller 节点安装!!!)</em></strong></h3><h3 id="1-创建-glance-数据库"><a href="#1-创建-glance-数据库" class="headerlink" title="1. 创建 glance 数据库"></a>1. 创建 glance 数据库</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">DATABASE</span> glance;</span><br><span class="line"><span class="keyword">GRANT</span> ALL <span class="keyword">PRIVILEGES</span> <span class="keyword">ON</span> glance.* <span class="keyword">TO</span> <span class="string">'glance'</span>@<span class="string">'localhost'</span> <span class="keyword">IDENTIFIED</span> <span class="keyword">BY</span> <span class="string">'123456'</span>;</span><br><span class="line"><span class="keyword">GRANT</span> ALL <span class="keyword">PRIVILEGES</span> <span class="keyword">ON</span> glance.* <span class="keyword">TO</span> <span class="string">'glance'</span>@<span class="string">'%'</span> <span class="keyword">IDENTIFIED</span> <span class="keyword">BY</span> <span class="string">'123456'</span>;</span><br><span class="line"><span class="keyword">flush</span> <span class="keyword">privileges</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# mysql -p123456</span><br><span class="line">Welcome <span class="keyword">to</span> the MariaDB monitor.  Commands <span class="keyword">end</span> <span class="keyword">with</span> ; <span class="keyword">or</span> \g.</span><br><span class="line">...</span><br><span class="line">...</span><br><span class="line">MariaDB [(none)]&gt; <span class="keyword">CREATE</span> DATABASE glance;</span><br><span class="line">Query OK, <span class="number">1</span> row affected (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; GRANT ALL PRIVILEGES <span class="keyword">ON</span> glance.* <span class="keyword">TO</span> <span class="string">'glance'</span>@<span class="string">'localhost'</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">'123456'</span>;</span><br><span class="line">Query OK, <span class="number">0</span> rows affected (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; GRANT ALL PRIVILEGES <span class="keyword">ON</span> glance.* <span class="keyword">TO</span> <span class="string">'glance'</span>@<span class="string">'%'</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">'123456'</span>;</span><br><span class="line">Query OK, <span class="number">0</span> rows affected (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; flush privileges;</span><br><span class="line">Query OK, <span class="number">0</span> rows affected (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; <span class="keyword">exit</span></span><br><span class="line">Bye</span><br></pre></td></tr></table></figure>
<h3 id="2-创建一个名为-glance-的-KeyStone-用户"><a href="#2-创建一个名为-glance-的-KeyStone-用户" class="headerlink" title="2. 创建一个名为 glance 的 KeyStone 用户"></a>2. 创建一个名为 glance 的 KeyStone 用户</h3><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# . admin-openrc </span><br><span class="line">[root@openstack ~]# openstack<span class="built_in"> user </span>create --domain<span class="built_in"> default </span><span class="attribute">--password</span>=123456 glance</span><br><span class="line">+---------------------+----------------------------------+</span><br><span class="line">| Field               | Value                            |</span><br><span class="line">+---------------------+----------------------------------+</span><br><span class="line">| domain_id           |<span class="built_in"> default </span>                         |</span><br><span class="line">| enabled             | <span class="literal">True</span>                             |</span><br><span class="line">| id                  | 063e3004acc94429a6b2a2cec9776608 |</span><br><span class="line">| name                | glance                           |</span><br><span class="line">| options             | &#123;&#125;                               |</span><br><span class="line">| password_expires_at | None                             |</span><br><span class="line">+---------------------+----------------------------------+</span><br><span class="line">[root@openstack ~]# openstack<span class="built_in"> user </span>list</span><br><span class="line">+----------------------------------+--------+</span><br><span class="line">| ID                               | Name   |</span><br><span class="line">+----------------------------------+--------+</span><br><span class="line">| 063e3004acc94429a6b2a2cec9776608 | glance |</span><br><span class="line">| 84e7e67f49ff4d13a7b7334134a13db2 | admin  |</span><br><span class="line">| a2750e3ab9144584962f1e28eaa496ee | myuser |</span><br><span class="line">+----------------------------------+--------+</span><br></pre></td></tr></table></figure>
<h3 id="3-将-glance-用户添加到-service-项目的-admin-角色"><a href="#3-将-glance-用户添加到-service-项目的-admin-角色" class="headerlink" title="3. 将 glance 用户添加到 service 项目的 admin 角色"></a>3. 将 glance 用户添加到 service 项目的 admin 角色</h3><p>以下命令无输出<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# openstack role <span class="builtin-name">add</span> --project<span class="built_in"> service </span>--user glance admin</span><br></pre></td></tr></table></figure></p>
<h3 id="4-创建-Glance-镜像服务实例"><a href="#4-创建-Glance-镜像服务实例" class="headerlink" title="4. 创建 Glance 镜像服务实例"></a>4. 创建 Glance 镜像服务实例</h3><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# openstack<span class="built_in"> service </span>create --name glance --description <span class="string">"OpenStack Image"</span> image</span><br><span class="line">+-------------+----------------------------------+</span><br><span class="line">| Field       | Value                            |</span><br><span class="line">+-------------+----------------------------------+</span><br><span class="line">| description | OpenStack Image                  |</span><br><span class="line">| enabled     | <span class="literal">True</span>                             |</span><br><span class="line">| id          | c9ed8738afa94a4abbe91144f2d67f45 |</span><br><span class="line">| name        | glance                           |</span><br><span class="line">|<span class="built_in"> type </span>       | image                            |</span><br><span class="line">+-------------+----------------------------------+</span><br><span class="line">[root@openstack ~]# openstack<span class="built_in"> service </span>list</span><br><span class="line">+----------------------------------+----------+----------+</span><br><span class="line">| ID                               | Name     |<span class="built_in"> Type </span>    |</span><br><span class="line">+----------------------------------+----------+----------+</span><br><span class="line">| 363f73076d45482c9a680f11193549e9 | keystone |<span class="built_in"> identity </span>|</span><br><span class="line">| c9ed8738afa94a4abbe91144f2d67f45 | glance   | image    |</span><br><span class="line">+----------------------------------+----------+----------+</span><br></pre></td></tr></table></figure>
<h3 id="5-创建-Glance-镜像服务的-API-端点-endpoint"><a href="#5-创建-Glance-镜像服务的-API-端点-endpoint" class="headerlink" title="5. 创建 Glance 镜像服务的 API 端点 (endpoint)"></a>5. 创建 Glance 镜像服务的 API 端点 (endpoint)</h3><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="meta">@openstack</span> ~]<span class="comment"># openstack endpoint create --region RegionOne image public http://controller:9292</span></span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">|<span class="string"> Field        </span>|<span class="string"> Value                            </span>|</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">|<span class="string"> enabled      </span>|<span class="string"> True                             </span>|</span><br><span class="line">|<span class="string"> id           </span>|<span class="string"> b02bf56e9c6f4ad6a54e513f23d333c7 </span>|</span><br><span class="line">|<span class="string"> interface    </span>|<span class="string"> public                           </span>|</span><br><span class="line">|<span class="string"> region       </span>|<span class="string"> RegionOne                        </span>|</span><br><span class="line">|<span class="string"> region_id    </span>|<span class="string"> RegionOne                        </span>|</span><br><span class="line">|<span class="string"> service_id   </span>|<span class="string"> c9ed8738afa94a4abbe91144f2d67f45 </span>|</span><br><span class="line">|<span class="string"> service_name </span>|<span class="string"> glance                           </span>|</span><br><span class="line">|<span class="string"> service_type </span>|<span class="string"> image                            </span>|</span><br><span class="line">|<span class="string"> url          </span>|<span class="string"> http://controller:9292           </span>|</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">[root<span class="meta">@openstack</span> ~]<span class="comment"># openstack endpoint create --region RegionOne image internal http://controller:9292</span></span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">|<span class="string"> Field        </span>|<span class="string"> Value                            </span>|</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">|<span class="string"> enabled      </span>|<span class="string"> True                             </span>|</span><br><span class="line">|<span class="string"> id           </span>|<span class="string"> 4c22aba83615477eaf5c42d935f882b8 </span>|</span><br><span class="line">|<span class="string"> interface    </span>|<span class="string"> internal                         </span>|</span><br><span class="line">|<span class="string"> region       </span>|<span class="string"> RegionOne                        </span>|</span><br><span class="line">|<span class="string"> region_id    </span>|<span class="string"> RegionOne                        </span>|</span><br><span class="line">|<span class="string"> service_id   </span>|<span class="string"> c9ed8738afa94a4abbe91144f2d67f45 </span>|</span><br><span class="line">|<span class="string"> service_name </span>|<span class="string"> glance                           </span>|</span><br><span class="line">|<span class="string"> service_type </span>|<span class="string"> image                            </span>|</span><br><span class="line">|<span class="string"> url          </span>|<span class="string"> http://controller:9292           </span>|</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">[root<span class="meta">@openstack</span> ~]<span class="comment"># openstack endpoint create --region RegionOne image admin http://controller:9292</span></span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">|<span class="string"> Field        </span>|<span class="string"> Value                            </span>|</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">|<span class="string"> enabled      </span>|<span class="string"> True                             </span>|</span><br><span class="line">|<span class="string"> id           </span>|<span class="string"> 54b25eea3f8a46c7af947adb4bff18ed </span>|</span><br><span class="line">|<span class="string"> interface    </span>|<span class="string"> admin                            </span>|</span><br><span class="line">|<span class="string"> region       </span>|<span class="string"> RegionOne                        </span>|</span><br><span class="line">|<span class="string"> region_id    </span>|<span class="string"> RegionOne                        </span>|</span><br><span class="line">|<span class="string"> service_id   </span>|<span class="string"> c9ed8738afa94a4abbe91144f2d67f45 </span>|</span><br><span class="line">|<span class="string"> service_name </span>|<span class="string"> glance                           </span>|</span><br><span class="line">|<span class="string"> service_type </span>|<span class="string"> image                            </span>|</span><br><span class="line">|<span class="string"> url          </span>|<span class="string"> http://controller:9292           </span>|</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">[root<span class="meta">@openstack</span> ~]<span class="comment"># openstack endpoint list</span></span><br><span class="line">+----------------------------------+-----------+--------------+--------------+---------+-----------+----------------------------+</span><br><span class="line">|<span class="string"> ID                               </span>|<span class="string"> Region    </span>|<span class="string"> Service Name </span>|<span class="string"> Service Type </span>|<span class="string"> Enabled </span>|<span class="string"> Interface </span>|<span class="string"> URL                        </span>|</span><br><span class="line">+----------------------------------+-----------+--------------+--------------+---------+-----------+----------------------------+</span><br><span class="line">|<span class="string"> 498db99146dc43d982449b1c7c6ac16b </span>|<span class="string"> RegionOne </span>|<span class="string"> keystone     </span>|<span class="string"> identity     </span>|<span class="string"> True    </span>|<span class="string"> public    </span>|<span class="string"> http://controller:5000/v3/ </span>|</span><br><span class="line">|<span class="string"> 4c22aba83615477eaf5c42d935f882b8 </span>|<span class="string"> RegionOne </span>|<span class="string"> glance       </span>|<span class="string"> image        </span>|<span class="string"> True    </span>|<span class="string"> internal  </span>|<span class="string"> http://controller:9292     </span>|</span><br><span class="line">|<span class="string"> 54b25eea3f8a46c7af947adb4bff18ed </span>|<span class="string"> RegionOne </span>|<span class="string"> glance       </span>|<span class="string"> image        </span>|<span class="string"> True    </span>|<span class="string"> admin     </span>|<span class="string"> http://controller:9292     </span>|</span><br><span class="line">|<span class="string"> 61af677340904813b4a5244da0a036ca </span>|<span class="string"> RegionOne </span>|<span class="string"> keystone     </span>|<span class="string"> identity     </span>|<span class="string"> True    </span>|<span class="string"> admin     </span>|<span class="string"> http://controller:5000/v3/ </span>|</span><br><span class="line">|<span class="string"> 9c6d59dfc5cc4f6c8dd55eb1c944e17c </span>|<span class="string"> RegionOne </span>|<span class="string"> keystone     </span>|<span class="string"> identity     </span>|<span class="string"> True    </span>|<span class="string"> internal  </span>|<span class="string"> http://controller:5000/v3/ </span>|</span><br><span class="line">|<span class="string"> b02bf56e9c6f4ad6a54e513f23d333c7 </span>|<span class="string"> RegionOne </span>|<span class="string"> glance       </span>|<span class="string"> image        </span>|<span class="string"> True    </span>|<span class="string"> public    </span>|<span class="string"> http://controller:9292     </span>|</span><br><span class="line">+----------------------------------+-----------+--------------+--------------+---------+-----------+----------------------------+</span><br></pre></td></tr></table></figure>
<h3 id="6-安装并配置-Glance-相关软件"><a href="#6-安装并配置-Glance-相关软件" class="headerlink" title="6. 安装并配置 Glance 相关软件"></a>6. 安装并配置 Glance 相关软件</h3><h4 id="a-确认-Python-版本"><a href="#a-确认-Python-版本" class="headerlink" title="a) 确认 Python 版本"></a>a) 确认 Python 版本</h4><p>在当前版本中有一个 bug 在 Python3.5 中可能会有 ssl 方面的问题, 详情参考<a href="https://docs.openstack.org/glance/rocky/install/get-started.html#running-glance-under-python3" target="_blank" rel="noopener">这里</a><br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-attr">[root@openstack ~]</span># <span class="selector-tag">python</span> <span class="selector-tag">--version</span></span><br><span class="line"><span class="selector-tag">Python</span> 2<span class="selector-class">.7</span><span class="selector-class">.5</span></span><br></pre></td></tr></table></figure></p>
<h4 id="b-安装-Glance-相关软件"><a href="#b-安装-Glance-相关软件" class="headerlink" title="b) 安装 Glance 相关软件"></a>b) 安装 Glance 相关软件</h4><figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# yum install -y openstack-glance <span class="keyword">python</span>-glance <span class="keyword">python</span>-glanceclient</span><br><span class="line">...</span><br><span class="line">Complete!</span><br></pre></td></tr></table></figure>
<h4 id="c-修改-Glance-的配置文件-glance-api-conf"><a href="#c-修改-Glance-的配置文件-glance-api-conf" class="headerlink" title="c) 修改 Glance 的配置文件 (glance-api.conf)"></a>c) 修改 Glance 的配置文件 (glance-api.conf)</h4><p><strong><em>必须确认配置是否正确</em></strong><br><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# openstack-config --<span class="keyword">set</span> /etc/glance/glance-api.conf database connection <span class="comment">"mysql+pymysql://glance:123456@controller/glance"</span></span><br><span class="line">[root@openstack ~]# openstack-config --set /etc/glance/glance-api.conf <span class="comment">keystone_authtoken www_authenticate_uri</span> <span class="comment">"http://controller:5000"</span></span><br><span class="line">[root@openstack ~<span class="comment">]# openstack-config --set</span> /etc/<span class="comment">glance</span>/glance-api.conf keystone_authtoken auth_url <span class="comment">"http://controller:5000"</span></span><br><span class="line">[root@openstack ~]# openstack-config --set /<span class="comment">etc</span>/glance/<span class="comment">glance-api.conf keystone_authtoken memcached_servers</span> <span class="comment">"controller:11211"</span></span><br><span class="line">[root@openstack ~<span class="comment">]# openstack-config --set</span> /etc/<span class="comment">glance</span>/glance-api.conf keystone_authtoken auth_type <span class="comment">"password"</span></span><br><span class="line">[root@openstack ~]# openstack-config --set /<span class="comment">etc</span>/glance/<span class="comment">glance-api.conf keystone_authtoken project_domain_name</span> <span class="comment">"Default"</span></span><br><span class="line">[root@openstack ~<span class="comment">]# openstack-config --set</span> /etc/<span class="comment">glance</span>/glance-api.conf keystone_authtoken user_domain_name <span class="comment">"Default"</span></span><br><span class="line">[root@openstack ~]# openstack-config --set /<span class="comment">etc</span>/glance/<span class="comment">glance-api.conf keystone_authtoken project_name</span> <span class="comment">"service "</span></span><br><span class="line">[root@openstack ~<span class="comment">]# openstack-config --set</span> /etc/<span class="comment">glance</span>/glance-api.conf keystone_authtoken username <span class="comment">"glance"</span></span><br><span class="line">[root@openstack ~]# openstack-config --set /<span class="comment">etc</span>/glance/<span class="comment">glance-api.conf keystone_authtoken password</span> <span class="comment">"123456"</span></span><br><span class="line">[root@openstack ~<span class="comment">]# openstack-config --set</span> /etc/<span class="comment">glance</span>/glance-api.conf paste_deploy flavor <span class="comment">"keystone"</span></span><br><span class="line">[root@openstack ~]# openstack-config --set /<span class="comment">etc</span>/glance/<span class="comment">glance-api.conf glance_store stores</span> <span class="comment">"file,http"</span></span><br><span class="line">[root@openstack ~<span class="comment">]# openstack-config --set</span> /etc/<span class="comment">glance</span>/glance-api.conf glance_store default_store <span class="comment">"file"</span></span><br><span class="line">[root@openstack ~]# openstack-config --set /<span class="comment">etc</span>/glance/<span class="comment">glance-api.conf glance_store filesystem_store_datadir</span> <span class="comment">"/var/lib/glance/images/"</span></span><br><span class="line">[root@openstack ~<span class="comment">]# grep</span> <span class="comment">'^[a-z]'</span> /etc/<span class="comment">glance</span>/glance-api.conf</span><br><span class="line">connection = mysql+pymysql:<span class="comment">//glance:123456@controller/glance</span></span><br><span class="line">stores = <span class="keyword">file</span>,http</span><br><span class="line">default_store = <span class="keyword">file</span></span><br><span class="line">filesystem_store_datadir = /<span class="comment">var</span>/lib/<span class="comment">glance</span>/images/</span><br><span class="line">www_authenticate_uri <span class="comment">= http:</span>//<span class="comment">controller:5000</span></span><br><span class="line">auth_url <span class="comment">= http:</span>//<span class="comment">controller:5000</span></span><br><span class="line">memcached_servers <span class="comment">= controller:11211</span></span><br><span class="line">auth_type <span class="comment">= password</span></span><br><span class="line">project_domain_name <span class="comment">= Default</span></span><br><span class="line">user_domain_name <span class="comment">= Default</span></span><br><span class="line">project_name <span class="comment">= service</span> </span><br><span class="line">username <span class="comment">= glance</span></span><br><span class="line">password <span class="comment">= 123456</span></span><br><span class="line">flavor <span class="comment">= keystone</span></span><br></pre></td></tr></table></figure></p>
<h4 id="d-修改-Glance-的配置文件-glance-registry-conf"><a href="#d-修改-Glance-的配置文件-glance-registry-conf" class="headerlink" title="d) 修改 Glance 的配置文件 (glance-registry.conf)"></a>d) 修改 Glance 的配置文件 (glance-registry.conf)</h4><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/glance/glance-registry.conf database connection "mysql+pymysql://glance:123456@controller/glance"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/glance/glance-registry.conf keystone_authtoken www_authenticate_uri "http://controller:5000"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/glance/glance-registry.conf keystone_authtoken auth_url "http://controller:5000"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/glance/glance-registry.conf keystone_authtoken memcached_servers "controller:11211"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/glance/glance-registry.conf keystone_authtoken auth_type "password"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/glance/glance-registry.conf keystone_authtoken project_domain_name "Default"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/glance/glance-registry.conf keystone_authtoken user_domain_name "Default"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/glance/glance-registry.conf keystone_authtoken project_name "service"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/glance/glance-registry.conf keystone_authtoken username "glance"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/glance/glance-registry.conf keystone_authtoken password "123456"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/glance/glance-registry.conf paste_deploy flavor "keystone"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># grep '^[a-z]' /etc/glance/glance-registry.conf</span></span><br><span class="line"><span class="attr">connection</span> = mysql+pymysql://glance:<span class="number">123456</span>@controller/glance</span><br><span class="line"><span class="attr">www_authenticate_uri</span> = http://controller:<span class="number">5000</span></span><br><span class="line"><span class="attr">auth_url</span> = http://controller:<span class="number">5000</span></span><br><span class="line"><span class="attr">memcached_servers</span> = controller:<span class="number">11211</span></span><br><span class="line"><span class="attr">auth_type</span> = password</span><br><span class="line"><span class="attr">project_domain_name</span> = Default</span><br><span class="line"><span class="attr">user_domain_name</span> = Default</span><br><span class="line"><span class="attr">project_name</span> = service</span><br><span class="line"><span class="attr">username</span> = glance</span><br><span class="line"><span class="attr">password</span> = <span class="number">123456</span></span><br><span class="line"><span class="attr">flavor</span> = keystone</span><br></pre></td></tr></table></figure>
<h3 id="7-初始化-glance-数据库"><a href="#7-初始化-glance-数据库" class="headerlink" title="7. 初始化 glance 数据库"></a>7. 初始化 glance 数据库</h3><p><strong><em>必须确认数据库是否初始化正确</em></strong><br><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# su -s /bin/sh -c <span class="string">"glance-manage db_sync"</span> glance</span><br><span class="line">/usr/lib/python2<span class="number">.7</span>/site-packages/oslo_db/sqlalchemy/enginefacade.py:<span class="number">1352</span>: <span class="symbol">OsloDBDeprecationWarning</span>: <span class="symbol">EngineFacade</span> is deprecated; please use oslo_db.sqlalchemy.enginefacade</span><br><span class="line">  expire_on_commit=expire_on_commit, <span class="symbol">_conf</span>=conf)</span><br><span class="line"><span class="symbol">INFO</span>  [alembic.runtime.migration] <span class="symbol">Context</span> impl <span class="symbol">MySQLImpl</span>.</span><br><span class="line"><span class="symbol">INFO</span>  [alembic.runtime.migration] <span class="symbol">Will</span> assume non-transactional <span class="symbol">DDL</span>.</span><br><span class="line"><span class="symbol">INFO</span>  [alembic.runtime.migration] <span class="symbol">Running</span> upgrade  -&gt; liberty, liberty initial</span><br><span class="line"><span class="symbol">INFO</span>  [alembic.runtime.migration] <span class="symbol">Running</span> upgrade liberty -&gt; mitaka01, add index on created_at and updated_at columns of <span class="string">'images'</span> table</span><br><span class="line"><span class="symbol">INFO</span>  [alembic.runtime.migration] <span class="symbol">Running</span> upgrade mitaka01 -&gt; mitaka02, update metadef os_nova_server</span><br><span class="line"><span class="symbol">INFO</span>  [alembic.runtime.migration] <span class="symbol">Running</span> upgrade mitaka02 -&gt; ocata_expand01, add visibility to images</span><br><span class="line"><span class="symbol">INFO</span>  [alembic.runtime.migration] <span class="symbol">Running</span> upgrade ocata_expand01 -&gt; pike_expand01, empty expand for symmetry with pike_contract01</span><br><span class="line"><span class="symbol">INFO</span>  [alembic.runtime.migration] <span class="symbol">Running</span> upgrade pike_expand01 -&gt; queens_expand01</span><br><span class="line"><span class="symbol">INFO</span>  [alembic.runtime.migration] <span class="symbol">Running</span> upgrade queens_expand01 -&gt; rocky_expand01, add os_hidden column to images table</span><br><span class="line"><span class="symbol">INFO</span>  [alembic.runtime.migration] <span class="symbol">Running</span> upgrade rocky_expand01 -&gt; rocky_expand02, add os_hash_algo and os_hash_value columns to images table</span><br><span class="line"><span class="symbol">INFO</span>  [alembic.runtime.migration] <span class="symbol">Context</span> impl <span class="symbol">MySQLImpl</span>.</span><br><span class="line"><span class="symbol">INFO</span>  [alembic.runtime.migration] <span class="symbol">Will</span> assume non-transactional <span class="symbol">DDL</span>.</span><br><span class="line"><span class="symbol">Upgraded</span> database to: rocky_expand02, current revision(s): rocky_expand02</span><br><span class="line"><span class="symbol">INFO</span>  [alembic.runtime.migration] <span class="symbol">Context</span> impl <span class="symbol">MySQLImpl</span>.</span><br><span class="line"><span class="symbol">INFO</span>  [alembic.runtime.migration] <span class="symbol">Will</span> assume non-transactional <span class="symbol">DDL</span>.</span><br><span class="line"><span class="symbol">INFO</span>  [alembic.runtime.migration] <span class="symbol">Context</span> impl <span class="symbol">MySQLImpl</span>.</span><br><span class="line"><span class="symbol">INFO</span>  [alembic.runtime.migration] <span class="symbol">Will</span> assume non-transactional <span class="symbol">DDL</span>.</span><br><span class="line"><span class="symbol">Database</span> migration is up to date. <span class="symbol">No</span> migration needed.</span><br><span class="line"><span class="symbol">INFO</span>  [alembic.runtime.migration] <span class="symbol">Context</span> impl <span class="symbol">MySQLImpl</span>.</span><br><span class="line"><span class="symbol">INFO</span>  [alembic.runtime.migration] <span class="symbol">Will</span> assume non-transactional <span class="symbol">DDL</span>.</span><br><span class="line"><span class="symbol">INFO</span>  [alembic.runtime.migration] <span class="symbol">Context</span> impl <span class="symbol">MySQLImpl</span>.</span><br><span class="line"><span class="symbol">INFO</span>  [alembic.runtime.migration] <span class="symbol">Will</span> assume non-transactional <span class="symbol">DDL</span>.</span><br><span class="line"><span class="symbol">INFO</span>  [alembic.runtime.migration] <span class="symbol">Running</span> upgrade mitaka02 -&gt; ocata_contract01, remove is_public from images</span><br><span class="line"><span class="symbol">INFO</span>  [alembic.runtime.migration] <span class="symbol">Running</span> upgrade ocata_contract01 -&gt; pike_contract01, drop glare artifacts tables</span><br><span class="line"><span class="symbol">INFO</span>  [alembic.runtime.migration] <span class="symbol">Running</span> upgrade pike_contract01 -&gt; queens_contract01</span><br><span class="line"><span class="symbol">INFO</span>  [alembic.runtime.migration] <span class="symbol">Running</span> upgrade queens_contract01 -&gt; rocky_contract01</span><br><span class="line"><span class="symbol">INFO</span>  [alembic.runtime.migration] <span class="symbol">Running</span> upgrade rocky_contract01 -&gt; rocky_contract02</span><br><span class="line"><span class="symbol">INFO</span>  [alembic.runtime.migration] <span class="symbol">Context</span> impl <span class="symbol">MySQLImpl</span>.</span><br><span class="line"><span class="symbol">INFO</span>  [alembic.runtime.migration] <span class="symbol">Will</span> assume non-transactional <span class="symbol">DDL</span>.</span><br><span class="line"><span class="symbol">Upgraded</span> database to: rocky_contract02, current revision(s): rocky_contract02</span><br><span class="line"><span class="symbol">INFO</span>  [alembic.runtime.migration] <span class="symbol">Context</span> impl <span class="symbol">MySQLImpl</span>.</span><br><span class="line"><span class="symbol">INFO</span>  [alembic.runtime.migration] <span class="symbol">Will</span> assume non-transactional <span class="symbol">DDL</span>.</span><br><span class="line"><span class="symbol">Database</span> is synced successfully.</span><br><span class="line">[root@openstack ~]# mysql -uglance -p123456 -e <span class="string">"use glance;show tables;"</span> | wc -l</span><br><span class="line"><span class="number">16</span></span><br><span class="line">[root@openstack ~]# mysql -uglance -p123456 -e <span class="string">"use glance;show tables;"</span></span><br><span class="line">+----------------------------------+</span><br><span class="line">| <span class="symbol">Tables_in_glance</span>                 |</span><br><span class="line">+----------------------------------+</span><br><span class="line">| alembic_version                  |</span><br><span class="line">| image_locations                  |</span><br><span class="line">| image_members                    |</span><br><span class="line">| image_properties                 |</span><br><span class="line">| image_tags                       |</span><br><span class="line">| images                           |</span><br><span class="line">| metadef_namespace_resource_types |</span><br><span class="line">| metadef_namespaces               |</span><br><span class="line">| metadef_objects                  |</span><br><span class="line">| metadef_properties               |</span><br><span class="line">| metadef_resource_types           |</span><br><span class="line">| metadef_tags                     |</span><br><span class="line">| migrate_version                  |</span><br><span class="line">| task_info                        |</span><br><span class="line">| tasks                            |</span><br><span class="line">+----------------------------------+</span><br></pre></td></tr></table></figure></p>
<h3 id="8-启动-Glance-服务并设置为开机自启"><a href="#8-启动-Glance-服务并设置为开机自启" class="headerlink" title="8. 启动 Glance 服务并设置为开机自启"></a>8. 启动 Glance 服务并设置为开机自启</h3><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]<span class="comment"># systemctl start openstack-glance-api openstack-glance-registry</span></span><br><span class="line">[root@openstack ~]<span class="comment"># systemctl enable openstack-glance-api openstack-glance-registry</span></span><br><span class="line">Created symlink from /etc/systemd/system/multi-user.target.wants/openstack-glance-api.service to /usr/<span class="class"><span class="keyword">lib</span>/<span class="title">systemd</span>/<span class="title">system</span>/<span class="title">openstack</span>-<span class="title">glance</span>-<span class="title">api</span>.<span class="title">service</span>.</span></span><br><span class="line">Created symlink from /etc/systemd/system/multi-user.target.wants/openstack-glance-registry.service to /usr/<span class="class"><span class="keyword">lib</span>/<span class="title">systemd</span>/<span class="title">system</span>/<span class="title">openstack</span>-<span class="title">glance</span>-<span class="title">registry</span>.<span class="title">service</span>.</span></span><br></pre></td></tr></table></figure>
<h3 id="9-测试-Glance-镜像服务"><a href="#9-测试-Glance-镜像服务" class="headerlink" title="9. 测试 Glance 镜像服务"></a>9. 测试 Glance 镜像服务</h3><h4 id="a-下载镜像"><a href="#a-下载镜像" class="headerlink" title="a) 下载镜像"></a>a) 下载镜像</h4><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-attr">[root@openstack ~]</span># <span class="selector-tag">wget</span> <span class="selector-tag">http</span>:<span class="comment">//download.cirros-cloud.net/0.4.0/cirros-0.4.0-x86_64-disk.img</span></span><br><span class="line"><span class="selector-tag">--2018-12-15</span> <span class="selector-tag">16</span><span class="selector-pseudo">:32</span><span class="selector-pseudo">:33--</span>  <span class="selector-tag">http</span>:<span class="comment">//download.cirros-cloud.net/0.4.0/cirros-0.4.0-x86_64-disk.img</span></span><br><span class="line"><span class="selector-tag">Resolving</span> <span class="selector-tag">download</span><span class="selector-class">.cirros-cloud</span><span class="selector-class">.net</span> (download.cirros-cloud.net)... <span class="selector-tag">64</span><span class="selector-class">.90</span><span class="selector-class">.42</span><span class="selector-class">.85</span>, <span class="selector-tag">2607</span><span class="selector-pseudo">:f298</span><span class="selector-pseudo">:6</span><span class="selector-pseudo">:a036</span><span class="selector-pseudo">::bd6</span><span class="selector-pseudo">:a72a</span></span><br><span class="line"><span class="selector-tag">Connecting</span> <span class="selector-tag">to</span> <span class="selector-tag">download</span><span class="selector-class">.cirros-cloud</span><span class="selector-class">.net</span> (download.cirros-cloud.net)|<span class="selector-tag">64</span><span class="selector-class">.90</span><span class="selector-class">.42</span><span class="selector-class">.85</span>|<span class="selector-pseudo">:80...</span> <span class="selector-tag">connected</span>.</span><br><span class="line"><span class="selector-tag">HTTP</span> <span class="selector-tag">request</span> <span class="selector-tag">sent</span>, <span class="selector-tag">awaiting</span> <span class="selector-tag">response</span>... <span class="selector-tag">200</span> <span class="selector-tag">OK</span></span><br><span class="line"><span class="selector-tag">Length</span>: <span class="selector-tag">12716032</span> (<span class="number">12</span>M) <span class="selector-attr">[text/plain]</span></span><br><span class="line"><span class="selector-tag">Saving</span> <span class="selector-tag">to</span>: ‘<span class="selector-tag">cirros-0</span><span class="selector-class">.4</span><span class="selector-class">.0-x86_64-disk</span><span class="selector-class">.img</span>’</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">100%</span><span class="selector-attr">[==========================================&gt;]</span> <span class="selector-tag">12</span>,<span class="selector-tag">716</span>,<span class="selector-tag">032</span>  <span class="selector-tag">77</span><span class="selector-class">.0KB</span>/<span class="selector-tag">s</span>   <span class="selector-tag">in</span> <span class="selector-tag">2m</span> <span class="selector-tag">13s</span> </span><br><span class="line"></span><br><span class="line"><span class="selector-tag">2018-12-15</span> <span class="selector-tag">16</span><span class="selector-pseudo">:34</span><span class="selector-pseudo">:50</span> (<span class="number">93.3</span> KB/s) <span class="selector-tag">-</span> ‘<span class="selector-tag">cirros-0</span><span class="selector-class">.4</span><span class="selector-class">.0-x86_64-disk</span><span class="selector-class">.img</span>’ <span class="selector-tag">saved</span> <span class="selector-attr">[12716032/12716032]</span></span><br></pre></td></tr></table></figure>
<h4 id="b-上传镜像到-Glance"><a href="#b-上传镜像到-Glance" class="headerlink" title="b) 上传镜像到 Glance"></a>b) 上传镜像到 Glance</h4><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="meta">@openstack</span> ~]<span class="comment"># . admin-openrc</span></span><br><span class="line">[root<span class="meta">@openstack</span> ~]<span class="comment"># openstack image create "cirros" --file cirros-0.4.0-x86_64-disk.img --disk-format qcow2 --container-format bare --public</span></span><br><span class="line">+------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">|<span class="string"> Field            </span>|<span class="string"> Value                                                                                                                                                                                      </span>|</span><br><span class="line">+------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">|<span class="string"> checksum         </span>|<span class="string"> 443b7623e27ecf03dc9e01ee93f67afe                                                                                                                                                           </span>|</span><br><span class="line">|<span class="string"> container_format </span>|<span class="string"> bare                                                                                                                                                                                       </span>|</span><br><span class="line">|<span class="string"> created_at       </span>|<span class="string"> 2018-12-15T08:43:13Z                                                                                                                                                                       </span>|</span><br><span class="line">|<span class="string"> disk_format      </span>|<span class="string"> qcow2                                                                                                                                                                                      </span>|</span><br><span class="line">|<span class="string"> file             </span>|<span class="string"> /v2/images/28be57c8-8f04-407b-8a32-41d953a4a131/file                                                                                                                                       </span>|</span><br><span class="line">|<span class="string"> id               </span>|<span class="string"> 28be57c8-8f04-407b-8a32-41d953a4a131                                                                                                                                                       </span>|</span><br><span class="line">|<span class="string"> min_disk         </span>|<span class="string"> 0                                                                                                                                                                                          </span>|</span><br><span class="line">|<span class="string"> min_ram          </span>|<span class="string"> 0                                                                                                                                                                                          </span>|</span><br><span class="line">|<span class="string"> name             </span>|<span class="string"> cirros                                                                                                                                                                                     </span>|</span><br><span class="line">|<span class="string"> owner            </span>|<span class="string"> 81ed22594f0d4148809e9c0e62e039a5                                                                                                                                                           </span>|</span><br><span class="line">|<span class="string"> properties       </span>|<span class="string"> os_hash_algo='sha512', os_hash_value='6513f21e44aa3da349f248188a44bc304a3653a04122d8fb4535423c8e1d14cd6a153f735bb0982e2161b5b5186106570c17a9e58b64dd39390617cd5a350f78', os_hidden='False' </span>|</span><br><span class="line">|<span class="string"> protected        </span>|<span class="string"> False                                                                                                                                                                                      </span>|</span><br><span class="line">|<span class="string"> schema           </span>|<span class="string"> /v2/schemas/image                                                                                                                                                                          </span>|</span><br><span class="line">|<span class="string"> size             </span>|<span class="string"> 12716032                                                                                                                                                                                   </span>|</span><br><span class="line">|<span class="string"> status           </span>|<span class="string"> active                                                                                                                                                                                     </span>|</span><br><span class="line">|<span class="string"> tags             </span>|<span class="string">                                                                                                                                                                                            </span>|</span><br><span class="line">|<span class="string"> updated_at       </span>|<span class="string"> 2018-12-15T08:43:15Z                                                                                                                                                                       </span>|</span><br><span class="line">|<span class="string"> virtual_size     </span>|<span class="string"> None                                                                                                                                                                                       </span>|</span><br><span class="line">|<span class="string"> visibility       </span>|<span class="string"> public                                                                                                                                                                                     </span>|</span><br><span class="line">+------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br></pre></td></tr></table></figure>
<h4 id="c-查看镜像"><a href="#c-查看镜像" class="headerlink" title="c) 查看镜像"></a>c) 查看镜像</h4><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# openstack image list</span><br><span class="line"><span class="code">+--------------------------------------+</span>--------<span class="code">+--------+</span></span><br><span class="line">| ID                                   | Name   | Status |</span><br><span class="line"><span class="code">+--------------------------------------+</span>--------<span class="code">+--------+</span></span><br><span class="line">| 28be57c8-8f04-407b-8a32-41d953a4a131 | cirros | active |</span><br><span class="line"><span class="code">+--------------------------------------+</span>--------<span class="code">+--------+</span></span><br></pre></td></tr></table></figure>
<h2 id="十、安装并配置-Nova-计算服务"><a href="#十、安装并配置-Nova-计算服务" class="headerlink" title="十、安装并配置 Nova 计算服务"></a>十、安装并配置 Nova 计算服务</h2><h3 id="只需在-Controller-节点安装-6"><a href="#只需在-Controller-节点安装-6" class="headerlink" title="(!!!只需在 Controller 节点安装!!!)"></a><strong><em>(!!!只需在 Controller 节点安装!!!)</em></strong></h3><h3 id="1-创建-nova-数据库"><a href="#1-创建-nova-数据库" class="headerlink" title="1. 创建 nova 数据库"></a>1. 创建 nova 数据库</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">DATABASE</span> nova_api;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">DATABASE</span> nova;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">DATABASE</span> nova_cell0;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">DATABASE</span> placement;</span><br><span class="line"><span class="keyword">GRANT</span> ALL <span class="keyword">PRIVILEGES</span> <span class="keyword">ON</span> nova_api.* <span class="keyword">TO</span> <span class="string">'nova'</span>@<span class="string">'localhost'</span> <span class="keyword">IDENTIFIED</span> <span class="keyword">BY</span> <span class="string">'123456'</span>;</span><br><span class="line"><span class="keyword">GRANT</span> ALL <span class="keyword">PRIVILEGES</span> <span class="keyword">ON</span> nova_api.* <span class="keyword">TO</span> <span class="string">'nova'</span>@<span class="string">'%'</span> <span class="keyword">IDENTIFIED</span> <span class="keyword">BY</span> <span class="string">'123456'</span>;</span><br><span class="line"><span class="keyword">GRANT</span> ALL <span class="keyword">PRIVILEGES</span> <span class="keyword">ON</span> nova.* <span class="keyword">TO</span> <span class="string">'nova'</span>@<span class="string">'localhost'</span> <span class="keyword">IDENTIFIED</span> <span class="keyword">BY</span> <span class="string">'123456'</span>;</span><br><span class="line"><span class="keyword">GRANT</span> ALL <span class="keyword">PRIVILEGES</span> <span class="keyword">ON</span> nova.* <span class="keyword">TO</span> <span class="string">'nova'</span>@<span class="string">'%'</span> <span class="keyword">IDENTIFIED</span> <span class="keyword">BY</span> <span class="string">'123456'</span>;</span><br><span class="line"><span class="keyword">GRANT</span> ALL <span class="keyword">PRIVILEGES</span> <span class="keyword">ON</span> nova_cell0.* <span class="keyword">TO</span> <span class="string">'nova'</span>@<span class="string">'localhost'</span> <span class="keyword">IDENTIFIED</span> <span class="keyword">BY</span> <span class="string">'123456'</span>;</span><br><span class="line"><span class="keyword">GRANT</span> ALL <span class="keyword">PRIVILEGES</span> <span class="keyword">ON</span> nova_cell0.* <span class="keyword">TO</span> <span class="string">'nova'</span>@<span class="string">'%'</span> <span class="keyword">IDENTIFIED</span> <span class="keyword">BY</span> <span class="string">'123456'</span>;</span><br><span class="line"><span class="keyword">GRANT</span> ALL <span class="keyword">PRIVILEGES</span> <span class="keyword">ON</span> placement.* <span class="keyword">TO</span> <span class="string">'placement'</span>@<span class="string">'localhost'</span> <span class="keyword">IDENTIFIED</span> <span class="keyword">BY</span> <span class="string">'123456'</span>;</span><br><span class="line"><span class="keyword">GRANT</span> ALL <span class="keyword">PRIVILEGES</span> <span class="keyword">ON</span> placement.* <span class="keyword">TO</span> <span class="string">'placement'</span>@<span class="string">'%'</span> <span class="keyword">IDENTIFIED</span> <span class="keyword">BY</span> <span class="string">'123456'</span>;</span><br><span class="line"><span class="keyword">flush</span> <span class="keyword">privileges</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# mysql -p123456</span><br><span class="line">Welcome <span class="keyword">to</span> the MariaDB monitor.  Commands <span class="keyword">end</span> <span class="keyword">with</span> ; <span class="keyword">or</span> \g.</span><br><span class="line">...</span><br><span class="line">...</span><br><span class="line">MariaDB [(none)]&gt; <span class="keyword">CREATE</span> DATABASE nova_api;</span><br><span class="line">Query OK, <span class="number">1</span> row affected (<span class="number">0.01</span> sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; <span class="keyword">CREATE</span> DATABASE nova;</span><br><span class="line">Query OK, <span class="number">1</span> row affected (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; <span class="keyword">CREATE</span> DATABASE nova_cell0;</span><br><span class="line">Query OK, <span class="number">1</span> row affected (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; <span class="keyword">CREATE</span> DATABASE placement;</span><br><span class="line">Query OK, <span class="number">1</span> row affected (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; GRANT ALL PRIVILEGES <span class="keyword">ON</span> nova_api.* <span class="keyword">TO</span> <span class="string">'nova'</span>@<span class="string">'localhost'</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">'123456'</span>;</span><br><span class="line">Query OK, <span class="number">0</span> rows affected (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; GRANT ALL PRIVILEGES <span class="keyword">ON</span> nova_api.* <span class="keyword">TO</span> <span class="string">'nova'</span>@<span class="string">'%'</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">'123456'</span>;</span><br><span class="line">Query OK, <span class="number">0</span> rows affected (<span class="number">0.01</span> sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; GRANT ALL PRIVILEGES <span class="keyword">ON</span> nova.* <span class="keyword">TO</span> <span class="string">'nova'</span>@<span class="string">'localhost'</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">'123456'</span>;</span><br><span class="line">Query OK, <span class="number">0</span> rows affected (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; GRANT ALL PRIVILEGES <span class="keyword">ON</span> nova.* <span class="keyword">TO</span> <span class="string">'nova'</span>@<span class="string">'%'</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">'123456'</span>;</span><br><span class="line">Query OK, <span class="number">0</span> rows affected (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; GRANT ALL PRIVILEGES <span class="keyword">ON</span> nova_cell0.* <span class="keyword">TO</span> <span class="string">'nova'</span>@<span class="string">'localhost'</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">'123456'</span>;</span><br><span class="line">Query OK, <span class="number">0</span> rows affected (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; GRANT ALL PRIVILEGES <span class="keyword">ON</span> nova_cell0.* <span class="keyword">TO</span> <span class="string">'nova'</span>@<span class="string">'%'</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">'123456'</span>;</span><br><span class="line">Query OK, <span class="number">0</span> rows affected (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; GRANT ALL PRIVILEGES <span class="keyword">ON</span> placement.* <span class="keyword">TO</span> <span class="string">'placement'</span>@<span class="string">'localhost'</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">'123456'</span>;</span><br><span class="line">Query OK, <span class="number">0</span> rows affected (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; GRANT ALL PRIVILEGES <span class="keyword">ON</span> placement.* <span class="keyword">TO</span> <span class="string">'placement'</span>@<span class="string">'%'</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">'123456'</span>;</span><br><span class="line">Query OK, <span class="number">0</span> rows affected (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; flush privileges;</span><br><span class="line">Query OK, <span class="number">0</span> rows affected (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; <span class="keyword">exit</span></span><br><span class="line">Bye</span><br></pre></td></tr></table></figure>
<h3 id="2-创建一个名为-nova-的-KeyStone-用户"><a href="#2-创建一个名为-nova-的-KeyStone-用户" class="headerlink" title="2. 创建一个名为 nova 的 KeyStone 用户"></a>2. 创建一个名为 nova 的 KeyStone 用户</h3><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# . admin-openrc </span><br><span class="line">[root@openstack ~]# openstack<span class="built_in"> user </span>create --domain<span class="built_in"> default </span><span class="attribute">--password</span>=123456 nova</span><br><span class="line">+---------------------+----------------------------------+</span><br><span class="line">| Field               | Value                            |</span><br><span class="line">+---------------------+----------------------------------+</span><br><span class="line">| domain_id           |<span class="built_in"> default </span>                         |</span><br><span class="line">| enabled             | <span class="literal">True</span>                             |</span><br><span class="line">| id                  | 50f123bb0cc640b7bc2603a3c5757b51 |</span><br><span class="line">| name                | nova                             |</span><br><span class="line">| options             | &#123;&#125;                               |</span><br><span class="line">| password_expires_at | None                             |</span><br><span class="line">+---------------------+----------------------------------+</span><br><span class="line">[root@openstack ~]# openstack<span class="built_in"> user </span>list</span><br><span class="line">+----------------------------------+--------+</span><br><span class="line">| ID                               | Name   |</span><br><span class="line">+----------------------------------+--------+</span><br><span class="line">| 063e3004acc94429a6b2a2cec9776608 | glance |</span><br><span class="line">| 50f123bb0cc640b7bc2603a3c5757b51 | nova   |</span><br><span class="line">| 84e7e67f49ff4d13a7b7334134a13db2 | admin  |</span><br><span class="line">| a2750e3ab9144584962f1e28eaa496ee | myuser |</span><br><span class="line">+----------------------------------+--------+</span><br></pre></td></tr></table></figure>
<h3 id="3-将-nova-用户添加到-service-项目的-admin-角色"><a href="#3-将-nova-用户添加到-service-项目的-admin-角色" class="headerlink" title="3. 将 nova 用户添加到 service 项目的 admin 角色"></a>3. 将 nova 用户添加到 service 项目的 admin 角色</h3><p>以下命令无输出<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# openstack role <span class="builtin-name">add</span> --project<span class="built_in"> service </span>--user nova admin</span><br></pre></td></tr></table></figure></p>
<h3 id="4-创建-Nova-镜像服务实例"><a href="#4-创建-Nova-镜像服务实例" class="headerlink" title="4. 创建 Nova 镜像服务实例"></a>4. 创建 Nova 镜像服务实例</h3><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# openstack<span class="built_in"> service </span>create --name nova --description <span class="string">"OpenStack Compute"</span> compute</span><br><span class="line">+-------------+----------------------------------+</span><br><span class="line">| Field       | Value                            |</span><br><span class="line">+-------------+----------------------------------+</span><br><span class="line">| description | OpenStack Compute                |</span><br><span class="line">| enabled     | <span class="literal">True</span>                             |</span><br><span class="line">| id          | 70155ce6ff3f41348cafa6e498d96e99 |</span><br><span class="line">| name        | nova                             |</span><br><span class="line">|<span class="built_in"> type </span>       | compute                          |</span><br><span class="line">+-------------+----------------------------------+</span><br><span class="line">[root@openstack ~]# openstack<span class="built_in"> service </span>list</span><br><span class="line">+----------------------------------+----------+----------+</span><br><span class="line">| ID                               | Name     |<span class="built_in"> Type </span>    |</span><br><span class="line">+----------------------------------+----------+----------+</span><br><span class="line">| 363f73076d45482c9a680f11193549e9 | keystone |<span class="built_in"> identity </span>|</span><br><span class="line">| 70155ce6ff3f41348cafa6e498d96e99 | nova     | compute  |</span><br><span class="line">| c9ed8738afa94a4abbe91144f2d67f45 | glance   | image    |</span><br><span class="line">+----------------------------------+----------+----------+</span><br></pre></td></tr></table></figure>
<h3 id="5-创建-Nova-镜像服务的-API-端点-endpoint"><a href="#5-创建-Nova-镜像服务的-API-端点-endpoint" class="headerlink" title="5. 创建 Nova 镜像服务的 API 端点 (endpoint)"></a>5. 创建 Nova 镜像服务的 API 端点 (endpoint)</h3><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="meta">@openstack</span> ~]<span class="comment"># openstack endpoint create --region RegionOne compute public http://controller:8774/v2.1</span></span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">|<span class="string"> Field        </span>|<span class="string"> Value                            </span>|</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">|<span class="string"> enabled      </span>|<span class="string"> True                             </span>|</span><br><span class="line">|<span class="string"> id           </span>|<span class="string"> dd00497083f94f8b8bae6fac7735f2f7 </span>|</span><br><span class="line">|<span class="string"> interface    </span>|<span class="string"> public                           </span>|</span><br><span class="line">|<span class="string"> region       </span>|<span class="string"> RegionOne                        </span>|</span><br><span class="line">|<span class="string"> region_id    </span>|<span class="string"> RegionOne                        </span>|</span><br><span class="line">|<span class="string"> service_id   </span>|<span class="string"> 70155ce6ff3f41348cafa6e498d96e99 </span>|</span><br><span class="line">|<span class="string"> service_name </span>|<span class="string"> nova                             </span>|</span><br><span class="line">|<span class="string"> service_type </span>|<span class="string"> compute                          </span>|</span><br><span class="line">|<span class="string"> url          </span>|<span class="string"> http://controller:8774/v2.1      </span>|</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">[root<span class="meta">@openstack</span> ~]<span class="comment"># openstack endpoint create --region RegionOne compute internal http://controller:8774/v2.1</span></span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">|<span class="string"> Field        </span>|<span class="string"> Value                            </span>|</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">|<span class="string"> enabled      </span>|<span class="string"> True                             </span>|</span><br><span class="line">|<span class="string"> id           </span>|<span class="string"> 1640b8023b96498ba283d645573acbf5 </span>|</span><br><span class="line">|<span class="string"> interface    </span>|<span class="string"> internal                         </span>|</span><br><span class="line">|<span class="string"> region       </span>|<span class="string"> RegionOne                        </span>|</span><br><span class="line">|<span class="string"> region_id    </span>|<span class="string"> RegionOne                        </span>|</span><br><span class="line">|<span class="string"> service_id   </span>|<span class="string"> 70155ce6ff3f41348cafa6e498d96e99 </span>|</span><br><span class="line">|<span class="string"> service_name </span>|<span class="string"> nova                             </span>|</span><br><span class="line">|<span class="string"> service_type </span>|<span class="string"> compute                          </span>|</span><br><span class="line">|<span class="string"> url          </span>|<span class="string"> http://controller:8774/v2.1      </span>|</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">[root<span class="meta">@openstack</span> ~]<span class="comment"># openstack endpoint create --region RegionOne compute admin http://controller:8774/v2.1</span></span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">|<span class="string"> Field        </span>|<span class="string"> Value                            </span>|</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">|<span class="string"> enabled      </span>|<span class="string"> True                             </span>|</span><br><span class="line">|<span class="string"> id           </span>|<span class="string"> 232c4a99a3fd46bca2bfc092a4ff0705 </span>|</span><br><span class="line">|<span class="string"> interface    </span>|<span class="string"> admin                            </span>|</span><br><span class="line">|<span class="string"> region       </span>|<span class="string"> RegionOne                        </span>|</span><br><span class="line">|<span class="string"> region_id    </span>|<span class="string"> RegionOne                        </span>|</span><br><span class="line">|<span class="string"> service_id   </span>|<span class="string"> 70155ce6ff3f41348cafa6e498d96e99 </span>|</span><br><span class="line">|<span class="string"> service_name </span>|<span class="string"> nova                             </span>|</span><br><span class="line">|<span class="string"> service_type </span>|<span class="string"> compute                          </span>|</span><br><span class="line">|<span class="string"> url          </span>|<span class="string"> http://controller:8774/v2.1      </span>|</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">[root<span class="meta">@openstack</span> ~]<span class="comment"># openstack endpoint list</span></span><br><span class="line">+----------------------------------+-----------+--------------+--------------+---------+-----------+-----------------------------+</span><br><span class="line">|<span class="string"> ID                               </span>|<span class="string"> Region    </span>|<span class="string"> Service Name </span>|<span class="string"> Service Type </span>|<span class="string"> Enabled </span>|<span class="string"> Interface </span>|<span class="string"> URL                         </span>|</span><br><span class="line">+----------------------------------+-----------+--------------+--------------+---------+-----------+-----------------------------+</span><br><span class="line">|<span class="string"> 1640b8023b96498ba283d645573acbf5 </span>|<span class="string"> RegionOne </span>|<span class="string"> nova         </span>|<span class="string"> compute      </span>|<span class="string"> True    </span>|<span class="string"> internal  </span>|<span class="string"> http://controller:8774/v2.1 </span>|</span><br><span class="line">|<span class="string"> 232c4a99a3fd46bca2bfc092a4ff0705 </span>|<span class="string"> RegionOne </span>|<span class="string"> nova         </span>|<span class="string"> compute      </span>|<span class="string"> True    </span>|<span class="string"> admin     </span>|<span class="string"> http://controller:8774/v2.1 </span>|</span><br><span class="line">|<span class="string"> 498db99146dc43d982449b1c7c6ac16b </span>|<span class="string"> RegionOne </span>|<span class="string"> keystone     </span>|<span class="string"> identity     </span>|<span class="string"> True    </span>|<span class="string"> public    </span>|<span class="string"> http://controller:5000/v3/  </span>|</span><br><span class="line">|<span class="string"> 4c22aba83615477eaf5c42d935f882b8 </span>|<span class="string"> RegionOne </span>|<span class="string"> glance       </span>|<span class="string"> image        </span>|<span class="string"> True    </span>|<span class="string"> internal  </span>|<span class="string"> http://controller:9292      </span>|</span><br><span class="line">|<span class="string"> 54b25eea3f8a46c7af947adb4bff18ed </span>|<span class="string"> RegionOne </span>|<span class="string"> glance       </span>|<span class="string"> image        </span>|<span class="string"> True    </span>|<span class="string"> admin     </span>|<span class="string"> http://controller:9292      </span>|</span><br><span class="line">|<span class="string"> 61af677340904813b4a5244da0a036ca </span>|<span class="string"> RegionOne </span>|<span class="string"> keystone     </span>|<span class="string"> identity     </span>|<span class="string"> True    </span>|<span class="string"> admin     </span>|<span class="string"> http://controller:5000/v3/  </span>|</span><br><span class="line">|<span class="string"> 9c6d59dfc5cc4f6c8dd55eb1c944e17c </span>|<span class="string"> RegionOne </span>|<span class="string"> keystone     </span>|<span class="string"> identity     </span>|<span class="string"> True    </span>|<span class="string"> internal  </span>|<span class="string"> http://controller:5000/v3/  </span>|</span><br><span class="line">|<span class="string"> b02bf56e9c6f4ad6a54e513f23d333c7 </span>|<span class="string"> RegionOne </span>|<span class="string"> glance       </span>|<span class="string"> image        </span>|<span class="string"> True    </span>|<span class="string"> public    </span>|<span class="string"> http://controller:9292      </span>|</span><br><span class="line">|<span class="string"> dd00497083f94f8b8bae6fac7735f2f7 </span>|<span class="string"> RegionOne </span>|<span class="string"> nova         </span>|<span class="string"> compute      </span>|<span class="string"> True    </span>|<span class="string"> public    </span>|<span class="string"> http://controller:8774/v2.1 </span>|</span><br><span class="line">+----------------------------------+-----------+--------------+--------------+---------+-----------+-----------------------------+</span><br></pre></td></tr></table></figure>
<h3 id="6-创建一个名为-placement-的-KeyStone-用户"><a href="#6-创建一个名为-placement-的-KeyStone-用户" class="headerlink" title="6. 创建一个名为 placement 的 KeyStone 用户"></a>6. 创建一个名为 placement 的 KeyStone 用户</h3><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="meta">@openstack</span> ~]<span class="comment"># . admin-openrc </span></span><br><span class="line">[root<span class="meta">@openstack</span> ~]<span class="comment"># openstack user create --domain default --password=123456 placement</span></span><br><span class="line">+---------------------+----------------------------------+</span><br><span class="line">|<span class="string"> Field               </span>|<span class="string"> Value                            </span>|</span><br><span class="line">+---------------------+----------------------------------+</span><br><span class="line">|<span class="string"> domain_id           </span>|<span class="string"> default                          </span>|</span><br><span class="line">|<span class="string"> enabled             </span>|<span class="string"> True                             </span>|</span><br><span class="line">|<span class="string"> id                  </span>|<span class="string"> 99f1f663e39f47c99b5bf59706541fc4 </span>|</span><br><span class="line">|<span class="string"> name                </span>|<span class="string"> placement                        </span>|</span><br><span class="line">|<span class="string"> options             </span>|<span class="string"> &#123;&#125;                               </span>|</span><br><span class="line">|<span class="string"> password_expires_at </span>|<span class="string"> None                             </span>|</span><br><span class="line">+---------------------+----------------------------------+</span><br><span class="line">[root<span class="meta">@openstack</span> ~]<span class="comment"># openstack user list</span></span><br><span class="line">+----------------------------------+-----------+</span><br><span class="line">|<span class="string"> ID                               </span>|<span class="string"> Name      </span>|</span><br><span class="line">+----------------------------------+-----------+</span><br><span class="line">|<span class="string"> 063e3004acc94429a6b2a2cec9776608 </span>|<span class="string"> glance    </span>|</span><br><span class="line">|<span class="string"> 50f123bb0cc640b7bc2603a3c5757b51 </span>|<span class="string"> nova      </span>|</span><br><span class="line">|<span class="string"> 84e7e67f49ff4d13a7b7334134a13db2 </span>|<span class="string"> admin     </span>|</span><br><span class="line">|<span class="string"> 99f1f663e39f47c99b5bf59706541fc4 </span>|<span class="string"> placement </span>|</span><br><span class="line">|<span class="string"> a2750e3ab9144584962f1e28eaa496ee </span>|<span class="string"> myuser    </span>|</span><br><span class="line">+----------------------------------+-----------+</span><br></pre></td></tr></table></figure>
<h3 id="7-将-placement-用户添加到-service-项目的-admin-角色"><a href="#7-将-placement-用户添加到-service-项目的-admin-角色" class="headerlink" title="7. 将 placement 用户添加到 service 项目的 admin 角色"></a>7. 将 placement 用户添加到 service 项目的 admin 角色</h3><p>以下命令无输出<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# openstack role <span class="builtin-name">add</span> --project<span class="built_in"> service </span>--user placement admin</span><br></pre></td></tr></table></figure></p>
<h3 id="8-创建-Placement-项目实例"><a href="#8-创建-Placement-项目实例" class="headerlink" title="8. 创建 Placement 项目实例"></a>8. 创建 Placement 项目实例</h3><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# openstack<span class="built_in"> service </span>create --name placement --description <span class="string">"Placement API"</span> placement</span><br><span class="line">+-------------+----------------------------------+</span><br><span class="line">| Field       | Value                            |</span><br><span class="line">+-------------+----------------------------------+</span><br><span class="line">| description | Placement API                    |</span><br><span class="line">| enabled     | <span class="literal">True</span>                             |</span><br><span class="line">| id          | a47516d9fae94cbd85f43a994ac2f4b4 |</span><br><span class="line">| name        | placement                        |</span><br><span class="line">|<span class="built_in"> type </span>       | placement                        |</span><br><span class="line">+-------------+----------------------------------+</span><br><span class="line">[root@openstack ~]# openstack<span class="built_in"> service </span>list</span><br><span class="line">+----------------------------------+-----------+-----------+</span><br><span class="line">| ID                               | Name      |<span class="built_in"> Type </span>     |</span><br><span class="line">+----------------------------------+-----------+-----------+</span><br><span class="line">| 363f73076d45482c9a680f11193549e9 | keystone  |<span class="built_in"> identity </span> |</span><br><span class="line">| 70155ce6ff3f41348cafa6e498d96e99 | nova      | compute   |</span><br><span class="line">| a47516d9fae94cbd85f43a994ac2f4b4 | placement | placement |</span><br><span class="line">| c9ed8738afa94a4abbe91144f2d67f45 | glance    | image     |</span><br><span class="line">+----------------------------------+-----------+-----------+</span><br></pre></td></tr></table></figure>
<h3 id="9-创建-Nova-镜像服务的-API-端点-endpoint"><a href="#9-创建-Nova-镜像服务的-API-端点-endpoint" class="headerlink" title="9. 创建 Nova 镜像服务的 API 端点 (endpoint)"></a>9. 创建 Nova 镜像服务的 API 端点 (endpoint)</h3><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="meta">@openstack</span> ~]<span class="comment"># openstack endpoint create --region RegionOne placement public http://controller:8778</span></span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">|<span class="string"> Field        </span>|<span class="string"> Value                            </span>|</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">|<span class="string"> enabled      </span>|<span class="string"> True                             </span>|</span><br><span class="line">|<span class="string"> id           </span>|<span class="string"> 1f24214b544b4804a1f5e3fbe3438a2c </span>|</span><br><span class="line">|<span class="string"> interface    </span>|<span class="string"> public                           </span>|</span><br><span class="line">|<span class="string"> region       </span>|<span class="string"> RegionOne                        </span>|</span><br><span class="line">|<span class="string"> region_id    </span>|<span class="string"> RegionOne                        </span>|</span><br><span class="line">|<span class="string"> service_id   </span>|<span class="string"> a47516d9fae94cbd85f43a994ac2f4b4 </span>|</span><br><span class="line">|<span class="string"> service_name </span>|<span class="string"> placement                        </span>|</span><br><span class="line">|<span class="string"> service_type </span>|<span class="string"> placement                        </span>|</span><br><span class="line">|<span class="string"> url          </span>|<span class="string"> http://controller:8778           </span>|</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">[root<span class="meta">@openstack</span> ~]<span class="comment"># openstack endpoint create --region RegionOne placement internal http://controller:8778</span></span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">|<span class="string"> Field        </span>|<span class="string"> Value                            </span>|</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">|<span class="string"> enabled      </span>|<span class="string"> True                             </span>|</span><br><span class="line">|<span class="string"> id           </span>|<span class="string"> 842e55cc821b4a74b9093072a02184fc </span>|</span><br><span class="line">|<span class="string"> interface    </span>|<span class="string"> internal                         </span>|</span><br><span class="line">|<span class="string"> region       </span>|<span class="string"> RegionOne                        </span>|</span><br><span class="line">|<span class="string"> region_id    </span>|<span class="string"> RegionOne                        </span>|</span><br><span class="line">|<span class="string"> service_id   </span>|<span class="string"> a47516d9fae94cbd85f43a994ac2f4b4 </span>|</span><br><span class="line">|<span class="string"> service_name </span>|<span class="string"> placement                        </span>|</span><br><span class="line">|<span class="string"> service_type </span>|<span class="string"> placement                        </span>|</span><br><span class="line">|<span class="string"> url          </span>|<span class="string"> http://controller:8778           </span>|</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">[root<span class="meta">@openstack</span> ~]<span class="comment"># openstack endpoint create --region RegionOne placement admin http://controller:8778</span></span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">|<span class="string"> Field        </span>|<span class="string"> Value                            </span>|</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">|<span class="string"> enabled      </span>|<span class="string"> True                             </span>|</span><br><span class="line">|<span class="string"> id           </span>|<span class="string"> ddd75210cbcf4d9294c6ddfcb1bb1927 </span>|</span><br><span class="line">|<span class="string"> interface    </span>|<span class="string"> admin                            </span>|</span><br><span class="line">|<span class="string"> region       </span>|<span class="string"> RegionOne                        </span>|</span><br><span class="line">|<span class="string"> region_id    </span>|<span class="string"> RegionOne                        </span>|</span><br><span class="line">|<span class="string"> service_id   </span>|<span class="string"> a47516d9fae94cbd85f43a994ac2f4b4 </span>|</span><br><span class="line">|<span class="string"> service_name </span>|<span class="string"> placement                        </span>|</span><br><span class="line">|<span class="string"> service_type </span>|<span class="string"> placement                        </span>|</span><br><span class="line">|<span class="string"> url          </span>|<span class="string"> http://controller:8778           </span>|</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">[root<span class="meta">@openstack</span> ~]<span class="comment"># openstack endpoint list</span></span><br><span class="line">+----------------------------------+-----------+--------------+--------------+---------+-----------+-----------------------------+</span><br><span class="line">|<span class="string"> ID                               </span>|<span class="string"> Region    </span>|<span class="string"> Service Name </span>|<span class="string"> Service Type </span>|<span class="string"> Enabled </span>|<span class="string"> Interface </span>|<span class="string"> URL                         </span>|</span><br><span class="line">+----------------------------------+-----------+--------------+--------------+---------+-----------+-----------------------------+</span><br><span class="line">|<span class="string"> 1640b8023b96498ba283d645573acbf5 </span>|<span class="string"> RegionOne </span>|<span class="string"> nova         </span>|<span class="string"> compute      </span>|<span class="string"> True    </span>|<span class="string"> internal  </span>|<span class="string"> http://controller:8774/v2.1 </span>|</span><br><span class="line">|<span class="string"> 1f24214b544b4804a1f5e3fbe3438a2c </span>|<span class="string"> RegionOne </span>|<span class="string"> placement    </span>|<span class="string"> placement    </span>|<span class="string"> True    </span>|<span class="string"> public    </span>|<span class="string"> http://controller:8778      </span>|</span><br><span class="line">|<span class="string"> 232c4a99a3fd46bca2bfc092a4ff0705 </span>|<span class="string"> RegionOne </span>|<span class="string"> nova         </span>|<span class="string"> compute      </span>|<span class="string"> True    </span>|<span class="string"> admin     </span>|<span class="string"> http://controller:8774/v2.1 </span>|</span><br><span class="line">|<span class="string"> 498db99146dc43d982449b1c7c6ac16b </span>|<span class="string"> RegionOne </span>|<span class="string"> keystone     </span>|<span class="string"> identity     </span>|<span class="string"> True    </span>|<span class="string"> public    </span>|<span class="string"> http://controller:5000/v3/  </span>|</span><br><span class="line">|<span class="string"> 4c22aba83615477eaf5c42d935f882b8 </span>|<span class="string"> RegionOne </span>|<span class="string"> glance       </span>|<span class="string"> image        </span>|<span class="string"> True    </span>|<span class="string"> internal  </span>|<span class="string"> http://controller:9292      </span>|</span><br><span class="line">|<span class="string"> 54b25eea3f8a46c7af947adb4bff18ed </span>|<span class="string"> RegionOne </span>|<span class="string"> glance       </span>|<span class="string"> image        </span>|<span class="string"> True    </span>|<span class="string"> admin     </span>|<span class="string"> http://controller:9292      </span>|</span><br><span class="line">|<span class="string"> 61af677340904813b4a5244da0a036ca </span>|<span class="string"> RegionOne </span>|<span class="string"> keystone     </span>|<span class="string"> identity     </span>|<span class="string"> True    </span>|<span class="string"> admin     </span>|<span class="string"> http://controller:5000/v3/  </span>|</span><br><span class="line">|<span class="string"> 842e55cc821b4a74b9093072a02184fc </span>|<span class="string"> RegionOne </span>|<span class="string"> placement    </span>|<span class="string"> placement    </span>|<span class="string"> True    </span>|<span class="string"> internal  </span>|<span class="string"> http://controller:8778      </span>|</span><br><span class="line">|<span class="string"> 9c6d59dfc5cc4f6c8dd55eb1c944e17c </span>|<span class="string"> RegionOne </span>|<span class="string"> keystone     </span>|<span class="string"> identity     </span>|<span class="string"> True    </span>|<span class="string"> internal  </span>|<span class="string"> http://controller:5000/v3/  </span>|</span><br><span class="line">|<span class="string"> b02bf56e9c6f4ad6a54e513f23d333c7 </span>|<span class="string"> RegionOne </span>|<span class="string"> glance       </span>|<span class="string"> image        </span>|<span class="string"> True    </span>|<span class="string"> public    </span>|<span class="string"> http://controller:9292      </span>|</span><br><span class="line">|<span class="string"> dd00497083f94f8b8bae6fac7735f2f7 </span>|<span class="string"> RegionOne </span>|<span class="string"> nova         </span>|<span class="string"> compute      </span>|<span class="string"> True    </span>|<span class="string"> public    </span>|<span class="string"> http://controller:8774/v2.1 </span>|</span><br><span class="line">|<span class="string"> ddd75210cbcf4d9294c6ddfcb1bb1927 </span>|<span class="string"> RegionOne </span>|<span class="string"> placement    </span>|<span class="string"> placement    </span>|<span class="string"> True    </span>|<span class="string"> admin     </span>|<span class="string"> http://controller:8778      </span>|</span><br><span class="line">+----------------------------------+-----------+--------------+--------------+---------+-----------+-----------------------------+</span><br></pre></td></tr></table></figure>
<h3 id="10-安装并配置-Nova-相关软件"><a href="#10-安装并配置-Nova-相关软件" class="headerlink" title="10. 安装并配置 Nova 相关软件"></a>10. 安装并配置 Nova 相关软件</h3><h4 id="a-安装-Nova-相关软件"><a href="#a-安装-Nova-相关软件" class="headerlink" title="a) 安装 Nova 相关软件"></a>a) 安装 Nova 相关软件</h4><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@openstack</span> ~]<span class="meta"># yum install -y openstack-nova-api openstack-nova-conductor openstack-nova-console openstack-nova-novncproxy openstack-nova-scheduler openstack-nova-placement-api</span></span><br><span class="line">...</span><br><span class="line">Complete!</span><br></pre></td></tr></table></figure>
<h4 id="b-修改-Glance-的配置文件-nova-conf"><a href="#b-修改-Glance-的配置文件-nova-conf" class="headerlink" title="b) 修改 Glance 的配置文件 (nova.conf)"></a>b) 修改 Glance 的配置文件 (nova.conf)</h4><p><strong><em>必须确认配置是否正确</em></strong><br><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/nova/nova.conf DEFAULT enabled_apis "osapi_compute,metadata"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/nova/nova.conf DEFAULT my_ip "192.168.10.11"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/nova/nova.conf DEFAULT use_neutron "true"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/nova/nova.conf DEFAULT firewall_driver "nova.virt.firewall.NoopFirewallDriver"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/nova/nova.conf DEFAULT transport_url "rabbit://openstack:123456@controller"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/nova/nova.conf api_database connection "mysql+pymysql://nova:123456@controller/nova_api"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/nova/nova.conf database connection "mysql+pymysql://nova:123456@controller/nova"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/nova/nova.conf placement_database connection "mysql+pymysql://placement:123456@controller/placement"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/nova/nova.conf api auth_strategy "keystone" </span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/nova/nova.conf keystone_authtoken auth_url "http://controller:5000/v3"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/nova/nova.conf keystone_authtoken memcached_servers "controller:11211"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/nova/nova.conf keystone_authtoken auth_type "password"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/nova/nova.conf keystone_authtoken project_domain_name "default"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/nova/nova.conf keystone_authtoken user_domain_name "default"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/nova/nova.conf keystone_authtoken project_name "service" </span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/nova/nova.conf keystone_authtoken username "nova" </span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/nova/nova.conf keystone_authtoken password "123456"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/nova/nova.conf vnc enabled "true"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/nova/nova.conf vnc server_listen "\$my_ip"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/nova/nova.conf vnc server_proxyclient_address "\$my_ip"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/nova/nova.conf glance api_servers "http://controller:9292"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/nova/nova.conf oslo_concurrency lock_path "/var/lib/nova/tmp "</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/nova/nova.conf placement region_name "RegionOne"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/nova/nova.conf placement project_domain_name "Default"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/nova/nova.conf placement project_name "service"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/nova/nova.conf placement auth_type "password"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/nova/nova.conf placement user_domain_name "Default"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/nova/nova.conf placement auth_url "http://controller:5000/v3"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/nova/nova.conf placement username "placement"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/nova/nova.conf placement password "123456"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/nova/nova.conf scheduler discover_hosts_in_cells_interval "300"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># grep '^[a-z]' /etc/nova/nova.conf</span></span><br><span class="line"><span class="attr">enabled_apis</span> = osapi_compute,metadata</span><br><span class="line"><span class="attr">my_ip</span> = <span class="number">192.168</span>.<span class="number">10.11</span></span><br><span class="line"><span class="attr">use_neutron</span> = <span class="literal">true</span></span><br><span class="line"><span class="attr">firewall_driver</span> = nova.virt.firewall.NoopFirewallDriver</span><br><span class="line"><span class="attr">transport_url</span> = rabbit://openstack:<span class="number">123456</span>@controller</span><br><span class="line"><span class="attr">auth_strategy</span> = keystone</span><br><span class="line"><span class="attr">connection</span> = mysql+pymysql://nova:<span class="number">123456</span>@controller/nova_api</span><br><span class="line"><span class="attr">connection</span> = mysql+pymysql://nova:<span class="number">123456</span>@controller/nova</span><br><span class="line"><span class="attr">api_servers</span> = http://controller:<span class="number">9292</span></span><br><span class="line"><span class="attr">auth_url</span> = http://controller:<span class="number">5000</span>/v3</span><br><span class="line"><span class="attr">memcached_servers</span> = controller:<span class="number">11211</span></span><br><span class="line"><span class="attr">auth_type</span> = password</span><br><span class="line"><span class="attr">project_domain_name</span> = default</span><br><span class="line"><span class="attr">user_domain_name</span> = default</span><br><span class="line"><span class="attr">project_name</span> = service</span><br><span class="line"><span class="attr">username</span> = nova</span><br><span class="line"><span class="attr">password</span> = <span class="number">123456</span></span><br><span class="line"><span class="attr">lock_path</span> = /var/lib/nova/tmp </span><br><span class="line"><span class="attr">region_name</span> = RegionOne</span><br><span class="line"><span class="attr">project_domain_name</span> = Default</span><br><span class="line"><span class="attr">project_name</span> = service</span><br><span class="line"><span class="attr">auth_type</span> = password</span><br><span class="line"><span class="attr">user_domain_name</span> = Default</span><br><span class="line"><span class="attr">auth_url</span> = http://controller:<span class="number">5000</span>/v3</span><br><span class="line"><span class="attr">username</span> = placement</span><br><span class="line"><span class="attr">password</span> = <span class="number">123456</span></span><br><span class="line"><span class="attr">connection</span> = mysql+pymysql://placement:<span class="number">123456</span>@controller/placement</span><br><span class="line"><span class="attr">discover_hosts_in_cells_interval</span> = <span class="number">300</span></span><br><span class="line"><span class="attr">enabled</span> = <span class="literal">true</span></span><br><span class="line"><span class="attr">server_listen</span> = <span class="variable">$my_ip</span></span><br><span class="line"><span class="attr">server_proxyclient_address</span> = <span class="variable">$my_ip</span></span><br></pre></td></tr></table></figure></p>
<h4 id="d-修改-Apache-Httpd-的虚拟主机配置文件-00-nova-placement-api-conf"><a href="#d-修改-Apache-Httpd-的虚拟主机配置文件-00-nova-placement-api-conf" class="headerlink" title="d) 修改 Apache (Httpd) 的虚拟主机配置文件 (00-nova-placement-api.conf)"></a>d) 修改 Apache (Httpd) 的虚拟主机配置文件 (00-nova-placement-api.conf)</h4><p>添加最后一段配置以修复 bug<br><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]<span class="meta"># vim /etc/httpd/conf.d/00-nova-placement-api.conf </span></span><br><span class="line">[root@openstack ~]<span class="meta"># cat /etc/httpd/conf.d/00-nova-placement-api.conf </span></span><br><span class="line">Listen <span class="number">8778</span></span><br><span class="line"></span><br><span class="line"><span class="params">&lt;VirtualHost *:<span class="number">8778</span>&gt;</span></span><br><span class="line">  WSGIProcessGroup nova-placement-api</span><br><span class="line">  WSGIApplicationGroup %&#123;GLOBAL&#125;</span><br><span class="line">  WSGIPassAuthorization On</span><br><span class="line">  WSGIDaemonProcess nova-placement-api processes=<span class="number">3</span> threads=<span class="number">1</span> user=nova group=nova</span><br><span class="line">  WSGIScriptAlias / <span class="meta-keyword">/usr/</span>bin/nova-placement-api</span><br><span class="line">  <span class="params">&lt;IfVersion &gt;</span>= <span class="number">2.4</span>&gt;</span><br><span class="line">    ErrorLogFormat <span class="string">"%M"</span></span><br><span class="line">  <span class="params">&lt;/IfVersion&gt;</span></span><br><span class="line">  ErrorLog <span class="meta-keyword">/var/</span>log<span class="meta-keyword">/nova/</span>nova-placement-api.log</span><br><span class="line">  <span class="meta">#SSLEngine On</span></span><br><span class="line">  <span class="meta">#SSLCertificateFile ...</span></span><br><span class="line">  <span class="meta">#SSLCertificateKeyFile ...</span></span><br><span class="line"><span class="params">&lt;/VirtualHost&gt;</span></span><br><span class="line"></span><br><span class="line">Alias /nova-placement-api <span class="meta-keyword">/usr/</span>bin/nova-placement-api</span><br><span class="line"><span class="params">&lt;Location /nova-placement-api&gt;</span></span><br><span class="line">  SetHandler wsgi-script</span><br><span class="line">  Options +ExecCGI</span><br><span class="line">  WSGIProcessGroup nova-placement-api</span><br><span class="line">  WSGIApplicationGroup %&#123;GLOBAL&#125;</span><br><span class="line">  WSGIPassAuthorization On</span><br><span class="line"><span class="params">&lt;/Location&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># ADD - make by zhaoshuai</span></span><br><span class="line"><span class="params">&lt;Directory /usr/bin&gt;</span></span><br><span class="line">   <span class="params">&lt;IfVersion &gt;</span>= <span class="number">2.4</span>&gt;</span><br><span class="line">      Require all granted</span><br><span class="line">   <span class="params">&lt;/IfVersion&gt;</span></span><br><span class="line">   <span class="params">&lt;IfVersion &lt; <span class="number">2.4</span>&gt;</span></span><br><span class="line">      Order allow,deny</span><br><span class="line">      Allow from all</span><br><span class="line">   <span class="params">&lt;/IfVersion&gt;</span></span><br><span class="line"><span class="params">&lt;/Directory&gt;</span></span><br></pre></td></tr></table></figure></p>
<h3 id="11-重启-Apache-Httpd-服务"><a href="#11-重启-Apache-Httpd-服务" class="headerlink" title="11. 重启 Apache (Httpd) 服务"></a>11. 重启 Apache (Httpd) 服务</h3><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@openstack</span> ~]<span class="meta"># systemctl restart httpd</span></span><br></pre></td></tr></table></figure>
<h3 id="12-初始化-nova-api-placement-数据库-请按顺序执行"><a href="#12-初始化-nova-api-placement-数据库-请按顺序执行" class="headerlink" title="12. 初始化 nova-api, placement 数据库 (请按顺序执行)"></a>12. 初始化 nova-api, placement 数据库 <strong><em>(请按顺序执行)</em></strong></h3><p><strong><em>必须确认数据库是否初始化正确</em></strong><br><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="meta">@openstack</span> ~]<span class="comment"># su -s /bin/sh -c "nova-manage api_db sync" nova</span></span><br><span class="line">[root<span class="meta">@openstack</span> ~]<span class="comment"># mysql -unova -p123456 -e "use nova_api;show tables;" | wc -l</span></span><br><span class="line">33</span><br><span class="line">[root<span class="meta">@openstack</span> ~]<span class="comment"># mysql -unova -p123456 -e "use nova_api;show tables;"</span></span><br><span class="line">+------------------------------+</span><br><span class="line">|<span class="string"> Tables_in_nova_api           </span>|</span><br><span class="line">+------------------------------+</span><br><span class="line">|<span class="string"> aggregate_hosts              </span>|</span><br><span class="line">|<span class="string"> aggregate_metadata           </span>|</span><br><span class="line">|<span class="string"> aggregates                   </span>|</span><br><span class="line">|<span class="string"> allocations                  </span>|</span><br><span class="line">|<span class="string"> build_requests               </span>|</span><br><span class="line">|<span class="string"> cell_mappings                </span>|</span><br><span class="line">|<span class="string"> consumers                    </span>|</span><br><span class="line">|<span class="string"> flavor_extra_specs           </span>|</span><br><span class="line">|<span class="string"> flavor_projects              </span>|</span><br><span class="line">|<span class="string"> flavors                      </span>|</span><br><span class="line">|<span class="string"> host_mappings                </span>|</span><br><span class="line">|<span class="string"> instance_group_member        </span>|</span><br><span class="line">|<span class="string"> instance_group_policy        </span>|</span><br><span class="line">|<span class="string"> instance_groups              </span>|</span><br><span class="line">|<span class="string"> instance_mappings            </span>|</span><br><span class="line">|<span class="string"> inventories                  </span>|</span><br><span class="line">|<span class="string"> key_pairs                    </span>|</span><br><span class="line">|<span class="string"> migrate_version              </span>|</span><br><span class="line">|<span class="string"> placement_aggregates         </span>|</span><br><span class="line">|<span class="string"> project_user_quotas          </span>|</span><br><span class="line">|<span class="string"> projects                     </span>|</span><br><span class="line">|<span class="string"> quota_classes                </span>|</span><br><span class="line">|<span class="string"> quota_usages                 </span>|</span><br><span class="line">|<span class="string"> quotas                       </span>|</span><br><span class="line">|<span class="string"> request_specs                </span>|</span><br><span class="line">|<span class="string"> reservations                 </span>|</span><br><span class="line">|<span class="string"> resource_classes             </span>|</span><br><span class="line">|<span class="string"> resource_provider_aggregates </span>|</span><br><span class="line">|<span class="string"> resource_provider_traits     </span>|</span><br><span class="line">|<span class="string"> resource_providers           </span>|</span><br><span class="line">|<span class="string"> traits                       </span>|</span><br><span class="line">|<span class="string"> users                        </span>|</span><br><span class="line">+------------------------------+</span><br><span class="line">[root<span class="meta">@openstack</span> ~]<span class="comment"># mysql -uplacement -p123456 -e "use placement;show tables;" | wc -l</span></span><br><span class="line">33</span><br><span class="line">[root<span class="meta">@openstack</span> ~]<span class="comment"># mysql -uplacement -p123456 -e "use placement;show tables;"</span></span><br><span class="line">+------------------------------+</span><br><span class="line">|<span class="string"> Tables_in_placement          </span>|</span><br><span class="line">+------------------------------+</span><br><span class="line">|<span class="string"> aggregate_hosts              </span>|</span><br><span class="line">|<span class="string"> aggregate_metadata           </span>|</span><br><span class="line">|<span class="string"> aggregates                   </span>|</span><br><span class="line">|<span class="string"> allocations                  </span>|</span><br><span class="line">|<span class="string"> build_requests               </span>|</span><br><span class="line">|<span class="string"> cell_mappings                </span>|</span><br><span class="line">|<span class="string"> consumers                    </span>|</span><br><span class="line">|<span class="string"> flavor_extra_specs           </span>|</span><br><span class="line">|<span class="string"> flavor_projects              </span>|</span><br><span class="line">|<span class="string"> flavors                      </span>|</span><br><span class="line">|<span class="string"> host_mappings                </span>|</span><br><span class="line">|<span class="string"> instance_group_member        </span>|</span><br><span class="line">|<span class="string"> instance_group_policy        </span>|</span><br><span class="line">|<span class="string"> instance_groups              </span>|</span><br><span class="line">|<span class="string"> instance_mappings            </span>|</span><br><span class="line">|<span class="string"> inventories                  </span>|</span><br><span class="line">|<span class="string"> key_pairs                    </span>|</span><br><span class="line">|<span class="string"> migrate_version              </span>|</span><br><span class="line">|<span class="string"> placement_aggregates         </span>|</span><br><span class="line">|<span class="string"> project_user_quotas          </span>|</span><br><span class="line">|<span class="string"> projects                     </span>|</span><br><span class="line">|<span class="string"> quota_classes                </span>|</span><br><span class="line">|<span class="string"> quota_usages                 </span>|</span><br><span class="line">|<span class="string"> quotas                       </span>|</span><br><span class="line">|<span class="string"> request_specs                </span>|</span><br><span class="line">|<span class="string"> reservations                 </span>|</span><br><span class="line">|<span class="string"> resource_classes             </span>|</span><br><span class="line">|<span class="string"> resource_provider_aggregates </span>|</span><br><span class="line">|<span class="string"> resource_provider_traits     </span>|</span><br><span class="line">|<span class="string"> resource_providers           </span>|</span><br><span class="line">|<span class="string"> traits                       </span>|</span><br><span class="line">|<span class="string"> users                        </span>|</span><br><span class="line">+------------------------------+</span><br></pre></td></tr></table></figure></p>
<h3 id="13-初始化-nova-cell0-nova-数据库-请按顺序执行"><a href="#13-初始化-nova-cell0-nova-数据库-请按顺序执行" class="headerlink" title="13. 初始化 nova_cell0, nova 数据库 (请按顺序执行)"></a>13. 初始化 nova_cell0, nova 数据库 <strong><em>(请按顺序执行)</em></strong></h3><p><strong><em>必须确认数据库是否初始化正确</em></strong><br><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="meta">@openstack</span> ~]<span class="comment"># su -s /bin/sh -c "nova-manage cell_v2 map_cell0" nova</span></span><br><span class="line">[root<span class="meta">@openstack</span> ~]<span class="comment"># su -s /bin/sh -c "nova-manage cell_v2 create_cell --name=cell1 --verbose" nova</span></span><br><span class="line">9edf7b72-1607-432d-8529-30f07576da4a</span><br><span class="line">[root<span class="meta">@openstack</span> ~]<span class="comment"># su -s /bin/sh -c "nova-manage db sync" nova</span></span><br><span class="line">/usr/lib/python2.7/site-packages/pymysql/cursors.py:170: Warning: (1831, u'Duplicate index `block_device_mapping_instance_uuid_virtual_name_device_name_idx`. This is deprecated and will be disallowed in a future release.')</span><br><span class="line">  result = self._query(query)</span><br><span class="line">/usr/lib/python2.7/site-packages/pymysql/cursors.py:170: Warning: (1831, u'Duplicate index `uniq_instances0uuid`. This is deprecated and will be disallowed in a future release.')</span><br><span class="line">  result = self._query(query)</span><br><span class="line">[root<span class="meta">@openstack</span> ~]<span class="comment"># su -s /bin/sh -c "nova-manage cell_v2 list_cells" nova</span></span><br><span class="line">+-------+--------------------------------------+------------------------------------+-------------------------------------------------+----------+</span><br><span class="line">|<span class="string">  Name </span>|<span class="string">                 UUID                 </span>|<span class="string">           Transport URL            </span>|<span class="string">               Database Connection               </span>|<span class="string"> Disabled </span>|</span><br><span class="line">+-------+--------------------------------------+------------------------------------+-------------------------------------------------+----------+</span><br><span class="line">|<span class="string"> cell0 </span>|<span class="string"> 00000000-0000-0000-0000-000000000000 </span>|<span class="string">               none:/               </span>|<span class="string"> mysql+pymysql://nova:****@controller/nova_cell0 </span>|<span class="string">  False   </span>|</span><br><span class="line">|<span class="string"> cell1 </span>|<span class="string"> 9edf7b72-1607-432d-8529-30f07576da4a </span>|<span class="string"> rabbit://openstack:****@controller </span>|<span class="string">    mysql+pymysql://nova:****@controller/nova    </span>|<span class="string">  False   </span>|</span><br><span class="line">+-------+--------------------------------------+------------------------------------+-------------------------------------------------+----------+</span><br><span class="line">[root<span class="meta">@openstack</span> ~]<span class="comment"># mysql -unova -p123456 -e "use nova_cell0;show tables;" | wc -l</span></span><br><span class="line">111</span><br><span class="line">[root<span class="meta">@openstack</span> ~]<span class="comment"># mysql -unova -p123456 -e "use nova_cell0;show tables;"</span></span><br><span class="line">+--------------------------------------------+</span><br><span class="line">|<span class="string"> Tables_in_nova_cell0                       </span>|</span><br><span class="line">+--------------------------------------------+</span><br><span class="line">|<span class="string"> agent_builds                               </span>|</span><br><span class="line">|<span class="string"> aggregate_hosts                            </span>|</span><br><span class="line">|<span class="string"> aggregate_metadata                         </span>|</span><br><span class="line">|<span class="string"> aggregates                                 </span>|</span><br><span class="line">|<span class="string"> allocations                                </span>|</span><br><span class="line">|<span class="string"> block_device_mapping                       </span>|</span><br><span class="line">|<span class="string"> bw_usage_cache                             </span>|</span><br><span class="line">|<span class="string"> cells                                      </span>|</span><br><span class="line">|<span class="string"> certificates                               </span>|</span><br><span class="line">|<span class="string"> compute_nodes                              </span>|</span><br><span class="line">|<span class="string"> console_auth_tokens                        </span>|</span><br><span class="line">|<span class="string"> console_pools                              </span>|</span><br><span class="line">|<span class="string"> consoles                                   </span>|</span><br><span class="line">|<span class="string"> dns_domains                                </span>|</span><br><span class="line">|<span class="string"> fixed_ips                                  </span>|</span><br><span class="line">|<span class="string"> floating_ips                               </span>|</span><br><span class="line">|<span class="string"> instance_actions                           </span>|</span><br><span class="line">|<span class="string"> instance_actions_events                    </span>|</span><br><span class="line">|<span class="string"> instance_extra                             </span>|</span><br><span class="line">|<span class="string"> instance_faults                            </span>|</span><br><span class="line">|<span class="string"> instance_group_member                      </span>|</span><br><span class="line">|<span class="string"> instance_group_policy                      </span>|</span><br><span class="line">|<span class="string"> instance_groups                            </span>|</span><br><span class="line">|<span class="string"> instance_id_mappings                       </span>|</span><br><span class="line">|<span class="string"> instance_info_caches                       </span>|</span><br><span class="line">|<span class="string"> instance_metadata                          </span>|</span><br><span class="line">|<span class="string"> instance_system_metadata                   </span>|</span><br><span class="line">|<span class="string"> instance_type_extra_specs                  </span>|</span><br><span class="line">|<span class="string"> instance_type_projects                     </span>|</span><br><span class="line">|<span class="string"> instance_types                             </span>|</span><br><span class="line">|<span class="string"> instances                                  </span>|</span><br><span class="line">|<span class="string"> inventories                                </span>|</span><br><span class="line">|<span class="string"> key_pairs                                  </span>|</span><br><span class="line">|<span class="string"> migrate_version                            </span>|</span><br><span class="line">|<span class="string"> migrations                                 </span>|</span><br><span class="line">|<span class="string"> networks                                   </span>|</span><br><span class="line">|<span class="string"> pci_devices                                </span>|</span><br><span class="line">|<span class="string"> project_user_quotas                        </span>|</span><br><span class="line">|<span class="string"> provider_fw_rules                          </span>|</span><br><span class="line">|<span class="string"> quota_classes                              </span>|</span><br><span class="line">|<span class="string"> quota_usages                               </span>|</span><br><span class="line">|<span class="string"> quotas                                     </span>|</span><br><span class="line">|<span class="string"> reservations                               </span>|</span><br><span class="line">|<span class="string"> resource_provider_aggregates               </span>|</span><br><span class="line">|<span class="string"> resource_providers                         </span>|</span><br><span class="line">|<span class="string"> s3_images                                  </span>|</span><br><span class="line">|<span class="string"> security_group_default_rules               </span>|</span><br><span class="line">|<span class="string"> security_group_instance_association        </span>|</span><br><span class="line">|<span class="string"> security_group_rules                       </span>|</span><br><span class="line">|<span class="string"> security_groups                            </span>|</span><br><span class="line">|<span class="string"> services                                   </span>|</span><br><span class="line">|<span class="string"> shadow_agent_builds                        </span>|</span><br><span class="line">|<span class="string"> shadow_aggregate_hosts                     </span>|</span><br><span class="line">|<span class="string"> shadow_aggregate_metadata                  </span>|</span><br><span class="line">|<span class="string"> shadow_aggregates                          </span>|</span><br><span class="line">|<span class="string"> shadow_block_device_mapping                </span>|</span><br><span class="line">|<span class="string"> shadow_bw_usage_cache                      </span>|</span><br><span class="line">|<span class="string"> shadow_cells                               </span>|</span><br><span class="line">|<span class="string"> shadow_certificates                        </span>|</span><br><span class="line">|<span class="string"> shadow_compute_nodes                       </span>|</span><br><span class="line">|<span class="string"> shadow_console_pools                       </span>|</span><br><span class="line">|<span class="string"> shadow_consoles                            </span>|</span><br><span class="line">|<span class="string"> shadow_dns_domains                         </span>|</span><br><span class="line">|<span class="string"> shadow_fixed_ips                           </span>|</span><br><span class="line">|<span class="string"> shadow_floating_ips                        </span>|</span><br><span class="line">|<span class="string"> shadow_instance_actions                    </span>|</span><br><span class="line">|<span class="string"> shadow_instance_actions_events             </span>|</span><br><span class="line">|<span class="string"> shadow_instance_extra                      </span>|</span><br><span class="line">|<span class="string"> shadow_instance_faults                     </span>|</span><br><span class="line">|<span class="string"> shadow_instance_group_member               </span>|</span><br><span class="line">|<span class="string"> shadow_instance_group_policy               </span>|</span><br><span class="line">|<span class="string"> shadow_instance_groups                     </span>|</span><br><span class="line">|<span class="string"> shadow_instance_id_mappings                </span>|</span><br><span class="line">|<span class="string"> shadow_instance_info_caches                </span>|</span><br><span class="line">|<span class="string"> shadow_instance_metadata                   </span>|</span><br><span class="line">|<span class="string"> shadow_instance_system_metadata            </span>|</span><br><span class="line">|<span class="string"> shadow_instance_type_extra_specs           </span>|</span><br><span class="line">|<span class="string"> shadow_instance_type_projects              </span>|</span><br><span class="line">|<span class="string"> shadow_instance_types                      </span>|</span><br><span class="line">|<span class="string"> shadow_instances                           </span>|</span><br><span class="line">|<span class="string"> shadow_key_pairs                           </span>|</span><br><span class="line">|<span class="string"> shadow_migrate_version                     </span>|</span><br><span class="line">|<span class="string"> shadow_migrations                          </span>|</span><br><span class="line">|<span class="string"> shadow_networks                            </span>|</span><br><span class="line">|<span class="string"> shadow_pci_devices                         </span>|</span><br><span class="line">|<span class="string"> shadow_project_user_quotas                 </span>|</span><br><span class="line">|<span class="string"> shadow_provider_fw_rules                   </span>|</span><br><span class="line">|<span class="string"> shadow_quota_classes                       </span>|</span><br><span class="line">|<span class="string"> shadow_quota_usages                        </span>|</span><br><span class="line">|<span class="string"> shadow_quotas                              </span>|</span><br><span class="line">|<span class="string"> shadow_reservations                        </span>|</span><br><span class="line">|<span class="string"> shadow_s3_images                           </span>|</span><br><span class="line">|<span class="string"> shadow_security_group_default_rules        </span>|</span><br><span class="line">|<span class="string"> shadow_security_group_instance_association </span>|</span><br><span class="line">|<span class="string"> shadow_security_group_rules                </span>|</span><br><span class="line">|<span class="string"> shadow_security_groups                     </span>|</span><br><span class="line">|<span class="string"> shadow_services                            </span>|</span><br><span class="line">|<span class="string"> shadow_snapshot_id_mappings                </span>|</span><br><span class="line">|<span class="string"> shadow_snapshots                           </span>|</span><br><span class="line">|<span class="string"> shadow_task_log                            </span>|</span><br><span class="line">|<span class="string"> shadow_virtual_interfaces                  </span>|</span><br><span class="line">|<span class="string"> shadow_volume_id_mappings                  </span>|</span><br><span class="line">|<span class="string"> shadow_volume_usage_cache                  </span>|</span><br><span class="line">|<span class="string"> snapshot_id_mappings                       </span>|</span><br><span class="line">|<span class="string"> snapshots                                  </span>|</span><br><span class="line">|<span class="string"> tags                                       </span>|</span><br><span class="line">|<span class="string"> task_log                                   </span>|</span><br><span class="line">|<span class="string"> virtual_interfaces                         </span>|</span><br><span class="line">|<span class="string"> volume_id_mappings                         </span>|</span><br><span class="line">|<span class="string"> volume_usage_cache                         </span>|</span><br><span class="line">+--------------------------------------------+</span><br><span class="line">[root<span class="meta">@openstack</span> ~]<span class="comment"># mysql -unova -p123456 -e "use nova;show tables;" | wc -l</span></span><br><span class="line">111</span><br><span class="line">[root<span class="meta">@openstack</span> ~]<span class="comment"># mysql -unova -p123456 -e "use nova;show tables;"</span></span><br><span class="line">+--------------------------------------------+</span><br><span class="line">|<span class="string"> Tables_in_nova                             </span>|</span><br><span class="line">+--------------------------------------------+</span><br><span class="line">|<span class="string"> agent_builds                               </span>|</span><br><span class="line">|<span class="string"> aggregate_hosts                            </span>|</span><br><span class="line">|<span class="string"> aggregate_metadata                         </span>|</span><br><span class="line">|<span class="string"> aggregates                                 </span>|</span><br><span class="line">|<span class="string"> allocations                                </span>|</span><br><span class="line">|<span class="string"> block_device_mapping                       </span>|</span><br><span class="line">|<span class="string"> bw_usage_cache                             </span>|</span><br><span class="line">|<span class="string"> cells                                      </span>|</span><br><span class="line">|<span class="string"> certificates                               </span>|</span><br><span class="line">|<span class="string"> compute_nodes                              </span>|</span><br><span class="line">|<span class="string"> console_auth_tokens                        </span>|</span><br><span class="line">|<span class="string"> console_pools                              </span>|</span><br><span class="line">|<span class="string"> consoles                                   </span>|</span><br><span class="line">|<span class="string"> dns_domains                                </span>|</span><br><span class="line">|<span class="string"> fixed_ips                                  </span>|</span><br><span class="line">|<span class="string"> floating_ips                               </span>|</span><br><span class="line">|<span class="string"> instance_actions                           </span>|</span><br><span class="line">|<span class="string"> instance_actions_events                    </span>|</span><br><span class="line">|<span class="string"> instance_extra                             </span>|</span><br><span class="line">|<span class="string"> instance_faults                            </span>|</span><br><span class="line">|<span class="string"> instance_group_member                      </span>|</span><br><span class="line">|<span class="string"> instance_group_policy                      </span>|</span><br><span class="line">|<span class="string"> instance_groups                            </span>|</span><br><span class="line">|<span class="string"> instance_id_mappings                       </span>|</span><br><span class="line">|<span class="string"> instance_info_caches                       </span>|</span><br><span class="line">|<span class="string"> instance_metadata                          </span>|</span><br><span class="line">|<span class="string"> instance_system_metadata                   </span>|</span><br><span class="line">|<span class="string"> instance_type_extra_specs                  </span>|</span><br><span class="line">|<span class="string"> instance_type_projects                     </span>|</span><br><span class="line">|<span class="string"> instance_types                             </span>|</span><br><span class="line">|<span class="string"> instances                                  </span>|</span><br><span class="line">|<span class="string"> inventories                                </span>|</span><br><span class="line">|<span class="string"> key_pairs                                  </span>|</span><br><span class="line">|<span class="string"> migrate_version                            </span>|</span><br><span class="line">|<span class="string"> migrations                                 </span>|</span><br><span class="line">|<span class="string"> networks                                   </span>|</span><br><span class="line">|<span class="string"> pci_devices                                </span>|</span><br><span class="line">|<span class="string"> project_user_quotas                        </span>|</span><br><span class="line">|<span class="string"> provider_fw_rules                          </span>|</span><br><span class="line">|<span class="string"> quota_classes                              </span>|</span><br><span class="line">|<span class="string"> quota_usages                               </span>|</span><br><span class="line">|<span class="string"> quotas                                     </span>|</span><br><span class="line">|<span class="string"> reservations                               </span>|</span><br><span class="line">|<span class="string"> resource_provider_aggregates               </span>|</span><br><span class="line">|<span class="string"> resource_providers                         </span>|</span><br><span class="line">|<span class="string"> s3_images                                  </span>|</span><br><span class="line">|<span class="string"> security_group_default_rules               </span>|</span><br><span class="line">|<span class="string"> security_group_instance_association        </span>|</span><br><span class="line">|<span class="string"> security_group_rules                       </span>|</span><br><span class="line">|<span class="string"> security_groups                            </span>|</span><br><span class="line">|<span class="string"> services                                   </span>|</span><br><span class="line">|<span class="string"> shadow_agent_builds                        </span>|</span><br><span class="line">|<span class="string"> shadow_aggregate_hosts                     </span>|</span><br><span class="line">|<span class="string"> shadow_aggregate_metadata                  </span>|</span><br><span class="line">|<span class="string"> shadow_aggregates                          </span>|</span><br><span class="line">|<span class="string"> shadow_block_device_mapping                </span>|</span><br><span class="line">|<span class="string"> shadow_bw_usage_cache                      </span>|</span><br><span class="line">|<span class="string"> shadow_cells                               </span>|</span><br><span class="line">|<span class="string"> shadow_certificates                        </span>|</span><br><span class="line">|<span class="string"> shadow_compute_nodes                       </span>|</span><br><span class="line">|<span class="string"> shadow_console_pools                       </span>|</span><br><span class="line">|<span class="string"> shadow_consoles                            </span>|</span><br><span class="line">|<span class="string"> shadow_dns_domains                         </span>|</span><br><span class="line">|<span class="string"> shadow_fixed_ips                           </span>|</span><br><span class="line">|<span class="string"> shadow_floating_ips                        </span>|</span><br><span class="line">|<span class="string"> shadow_instance_actions                    </span>|</span><br><span class="line">|<span class="string"> shadow_instance_actions_events             </span>|</span><br><span class="line">|<span class="string"> shadow_instance_extra                      </span>|</span><br><span class="line">|<span class="string"> shadow_instance_faults                     </span>|</span><br><span class="line">|<span class="string"> shadow_instance_group_member               </span>|</span><br><span class="line">|<span class="string"> shadow_instance_group_policy               </span>|</span><br><span class="line">|<span class="string"> shadow_instance_groups                     </span>|</span><br><span class="line">|<span class="string"> shadow_instance_id_mappings                </span>|</span><br><span class="line">|<span class="string"> shadow_instance_info_caches                </span>|</span><br><span class="line">|<span class="string"> shadow_instance_metadata                   </span>|</span><br><span class="line">|<span class="string"> shadow_instance_system_metadata            </span>|</span><br><span class="line">|<span class="string"> shadow_instance_type_extra_specs           </span>|</span><br><span class="line">|<span class="string"> shadow_instance_type_projects              </span>|</span><br><span class="line">|<span class="string"> shadow_instance_types                      </span>|</span><br><span class="line">|<span class="string"> shadow_instances                           </span>|</span><br><span class="line">|<span class="string"> shadow_key_pairs                           </span>|</span><br><span class="line">|<span class="string"> shadow_migrate_version                     </span>|</span><br><span class="line">|<span class="string"> shadow_migrations                          </span>|</span><br><span class="line">|<span class="string"> shadow_networks                            </span>|</span><br><span class="line">|<span class="string"> shadow_pci_devices                         </span>|</span><br><span class="line">|<span class="string"> shadow_project_user_quotas                 </span>|</span><br><span class="line">|<span class="string"> shadow_provider_fw_rules                   </span>|</span><br><span class="line">|<span class="string"> shadow_quota_classes                       </span>|</span><br><span class="line">|<span class="string"> shadow_quota_usages                        </span>|</span><br><span class="line">|<span class="string"> shadow_quotas                              </span>|</span><br><span class="line">|<span class="string"> shadow_reservations                        </span>|</span><br><span class="line">|<span class="string"> shadow_s3_images                           </span>|</span><br><span class="line">|<span class="string"> shadow_security_group_default_rules        </span>|</span><br><span class="line">|<span class="string"> shadow_security_group_instance_association </span>|</span><br><span class="line">|<span class="string"> shadow_security_group_rules                </span>|</span><br><span class="line">|<span class="string"> shadow_security_groups                     </span>|</span><br><span class="line">|<span class="string"> shadow_services                            </span>|</span><br><span class="line">|<span class="string"> shadow_snapshot_id_mappings                </span>|</span><br><span class="line">|<span class="string"> shadow_snapshots                           </span>|</span><br><span class="line">|<span class="string"> shadow_task_log                            </span>|</span><br><span class="line">|<span class="string"> shadow_virtual_interfaces                  </span>|</span><br><span class="line">|<span class="string"> shadow_volume_id_mappings                  </span>|</span><br><span class="line">|<span class="string"> shadow_volume_usage_cache                  </span>|</span><br><span class="line">|<span class="string"> snapshot_id_mappings                       </span>|</span><br><span class="line">|<span class="string"> snapshots                                  </span>|</span><br><span class="line">|<span class="string"> tags                                       </span>|</span><br><span class="line">|<span class="string"> task_log                                   </span>|</span><br><span class="line">|<span class="string"> virtual_interfaces                         </span>|</span><br><span class="line">|<span class="string"> volume_id_mappings                         </span>|</span><br><span class="line">|<span class="string"> volume_usage_cache                         </span>|</span><br><span class="line">+--------------------------------------------+</span><br></pre></td></tr></table></figure></p>
<h3 id="14-确认-cell0-cell1-注册成功"><a href="#14-确认-cell0-cell1-注册成功" class="headerlink" title="14. 确认 cell0, cell1 注册成功"></a>14. 确认 cell0, cell1 注册成功</h3><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="meta">@openstack</span> ~]<span class="comment"># su -s /bin/sh -c "nova-manage cell_v2 list_cells" nova</span></span><br><span class="line">+-------+--------------------------------------+------------------------------------+-------------------------------------------------+----------+</span><br><span class="line">|<span class="string">  Name </span>|<span class="string">                 UUID                 </span>|<span class="string">           Transport URL            </span>|<span class="string">               Database Connection               </span>|<span class="string"> Disabled </span>|</span><br><span class="line">+-------+--------------------------------------+------------------------------------+-------------------------------------------------+----------+</span><br><span class="line">|<span class="string"> cell0 </span>|<span class="string"> 00000000-0000-0000-0000-000000000000 </span>|<span class="string">               none:/               </span>|<span class="string"> mysql+pymysql://nova:****@controller/nova_cell0 </span>|<span class="string">  False   </span>|</span><br><span class="line">|<span class="string"> cell1 </span>|<span class="string"> 9edf7b72-1607-432d-8529-30f07576da4a </span>|<span class="string"> rabbit://openstack:****@controller </span>|<span class="string">    mysql+pymysql://nova:****@controller/nova    </span>|<span class="string">  False   </span>|</span><br><span class="line">+-------+--------------------------------------+------------------------------------+-------------------------------------------------+----------+</span><br></pre></td></tr></table></figure>
<h3 id="15-启动-Nova-服务并设置为开机自启"><a href="#15-启动-Nova-服务并设置为开机自启" class="headerlink" title="15. 启动 Nova 服务并设置为开机自启"></a>15. 启动 Nova 服务并设置为开机自启</h3><p><strong><em>需要确认5个服务全部启动成功</em></strong><br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# systemctl start openstack-nova-api openstack-nova-consoleauth openstack-nova-scheduler openstack-nova-conductor openstack-nova-novncproxy</span><br><span class="line">[root@openstack ~]# systemctl <span class="builtin-name">enable</span> openstack-nova-api openstack-nova-consoleauth openstack-nova-scheduler openstack-nova-conductor openstack-nova-novncproxy</span><br><span class="line">Created symlink <span class="keyword">from</span> /etc/systemd/system/multi-user.target.wants/openstack-nova-api.service <span class="keyword">to</span> /usr/lib/systemd/system/openstack-nova-api.service.</span><br><span class="line">Created symlink <span class="keyword">from</span> /etc/systemd/system/multi-user.target.wants/openstack-nova-consoleauth.service <span class="keyword">to</span> /usr/lib/systemd/system/openstack-nova-consoleauth.service.</span><br><span class="line">Created symlink <span class="keyword">from</span> /etc/systemd/system/multi-user.target.wants/openstack-nova-scheduler.service <span class="keyword">to</span> /usr/lib/systemd/system/openstack-nova-scheduler.service.</span><br><span class="line">Created symlink <span class="keyword">from</span> /etc/systemd/system/multi-user.target.wants/openstack-nova-conductor.service <span class="keyword">to</span> /usr/lib/systemd/system/openstack-nova-conductor.service.</span><br><span class="line">Created symlink <span class="keyword">from</span> /etc/systemd/system/multi-user.target.wants/openstack-nova-novncproxy.service <span class="keyword">to</span> /usr/lib/systemd/system/openstack-nova-novncproxy.service.</span><br><span class="line">[root@openstack ~]# systemctl status openstack-nova-api openstack-nova-consoleauth openstack-nova-scheduler openstack-nova-conductor openstack-nova-novncproxy</span><br><span class="line">● openstack-nova-api.service - OpenStack Nova API Server</span><br><span class="line">   Loaded: loaded (/usr/lib/systemd/system/openstack-nova-api.service; enabled; vendor preset: disabled)</span><br><span class="line">   Active: active (running) since Sat 2018-12-15 17:28:02 CST; 2min 17s ago</span><br><span class="line"> Main PID: 24930 (nova-api)</span><br><span class="line">   CGroup: /system.slice/openstack-nova-api.service</span><br><span class="line">           ├─24930 /usr/bin/python2 /usr/bin/nova-api</span><br><span class="line">           ├─24998 /usr/bin/python2 /usr/bin/nova-api</span><br><span class="line">           └─24999 /usr/bin/python2 /usr/bin/nova-api</span><br><span class="line"></span><br><span class="line">Dec 15 17:27:21 openstack.controller systemd[1]: Starting OpenStack Nova API Ser<span class="built_in">..</span><span class="built_in">..</span></span><br><span class="line">Dec 15 17:28:02 openstack.controller systemd[1]: Started OpenStack Nova API Server.</span><br><span class="line"></span><br><span class="line">● openstack-nova-consoleauth.service - OpenStack Nova VNC<span class="built_in"> console </span>auth Server</span><br><span class="line">   Loaded: loaded (/usr/lib/systemd/system/openstack-nova-consoleauth.service; enabled; vendor preset: disabled)</span><br><span class="line">   Active: active (running) since Sat 2018-12-15 17:27:55 CST; 2min 24s ago</span><br><span class="line"> Main PID: 24931 (nova-consoleaut)</span><br><span class="line">   CGroup: /system.slice/openstack-nova-consoleauth.service</span><br><span class="line">           └─24931 /usr/bin/python2 /usr/bin/nova-consoleauth</span><br><span class="line"></span><br><span class="line">Dec 15 17:27:21 openstack.controller systemd[1]: Starting OpenStack Nova VNC con<span class="built_in">..</span><span class="built_in">..</span></span><br><span class="line">Dec 15 17:27:55 openstack.controller systemd[1]: Started OpenStack Nova VNC cons<span class="built_in">..</span><span class="built_in">..</span></span><br><span class="line"></span><br><span class="line">● openstack-nova-scheduler.service - OpenStack Nova<span class="built_in"> Scheduler </span>Server</span><br><span class="line">   Loaded: loaded (/usr/lib/systemd/system/openstack-nova-scheduler.service; enabled; vendor preset: disabled)</span><br><span class="line">   Active: active (running) since Sat 2018-12-15 17:28:00 CST; 2min 20s ago</span><br><span class="line"> Main PID: 24932 (nova-scheduler)</span><br><span class="line">   CGroup: /system.slice/openstack-nova-scheduler.service</span><br><span class="line">           └─24932 /usr/bin/python2 /usr/bin/nova-scheduler</span><br><span class="line"></span><br><span class="line">Dec 15 17:27:21 openstack.controller systemd[1]: Starting OpenStack Nova Schedul<span class="built_in">..</span><span class="built_in">..</span></span><br><span class="line">Dec 15 17:28:00 openstack.controller systemd[1]: Started OpenStack Nova Schedule<span class="built_in">..</span><span class="built_in">..</span></span><br><span class="line"></span><br><span class="line">● openstack-nova-conductor.service - OpenStack Nova Conductor Server</span><br><span class="line">   Loaded: loaded (/usr/lib/systemd/system/openstack-nova-conductor.service; enabled; vendor preset: disabled)</span><br><span class="line">   Active: active (running) since Sat 2018-12-15 17:27:57 CST; 2min 23s ago</span><br><span class="line"> Main PID: 24933 (nova-conductor)</span><br><span class="line">   CGroup: /system.slice/openstack-nova-conductor.service</span><br><span class="line">           └─24933 /usr/bin/python2 /usr/bin/nova-conductor</span><br><span class="line"></span><br><span class="line">Dec 15 17:27:21 openstack.controller systemd[1]: Starting OpenStack Nova Conduct<span class="built_in">..</span><span class="built_in">..</span></span><br><span class="line">Dec 15 17:27:57 openstack.controller systemd[1]: Started OpenStack Nova Conducto<span class="built_in">..</span><span class="built_in">..</span></span><br><span class="line"></span><br><span class="line">● openstack-nova-novncproxy.service - OpenStack Nova NoVNC<span class="built_in"> Proxy </span>Server</span><br><span class="line">   Loaded: loaded (/usr/lib/systemd/system/openstack-nova-novncproxy.service; enabled; vendor preset: disabled)</span><br><span class="line">   Active: active (running) since Sat 2018-12-15 17:27:21 CST; 2min 58s ago</span><br><span class="line"> Main PID: 24934 (nova-novncproxy)</span><br><span class="line">   CGroup: /system.slice/openstack-nova-novncproxy.service</span><br><span class="line">           └─24934 /usr/bin/python2 /usr/bin/nova-novncproxy --web /usr/share/nov<span class="built_in">..</span>.</span><br><span class="line"></span><br><span class="line">Dec 15 17:27:21 openstack.controller systemd[1]: Started OpenStack Nova NoVNC Pr<span class="built_in">..</span><span class="built_in">..</span></span><br><span class="line">Hint: Some lines were ellipsized, use -l <span class="keyword">to</span> show <span class="keyword">in</span> full.</span><br></pre></td></tr></table></figure></p>
<h2 id="十二、安装并配置-Neutron-网络服务"><a href="#十二、安装并配置-Neutron-网络服务" class="headerlink" title="十二、安装并配置 Neutron 网络服务"></a>十二、安装并配置 Neutron 网络服务</h2><h3 id="只需在-Controller-节点安装-7"><a href="#只需在-Controller-节点安装-7" class="headerlink" title="(!!!只需在 Controller 节点安装!!!)"></a><strong><em>(!!!只需在 Controller 节点安装!!!)</em></strong></h3><h3 id="1-创建-neutron-数据库"><a href="#1-创建-neutron-数据库" class="headerlink" title="1. 创建 neutron 数据库"></a>1. 创建 neutron 数据库</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">DATABASE</span> neutron;</span><br><span class="line"><span class="keyword">GRANT</span> ALL <span class="keyword">PRIVILEGES</span> <span class="keyword">ON</span> neutron.* <span class="keyword">TO</span> <span class="string">'neutron'</span>@<span class="string">'localhost'</span> <span class="keyword">IDENTIFIED</span> <span class="keyword">BY</span> <span class="string">'123456'</span>;</span><br><span class="line"><span class="keyword">GRANT</span> ALL <span class="keyword">PRIVILEGES</span> <span class="keyword">ON</span> neutron.* <span class="keyword">TO</span> <span class="string">'neutron'</span>@<span class="string">'%'</span> <span class="keyword">IDENTIFIED</span> <span class="keyword">BY</span> <span class="string">'123456'</span>;</span><br><span class="line"><span class="keyword">flush</span> <span class="keyword">privileges</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# mysql -p123456</span><br><span class="line">Welcome <span class="keyword">to</span> the MariaDB monitor.  Commands <span class="keyword">end</span> <span class="keyword">with</span> ; <span class="keyword">or</span> \g.</span><br><span class="line">...</span><br><span class="line">...</span><br><span class="line">MariaDB [(none)]&gt; <span class="keyword">CREATE</span> DATABASE neutron;</span><br><span class="line">Query OK, <span class="number">1</span> row affected (<span class="number">0.01</span> sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; GRANT ALL PRIVILEGES <span class="keyword">ON</span> neutron.* <span class="keyword">TO</span> <span class="string">'neutron'</span>@<span class="string">'localhost'</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">'123456'</span>;</span><br><span class="line">Query OK, <span class="number">0</span> rows affected (<span class="number">0.11</span> sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; GRANT ALL PRIVILEGES <span class="keyword">ON</span> neutron.* <span class="keyword">TO</span> <span class="string">'neutron'</span>@<span class="string">'%'</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">'123456'</span>;</span><br><span class="line">Query OK, <span class="number">0</span> rows affected (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; flush privileges;</span><br><span class="line">Query OK, <span class="number">0</span> rows affected (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; <span class="keyword">exit</span></span><br><span class="line">Bye</span><br></pre></td></tr></table></figure>
<h3 id="2-创建一个名为-neutron-的-KeyStone-用户"><a href="#2-创建一个名为-neutron-的-KeyStone-用户" class="headerlink" title="2. 创建一个名为 neutron 的 KeyStone 用户"></a>2. 创建一个名为 neutron 的 KeyStone 用户</h3><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="meta">@openstack</span> ~]<span class="comment"># . admin-openrc </span></span><br><span class="line">[root<span class="meta">@openstack</span> ~]<span class="comment"># openstack user create --domain default --password=123456 neutron</span></span><br><span class="line">+---------------------+----------------------------------+</span><br><span class="line">|<span class="string"> Field               </span>|<span class="string"> Value                            </span>|</span><br><span class="line">+---------------------+----------------------------------+</span><br><span class="line">|<span class="string"> domain_id           </span>|<span class="string"> default                          </span>|</span><br><span class="line">|<span class="string"> enabled             </span>|<span class="string"> True                             </span>|</span><br><span class="line">|<span class="string"> id                  </span>|<span class="string"> 4333e81db907449f8d77cdaded8d2a85 </span>|</span><br><span class="line">|<span class="string"> name                </span>|<span class="string"> neutron                          </span>|</span><br><span class="line">|<span class="string"> options             </span>|<span class="string"> &#123;&#125;                               </span>|</span><br><span class="line">|<span class="string"> password_expires_at </span>|<span class="string"> None                             </span>|</span><br><span class="line">+---------------------+----------------------------------+</span><br><span class="line">[root<span class="meta">@openstack</span> ~]<span class="comment"># openstack user list</span></span><br><span class="line">+----------------------------------+------------+</span><br><span class="line">|<span class="string"> ID                               </span>|<span class="string"> Name       </span>|</span><br><span class="line">+----------------------------------+------------+</span><br><span class="line">|<span class="string"> 063e3004acc94429a6b2a2cec9776608 </span>|<span class="string"> glance     </span>|</span><br><span class="line">|<span class="string"> 4333e81db907449f8d77cdaded8d2a85 </span>|<span class="string"> neutron    </span>|</span><br><span class="line">|<span class="string"> 50f123bb0cc640b7bc2603a3c5757b51 </span>|<span class="string"> nova       </span>|</span><br><span class="line">|<span class="string"> 84e7e67f49ff4d13a7b7334134a13db2 </span>|<span class="string"> admin      </span>|</span><br><span class="line">|<span class="string"> 99f1f663e39f47c99b5bf59706541fc4 </span>|<span class="string"> placement  </span>|</span><br><span class="line">|<span class="string"> a2750e3ab9144584962f1e28eaa496ee </span>|<span class="string"> myuser     </span>|</span><br><span class="line">+----------------------------------+------------+</span><br></pre></td></tr></table></figure>
<h3 id="3-将-neutron-用户添加到-service-项目的-admin-角色"><a href="#3-将-neutron-用户添加到-service-项目的-admin-角色" class="headerlink" title="3. 将 neutron 用户添加到 service 项目的 admin 角色"></a>3. 将 neutron 用户添加到 service 项目的 admin 角色</h3><p>以下命令无输出<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# openstack role <span class="builtin-name">add</span> --project<span class="built_in"> service </span>--user neutron admin</span><br></pre></td></tr></table></figure></p>
<h3 id="4-创建-Neutron-网络服务实例"><a href="#4-创建-Neutron-网络服务实例" class="headerlink" title="4. 创建 Neutron 网络服务实例"></a>4. 创建 Neutron 网络服务实例</h3><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# openstack<span class="built_in"> service </span>create --name neutron --description <span class="string">"OpenStack Networking"</span> network</span><br><span class="line">+-------------+----------------------------------+</span><br><span class="line">| Field       | Value                            |</span><br><span class="line">+-------------+----------------------------------+</span><br><span class="line">| description | OpenStack Networking             |</span><br><span class="line">| enabled     | <span class="literal">True</span>                             |</span><br><span class="line">| id          | df5e3d7fca9a4373a62e7ae322a86fcc |</span><br><span class="line">| name        | neutron                          |</span><br><span class="line">|<span class="built_in"> type </span>       |<span class="built_in"> network </span>                         |</span><br><span class="line">+-------------+----------------------------------+</span><br><span class="line">[root@openstack ~]# openstack<span class="built_in"> service </span>list</span><br><span class="line">+----------------------------------+-----------+-----------+</span><br><span class="line">| ID                               | Name      |<span class="built_in"> Type </span>     |</span><br><span class="line">+----------------------------------+-----------+-----------+</span><br><span class="line">| 363f73076d45482c9a680f11193549e9 | keystone  |<span class="built_in"> identity </span> |</span><br><span class="line">| 70155ce6ff3f41348cafa6e498d96e99 | nova      | compute   |</span><br><span class="line">| a47516d9fae94cbd85f43a994ac2f4b4 | placement | placement |</span><br><span class="line">| c9ed8738afa94a4abbe91144f2d67f45 | glance    | image     |</span><br><span class="line">| df5e3d7fca9a4373a62e7ae322a86fcc | neutron   |<span class="built_in"> network </span>  |</span><br><span class="line">+----------------------------------+-----------+-----------+</span><br></pre></td></tr></table></figure>
<h3 id="5-创建-Neutron-网络服务的-API-端点-endpoint"><a href="#5-创建-Neutron-网络服务的-API-端点-endpoint" class="headerlink" title="5. 创建 Neutron 网络服务的 API 端点 (endpoint)"></a>5. 创建 Neutron 网络服务的 API 端点 (endpoint)</h3><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="meta">@openstack</span> ~]<span class="comment"># openstack endpoint create --region RegionOne network public http://controller:9696</span></span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">|<span class="string"> Field        </span>|<span class="string"> Value                            </span>|</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">|<span class="string"> enabled      </span>|<span class="string"> True                             </span>|</span><br><span class="line">|<span class="string"> id           </span>|<span class="string"> 20acd6ad16e1475c98bf3264b56302da </span>|</span><br><span class="line">|<span class="string"> interface    </span>|<span class="string"> public                           </span>|</span><br><span class="line">|<span class="string"> region       </span>|<span class="string"> RegionOne                        </span>|</span><br><span class="line">|<span class="string"> region_id    </span>|<span class="string"> RegionOne                        </span>|</span><br><span class="line">|<span class="string"> service_id   </span>|<span class="string"> df5e3d7fca9a4373a62e7ae322a86fcc </span>|</span><br><span class="line">|<span class="string"> service_name </span>|<span class="string"> neutron                          </span>|</span><br><span class="line">|<span class="string"> service_type </span>|<span class="string"> network                          </span>|</span><br><span class="line">|<span class="string"> url          </span>|<span class="string"> http://controller:9696           </span>|</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">[root<span class="meta">@openstack</span> ~]<span class="comment"># openstack endpoint create --region RegionOne network internal http://controller:9696</span></span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">|<span class="string"> Field        </span>|<span class="string"> Value                            </span>|</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">|<span class="string"> enabled      </span>|<span class="string"> True                             </span>|</span><br><span class="line">|<span class="string"> id           </span>|<span class="string"> bf26b7aad8f3480dbe9dbb936083968a </span>|</span><br><span class="line">|<span class="string"> interface    </span>|<span class="string"> internal                         </span>|</span><br><span class="line">|<span class="string"> region       </span>|<span class="string"> RegionOne                        </span>|</span><br><span class="line">|<span class="string"> region_id    </span>|<span class="string"> RegionOne                        </span>|</span><br><span class="line">|<span class="string"> service_id   </span>|<span class="string"> df5e3d7fca9a4373a62e7ae322a86fcc </span>|</span><br><span class="line">|<span class="string"> service_name </span>|<span class="string"> neutron                          </span>|</span><br><span class="line">|<span class="string"> service_type </span>|<span class="string"> network                          </span>|</span><br><span class="line">|<span class="string"> url          </span>|<span class="string"> http://controller:9696           </span>|</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">[root<span class="meta">@openstack</span> ~]<span class="comment"># openstack endpoint create --region RegionOne network admin http://controller:9696</span></span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">|<span class="string"> Field        </span>|<span class="string"> Value                            </span>|</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">|<span class="string"> enabled      </span>|<span class="string"> True                             </span>|</span><br><span class="line">|<span class="string"> id           </span>|<span class="string"> ccb1e598085d412f964049cfb5713776 </span>|</span><br><span class="line">|<span class="string"> interface    </span>|<span class="string"> admin                            </span>|</span><br><span class="line">|<span class="string"> region       </span>|<span class="string"> RegionOne                        </span>|</span><br><span class="line">|<span class="string"> region_id    </span>|<span class="string"> RegionOne                        </span>|</span><br><span class="line">|<span class="string"> service_id   </span>|<span class="string"> df5e3d7fca9a4373a62e7ae322a86fcc </span>|</span><br><span class="line">|<span class="string"> service_name </span>|<span class="string"> neutron                          </span>|</span><br><span class="line">|<span class="string"> service_type </span>|<span class="string"> network                          </span>|</span><br><span class="line">|<span class="string"> url          </span>|<span class="string"> http://controller:9696           </span>|</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">[root<span class="meta">@openstack</span> ~]<span class="comment"># openstack endpoint list</span></span><br><span class="line">+----------------------------------+-----------+--------------+--------------+---------+-----------+-----------------------------+</span><br><span class="line">|<span class="string"> ID                               </span>|<span class="string"> Region    </span>|<span class="string"> Service Name </span>|<span class="string"> Service Type </span>|<span class="string"> Enabled </span>|<span class="string"> Interface </span>|<span class="string"> URL                         </span>|</span><br><span class="line">+----------------------------------+-----------+--------------+--------------+---------+-----------+-----------------------------+</span><br><span class="line">|<span class="string"> 1640b8023b96498ba283d645573acbf5 </span>|<span class="string"> RegionOne </span>|<span class="string"> nova         </span>|<span class="string"> compute      </span>|<span class="string"> True    </span>|<span class="string"> internal  </span>|<span class="string"> http://controller:8774/v2.1 </span>|</span><br><span class="line">|<span class="string"> 1f24214b544b4804a1f5e3fbe3438a2c </span>|<span class="string"> RegionOne </span>|<span class="string"> placement    </span>|<span class="string"> placement    </span>|<span class="string"> True    </span>|<span class="string"> public    </span>|<span class="string"> http://controller:8778      </span>|</span><br><span class="line">|<span class="string"> 20acd6ad16e1475c98bf3264b56302da </span>|<span class="string"> RegionOne </span>|<span class="string"> neutron      </span>|<span class="string"> network      </span>|<span class="string"> True    </span>|<span class="string"> public    </span>|<span class="string"> http://controller:9696      </span>|</span><br><span class="line">|<span class="string"> 232c4a99a3fd46bca2bfc092a4ff0705 </span>|<span class="string"> RegionOne </span>|<span class="string"> nova         </span>|<span class="string"> compute      </span>|<span class="string"> True    </span>|<span class="string"> admin     </span>|<span class="string"> http://controller:8774/v2.1 </span>|</span><br><span class="line">|<span class="string"> 498db99146dc43d982449b1c7c6ac16b </span>|<span class="string"> RegionOne </span>|<span class="string"> keystone     </span>|<span class="string"> identity     </span>|<span class="string"> True    </span>|<span class="string"> public    </span>|<span class="string"> http://controller:5000/v3/  </span>|</span><br><span class="line">|<span class="string"> 4c22aba83615477eaf5c42d935f882b8 </span>|<span class="string"> RegionOne </span>|<span class="string"> glance       </span>|<span class="string"> image        </span>|<span class="string"> True    </span>|<span class="string"> internal  </span>|<span class="string"> http://controller:9292      </span>|</span><br><span class="line">|<span class="string"> 54b25eea3f8a46c7af947adb4bff18ed </span>|<span class="string"> RegionOne </span>|<span class="string"> glance       </span>|<span class="string"> image        </span>|<span class="string"> True    </span>|<span class="string"> admin     </span>|<span class="string"> http://controller:9292      </span>|</span><br><span class="line">|<span class="string"> 61af677340904813b4a5244da0a036ca </span>|<span class="string"> RegionOne </span>|<span class="string"> keystone     </span>|<span class="string"> identity     </span>|<span class="string"> True    </span>|<span class="string"> admin     </span>|<span class="string"> http://controller:5000/v3/  </span>|</span><br><span class="line">|<span class="string"> 842e55cc821b4a74b9093072a02184fc </span>|<span class="string"> RegionOne </span>|<span class="string"> placement    </span>|<span class="string"> placement    </span>|<span class="string"> True    </span>|<span class="string"> internal  </span>|<span class="string"> http://controller:8778      </span>|</span><br><span class="line">|<span class="string"> 9c6d59dfc5cc4f6c8dd55eb1c944e17c </span>|<span class="string"> RegionOne </span>|<span class="string"> keystone     </span>|<span class="string"> identity     </span>|<span class="string"> True    </span>|<span class="string"> internal  </span>|<span class="string"> http://controller:5000/v3/  </span>|</span><br><span class="line">|<span class="string"> b02bf56e9c6f4ad6a54e513f23d333c7 </span>|<span class="string"> RegionOne </span>|<span class="string"> glance       </span>|<span class="string"> image        </span>|<span class="string"> True    </span>|<span class="string"> public    </span>|<span class="string"> http://controller:9292      </span>|</span><br><span class="line">|<span class="string"> bf26b7aad8f3480dbe9dbb936083968a </span>|<span class="string"> RegionOne </span>|<span class="string"> neutron      </span>|<span class="string"> network      </span>|<span class="string"> True    </span>|<span class="string"> internal  </span>|<span class="string"> http://controller:9696      </span>|</span><br><span class="line">|<span class="string"> ccb1e598085d412f964049cfb5713776 </span>|<span class="string"> RegionOne </span>|<span class="string"> neutron      </span>|<span class="string"> network      </span>|<span class="string"> True    </span>|<span class="string"> admin     </span>|<span class="string"> http://controller:9696      </span>|</span><br><span class="line">|<span class="string"> dd00497083f94f8b8bae6fac7735f2f7 </span>|<span class="string"> RegionOne </span>|<span class="string"> nova         </span>|<span class="string"> compute      </span>|<span class="string"> True    </span>|<span class="string"> public    </span>|<span class="string"> http://controller:8774/v2.1 </span>|</span><br><span class="line">|<span class="string"> ddd75210cbcf4d9294c6ddfcb1bb1927 </span>|<span class="string"> RegionOne </span>|<span class="string"> placement    </span>|<span class="string"> placement    </span>|<span class="string"> True    </span>|<span class="string"> admin     </span>|<span class="string"> http://controller:8778      </span>|</span><br><span class="line">+----------------------------------+-----------+--------------+--------------+---------+-----------+-----------------------------+</span><br></pre></td></tr></table></figure>
<h3 id="6-安装并配置-Neutron-相关软件"><a href="#6-安装并配置-Neutron-相关软件" class="headerlink" title="6. 安装并配置 Neutron 相关软件"></a>6. 安装并配置 Neutron 相关软件</h3><h4 id="a-安装-Neutron-相关软件"><a href="#a-安装-Neutron-相关软件" class="headerlink" title="a) 安装 Neutron 相关软件"></a>a) 安装 Neutron 相关软件</h4><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@openstack</span> ~]<span class="meta"># yum install -y openstack-neutron openstack-neutron-ml2 openstack-neutron-linuxbridge ebtables</span></span><br><span class="line">...</span><br><span class="line">Complete!</span><br></pre></td></tr></table></figure>
<h4 id="b-修改-Neutron-的配置文件-neutron-conf"><a href="#b-修改-Neutron-的配置文件-neutron-conf" class="headerlink" title="b) 修改 Neutron 的配置文件 (neutron.conf)"></a>b) 修改 Neutron 的配置文件 (neutron.conf)</h4><p><strong><em>必须确认配置是否正确</em></strong><br><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/neutron/neutron.conf database connection "mysql+pymysql://neutron:123456@controller/neutron"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/neutron/neutron.conf DEFAULT core_plugin "ml2"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/neutron/neutron.conf DEFAULT service_plugins</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/neutron/neutron.conf DEFAULT transport_url "rabbit://openstack:123456@controller"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/neutron/neutron.conf DEFAULT auth_strategy "keystone"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/neutron/neutron.conf keystone_authtoken www_authenticate_uri "http://controller:5000"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/neutron/neutron.conf keystone_authtoken auth_url "http://controller:5000"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/neutron/neutron.conf keystone_authtoken memcached_servers "controller:11211"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/neutron/neutron.conf keystone_authtoken auth_type "password"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/neutron/neutron.conf keystone_authtoken project_domain_name "default"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/neutron/neutron.conf keystone_authtoken user_domain_name "default"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/neutron/neutron.conf keystone_authtoken project_name "service"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/neutron/neutron.conf keystone_authtoken username "neutron"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/neutron/neutron.conf keystone_authtoken password "123456"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/neutron/neutron.conf DEFAULT notify_nova_on_port_status_changes "True"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/neutron/neutron.conf DEFAULT notify_nova_on_port_data_changes "True"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/neutron/neutron.conf nova auth_url "http://controller:5000"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/neutron/neutron.conf nova auth_type "password"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/neutron/neutron.conf nova project_domain_name "default"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/neutron/neutron.conf nova user_domain_name "default"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/neutron/neutron.conf nova region_name "RegionOne"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/neutron/neutron.conf nova project_name "service"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/neutron/neutron.conf nova username "nova"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/neutron/neutron.conf nova password "123456"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/neutron/neutron.conf oslo_concurrency lock_path "/var/lib/neutron/tmp"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># grep '^[a-z]' /etc/neutron/neutron.conf</span></span><br><span class="line"><span class="attr">core_plugin</span> = ml2</span><br><span class="line"><span class="attr">service_plugins</span> = </span><br><span class="line"><span class="attr">transport_url</span> = rabbit://openstack:<span class="number">123456</span>@controller</span><br><span class="line"><span class="attr">auth_strategy</span> = keystone</span><br><span class="line"><span class="attr">notify_nova_on_port_status_changes</span> = <span class="literal">True</span></span><br><span class="line"><span class="attr">notify_nova_on_port_data_changes</span> = <span class="literal">True</span></span><br><span class="line"><span class="attr">connection</span> = mysql+pymysql://neutron:<span class="number">123456</span>@controller/neutron</span><br><span class="line"><span class="attr">www_authenticate_uri</span> = http://controller:<span class="number">5000</span></span><br><span class="line"><span class="attr">auth_url</span> = http://controller:<span class="number">5000</span></span><br><span class="line"><span class="attr">memcached_servers</span> = controller:<span class="number">11211</span></span><br><span class="line"><span class="attr">auth_type</span> = password</span><br><span class="line"><span class="attr">project_domain_name</span> = default</span><br><span class="line"><span class="attr">user_domain_name</span> = default</span><br><span class="line"><span class="attr">project_name</span> = service</span><br><span class="line"><span class="attr">username</span> = neutron</span><br><span class="line"><span class="attr">password</span> = <span class="number">123456</span></span><br><span class="line"><span class="attr">auth_url</span> = http://controller:<span class="number">5000</span></span><br><span class="line"><span class="attr">auth_type</span> = password</span><br><span class="line"><span class="attr">project_domain_name</span> = default</span><br><span class="line"><span class="attr">user_domain_name</span> = default</span><br><span class="line"><span class="attr">region_name</span> = RegionOne</span><br><span class="line"><span class="attr">project_name</span> = service</span><br><span class="line"><span class="attr">username</span> = nova</span><br><span class="line"><span class="attr">password</span> = <span class="number">123456</span></span><br><span class="line"><span class="attr">lock_path</span> = /var/lib/neutron/tmp</span><br></pre></td></tr></table></figure></p>
<h4 id="c-修改-Neutron-的配置文件-ml2-conf-ini"><a href="#c-修改-Neutron-的配置文件-ml2-conf-ini" class="headerlink" title="c) 修改 Neutron 的配置文件 (ml2_conf.ini)"></a>c) 修改 Neutron 的配置文件 (ml2_conf.ini)</h4><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/neutron/plugins/ml2/ml2_conf.ini ml2 type_drivers "local,flat,vlan"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/neutron/plugins/ml2/ml2_conf.ini ml2 tenant_network_types</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/neutron/plugins/ml2/ml2_conf.ini ml2 mechanism_drivers "linuxbridge"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/neutron/plugins/ml2/ml2_conf.ini ml2 extension_drivers "port_security"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/neutron/plugins/ml2/ml2_conf.ini ml2_type_flat flat_networks "provider"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/neutron/plugins/ml2/ml2_conf.ini securitygroup enable_ipset "True"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># grep '^[a-z]' /etc/neutron/plugins/ml2/ml2_conf.ini</span></span><br><span class="line"><span class="attr">type_drivers</span> = local,flat,vlan</span><br><span class="line"><span class="attr">tenant_network_types</span> = </span><br><span class="line"><span class="attr">mechanism_drivers</span> = linuxbridge</span><br><span class="line"><span class="attr">extension_drivers</span> = port_security</span><br><span class="line"><span class="attr">flat_networks</span> = provider</span><br><span class="line"><span class="attr">enable_ipset</span> = <span class="literal">True</span></span><br></pre></td></tr></table></figure>
<h4 id="d-修改-Neutron-的配置文件-linuxbridge-agent-ini"><a href="#d-修改-Neutron-的配置文件-linuxbridge-agent-ini" class="headerlink" title="d) 修改 Neutron 的配置文件 (linuxbridge_agent.ini)"></a>d) 修改 Neutron 的配置文件 (linuxbridge_agent.ini)</h4><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/neutron/plugins/ml2/linuxbridge_agent.ini linux_bridge physical_interface_mappings "provider:ens32"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/neutron/plugins/ml2/linuxbridge_agent.ini vxlan enable_vxlan "False"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/neutron/plugins/ml2/linuxbridge_agent.ini securitygroup enable_security_group "True"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/neutron/plugins/ml2/linuxbridge_agent.ini securitygroup firewall_driver "neutron.agent.linux.iptables_firewall.IptablesFirewallDriver"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># grep '^[a-z]' /etc/neutron/plugins/ml2/linuxbridge_agent.ini</span></span><br><span class="line"><span class="attr">physical_interface_mappings</span> = provider:ens32</span><br><span class="line"><span class="attr">enable_security_group</span> = <span class="literal">True</span></span><br><span class="line"><span class="attr">firewall_driver</span> = neutron.agent.linux.iptables_firewall.IptablesFirewallDriver</span><br><span class="line"><span class="attr">enable_vxlan</span> = <span class="literal">False</span></span><br></pre></td></tr></table></figure>
<h4 id="e-修改-Neutron-的配置文件-dhcp-agent-ini"><a href="#e-修改-Neutron-的配置文件-dhcp-agent-ini" class="headerlink" title="e) 修改 Neutron 的配置文件 (dhcp_agent.ini)"></a>e) 修改 Neutron 的配置文件 (dhcp_agent.ini)</h4><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# openstack-config --<span class="keyword">set</span> /etc/neutron/dhcp_agent.ini DEFAULT interface_driver <span class="comment">"linuxbridge"</span></span><br><span class="line">[root@openstack ~]# openstack-config --set /etc/neutron/dhcp_agent.ini <span class="comment">DEFAULT dhcp_driver</span> <span class="comment">"neutron.agent.linux.dhcp.Dnsmasq"</span></span><br><span class="line">[root@openstack ~<span class="comment">]# openstack-config --set</span> /etc/<span class="comment">neutron</span>/dhcp_agent.ini DEFAULT enable_isolated_metadata <span class="comment">"True"</span></span><br><span class="line">[root@openstack ~]# grep <span class="comment">'^[a-z]'</span> /<span class="comment">etc</span>/neutron/<span class="comment">dhcp_agent.ini</span></span><br><span class="line">interface_driver <span class="comment">= linuxbridge</span></span><br><span class="line">dhcp_driver <span class="comment">= neutron.agent.linux.dhcp.Dnsmasq</span></span><br><span class="line">enable_isolated_metadata <span class="comment">= True</span></span><br></pre></td></tr></table></figure>
<h4 id="f-修改-Neutron-的配置文件-metadata-agent-ini"><a href="#f-修改-Neutron-的配置文件-metadata-agent-ini" class="headerlink" title="f) 修改 Neutron 的配置文件 (metadata_agent.ini)"></a>f) 修改 Neutron 的配置文件 (metadata_agent.ini)</h4><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/neutron/metadata_agent.ini DEFAULT nova_metadata_host "controller"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/neutron/metadata_agent.ini DEFAULT metadata_proxy_shared_secret "neutron"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># grep '^[a-z]' /etc/neutron/metadata_agent.ini</span></span><br><span class="line"><span class="attr">nova_metadata_host</span> = controller</span><br><span class="line"><span class="attr">metadata_proxy_shared_secret</span> = neutron</span><br></pre></td></tr></table></figure>
<h4 id="g-修改-Neutron-的配置文件-nova-conf"><a href="#g-修改-Neutron-的配置文件-nova-conf" class="headerlink" title="g) 修改 Neutron 的配置文件 (nova.conf)"></a>g) 修改 Neutron 的配置文件 (nova.conf)</h4><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/nova/nova.conf neutron url "http://controller:9696"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/nova/nova.conf neutron auth_url "http://controller:5000"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/nova/nova.conf neutron auth_type "password"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/nova/nova.conf neutron project_domain_name "default"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/nova/nova.conf neutron user_domain_name "default"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/nova/nova.conf neutron region_name "RegionOne"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/nova/nova.conf neutron project_name "service"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/nova/nova.conf neutron username "neutron"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/nova/nova.conf neutron password "123456"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/nova/nova.conf neutron service_metadata_proxy "true"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/nova/nova.conf neutron metadata_proxy_shared_secret "neutron"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># grep '^[a-z]' /etc/nova/nova.conf</span></span><br><span class="line"><span class="attr">enabled_apis</span> = osapi_compute,metadata</span><br><span class="line"><span class="attr">my_ip</span> = <span class="number">192.168</span>.<span class="number">10.11</span></span><br><span class="line"><span class="attr">use_neutron</span> = <span class="literal">true</span></span><br><span class="line"><span class="attr">firewall_driver</span> = nova.virt.firewall.NoopFirewallDriver</span><br><span class="line"><span class="attr">transport_url</span> = rabbit://openstack:<span class="number">123456</span>@controller</span><br><span class="line"><span class="attr">auth_strategy</span> = keystone</span><br><span class="line"><span class="attr">connection</span> = mysql+pymysql://nova:<span class="number">123456</span>@controller/nova_api</span><br><span class="line"><span class="attr">connection</span> = mysql+pymysql://nova:<span class="number">123456</span>@controller/nova</span><br><span class="line"><span class="attr">api_servers</span> = http://controller:<span class="number">9292</span></span><br><span class="line"><span class="attr">auth_url</span> = http://controller:<span class="number">5000</span>/v3</span><br><span class="line"><span class="attr">memcached_servers</span> = controller:<span class="number">11211</span></span><br><span class="line"><span class="attr">auth_type</span> = password</span><br><span class="line"><span class="attr">project_domain_name</span> = default</span><br><span class="line"><span class="attr">user_domain_name</span> = default</span><br><span class="line"><span class="attr">project_name</span> = service</span><br><span class="line"><span class="attr">username</span> = nova</span><br><span class="line"><span class="attr">password</span> = <span class="number">123456</span></span><br><span class="line"><span class="attr">url</span> = http://controller:<span class="number">9696</span></span><br><span class="line"><span class="attr">auth_url</span> = http://controller:<span class="number">5000</span></span><br><span class="line"><span class="attr">auth_type</span> = password</span><br><span class="line"><span class="attr">project_domain_name</span> = default</span><br><span class="line"><span class="attr">user_domain_name</span> = default</span><br><span class="line"><span class="attr">region_name</span> = RegionOne</span><br><span class="line"><span class="attr">project_name</span> = service</span><br><span class="line"><span class="attr">username</span> = neutron</span><br><span class="line"><span class="attr">password</span> = <span class="number">123456</span></span><br><span class="line"><span class="attr">service_metadata_proxy</span> = <span class="literal">true</span></span><br><span class="line"><span class="attr">metadata_proxy_shared_secret</span> = neutron</span><br><span class="line"><span class="attr">lock_path</span> = /var/lib/nova/tmp </span><br><span class="line"><span class="attr">region_name</span> = RegionOne</span><br><span class="line"><span class="attr">project_domain_name</span> = Default</span><br><span class="line"><span class="attr">project_name</span> = service</span><br><span class="line"><span class="attr">auth_type</span> = password</span><br><span class="line"><span class="attr">user_domain_name</span> = Default</span><br><span class="line"><span class="attr">auth_url</span> = http://controller:<span class="number">5000</span>/v3</span><br><span class="line"><span class="attr">username</span> = placement</span><br><span class="line"><span class="attr">password</span> = <span class="number">123456</span></span><br><span class="line"><span class="attr">connection</span> = mysql+pymysql://placement:<span class="number">123456</span>@controller/placement</span><br><span class="line"><span class="attr">discover_hosts_in_cells_interval</span> = <span class="number">300</span></span><br><span class="line"><span class="attr">enabled</span> = <span class="literal">true</span></span><br><span class="line"><span class="attr">server_listen</span> = <span class="variable">$my_ip</span></span><br><span class="line"><span class="attr">server_proxyclient_address</span> = <span class="variable">$my_ip</span></span><br></pre></td></tr></table></figure>
<h4 id="h-链接-Neutron-的配置文件-plugin-ini"><a href="#h-链接-Neutron-的配置文件-plugin-ini" class="headerlink" title="h) 链接 Neutron 的配置文件 (plugin.ini)"></a>h) 链接 Neutron 的配置文件 (plugin.ini)</h4><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# ln -s <span class="regexp">/etc/</span>neutron<span class="regexp">/plugins/m</span>l2<span class="regexp">/ml2_conf.ini /</span>etc<span class="regexp">/neutron/</span>plugin.ini</span><br></pre></td></tr></table></figure>
<h3 id="7-初始化-neutron-数据库"><a href="#7-初始化-neutron-数据库" class="headerlink" title="7. 初始化 neutron 数据库"></a>7. 初始化 neutron 数据库</h3><p><strong><em>必须确认数据库是否初始化正确</em></strong><br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# su -s /bin/sh -c <span class="string">"neutron-db-manage --config-file /etc/neutron/neutron.conf --config-file /etc/neutron/plugins/ml2/ml2_conf.ini upgrade head"</span> neutron</span><br><span class="line"><span class="builtin-name">INFO</span>  [alembic.runtime.migration] Context impl MySQLImpl.</span><br><span class="line"><span class="builtin-name">INFO</span>  [alembic.runtime.migration] Will assume non-transactional DDL.</span><br><span class="line">  Running<span class="built_in"> upgrade </span><span class="keyword">for</span> neutron <span class="built_in">..</span>.</span><br><span class="line"><span class="builtin-name">INFO</span>  [alembic.runtime.migration] Context impl MySQLImpl.</span><br><span class="line"><span class="builtin-name">INFO</span>  [alembic.runtime.migration] Will assume non-transactional DDL.</span><br><span class="line"><span class="builtin-name">INFO</span>  [alembic.runtime.migration] Running<span class="built_in"> upgrade </span> -&gt; kilo</span><br><span class="line"><span class="builtin-name">INFO</span>  [alembic.runtime.migration] Running<span class="built_in"> upgrade </span>kilo -&gt; 354db87e3225</span><br><span class="line"><span class="builtin-name">INFO</span>  [alembic.runtime.migration] Running<span class="built_in"> upgrade </span>354db87e3225 -&gt; 599c6a226151</span><br><span class="line"><span class="builtin-name">INFO</span>  [alembic.runtime.migration] Running<span class="built_in"> upgrade </span>599c6a226151 -&gt; 52c5312f6baf</span><br><span class="line"><span class="builtin-name">INFO</span>  [alembic.runtime.migration] Running<span class="built_in"> upgrade </span>52c5312f6baf -&gt; 313373c0ffee</span><br><span class="line"><span class="builtin-name">INFO</span>  [alembic.runtime.migration] Running<span class="built_in"> upgrade </span>313373c0ffee -&gt; 8675309a5c4f</span><br><span class="line"><span class="builtin-name">INFO</span>  [alembic.runtime.migration] Running<span class="built_in"> upgrade </span>8675309a5c4f -&gt; 45f955889773</span><br><span class="line"><span class="builtin-name">INFO</span>  [alembic.runtime.migration] Running<span class="built_in"> upgrade </span>45f955889773 -&gt; 26c371498592</span><br><span class="line"><span class="builtin-name">INFO</span>  [alembic.runtime.migration] Running<span class="built_in"> upgrade </span>26c371498592 -&gt; 1c844d1677f7</span><br><span class="line"><span class="builtin-name">INFO</span>  [alembic.runtime.migration] Running<span class="built_in"> upgrade </span>1c844d1677f7 -&gt; 1b4c6e320f79</span><br><span class="line"><span class="builtin-name">INFO</span>  [alembic.runtime.migration] Running<span class="built_in"> upgrade </span>1b4c6e320f79 -&gt; 48153cb5f051</span><br><span class="line"><span class="builtin-name">INFO</span>  [alembic.runtime.migration] Running<span class="built_in"> upgrade </span>48153cb5f051 -&gt; 9859ac9c136</span><br><span class="line"><span class="builtin-name">INFO</span>  [alembic.runtime.migration] Running<span class="built_in"> upgrade </span>9859ac9c136 -&gt; 34af2b5c5a59</span><br><span class="line"><span class="builtin-name">INFO</span>  [alembic.runtime.migration] Running<span class="built_in"> upgrade </span>34af2b5c5a59 -&gt; 59cb5b6cf4d</span><br><span class="line"><span class="builtin-name">INFO</span>  [alembic.runtime.migration] Running<span class="built_in"> upgrade </span>59cb5b6cf4d -&gt; 13cfb89f881a</span><br><span class="line"><span class="builtin-name">INFO</span>  [alembic.runtime.migration] Running<span class="built_in"> upgrade </span>13cfb89f881a -&gt; 32e5974ada25</span><br><span class="line"><span class="builtin-name">INFO</span>  [alembic.runtime.migration] Running<span class="built_in"> upgrade </span>32e5974ada25 -&gt; ec7fcfbf72ee</span><br><span class="line"><span class="builtin-name">INFO</span>  [alembic.runtime.migration] Running<span class="built_in"> upgrade </span>ec7fcfbf72ee -&gt; dce3ec7a25c9</span><br><span class="line"><span class="builtin-name">INFO</span>  [alembic.runtime.migration] Running<span class="built_in"> upgrade </span>dce3ec7a25c9 -&gt; c3a73f615e4</span><br><span class="line"><span class="builtin-name">INFO</span>  [alembic.runtime.migration] Running<span class="built_in"> upgrade </span>c3a73f615e4 -&gt; 659bf3d90664</span><br><span class="line"><span class="builtin-name">INFO</span>  [alembic.runtime.migration] Running<span class="built_in"> upgrade </span>659bf3d90664 -&gt; 1df244e556f5</span><br><span class="line"><span class="builtin-name">INFO</span>  [alembic.runtime.migration] Running<span class="built_in"> upgrade </span>1df244e556f5 -&gt; 19f26505c74f</span><br><span class="line"><span class="builtin-name">INFO</span>  [alembic.runtime.migration] Running<span class="built_in"> upgrade </span>19f26505c74f -&gt; 15be73214821</span><br><span class="line"><span class="builtin-name">INFO</span>  [alembic.runtime.migration] Running<span class="built_in"> upgrade </span>15be73214821 -&gt; b4caf27aae4</span><br><span class="line"><span class="builtin-name">INFO</span>  [alembic.runtime.migration] Running<span class="built_in"> upgrade </span>b4caf27aae4 -&gt; 15e43b934f81</span><br><span class="line"><span class="builtin-name">INFO</span>  [alembic.runtime.migration] Running<span class="built_in"> upgrade </span>15e43b934f81 -&gt; 31ed664953e6</span><br><span class="line"><span class="builtin-name">INFO</span>  [alembic.runtime.migration] Running<span class="built_in"> upgrade </span>31ed664953e6 -&gt; 2f9e956e7532</span><br><span class="line"><span class="builtin-name">INFO</span>  [alembic.runtime.migration] Running<span class="built_in"> upgrade </span>2f9e956e7532 -&gt; 3894bccad37f</span><br><span class="line"><span class="builtin-name">INFO</span>  [alembic.runtime.migration] Running<span class="built_in"> upgrade </span>3894bccad37f -&gt; 0e66c5227a8a</span><br><span class="line"><span class="builtin-name">INFO</span>  [alembic.runtime.migration] Running<span class="built_in"> upgrade </span>0e66c5227a8a -&gt; 45f8dd33480b</span><br><span class="line"><span class="builtin-name">INFO</span>  [alembic.runtime.migration] Running<span class="built_in"> upgrade </span>45f8dd33480b -&gt; 5abc0278ca73</span><br><span class="line"><span class="builtin-name">INFO</span>  [alembic.runtime.migration] Running<span class="built_in"> upgrade </span>kilo -&gt; 30018084ec99</span><br><span class="line"><span class="builtin-name">INFO</span>  [alembic.runtime.migration] Running<span class="built_in"> upgrade </span>30018084ec99 -&gt; 4ffceebfada</span><br><span class="line"><span class="builtin-name">INFO</span>  [alembic.runtime.migration] Running<span class="built_in"> upgrade </span>4ffceebfada -&gt; 5498d17be016</span><br><span class="line"><span class="builtin-name">INFO</span>  [alembic.runtime.migration] Running<span class="built_in"> upgrade </span>5498d17be016 -&gt; 2a16083502f3</span><br><span class="line"><span class="builtin-name">INFO</span>  [alembic.runtime.migration] Running<span class="built_in"> upgrade </span>2a16083502f3 -&gt; 2e5352a0ad4d</span><br><span class="line"><span class="builtin-name">INFO</span>  [alembic.runtime.migration] Running<span class="built_in"> upgrade </span>2e5352a0ad4d -&gt; 11926bcfe72d</span><br><span class="line"><span class="builtin-name">INFO</span>  [alembic.runtime.migration] Running<span class="built_in"> upgrade </span>11926bcfe72d -&gt; 4af11ca47297</span><br><span class="line"><span class="builtin-name">INFO</span>  [alembic.runtime.migration] Running<span class="built_in"> upgrade </span>4af11ca47297 -&gt; 1b294093239c</span><br><span class="line"><span class="builtin-name">INFO</span>  [alembic.runtime.migration] Running<span class="built_in"> upgrade </span>1b294093239c -&gt; 8a6d8bdae39</span><br><span class="line"><span class="builtin-name">INFO</span>  [alembic.runtime.migration] Running<span class="built_in"> upgrade </span>8a6d8bdae39 -&gt; 2b4c2465d44b</span><br><span class="line"><span class="builtin-name">INFO</span>  [alembic.runtime.migration] Running<span class="built_in"> upgrade </span>2b4c2465d44b -&gt; e3278ee65050</span><br><span class="line"><span class="builtin-name">INFO</span>  [alembic.runtime.migration] Running<span class="built_in"> upgrade </span>e3278ee65050 -&gt; c6c112992c9</span><br><span class="line"><span class="builtin-name">INFO</span>  [alembic.runtime.migration] Running<span class="built_in"> upgrade </span>c6c112992c9 -&gt; 5ffceebfada</span><br><span class="line"><span class="builtin-name">INFO</span>  [alembic.runtime.migration] Running<span class="built_in"> upgrade </span>5ffceebfada -&gt; 4ffceebfcdc</span><br><span class="line"><span class="builtin-name">INFO</span>  [alembic.runtime.migration] Running<span class="built_in"> upgrade </span>4ffceebfcdc -&gt; 7bbb25278f53</span><br><span class="line"><span class="builtin-name">INFO</span>  [alembic.runtime.migration] Running<span class="built_in"> upgrade </span>7bbb25278f53 -&gt; 89ab9a816d70</span><br><span class="line"><span class="builtin-name">INFO</span>  [alembic.runtime.migration] Running<span class="built_in"> upgrade </span>5abc0278ca73 -&gt; d3435b514502</span><br><span class="line"><span class="builtin-name">INFO</span>  [alembic.runtime.migration] Running<span class="built_in"> upgrade </span>d3435b514502 -&gt; 30107ab6a3ee</span><br><span class="line"><span class="builtin-name">INFO</span>  [alembic.runtime.migration] Running<span class="built_in"> upgrade </span>30107ab6a3ee -&gt; c415aab1c048</span><br><span class="line"><span class="builtin-name">INFO</span>  [alembic.runtime.migration] Running<span class="built_in"> upgrade </span>c415aab1c048 -&gt; a963b38d82f4</span><br><span class="line"><span class="builtin-name">INFO</span>  [alembic.runtime.migration] Running<span class="built_in"> upgrade </span>a963b38d82f4 -&gt; 3d0e74aa7d37</span><br><span class="line"><span class="builtin-name">INFO</span>  [alembic.runtime.migration] Running<span class="built_in"> upgrade </span>3d0e74aa7d37 -&gt; 030a959ceafa</span><br><span class="line"><span class="builtin-name">INFO</span>  [alembic.runtime.migration] Running<span class="built_in"> upgrade </span>030a959ceafa -&gt; a5648cfeeadf</span><br><span class="line"><span class="builtin-name">INFO</span>  [alembic.runtime.migration] Running<span class="built_in"> upgrade </span>a5648cfeeadf -&gt; 0f5bef0f87d4</span><br><span class="line"><span class="builtin-name">INFO</span>  [alembic.runtime.migration] Running<span class="built_in"> upgrade </span>0f5bef0f87d4 -&gt; 67daae611b6e</span><br><span class="line"><span class="builtin-name">INFO</span>  [alembic.runtime.migration] Running<span class="built_in"> upgrade </span>89ab9a816d70 -&gt; c879c5e1ee90</span><br><span class="line"><span class="builtin-name">INFO</span>  [alembic.runtime.migration] Running<span class="built_in"> upgrade </span>c879c5e1ee90 -&gt; 8fd3918ef6f4</span><br><span class="line"><span class="builtin-name">INFO</span>  [alembic.runtime.migration] Running<span class="built_in"> upgrade </span>8fd3918ef6f4 -&gt; 4bcd4df1f426</span><br><span class="line"><span class="builtin-name">INFO</span>  [alembic.runtime.migration] Running<span class="built_in"> upgrade </span>4bcd4df1f426 -&gt; b67e765a3524</span><br><span class="line"><span class="builtin-name">INFO</span>  [alembic.runtime.migration] Running<span class="built_in"> upgrade </span>67daae611b6e -&gt; 6b461a21bcfc</span><br><span class="line"><span class="builtin-name">INFO</span>  [alembic.runtime.migration] Running<span class="built_in"> upgrade </span>6b461a21bcfc -&gt; 5cd92597d11d</span><br><span class="line"><span class="builtin-name">INFO</span>  [alembic.runtime.migration] Running<span class="built_in"> upgrade </span>5cd92597d11d -&gt; 929c968efe70</span><br><span class="line"><span class="builtin-name">INFO</span>  [alembic.runtime.migration] Running<span class="built_in"> upgrade </span>929c968efe70 -&gt; a9c43481023c</span><br><span class="line"><span class="builtin-name">INFO</span>  [alembic.runtime.migration] Running<span class="built_in"> upgrade </span>a9c43481023c -&gt; 804a3c76314c</span><br><span class="line"><span class="builtin-name">INFO</span>  [alembic.runtime.migration] Running<span class="built_in"> upgrade </span>804a3c76314c -&gt; 2b42d90729da</span><br><span class="line"><span class="builtin-name">INFO</span>  [alembic.runtime.migration] Running<span class="built_in"> upgrade </span>2b42d90729da -&gt; 62c781cb6192</span><br><span class="line"><span class="builtin-name">INFO</span>  [alembic.runtime.migration] Running<span class="built_in"> upgrade </span>62c781cb6192 -&gt; c8c222d42aa9</span><br><span class="line"><span class="builtin-name">INFO</span>  [alembic.runtime.migration] Running<span class="built_in"> upgrade </span>c8c222d42aa9 -&gt; 349b6fd605a6</span><br><span class="line"><span class="builtin-name">INFO</span>  [alembic.runtime.migration] Running<span class="built_in"> upgrade </span>349b6fd605a6 -&gt; 7d32f979895f</span><br><span class="line"><span class="builtin-name">INFO</span>  [alembic.runtime.migration] Running<span class="built_in"> upgrade </span>7d32f979895f -&gt; 594422d373ee</span><br><span class="line"><span class="builtin-name">INFO</span>  [alembic.runtime.migration] Running<span class="built_in"> upgrade </span>594422d373ee -&gt; 61663558142c</span><br><span class="line"><span class="builtin-name">INFO</span>  [alembic.runtime.migration] Running<span class="built_in"> upgrade </span>61663558142c -&gt; 867d39095bf4,<span class="built_in"> port </span>forwarding</span><br><span class="line"><span class="builtin-name">INFO</span>  [alembic.runtime.migration] Running<span class="built_in"> upgrade </span>b67e765a3524 -&gt; a84ccf28f06a</span><br><span class="line"><span class="builtin-name">INFO</span>  [alembic.runtime.migration] Running<span class="built_in"> upgrade </span>a84ccf28f06a -&gt; 7d9d8eeec6ad</span><br><span class="line"><span class="builtin-name">INFO</span>  [alembic.runtime.migration] Running<span class="built_in"> upgrade </span>7d9d8eeec6ad -&gt; a8b517cff8ab</span><br><span class="line"><span class="builtin-name">INFO</span>  [alembic.runtime.migration] Running<span class="built_in"> upgrade </span>a8b517cff8ab -&gt; 3b935b28e7a0</span><br><span class="line"><span class="builtin-name">INFO</span>  [alembic.runtime.migration] Running<span class="built_in"> upgrade </span>3b935b28e7a0 -&gt; b12a3ef66e62</span><br><span class="line"><span class="builtin-name">INFO</span>  [alembic.runtime.migration] Running<span class="built_in"> upgrade </span>b12a3ef66e62 -&gt; 97c25b0d2353</span><br><span class="line"><span class="builtin-name">INFO</span>  [alembic.runtime.migration] Running<span class="built_in"> upgrade </span>97c25b0d2353 -&gt; 2e0d7a8a1586</span><br><span class="line"><span class="builtin-name">INFO</span>  [alembic.runtime.migration] Running<span class="built_in"> upgrade </span>2e0d7a8a1586 -&gt; 5c85685d616d</span><br><span class="line">  OK</span><br></pre></td></tr></table></figure></p>
<h3 id="8-重启-nova-api-服务-会话存储服务"><a href="#8-重启-nova-api-服务-会话存储服务" class="headerlink" title="8. 重启 nova_api 服务, 会话存储服务"></a>8. 重启 nova_api 服务, 会话存储服务</h3><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@openstack</span> ~]<span class="meta"># systemctl restart openstack-nova-api</span></span><br></pre></td></tr></table></figure>
<h3 id="9-启动-Neutron-服务并设置为开机自启"><a href="#9-启动-Neutron-服务并设置为开机自启" class="headerlink" title="9. 启动 Neutron 服务并设置为开机自启"></a>9. 启动 Neutron 服务并设置为开机自启</h3><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]<span class="comment"># systemctl start neutron-server neutron-linuxbridge-agent neutron-dhcp-agent neutron-metadata-agent</span></span><br><span class="line">[root@openstack ~]<span class="comment"># systemctl enable neutron-server neutron-linuxbridge-agent neutron-dhcp-agent neutron-metadata-agent</span></span><br><span class="line">Created symlink from /etc/systemd/system/multi-user.target.wants/neutron-server.service to /usr/<span class="class"><span class="keyword">lib</span>/<span class="title">systemd</span>/<span class="title">system</span>/<span class="title">neutron</span>-<span class="title">server</span>.<span class="title">service</span>.</span></span><br><span class="line">Created symlink from /etc/systemd/system/multi-user.target.wants/neutron-linuxbridge-agent.service to /usr/<span class="class"><span class="keyword">lib</span>/<span class="title">systemd</span>/<span class="title">system</span>/<span class="title">neutron</span>-<span class="title">linuxbridge</span>-<span class="title">agent</span>.<span class="title">service</span>.</span></span><br><span class="line">Created symlink from /etc/systemd/system/multi-user.target.wants/neutron-dhcp-agent.service to /usr/<span class="class"><span class="keyword">lib</span>/<span class="title">systemd</span>/<span class="title">system</span>/<span class="title">neutron</span>-<span class="title">dhcp</span>-<span class="title">agent</span>.<span class="title">service</span>.</span></span><br><span class="line">Created symlink from /etc/systemd/system/multi-user.target.wants/neutron-metadata-agent.service to /usr/<span class="class"><span class="keyword">lib</span>/<span class="title">systemd</span>/<span class="title">system</span>/<span class="title">neutron</span>-<span class="title">metadata</span>-<span class="title">agent</span>.<span class="title">service</span>.</span></span><br></pre></td></tr></table></figure>
<p><strong><em>恭喜你配置完成了 controller 节点, 为 controller 节点再再次拍摄一个快照, 以备不时之需</em></strong></p>
<h2 id="十二、安装并部署-Compute-节点"><a href="#十二、安装并部署-Compute-节点" class="headerlink" title="十二、安装并部署 Compute 节点"></a>十二、安装并部署 Compute 节点</h2><p><strong><em>!!!以下命令无特殊说明, 均在 Compute 节点执行!!!</em></strong></p>
<h3 id="1-安装-Nova-相关软件包"><a href="#1-安装-Nova-相关软件包" class="headerlink" title="1. 安装 Nova 相关软件包"></a>1. 安装 Nova 相关软件包</h3><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@openstack</span> ~]<span class="meta"># yum install -y openstack-nova-compute python-openstackclient openstack-utils</span></span><br><span class="line">...</span><br><span class="line">Complete!</span><br></pre></td></tr></table></figure>
<h3 id="2-使用-openstack-utils-快速配置-Nova"><a href="#2-使用-openstack-utils-快速配置-Nova" class="headerlink" title="2. 使用 openstack-utils 快速配置 Nova"></a>2. 使用 openstack-utils 快速配置 Nova</h3><p><strong><em>必须确认配置是否正确</em></strong><br><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/nova/nova.conf DEFAULT my_ip "192.168.10.31"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/nova/nova.conf DEFAULT use_neutron "True"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/nova/nova.conf DEFAULT firewall_driver "nova.virt.firewall.NoopFirewallDriver"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/nova/nova.conf DEFAULT enabled_apis "osapi_compute,metadata"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/nova/nova.conf DEFAULT transport_url "rabbit://openstack:123456@controller"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/nova/nova.conf api auth_strategy "keystone" </span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/nova/nova.conf keystone_authtoken auth_url "http://controller:5000/v3"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/nova/nova.conf keystone_authtoken memcached_servers "controller:11211"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/nova/nova.conf keystone_authtoken auth_type "password"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/nova/nova.conf keystone_authtoken project_domain_name "default"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/nova/nova.conf keystone_authtoken user_domain_name "default"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/nova/nova.conf keystone_authtoken project_name "service"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/nova/nova.conf keystone_authtoken username "nova"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/nova/nova.conf keystone_authtoken password "123456"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/nova/nova.conf vnc enabled "True"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/nova/nova.conf vnc server_listen "0.0.0.0"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/nova/nova.conf vnc server_proxyclient_address "\$my_ip"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/nova/nova.conf vnc novncproxy_base_url "http://controller:6080/vnc_auto.html"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/nova/nova.conf glance api_servers "http://controller:9292"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/nova/nova.conf oslo_concurrency lock_path "/var/lib/nova/tmp"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/nova/nova.conf placement region_name "RegionOne"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/nova/nova.conf placement project_domain_name "Default"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/nova/nova.conf placement project_name "service"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/nova/nova.conf placement auth_type "password"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/nova/nova.conf placement user_domain_name "Default"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/nova/nova.conf placement auth_url "http://controller:5000/v3"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/nova/nova.conf placement username "placement"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/nova/nova.conf placement password "123456"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># grep '^[a-z]' /etc/nova/nova.conf</span></span><br><span class="line"><span class="attr">my_ip</span> = <span class="number">192.168</span>.<span class="number">10.31</span></span><br><span class="line"><span class="attr">use_neutron</span> = <span class="literal">True</span></span><br><span class="line"><span class="attr">firewall_driver</span> = nova.virt.firewall.NoopFirewallDriver</span><br><span class="line"><span class="attr">enabled_apis</span> = osapi_compute,metadata</span><br><span class="line"><span class="attr">transport_url</span> = rabbit://openstack:<span class="number">123456</span>@controller</span><br><span class="line"><span class="attr">auth_strategy</span> = keystone</span><br><span class="line"><span class="attr">api_servers</span> = http://controller:<span class="number">9292</span></span><br><span class="line"><span class="attr">auth_url</span> = http://controller:<span class="number">5000</span>/v3</span><br><span class="line"><span class="attr">memcached_servers</span> = controller:<span class="number">11211</span></span><br><span class="line"><span class="attr">auth_type</span> = password</span><br><span class="line"><span class="attr">project_domain_name</span> = default</span><br><span class="line"><span class="attr">user_domain_name</span> = default</span><br><span class="line"><span class="attr">project_name</span> = service</span><br><span class="line"><span class="attr">username</span> = nova</span><br><span class="line"><span class="attr">password</span> = <span class="number">123456</span></span><br><span class="line"><span class="attr">lock_path</span> = /var/lib/nova/tmp</span><br><span class="line"><span class="attr">region_name</span> = RegionOne</span><br><span class="line"><span class="attr">project_domain_name</span> = Default</span><br><span class="line"><span class="attr">project_name</span> = service</span><br><span class="line"><span class="attr">auth_type</span> = password</span><br><span class="line"><span class="attr">user_domain_name</span> = Default</span><br><span class="line"><span class="attr">auth_url</span> = http://controller:<span class="number">5000</span>/v3</span><br><span class="line"><span class="attr">username</span> = placement</span><br><span class="line"><span class="attr">password</span> = <span class="number">123456</span></span><br><span class="line"><span class="attr">enabled</span> = <span class="literal">True</span></span><br><span class="line"><span class="attr">server_listen</span> = <span class="number">0.0</span>.<span class="number">0.0</span></span><br><span class="line"><span class="attr">server_proxyclient_address</span> = <span class="variable">$my_ip</span></span><br><span class="line"><span class="attr">novncproxy_base_url</span> = http://controller:<span class="number">6080</span>/vnc_auto.html</span><br></pre></td></tr></table></figure></p>
<h3 id="3-配置虚拟机的硬件加速"><a href="#3-配置虚拟机的硬件加速" class="headerlink" title="3. 配置虚拟机的硬件加速"></a>3. 配置虚拟机的硬件加速</h3><h4 id="a-确认计算节点是否支持虚拟机的硬件加速"><a href="#a-确认计算节点是否支持虚拟机的硬件加速" class="headerlink" title="a) 确认计算节点是否支持虚拟机的硬件加速"></a>a) 确认计算节点是否支持虚拟机的硬件加速</h4><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@openstack</span> ~]<span class="meta"># egrep -c <span class="string">'(vmx|svm)'</span> /proc/cpuinfo</span></span><br><span class="line"><span class="number">1</span></span><br></pre></td></tr></table></figure>
<h4 id="b1-如果返回0-表示计算节点不支持硬件加速-需要配置-libvirt-使用-QEMU-方式管理虚拟机-使用以下命令"><a href="#b1-如果返回0-表示计算节点不支持硬件加速-需要配置-libvirt-使用-QEMU-方式管理虚拟机-使用以下命令" class="headerlink" title="b1) 如果返回0, 表示计算节点不支持硬件加速, 需要配置 libvirt 使用 QEMU 方式管理虚拟机, 使用以下命令:"></a>b1) 如果返回0, 表示计算节点不支持硬件加速, 需要配置 libvirt 使用 QEMU 方式管理虚拟机, 使用以下命令:</h4><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# openstack-config --<span class="keyword">set</span> /etc/nova/nova.conf libvirt virt_type <span class="comment">"qemu"</span></span><br><span class="line">[root@openstack ~]# egrep -v <span class="comment">"^#|^$"</span> /etc/nova/nova.conf |<span class="comment"> grep</span> <span class="comment">'virt_type'</span></span><br><span class="line">virt_type <span class="comment">= qemu</span></span><br></pre></td></tr></table></figure>
<h4 id="b2-如果返回其他值-表示计算节点支持硬件加速且不需要额外的配置-使用以下命令"><a href="#b2-如果返回其他值-表示计算节点支持硬件加速且不需要额外的配置-使用以下命令" class="headerlink" title="b2) 如果返回其他值, 表示计算节点支持硬件加速且不需要额外的配置, 使用以下命令:"></a>b2) 如果返回其他值, 表示计算节点支持硬件加速且不需要额外的配置, 使用以下命令:</h4><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# openstack-config --<span class="keyword">set</span> /etc/nova/nova.conf libvirt virt_type <span class="comment">"kvm"</span></span><br><span class="line">[root@openstack ~]# egrep -v <span class="comment">"^#|^$"</span> /etc/nova/nova.conf |<span class="comment"> grep</span> <span class="comment">'virt_type'</span></span><br><span class="line">virt_type <span class="comment">= kvm</span></span><br></pre></td></tr></table></figure>
<h3 id="4-启动-Nova-服务并设置为开机自启"><a href="#4-启动-Nova-服务并设置为开机自启" class="headerlink" title="4. 启动 Nova 服务并设置为开机自启"></a>4. 启动 Nova 服务并设置为开机自启</h3><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]<span class="comment"># systemctl start libvirtd openstack-nova-compute</span></span><br><span class="line">[root@openstack ~]<span class="comment"># systemctl enable libvirtd openstack-nova-compute</span></span><br><span class="line">Created symlink from /etc/systemd/system/multi-user.target.wants/openstack-nova-compute.service to /usr/<span class="class"><span class="keyword">lib</span>/<span class="title">systemd</span>/<span class="title">system</span>/<span class="title">openstack</span>-<span class="title">nova</span>-<span class="title">compute</span>.<span class="title">service</span>.</span></span><br></pre></td></tr></table></figure>
<h3 id="5-安装-Neutron-相关软件包"><a href="#5-安装-Neutron-相关软件包" class="headerlink" title="5. 安装 Neutron 相关软件包"></a>5. 安装 Neutron 相关软件包</h3><p><strong><em>!!!以下命令在 Compute 节点执行!!!</em></strong><br><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@openstack</span> ~]<span class="meta"># yum install -y openstack-neutron-linuxbridge ebtables ipset</span></span><br><span class="line">...</span><br><span class="line">Complete!</span><br></pre></td></tr></table></figure></p>
<h3 id="6-使用-openstack-utils-快速配置-Neutron-的配置文件-neutron-conf"><a href="#6-使用-openstack-utils-快速配置-Neutron-的配置文件-neutron-conf" class="headerlink" title="6. 使用 openstack-utils 快速配置 Neutron 的配置文件 (neutron.conf)"></a>6. 使用 openstack-utils 快速配置 Neutron 的配置文件 (neutron.conf)</h3><p><strong><em>必须确认配置是否正确</em></strong><br><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/neutron/neutron.conf DEFAULT transport_url "rabbit://openstack:123456@controller"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/neutron/neutron.conf DEFAULT auth_strategy "keystone"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/neutron/neutron.conf keystone_authtoken www_authenticate_uri "http://controller:5000"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/neutron/neutron.conf keystone_authtoken auth_url "http://controller:5000"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/neutron/neutron.conf keystone_authtoken memcached_servers "controller:11211"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/neutron/neutron.conf keystone_authtoken auth_type "password"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/neutron/neutron.conf keystone_authtoken project_domain_name "default"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/neutron/neutron.conf keystone_authtoken user_domain_name "default"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/neutron/neutron.conf keystone_authtoken project_name "service"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/neutron/neutron.conf keystone_authtoken username "neutron"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/neutron/neutron.conf keystone_authtoken password "123456"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/neutron/neutron.conf oslo_concurrency lock_path "/var/lib/neutron/tmp"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># grep '^[a-z]' /etc/neutron/neutron.conf</span></span><br><span class="line"><span class="attr">transport_url</span> = rabbit://openstack:<span class="number">123456</span>@controller</span><br><span class="line"><span class="attr">auth_strategy</span> = keystone</span><br><span class="line"><span class="attr">www_authenticate_uri</span> = http://controller:<span class="number">5000</span></span><br><span class="line"><span class="attr">auth_url</span> = http://controller:<span class="number">5000</span></span><br><span class="line"><span class="attr">memcached_servers</span> = controller:<span class="number">11211</span></span><br><span class="line"><span class="attr">auth_type</span> = password</span><br><span class="line"><span class="attr">project_domain_name</span> = default</span><br><span class="line"><span class="attr">user_domain_name</span> = default</span><br><span class="line"><span class="attr">project_name</span> = service</span><br><span class="line"><span class="attr">username</span> = neutron</span><br><span class="line"><span class="attr">password</span> = <span class="number">123456</span></span><br><span class="line"><span class="attr">lock_path</span> = /var/lib/neutron/tmp</span><br></pre></td></tr></table></figure></p>
<h3 id="7-使用-openstack-utils-快速配置-Neutron-的配置文件-linuxbridge-agent-conf"><a href="#7-使用-openstack-utils-快速配置-Neutron-的配置文件-linuxbridge-agent-conf" class="headerlink" title="7. 使用 openstack-utils 快速配置 Neutron 的配置文件 (linuxbridge_agent.conf)"></a>7. 使用 openstack-utils 快速配置 Neutron 的配置文件 (linuxbridge_agent.conf)</h3><p><strong><em>必须确认配置是否正确</em></strong><br>注意：第一个选项physical_interface_mappings选项要配置计算节点自身的网卡名称provider:ens33<br><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/neutron/plugins/ml2/linuxbridge_agent.ini linux_bridge physical_interface_mappings "provider:ens32"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/neutron/plugins/ml2/linuxbridge_agent.ini vxlan enable_vxlan "false"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/neutron/plugins/ml2/linuxbridge_agent.ini securitygroup enable_security_group "true"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/neutron/plugins/ml2/linuxbridge_agent.ini securitygroup firewall_driver "neutron.agent.linux.iptables_firewall.IptablesFirewallDriver"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># grep '^[a-z]' /etc/neutron/plugins/ml2/linuxbridge_agent.ini</span></span><br><span class="line"><span class="attr">physical_interface_mappings</span> = provider:ens32</span><br><span class="line"><span class="attr">enable_security_group</span> = <span class="literal">true</span></span><br><span class="line"><span class="attr">firewall_driver</span> = neutron.agent.linux.iptables_firewall.IptablesFirewallDriver</span><br><span class="line"><span class="attr">enable_vxlan</span> = <span class="literal">false</span></span><br></pre></td></tr></table></figure></p>
<h3 id="8-使用-openstack-utils-快速配置-Neutron-的配置文件-nova-conf"><a href="#8-使用-openstack-utils-快速配置-Neutron-的配置文件-nova-conf" class="headerlink" title="8. 使用 openstack-utils 快速配置 Neutron 的配置文件 (nova.conf)"></a>8. 使用 openstack-utils 快速配置 Neutron 的配置文件 (nova.conf)</h3><p><strong><em>必须确认配置是否正确</em></strong><br><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/nova/nova.conf neutron url "http://controller:9696"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/nova/nova.conf neutron auth_url "http://controller:5000"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/nova/nova.conf neutron auth_type "password"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/nova/nova.conf neutron project_domain_name "default"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/nova/nova.conf neutron user_domain_name "default"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/nova/nova.conf neutron region_name "RegionOne"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/nova/nova.conf neutron project_name "service" </span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/nova/nova.conf neutron username "neutron"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># openstack-config --set /etc/nova/nova.conf neutron password "123456"</span></span><br><span class="line"><span class="section">[root@openstack ~]</span><span class="comment"># grep '^[a-z]' /etc/nova/nova.conf</span></span><br><span class="line"><span class="attr">my_ip</span> = <span class="number">192.168</span>.<span class="number">10.31</span></span><br><span class="line"><span class="attr">use_neutron</span> = <span class="literal">True</span></span><br><span class="line"><span class="attr">firewall_driver</span> = nova.virt.firewall.NoopFirewallDriver</span><br><span class="line"><span class="attr">enabled_apis</span> = osapi_compute,metadata</span><br><span class="line"><span class="attr">transport_url</span> = rabbit://openstack:<span class="number">123456</span>@controller</span><br><span class="line"><span class="attr">auth_strategy</span> = keystone</span><br><span class="line"><span class="attr">api_servers</span> = http://controller:<span class="number">9292</span></span><br><span class="line"><span class="attr">auth_url</span> = http://controller:<span class="number">5000</span>/v3</span><br><span class="line"><span class="attr">memcached_servers</span> = controller:<span class="number">11211</span></span><br><span class="line"><span class="attr">auth_type</span> = password</span><br><span class="line"><span class="attr">project_domain_name</span> = default</span><br><span class="line"><span class="attr">user_domain_name</span> = default</span><br><span class="line"><span class="attr">project_name</span> = service</span><br><span class="line"><span class="attr">username</span> = nova</span><br><span class="line"><span class="attr">password</span> = <span class="number">123456</span></span><br><span class="line"><span class="attr">virt_type</span> = kvm</span><br><span class="line"><span class="attr">url</span> = http://controller:<span class="number">9696</span></span><br><span class="line"><span class="attr">auth_url</span> = http://controller:<span class="number">5000</span></span><br><span class="line"><span class="attr">auth_type</span> = password</span><br><span class="line"><span class="attr">project_domain_name</span> = default</span><br><span class="line"><span class="attr">user_domain_name</span> = default</span><br><span class="line"><span class="attr">region_name</span> = RegionOne</span><br><span class="line"><span class="attr">project_name</span> = service</span><br><span class="line"><span class="attr">username</span> = neutron</span><br><span class="line"><span class="attr">password</span> = <span class="number">123456</span></span><br><span class="line"><span class="attr">lock_path</span> = /var/lib/nova/tmp</span><br><span class="line"><span class="attr">region_name</span> = RegionOne</span><br><span class="line"><span class="attr">project_domain_name</span> = Default</span><br><span class="line"><span class="attr">project_name</span> = service</span><br><span class="line"><span class="attr">auth_type</span> = password</span><br><span class="line"><span class="attr">user_domain_name</span> = Default</span><br><span class="line"><span class="attr">auth_url</span> = http://controller:<span class="number">5000</span>/v3</span><br><span class="line"><span class="attr">username</span> = placement</span><br><span class="line"><span class="attr">password</span> = <span class="number">123456</span></span><br><span class="line"><span class="attr">enabled</span> = <span class="literal">True</span></span><br><span class="line"><span class="attr">server_listen</span> = <span class="number">0.0</span>.<span class="number">0.0</span></span><br><span class="line"><span class="attr">server_proxyclient_address</span> = <span class="variable">$my_ip</span></span><br><span class="line"><span class="attr">novncproxy_base_url</span> = http://controller:<span class="number">6080</span>/vnc_auto.html</span><br></pre></td></tr></table></figure></p>
<h3 id="9-重启-Neutron-服务"><a href="#9-重启-Neutron-服务" class="headerlink" title="9. 重启 Neutron 服务"></a>9. 重启 Neutron 服务</h3><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@openstack</span> ~]<span class="meta"># systemctl restart openstack-nova-compute</span></span><br></pre></td></tr></table></figure>
<h3 id="10-启动-Nova-服务并设置为开机自启"><a href="#10-启动-Nova-服务并设置为开机自启" class="headerlink" title="10. 启动 Nova 服务并设置为开机自启"></a>10. 启动 Nova 服务并设置为开机自启</h3><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]<span class="comment"># systemctl start neutron-linuxbridge-agent</span></span><br><span class="line">[root@openstack ~]<span class="comment"># systemctl enable neutron-linuxbridge-agent</span></span><br><span class="line">Created symlink from /etc/systemd/system/multi-user.target.wants/neutron-linuxbridge-agent.service to /usr/<span class="class"><span class="keyword">lib</span>/<span class="title">systemd</span>/<span class="title">system</span>/<span class="title">neutron</span>-<span class="title">linuxbridge</span>-<span class="title">agent</span>.<span class="title">service</span>.</span></span><br></pre></td></tr></table></figure>
<h3 id="11-将-Compute-节点增加到-cell-数据库"><a href="#11-将-Compute-节点增加到-cell-数据库" class="headerlink" title="11. 将 Compute 节点增加到 cell 数据库"></a>11. 将 Compute 节点增加到 cell 数据库</h3><p><strong><em>!!!以下命令在 Controller 节点执行!!!</em></strong></p>
<h4 id="a-确认数据库中有新的-Compute-节点"><a href="#a-确认数据库中有新的-Compute-节点" class="headerlink" title="a) 确认数据库中有新的 Compute 节点"></a>a) 确认数据库中有新的 Compute 节点</h4><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]<span class="comment"># . admin-openrc </span></span><br><span class="line">[root@openstack ~]<span class="comment"># openstack compute service list --service nova-compute</span></span><br><span class="line">+<span class="params">----</span>+<span class="params">--------------</span>+<span class="params">--------------------</span>+<span class="params">------</span>+<span class="params">---------</span>+<span class="params">-------</span>+<span class="params">----------------------------</span>+</span><br><span class="line">| ID | Binary       | Host               | Zone | Status  | State | Updated At                 |</span><br><span class="line">+<span class="params">----</span>+<span class="params">--------------</span>+<span class="params">--------------------</span>+<span class="params">------</span>+<span class="params">---------</span>+<span class="params">-------</span>+<span class="params">----------------------------</span>+</span><br><span class="line">|  6 | nova-compute | openstack.compute1 | nova | enabled | up    | 2018-12-15T10<span class="function">:00</span><span class="function">:46.000000</span> |</span><br><span class="line">+<span class="params">----</span>+<span class="params">--------------</span>+<span class="params">--------------------</span>+<span class="params">------</span>+<span class="params">---------</span>+<span class="params">-------</span>+<span class="params">----------------------------</span>+</span><br></pre></td></tr></table></figure>
<h4 id="b-手动添加新的-Compute-节点到-Openstack-集群"><a href="#b-手动添加新的-Compute-节点到-Openstack-集群" class="headerlink" title="b) 手动添加新的 Compute 节点到 Openstack 集群"></a>b) 手动添加新的 Compute 节点到 Openstack 集群</h4><figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# su -s /bin/sh -c "nova-manage cell_v2 discover_hosts --verbose" nova</span><br><span class="line">Found 2 cell mappings.</span><br><span class="line">Skipping cell0 since it does not contain hosts.</span><br><span class="line">Getting computes from cell 'cell1': 9edf7b72<span class="string">-1607</span><span class="string">-432</span>d<span class="string">-8529</span><span class="string">-30</span>f07576da4a</span><br><span class="line">Found 0 unmapped computes in cell: 9edf7b72<span class="string">-1607</span><span class="string">-432</span>d<span class="string">-8529</span><span class="string">-30</span>f07576da4a</span><br></pre></td></tr></table></figure>
<h3 id="12-验证-Compute-节点"><a href="#12-验证-Compute-节点" class="headerlink" title="12. 验证 Compute 节点"></a>12. 验证 Compute 节点</h3><p><strong><em>!!!以下命令在 Controller 节点执行!!!</em></strong><br>列出 Nova 服务组件 (openstack compute service list)<br>列出 KeyStone 服务中 API 端点 (openstack catalog list)<br>列出 Glance 服务中已有镜像 (openstack image list)<br>检查 Nova 服务各组件的状态 (nova-status upgrade check)<br><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="meta">@openstack</span> ~]<span class="comment"># . admin-openrc</span></span><br><span class="line">[root<span class="meta">@openstack</span> ~]<span class="comment"># openstack compute service list</span></span><br><span class="line">+----+------------------+----------------------+----------+---------+-------+----------------------------+</span><br><span class="line">|<span class="string"> ID </span>|<span class="string"> Binary           </span>|<span class="string"> Host                 </span>|<span class="string"> Zone     </span>|<span class="string"> Status  </span>|<span class="string"> State </span>|<span class="string"> Updated At                 </span>|</span><br><span class="line">+----+------------------+----------------------+----------+---------+-------+----------------------------+</span><br><span class="line">|<span class="string">  1 </span>|<span class="string"> nova-consoleauth </span>|<span class="string"> openstack.controller </span>|<span class="string"> internal </span>|<span class="string"> enabled </span>|<span class="string"> up    </span>|<span class="string"> 2018-12-15T10:07:03.000000 </span>|</span><br><span class="line">|<span class="string">  2 </span>|<span class="string"> nova-conductor   </span>|<span class="string"> openstack.controller </span>|<span class="string"> internal </span>|<span class="string"> enabled </span>|<span class="string"> up    </span>|<span class="string"> 2018-12-15T10:07:03.000000 </span>|</span><br><span class="line">|<span class="string">  3 </span>|<span class="string"> nova-scheduler   </span>|<span class="string"> openstack.controller </span>|<span class="string"> internal </span>|<span class="string"> enabled </span>|<span class="string"> up    </span>|<span class="string"> 2018-12-15T10:07:03.000000 </span>|</span><br><span class="line">|<span class="string">  6 </span>|<span class="string"> nova-compute     </span>|<span class="string"> openstack.compute1   </span>|<span class="string"> nova     </span>|<span class="string"> enabled </span>|<span class="string"> up    </span>|<span class="string"> 2018-12-15T10:06:59.000000 </span>|</span><br><span class="line">+----+------------------+----------------------+----------+---------+-------+----------------------------+</span><br><span class="line">[root<span class="meta">@openstack</span> ~]<span class="comment"># openstack catalog list</span></span><br><span class="line">+-----------+-----------+-----------------------------------------+</span><br><span class="line">|<span class="string"> Name      </span>|<span class="string"> Type      </span>|<span class="string"> Endpoints                               </span>|</span><br><span class="line">+-----------+-----------+-----------------------------------------+</span><br><span class="line">|<span class="string"> keystone  </span>|<span class="string"> identity  </span>|<span class="string"> RegionOne                               </span>|</span><br><span class="line">|<span class="string">           </span>|<span class="string">           </span>|<span class="string">   public: http://controller:5000/v3/    </span>|</span><br><span class="line">|<span class="string">           </span>|<span class="string">           </span>|<span class="string"> RegionOne                               </span>|</span><br><span class="line">|<span class="string">           </span>|<span class="string">           </span>|<span class="string">   admin: http://controller:5000/v3/     </span>|</span><br><span class="line">|<span class="string">           </span>|<span class="string">           </span>|<span class="string"> RegionOne                               </span>|</span><br><span class="line">|<span class="string">           </span>|<span class="string">           </span>|<span class="string">   internal: http://controller:5000/v3/  </span>|</span><br><span class="line">|<span class="string">           </span>|<span class="string">           </span>|<span class="string">                                         </span>|</span><br><span class="line">|<span class="string"> nova      </span>|<span class="string"> compute   </span>|<span class="string"> RegionOne                               </span>|</span><br><span class="line">|<span class="string">           </span>|<span class="string">           </span>|<span class="string">   internal: http://controller:8774/v2.1 </span>|</span><br><span class="line">|<span class="string">           </span>|<span class="string">           </span>|<span class="string"> RegionOne                               </span>|</span><br><span class="line">|<span class="string">           </span>|<span class="string">           </span>|<span class="string">   admin: http://controller:8774/v2.1    </span>|</span><br><span class="line">|<span class="string">           </span>|<span class="string">           </span>|<span class="string"> RegionOne                               </span>|</span><br><span class="line">|<span class="string">           </span>|<span class="string">           </span>|<span class="string">   public: http://controller:8774/v2.1   </span>|</span><br><span class="line">|<span class="string">           </span>|<span class="string">           </span>|<span class="string">                                         </span>|</span><br><span class="line">|<span class="string"> placement </span>|<span class="string"> placement </span>|<span class="string"> RegionOne                               </span>|</span><br><span class="line">|<span class="string">           </span>|<span class="string">           </span>|<span class="string">   public: http://controller:8778        </span>|</span><br><span class="line">|<span class="string">           </span>|<span class="string">           </span>|<span class="string"> RegionOne                               </span>|</span><br><span class="line">|<span class="string">           </span>|<span class="string">           </span>|<span class="string">   internal: http://controller:8778      </span>|</span><br><span class="line">|<span class="string">           </span>|<span class="string">           </span>|<span class="string"> RegionOne                               </span>|</span><br><span class="line">|<span class="string">           </span>|<span class="string">           </span>|<span class="string">   admin: http://controller:8778         </span>|</span><br><span class="line">|<span class="string">           </span>|<span class="string">           </span>|<span class="string">                                         </span>|</span><br><span class="line">|<span class="string"> glance    </span>|<span class="string"> image     </span>|<span class="string"> RegionOne                               </span>|</span><br><span class="line">|<span class="string">           </span>|<span class="string">           </span>|<span class="string">   internal: http://controller:9292      </span>|</span><br><span class="line">|<span class="string">           </span>|<span class="string">           </span>|<span class="string"> RegionOne                               </span>|</span><br><span class="line">|<span class="string">           </span>|<span class="string">           </span>|<span class="string">   admin: http://controller:9292         </span>|</span><br><span class="line">|<span class="string">           </span>|<span class="string">           </span>|<span class="string"> RegionOne                               </span>|</span><br><span class="line">|<span class="string">           </span>|<span class="string">           </span>|<span class="string">   public: http://controller:9292        </span>|</span><br><span class="line">|<span class="string">           </span>|<span class="string">           </span>|<span class="string">                                         </span>|</span><br><span class="line">+-----------+-----------+-----------------------------------------+</span><br><span class="line">[root<span class="meta">@openstack</span> ~]<span class="comment"># openstack image list</span></span><br><span class="line">+--------------------------------------+--------+--------+</span><br><span class="line">|<span class="string"> ID                                   </span>|<span class="string"> Name   </span>|<span class="string"> Status </span>|</span><br><span class="line">+--------------------------------------+--------+--------+</span><br><span class="line">|<span class="string"> 28be57c8-8f04-407b-8a32-41d953a4a131 </span>|<span class="string"> cirros </span>|<span class="string"> active </span>|</span><br><span class="line">+--------------------------------------+--------+--------+</span><br><span class="line">[root<span class="meta">@openstack</span> ~]<span class="comment"># nova-status upgrade check</span></span><br><span class="line">+--------------------------------+</span><br><span class="line">|<span class="string"> Upgrade Check Results          </span>|</span><br><span class="line">+--------------------------------+</span><br><span class="line">|<span class="string"> Check: Cells v2                </span>|</span><br><span class="line">|<span class="string"> Result: Success                </span>|</span><br><span class="line">|<span class="string"> Details: None                  </span>|</span><br><span class="line">+--------------------------------+</span><br><span class="line">|<span class="string"> Check: Placement API           </span>|</span><br><span class="line">|<span class="string"> Result: Success                </span>|</span><br><span class="line">|<span class="string"> Details: None                  </span>|</span><br><span class="line">+--------------------------------+</span><br><span class="line">|<span class="string"> Check: Resource Providers      </span>|</span><br><span class="line">|<span class="string"> Result: Success                </span>|</span><br><span class="line">|<span class="string"> Details: None                  </span>|</span><br><span class="line">+--------------------------------+</span><br><span class="line">|<span class="string"> Check: Ironic Flavor Migration </span>|</span><br><span class="line">|<span class="string"> Result: Success                </span>|</span><br><span class="line">|<span class="string"> Details: None                  </span>|</span><br><span class="line">+--------------------------------+</span><br><span class="line">|<span class="string"> Check: API Service Version     </span>|</span><br><span class="line">|<span class="string"> Result: Success                </span>|</span><br><span class="line">|<span class="string"> Details: None                  </span>|</span><br><span class="line">+--------------------------------+</span><br><span class="line">|<span class="string"> Check: Request Spec Migration  </span>|</span><br><span class="line">|<span class="string"> Result: Success                </span>|</span><br><span class="line">|<span class="string"> Details: None                  </span>|</span><br><span class="line">+--------------------------------+</span><br><span class="line">|<span class="string"> Check: Console Auths           </span>|</span><br><span class="line">|<span class="string"> Result: Success                </span>|</span><br><span class="line">|<span class="string"> Details: None                  </span>|</span><br><span class="line">+--------------------------------+</span><br><span class="line">[root<span class="meta">@openstack</span> ~]<span class="comment"># neutron ext-list</span></span><br><span class="line">neutron CLI is deprecated and will be removed in the future. Use openstack CLI instead.</span><br><span class="line">+--------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">|<span class="string"> alias                          </span>|<span class="string"> name                                                                                                                                    </span>|</span><br><span class="line">+--------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">|<span class="string"> default-subnetpools            </span>|<span class="string"> Default Subnetpools                                                                                                                     </span>|</span><br><span class="line">|<span class="string"> network-ip-availability        </span>|<span class="string"> Network IP Availability                                                                                                                 </span>|</span><br><span class="line">|<span class="string"> network_availability_zone      </span>|<span class="string"> Network Availability Zone                                                                                                               </span>|</span><br><span class="line">|<span class="string"> net-mtu-writable               </span>|<span class="string"> Network MTU (writable)                                                                                                                  </span>|</span><br><span class="line">|<span class="string"> binding                        </span>|<span class="string"> Port Binding                                                                                                                            </span>|</span><br><span class="line">|<span class="string"> agent                          </span>|<span class="string"> agent                                                                                                                                   </span>|</span><br><span class="line">|<span class="string"> subnet_allocation              </span>|<span class="string"> Subnet Allocation                                                                                                                       </span>|</span><br><span class="line">|<span class="string"> dhcp_agent_scheduler           </span>|<span class="string"> DHCP Agent Scheduler                                                                                                                    </span>|</span><br><span class="line">|<span class="string"> external-net                   </span>|<span class="string"> Neutron external network                                                                                                                </span>|</span><br><span class="line">|<span class="string"> flavors                        </span>|<span class="string"> Neutron Service Flavors                                                                                                                 </span>|</span><br><span class="line">|<span class="string"> net-mtu                        </span>|<span class="string"> Network MTU                                                                                                                             </span>|</span><br><span class="line">|<span class="string"> availability_zone              </span>|<span class="string"> Availability Zone                                                                                                                       </span>|</span><br><span class="line">|<span class="string"> quotas                         </span>|<span class="string"> Quota management support                                                                                                                </span>|</span><br><span class="line">|<span class="string"> standard-attr-tag              </span>|<span class="string"> Tag support for resources with standard attribute: subnet, trunk, router, network, policy, subnetpool, port, security_group, floatingip </span>|</span><br><span class="line">|<span class="string"> availability_zone_filter       </span>|<span class="string"> Availability Zone Filter Extension                                                                                                      </span>|</span><br><span class="line">|<span class="string"> revision-if-match              </span>|<span class="string"> If-Match constraints based on revision_number                                                                                           </span>|</span><br><span class="line">|<span class="string"> filter-validation              </span>|<span class="string"> Filter parameters validation                                                                                                            </span>|</span><br><span class="line">|<span class="string"> multi-provider                 </span>|<span class="string"> Multi Provider Network                                                                                                                  </span>|</span><br><span class="line">|<span class="string"> quota_details                  </span>|<span class="string"> Quota details management support                                                                                                        </span>|</span><br><span class="line">|<span class="string"> address-scope                  </span>|<span class="string"> Address scope                                                                                                                           </span>|</span><br><span class="line">|<span class="string"> empty-string-filtering         </span>|<span class="string"> Empty String Filtering Extension                                                                                                        </span>|</span><br><span class="line">|<span class="string"> subnet-service-types           </span>|<span class="string"> Subnet service types                                                                                                                    </span>|</span><br><span class="line">|<span class="string"> port-mac-address-regenerate    </span>|<span class="string"> Neutron Port MAC address regenerate                                                                                                     </span>|</span><br><span class="line">|<span class="string"> standard-attr-timestamp        </span>|<span class="string"> Resource timestamps                                                                                                                     </span>|</span><br><span class="line">|<span class="string"> provider                       </span>|<span class="string"> Provider Network                                                                                                                        </span>|</span><br><span class="line">|<span class="string"> service-type                   </span>|<span class="string"> Neutron Service Type Management                                                                                                         </span>|</span><br><span class="line">|<span class="string"> extra_dhcp_opt                 </span>|<span class="string"> Neutron Extra DHCP options                                                                                                              </span>|</span><br><span class="line">|<span class="string"> port-security-groups-filtering </span>|<span class="string"> Port filtering on security groups                                                                                                       </span>|</span><br><span class="line">|<span class="string"> standard-attr-revisions        </span>|<span class="string"> Resource revision numbers                                                                                                               </span>|</span><br><span class="line">|<span class="string"> pagination                     </span>|<span class="string"> Pagination support                                                                                                                      </span>|</span><br><span class="line">|<span class="string"> sorting                        </span>|<span class="string"> Sorting support                                                                                                                         </span>|</span><br><span class="line">|<span class="string"> security-group                 </span>|<span class="string"> security-group                                                                                                                          </span>|</span><br><span class="line">|<span class="string"> rbac-policies                  </span>|<span class="string"> RBAC Policies                                                                                                                           </span>|</span><br><span class="line">|<span class="string"> standard-attr-description      </span>|<span class="string"> standard-attr-description                                                                                                               </span>|</span><br><span class="line">|<span class="string"> ip-substring-filtering         </span>|<span class="string"> IP address substring filtering                                                                                                          </span>|</span><br><span class="line">|<span class="string"> port-security                  </span>|<span class="string"> Port Security                                                                                                                           </span>|</span><br><span class="line">|<span class="string"> allowed-address-pairs          </span>|<span class="string"> Allowed Address Pairs                                                                                                                   </span>|</span><br><span class="line">|<span class="string"> project-id                     </span>|<span class="string"> project_id field enabled                                                                                                                </span>|</span><br><span class="line">|<span class="string"> binding-extended               </span>|<span class="string"> Port Bindings Extended                                                                                                                  </span>|</span><br><span class="line">+--------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">[root<span class="meta">@openstack</span> ~]<span class="comment"># openstack network agent list</span></span><br><span class="line">+--------------------------------------+--------------------+----------------------+-------------------+-------+-------+---------------------------+</span><br><span class="line">|<span class="string"> ID                                   </span>|<span class="string"> Agent Type         </span>|<span class="string"> Host                 </span>|<span class="string"> Availability Zone </span>|<span class="string"> Alive </span>|<span class="string"> State </span>|<span class="string"> Binary                    </span>|</span><br><span class="line">+--------------------------------------+--------------------+----------------------+-------------------+-------+-------+---------------------------+</span><br><span class="line">|<span class="string"> 040ba8f0-85e5-42af-8296-d9a35c37656f </span>|<span class="string"> DHCP agent         </span>|<span class="string"> openstack.controller </span>|<span class="string"> nova              </span>|<span class="string"> :-)   </span>|<span class="string"> UP    </span>|<span class="string"> neutron-dhcp-agent        </span>|</span><br><span class="line">|<span class="string"> 25242bc3-6f42-425f-9705-b3ec3ccaeb0c </span>|<span class="string"> Linux bridge agent </span>|<span class="string"> openstack.compute1   </span>|<span class="string"> None              </span>|<span class="string"> :-)   </span>|<span class="string"> UP    </span>|<span class="string"> neutron-linuxbridge-agent </span>|</span><br><span class="line">|<span class="string"> 45780a9a-ed9e-41f2-8639-f5fdd1bc0a5b </span>|<span class="string"> Metadata agent     </span>|<span class="string"> openstack.controller </span>|<span class="string"> None              </span>|<span class="string"> :-)   </span>|<span class="string"> UP    </span>|<span class="string"> neutron-metadata-agent    </span>|</span><br><span class="line">|<span class="string"> cd1c060a-2d53-4792-a687-baf50b9671d9 </span>|<span class="string"> Linux bridge agent </span>|<span class="string"> openstack.controller </span>|<span class="string"> None              </span>|<span class="string"> :-)   </span>|<span class="string"> UP    </span>|<span class="string"> neutron-linuxbridge-agent </span>|</span><br><span class="line">+--------------------------------------+--------------------+----------------------+-------------------+-------+-------+---------------------------+</span><br></pre></td></tr></table></figure></p>
<h2 id="十三、安装并配置-Dashboard-计算服务"><a href="#十三、安装并配置-Dashboard-计算服务" class="headerlink" title="十三、安装并配置 Dashboard 计算服务"></a>十三、安装并配置 Dashboard 计算服务</h2><h3 id="只需在-Controller-节点安装-8"><a href="#只需在-Controller-节点安装-8" class="headerlink" title="(!!!只需在 Controller 节点安装!!!)"></a><strong><em>(!!!只需在 Controller 节点安装!!!)</em></strong></h3><h3 id="1-安装并配置-Dashboard-相关软件"><a href="#1-安装并配置-Dashboard-相关软件" class="headerlink" title="1. 安装并配置 Dashboard 相关软件"></a>1. 安装并配置 Dashboard 相关软件</h3><h4 id="a-安装-Dashboard-相关软件"><a href="#a-安装-Dashboard-相关软件" class="headerlink" title="a) 安装 Dashboard 相关软件"></a>a) 安装 Dashboard 相关软件</h4><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@openstack</span> ~]<span class="meta"># yum install -y openstack-dashboard</span></span><br><span class="line">...</span><br><span class="line">Complete!</span><br></pre></td></tr></table></figure>
<h4 id="b-修改-Dashboard-的配置文件-local-settings"><a href="#b-修改-Dashboard-的配置文件-local-settings" class="headerlink" title="b) 修改 Dashboard 的配置文件 (local_settings)"></a>b) 修改 Dashboard 的配置文件 (local_settings)</h4><p><strong><em>必须确认配置是否正确</em></strong><br><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">OPENSTACK_HOST = <span class="string">"controller"</span></span><br><span class="line">ALLOWED_HOSTS = [<span class="string">'*'</span>, ]</span><br><span class="line">SESSION_ENGINE = <span class="string">'django.contrib.sessions.backends.file'</span></span><br><span class="line">CACHES = &#123;</span><br><span class="line">    <span class="string">'default'</span>: &#123;</span><br><span class="line">         <span class="string">'BACKEND'</span>: <span class="string">'django.core.cache.backends.memcached.MemcachedCache'</span>,</span><br><span class="line">         <span class="string">'LOCATION'</span>: <span class="string">'192.168.10.11:11211'</span>,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">OPENSTACK_KEYSTONE_URL = <span class="string">"http://%s:5000/v3"</span> % OPENSTACK_HOST</span><br><span class="line">OPENSTACK_KEYSTONE_MULTIDOMAIN_SUPPORT = <span class="literal">True</span></span><br><span class="line">OPENSTACK_API_VERSIONS = &#123;</span><br><span class="line">    <span class="string">"identity"</span>: <span class="number">3</span>,</span><br><span class="line">    <span class="string">"image"</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="string">"volume"</span>: <span class="number">2</span>,</span><br><span class="line">&#125;</span><br><span class="line">OPENSTACK_KEYSTONE_DEFAULT_DOMAIN = <span class="string">"default"</span></span><br><span class="line">OPENSTACK_KEYSTONE_DEFAULT_ROLE = <span class="string">"user"</span></span><br><span class="line">OPENSTACK_NEUTRON_NETWORK = &#123;</span><br><span class="line">    <span class="string">'enable_router'</span>: <span class="literal">False</span>,</span><br><span class="line">    <span class="string">'enable_quotas'</span>: <span class="literal">False</span>,</span><br><span class="line">    <span class="string">'enable_distributed_router'</span>: <span class="literal">False</span>,</span><br><span class="line">    <span class="string">'enable_ha_router'</span>: <span class="literal">False</span>,</span><br><span class="line">    <span class="string">'enable_lb'</span>: <span class="literal">False</span>,</span><br><span class="line">    <span class="string">'enable_firewall'</span>: <span class="literal">False</span>,</span><br><span class="line">    <span class="string">'enable_vpn'</span>: <span class="literal">False</span>,</span><br><span class="line">    <span class="string">'enable_fip_topology_check'</span>: <span class="literal">False</span>,</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line">TIME_ZONE = <span class="string">"TIME_ZONE"</span></span><br></pre></td></tr></table></figure></p>
<h4 id="d-修改-Apache-Httpd-的虚拟主机配置文件-openstack-dashboard-conf"><a href="#d-修改-Apache-Httpd-的虚拟主机配置文件-openstack-dashboard-conf" class="headerlink" title="d) 修改 Apache (Httpd) 的虚拟主机配置文件 (openstack-dashboard.conf)"></a>d) 修改 Apache (Httpd) 的虚拟主机配置文件 (openstack-dashboard.conf)</h4><p><strong><em>必须确认配置是否正确</em></strong><br>增加第一行即可<br><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]<span class="meta"># cat /etc/httpd/conf.d/openstack-dashboard.conf </span></span><br><span class="line">WSGIApplicationGroup %&#123;GLOBAL&#125;</span><br><span class="line">WSGIDaemonProcess dashboard</span><br><span class="line">WSGIProcessGroup dashboard</span><br><span class="line">WSGISocketPrefix run/wsgi</span><br><span class="line"></span><br><span class="line">WSGIScriptAlias /dashboard <span class="meta-keyword">/usr/</span>share<span class="meta-keyword">/openstack-dashboard/</span>openstack_dashboard<span class="meta-keyword">/wsgi/</span>django.wsgi</span><br><span class="line">Alias <span class="meta-keyword">/dashboard/</span>static <span class="meta-keyword">/usr/</span>share<span class="meta-keyword">/openstack-dashboard/</span>static</span><br><span class="line"></span><br><span class="line"><span class="params">&lt;Directory /usr/share/openstack-dashboard/openstack_dashboard/wsgi&gt;</span></span><br><span class="line">  Options All</span><br><span class="line">  AllowOverride All</span><br><span class="line">  Require all granted</span><br><span class="line"><span class="params">&lt;/Directory&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="params">&lt;Directory /usr/share/openstack-dashboard/static&gt;</span></span><br><span class="line">  Options All</span><br><span class="line">  AllowOverride All</span><br><span class="line">  Require all granted</span><br><span class="line"><span class="params">&lt;/Directory&gt;</span></span><br></pre></td></tr></table></figure></p>
<h3 id="2-重启-Apache-Httpd-服务-会话存储服务"><a href="#2-重启-Apache-Httpd-服务-会话存储服务" class="headerlink" title="2. 重启 Apache (Httpd) 服务, 会话存储服务"></a>2. 重启 Apache (Httpd) 服务, 会话存储服务</h3><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@openstack</span> ~]<span class="meta"># systemctl restart httpd memcached</span></span><br></pre></td></tr></table></figure>
<h3 id="3-访问-Openstack-的-web-界面"><a href="#3-访问-Openstack-的-web-界面" class="headerlink" title="3. 访问 Openstack 的 web 界面"></a>3. 访问 Openstack 的 web 界面</h3><p>URL: <a href="http://192.168.10.11/dashboard" target="_blank" rel="noopener">http://192.168.10.11/dashboard</a><br>域: Default<br>用户名: admin<br>密码: 123456<br><img src="https://yongjie-xie.github.io/images/00019.png" alt="dashboard" title="web 控制台"><br><strong><em>Openstack Rocky 最小化安装到此结束</em></strong></p>

            <!--[if lt IE 9]><script>document.createElement('audio');</script><![endif]-->
            <audio id="audio" loop="1" preload="auto" controls="controls" data-autoplay="false">
                <source type="audio/mpeg" src="">
            </audio>
            
                <ul id="audio-list" style="display:none">
                    
                        <li title='0' data-url='http://link.hhtjim.com/163/35032211.mp3'></li>
                    
                        <li title='1' data-url='http://link.hhtjim.com/163/41500546.mp3'></li>
                    
                        <li title='2' data-url='http://link.hhtjim.com/163/555557845.mp3'></li>
                    
                        <li title='3' data-url='http://link.hhtjim.com/163/493041272.mp3'></li>
                    
                        <li title='4' data-url='http://link.hhtjim.com/163/493041272.mp3'></li>
                    
                        <li title='5' data-url='http://link.hhtjim.com/163/409650440.mp3'></li>
                    
                        <li title='6' data-url='http://link.hhtjim.com/163/409654855.mp3'></li>
                    
                        <li title='7' data-url='http://link.hhtjim.com/163/407761545.mp3'></li>
                    
                        <li title='8' data-url='http://link.hhtjim.com/163/409654856.mp3'></li>
                    
                        <li title='9' data-url='http://link.hhtjim.com/163/466327445.mp3'></li>
                    
                        <li title='10' data-url='http://link.hhtjim.com/163/409654857.mp3'></li>
                    
                        <li title='11' data-url='http://link.hhtjim.com/163/405987145.mp3'></li>
                    
                        <li title='12' data-url='http://link.hhtjim.com/163/474945732.mp3'></li>
                    
                        <li title='13' data-url='http://link.hhtjim.com/163/409654858.mp3'></li>
                    
                        <li title='14' data-url='http://link.hhtjim.com/163/452578261.mp3'></li>
                    
                        <li title='15' data-url='http://link.hhtjim.com/163/409654859.mp3'></li>
                    
                        <li title='16' data-url='http://link.hhtjim.com/163/435307781.mp3'></li>
                    
                        <li title='17' data-url='http://link.hhtjim.com/163/477145631.mp3'></li>
                    
                        <li title='18' data-url='http://link.hhtjim.com/163/456175343.mp3'></li>
                    
                        <li title='19' data-url='http://link.hhtjim.com/163/409654860.mp3'></li>
                    
                        <li title='20' data-url='http://link.hhtjim.com/163/408250066.mp3'></li>
                    
                        <li title='21' data-url='http://link.hhtjim.com/163/537262197.mp3'></li>
                    
                        <li title='22' data-url='http://link.hhtjim.com/163/447978200.mp3'></li>
                    
                        <li title='23' data-url='http://link.hhtjim.com/163/439625573.mp3'></li>
                    
                        <li title='24' data-url='http://link.hhtjim.com/163/457840567.mp3'></li>
                    
                        <li title='25' data-url='http://link.hhtjim.com/163/452575951.mp3'></li>
                    
                        <li title='26' data-url='http://link.hhtjim.com/163/454966416.mp3'></li>
                    
                        <li title='27' data-url='http://link.hhtjim.com/163/419375942.mp3'></li>
                    
                        <li title='28' data-url='http://link.hhtjim.com/163/411988718.mp3'></li>
                    
                        <li title='29' data-url='http://link.hhtjim.com/163/418279656.mp3'></li>
                    
                        <li title='30' data-url='http://link.hhtjim.com/163/417594827.mp3'></li>
                    
                        <li title='31' data-url='http://link.hhtjim.com/163/423104116.mp3'></li>
                    
                        <li title='32' data-url='http://link.hhtjim.com/163/452577615.mp3'></li>
                    
                        <li title='33' data-url='http://link.hhtjim.com/163/436675327.mp3'></li>
                    
                        <li title='34' data-url='http://link.hhtjim.com/163/413074476.mp3'></li>
                    
                </ul>
            
        </div>
        
    <div id='gitalk-container' class="comment link"
        data-ae='false'
        data-ci='6f2ced5993cec2abfdc0'
        data-cs='53941abd6c61cb31c982bddf0394826699a4b9a7'
        data-r='YongJie-Xie.github.io'
        data-o='YongJie-Xie'
        data-a='YongJie-Xie'
        data-d='false'
    >查看评论</div>


    </div>
    
</div>


    </div>
</div>
</body>
<script src="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
<script src="//lib.baomitu.com/jquery/1.8.3/jquery.min.js"></script>
<script src="/js/plugin.js"></script>
<script src="/js/diaspora.js"></script>
<link rel="stylesheet" href="/photoswipe/photoswipe.css">
<link rel="stylesheet" href="/photoswipe/default-skin/default-skin.css">
<script src="/photoswipe/photoswipe.min.js"></script>
<script src="/photoswipe/photoswipe-ui-default.min.js"></script>

<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">
    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>
    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">
        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>
        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">
            <div class="pswp__top-bar">
                <!--  Controls are self-explanatory. Order can be changed. -->
                <div class="pswp__counter"></div>
                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
                <button class="pswp__button pswp__button--share" title="Share"></button>
                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>
            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div> 
            </div>
            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>
            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>
            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>
        </div>
    </div>
</div>




</html>