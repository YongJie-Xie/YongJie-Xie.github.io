
<!DOCTYPE html>
<html lang="zh-cn" class="loading">
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>抱着西瓜砸地球的博客</title>

    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="google" content="notranslate" />
    <meta name="keywords" content="Blog,"> 
    <meta name="description" content="OpenStack 是一个云操作系统，通过数据中心可控制大型的计算、存储、网络等资源池。所有的管理通过前端界面管理员就可以完成，同样也可以通过 web 接口让最终用户部署资源。
参考文档: 

官方,"> 
    <meta name="author" content="YongJie-Xie"> 
    <link rel="alternative" href="atom.xml" title="抱着西瓜砸地球的博客" type="application/atom+xml"> 
    <link rel="icon" href="/img/favicon.png"> 
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
    <link rel="stylesheet" href="/css/diaspora.css">
</head>

<body class="loading">
    <div id="loader"></div>
    <div id="single">
    <div id="top" style="display: block;">
    <div class="bar" style="width: 0;"></div>
    <a class="icon-home image-icon" href="javascript:;"></a>
    <div title="播放/暂停" class="icon-play"></div>
    <h3 class="subtitle">Openstack Rocky 部署教程 (1)</h3>
    <div class="social">
        <!--<div class="like-icon">-->
            <!--<a href="javascript:;" class="likeThis active"><span class="icon-like"></span><span class="count">76</span></a>-->
        <!--</div>-->
        <div>
            <div class="share">
                <a title="获取二维码" class="icon-scan" href="javascript:;"></a>
            </div>
            <div id="qr"></div>
        </div>
    </div>
    <div class="scrollbar"></div>
</div>
    <div class="section">
        <div class="article">
    <div class='main'>
        <h1 class="title">Openstack Rocky 部署教程 (1)</h1>
        <div class="stuff">
            <span>十二月 15, 2018</span>
            
  <ul class="post-tags-list"><li class="post-tags-list-item"><a class="post-tags-list-link" href="/tags/CentOS/">CentOS</a></li><li class="post-tags-list-item"><a class="post-tags-list-link" href="/tags/Openstack/">Openstack</a></li><li class="post-tags-list-item"><a class="post-tags-list-link" href="/tags/Rocky/">Rocky</a></li><li class="post-tags-list-item"><a class="post-tags-list-link" href="/tags/VMware/">VMware</a></li></ul>


        </div>
        <div class="content markdown">
            <p>OpenStack 是一个云操作系统，通过数据中心可控制大型的计算、存储、网络等资源池。所有的管理通过前端界面管理员就可以完成，同样也可以通过 web 接口让最终用户部署资源。</p>
<p>参考文档: </p>
<ol>
<li><a href="https://docs.openstack.org/install-guide/openstack-services.html" target="_blank" rel="noopener">官方部署文档</a></li>
<li><a href="https://docs.openstack.org/mitaka/zh_CN/install-guide-rdo" target="_blank" rel="noopener">官方部署文档中文版 (Mitaka)</a></li>
<li><a href="https://www.cnblogs.com/tssc/p/9857526.html" target="_blank" rel="noopener">天生帅才的全套 Openstack 安装指南</a></li>
</ol>
<p>注意：</p>
<ol>
<li>部署 Openstack 分布式集群需要一定的 Linux 基础</li>
<li>本教程部署的是 Rocky 版本的最小化的 Openstack 集群</li>
<li>至少安装两个节点, 控制节点【Controller】和计算节点【Compute】</li>
<li>至少拥有两个网络, 公共网络【使用 NAT 模式模拟】和私有网络【管理网络, 使用仅主机模式模拟】</li>
<li>本教程所有密码均设为 123456</li>
</ol>
<h2 id="一、准备工作"><a href="#一、准备工作" class="headerlink" title="一、准备工作"></a>一、准备工作</h2><h3 id="0-虚拟机配置"><a href="#0-虚拟机配置" class="headerlink" title="0. 虚拟机配置"></a>0. 虚拟机配置</h3><h4 id="a-虚拟机-Controller-Hostname-openstack-controller"><a href="#a-虚拟机-Controller-Hostname-openstack-controller" class="headerlink" title="a) 虚拟机 Controller (Hostname: openstack.controller)"></a>a) 虚拟机 Controller (Hostname: openstack.controller)</h4><ul>
<li>内存: 4 GB</li>
<li>处理器: 1个1核 (勾选虚拟化 Inter VT-x/EPT 或 AMD-V/RVI)</li>
<li>硬盘: 20G</li>
<li>网络适配器: NAT (192.168.80.11/24 - 192.168.80.2 - 223.5.5.5)</li>
<li>网络适配器2: 仅主机模式 (192.168.10.11/24)</li>
</ul>
<h4 id="b-虚拟机-Compute-Hostname-openstack-compute"><a href="#b-虚拟机-Compute-Hostname-openstack-compute" class="headerlink" title="b) 虚拟机 Compute (Hostname: openstack.compute)"></a>b) 虚拟机 Compute (Hostname: openstack.compute)</h4><ul>
<li>内存: 2 GB</li>
<li>处理器: 1个1核 (勾选虚拟化 Inter VT-x/EPT 或 AMD-V/RVI)</li>
<li>硬盘: 20G</li>
<li>网络适配器: NAT (192.168.80.31/24 - 192.168.80.2 - 223.5.5.5)</li>
<li>网络适配器2: 仅主机模式 (192.168.10.31/24)</li>
</ul>
<h3 id="1-软件工具下载"><a href="#1-软件工具下载" class="headerlink" title="1. 软件工具下载"></a>1. 软件工具下载</h3><ul>
<li><a href="https://my.vmware.com/web/vmware/details?downloadGroup=WKST1413-WIN&amp;productId=686&amp;rPId=25457" target="_blank" rel="noopener">VMware Workstation 14</a></li>
<li><a href="http://mirrors.aliyun.com/centos/7.5.1804/isos/x86_64/CentOS-7-x86_64-Minimal-1804.iso" target="_blank" rel="noopener">CentOS-7-x86_64-Minimal-1804</a></li>
<li><a href="http://www.netsarang.com/download/down_form.html?code=622" target="_blank" rel="noopener">Xshell 6</a> –&gt; 个人免费, License type 选择 Home and school use, 邮箱获取下载链接</li>
<li><a href="http://www.netsarang.com/download/down_form.html?code=623" target="_blank" rel="noopener">Xftp 6</a> –&gt; 同上</li>
</ul>
<h3 id="2-基础环境搭建"><a href="#2-基础环境搭建" class="headerlink" title="2. 基础环境搭建"></a>2. 基础环境搭建</h3><h4 id="a-安装-VMware-Workstation-物理机"><a href="#a-安装-VMware-Workstation-物理机" class="headerlink" title="a) 安装 VMware Workstation (物理机)"></a>a) 安装 VMware Workstation (物理机)</h4><p>过程略</p>
<h4 id="b-安装-Xshell-6-和-Xftp-6-物理机"><a href="#b-安装-Xshell-6-和-Xftp-6-物理机" class="headerlink" title="b) 安装 Xshell 6 和 Xftp 6 (物理机)"></a>b) 安装 Xshell 6 和 Xftp 6 (物理机)</h4><p>过程略</p>
<h4 id="c-VMware-Workstation-安装-CentOS-7"><a href="#c-VMware-Workstation-安装-CentOS-7" class="headerlink" title="c) VMware Workstation 安装 CentOS 7"></a>c) VMware Workstation 安装 CentOS 7</h4><p>参考<a href="https://yongjie-xie.github.io/2018/10/10/CentOSInstall">这里</a></p>
<h2 id="二、系统环境配置"><a href="#二、系统环境配置" class="headerlink" title="二、系统环境配置"></a>二、系统环境配置</h2><p><strong><em>建议配置系统环境前为所有虚拟机拍摄一次快照, 以备不时之需</em></strong></p>
<h3 id="1-配置网络接口-可使用-nmtui-打开命令图形化配置"><a href="#1-配置网络接口-可使用-nmtui-打开命令图形化配置" class="headerlink" title="1. 配置网络接口 (可使用 nmtui 打开命令图形化配置)"></a>1. 配置网络接口 (可使用 nmtui 打开命令图形化配置)</h3><h4 id="a-Controller-节点"><a href="#a-Controller-节点" class="headerlink" title="a) Controller 节点"></a>a) Controller 节点</h4><p>网络适配器</p>
<ul>
<li>IP 地址: 192.168.80.11 (静态IP)</li>
<li>子网掩码: 255.255.255.0 (or /24)</li>
<li>默认网关: 192.168.80.2</li>
<li>DNS1: 192.168.80.2</li>
<li>DNS2: 223.5.5.5<br>网络适配器 2</li>
<li>IP 地址: 192.168.10.11 (静态IP)<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# cat /etc/sysconfig/network-scripts/ifcfg-ens32</span><br><span class="line">TYPE=Ethernet</span><br><span class="line">PROXY_METHOD=none</span><br><span class="line">BROWSER_ONLY=no</span><br><span class="line">BOOTPROTO=none</span><br><span class="line">DEFROUTE=yes</span><br><span class="line">IPV4_FAILURE_FATAL=no</span><br><span class="line">IPV6INIT=no</span><br><span class="line">IPV6_AUTOCONF=&quot;yes&quot;</span><br><span class="line">IPV6_DEFROUTE=&quot;yes&quot;</span><br><span class="line">IPV6_FAILURE_FATAL=&quot;no&quot;</span><br><span class="line">IPV6_ADDR_GEN_MODE=&quot;stable-privacy&quot;</span><br><span class="line">NAME=ens32</span><br><span class="line">UUID=b6026ed9-05a0-450a-af4c-218b167e2a64</span><br><span class="line">DEVICE=ens32</span><br><span class="line">ONBOOT=yes</span><br><span class="line">IPADDR=192.168.80.11</span><br><span class="line">PREFIX=24</span><br><span class="line">GATEWAY=192.168.80.2</span><br><span class="line">DNS1=192.168.80.2</span><br><span class="line">DNS2=223.5.5.5</span><br><span class="line">[root@openstack ~]# cat /etc/sysconfig/network-scripts/ifcfg-ens33</span><br><span class="line">TYPE=Ethernet</span><br><span class="line">PROXY_METHOD=none</span><br><span class="line">BROWSER_ONLY=no</span><br><span class="line">BOOTPROTO=none</span><br><span class="line">IPADDR=192.168.10.11</span><br><span class="line">PREFIX=24</span><br><span class="line">DEFROUTE=yes</span><br><span class="line">IPV4_FAILURE_FATAL=no</span><br><span class="line">IPV6INIT=no</span><br><span class="line">NAME=ens33</span><br><span class="line">UUID=c74edb0e-e525-3522-8d9e-59d203378ef8</span><br><span class="line">DEVICE=ens33</span><br><span class="line">ONBOOT=yes</span><br><span class="line">AUTOCONNECT_PRIORITY=-999</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="b-Compute-节点"><a href="#b-Compute-节点" class="headerlink" title="b) Compute 节点"></a>b) Compute 节点</h4><p>网络适配器</p>
<ul>
<li>IP 地址: 192.168.80.31 (静态IP)</li>
<li>子网掩码: 255.255.255.0 (or /24)</li>
<li>默认网关: 192.168.80.2</li>
<li>DNS1: 192.168.80.2</li>
<li>DNS2: 223.5.5.5<br>网络适配器 2</li>
<li>IP 地址: 192.168.10.31 (静态IP)<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# cat /etc/sysconfig/network-scripts/ifcfg-ens32</span><br><span class="line">TYPE=Ethernet</span><br><span class="line">PROXY_METHOD=none</span><br><span class="line">BROWSER_ONLY=no</span><br><span class="line">BOOTPROTO=none</span><br><span class="line">DEFROUTE=yes</span><br><span class="line">IPV4_FAILURE_FATAL=no</span><br><span class="line">IPV6INIT=no</span><br><span class="line">IPV6_AUTOCONF=&quot;yes&quot;</span><br><span class="line">IPV6_DEFROUTE=&quot;yes&quot;</span><br><span class="line">IPV6_FAILURE_FATAL=&quot;no&quot;</span><br><span class="line">IPV6_ADDR_GEN_MODE=&quot;stable-privacy&quot;</span><br><span class="line">NAME=ens32</span><br><span class="line">UUID=b6026ed9-05a0-450a-af4c-218b167e2a64</span><br><span class="line">DEVICE=ens32</span><br><span class="line">ONBOOT=yes</span><br><span class="line">IPADDR=192.168.80.31</span><br><span class="line">PREFIX=24</span><br><span class="line">GATEWAY=192.168.80.2</span><br><span class="line">DNS1=192.168.80.2</span><br><span class="line">DNS2=223.5.5.5</span><br><span class="line">[root@openstack ~]# cat /etc/sysconfig/network-scripts/ifcfg-ens33</span><br><span class="line">TYPE=Ethernet</span><br><span class="line">PROXY_METHOD=none</span><br><span class="line">BROWSER_ONLY=no</span><br><span class="line">BOOTPROTO=none</span><br><span class="line">IPADDR=192.168.10.31</span><br><span class="line">PREFIX=24</span><br><span class="line">DEFROUTE=yes</span><br><span class="line">IPV4_FAILURE_FATAL=no</span><br><span class="line">IPV6INIT=no</span><br><span class="line">NAME=ens33</span><br><span class="line">UUID=6e46fbbc-fbeb-3416-8dc4-ca5b16d2d0da</span><br><span class="line">DEVICE=ens33</span><br><span class="line">ONBOOT=yes</span><br><span class="line">AUTOCONNECT_PRIORITY=-999</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="2-配置域名解析"><a href="#2-配置域名解析" class="headerlink" title="2. 配置域名解析"></a>2. 配置域名解析</h3><h4 id="a-Controller-节点-1"><a href="#a-Controller-节点-1" class="headerlink" title="a) Controller 节点"></a>a) Controller 节点</h4><p>域名: openstack.controller 或 controller (设置后请勿随意修改)<br>hosts: 添加全部节点的域名解析<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# cat /etc/hostname </span><br><span class="line">openstack.controller</span><br><span class="line">[root@openstack ~]# cat /etc/hosts</span><br><span class="line">127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4</span><br><span class="line">::1         localhost localhost.localdomain localhost6 localhost6.localdomain6</span><br><span class="line"></span><br><span class="line">192.168.10.11 openstack.controller controller</span><br><span class="line">192.168.10.31 openstack.compute1 compute1</span><br></pre></td></tr></table></figure></p>
<h4 id="b-Compute-节点-1"><a href="#b-Compute-节点-1" class="headerlink" title="b) Compute 节点"></a>b) Compute 节点</h4><p>域名: openstack.compute1 或 compute1 (设置后请勿随意修改)<br>hosts: 添加全部节点的域名解析<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# cat /etc/hostname</span><br><span class="line">openstack.compute1</span><br><span class="line">[root@openstack ~]# cat /etc/hosts</span><br><span class="line">127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4</span><br><span class="line">::1         localhost localhost.localdomain localhost6 localhost6.localdomain6</span><br><span class="line"></span><br><span class="line">192.168.10.11 openstack.controller controller</span><br><span class="line">192.168.10.31 openstack.compute1 compute1</span><br></pre></td></tr></table></figure></p>
<h3 id="3-验证网络连通性"><a href="#3-验证网络连通性" class="headerlink" title="3. 验证网络连通性"></a>3. 验证网络连通性</h3><p>测试节点与互联网的连接以及节点之间的连接是否均连通</p>
<h4 id="a-Controller-节点-2"><a href="#a-Controller-节点-2" class="headerlink" title="a) Controller 节点"></a>a) Controller 节点</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# ping -c 4 openstack.org</span><br><span class="line">PING openstack.org (162.242.140.107) 56(84) bytes of data.</span><br><span class="line">64 bytes from 162.242.140.107 (162.242.140.107): icmp_seq=1 ttl=128 time=184 ms</span><br><span class="line">64 bytes from 162.242.140.107 (162.242.140.107): icmp_seq=2 ttl=128 time=184 ms</span><br><span class="line">64 bytes from 162.242.140.107 (162.242.140.107): icmp_seq=3 ttl=128 time=184 ms</span><br><span class="line">64 bytes from 162.242.140.107 (162.242.140.107): icmp_seq=4 ttl=128 time=185 ms</span><br><span class="line"></span><br><span class="line">--- openstack.org ping statistics ---</span><br><span class="line">4 packets transmitted, 4 received, 0% packet loss, time 3006ms</span><br><span class="line">rtt min/avg/max/mdev = 184.094/184.711/185.908/0.829 ms</span><br><span class="line">[root@openstack ~]# ping -c 4 compute1</span><br><span class="line">PING openstack.compute1 (192.168.10.31) 56(84) bytes of data.</span><br><span class="line">64 bytes from openstack.compute1 (192.168.10.31): icmp_seq=1 ttl=64 time=1.28 ms</span><br><span class="line">64 bytes from openstack.compute1 (192.168.10.31): icmp_seq=2 ttl=64 time=0.335 ms</span><br><span class="line">64 bytes from openstack.compute1 (192.168.10.31): icmp_seq=3 ttl=64 time=0.322 ms</span><br><span class="line">64 bytes from openstack.compute1 (192.168.10.31): icmp_seq=4 ttl=64 time=2.95 ms</span><br><span class="line"></span><br><span class="line">--- openstack.compute1 ping statistics ---</span><br><span class="line">4 packets transmitted, 4 received, 0% packet loss, time 3007ms</span><br><span class="line">rtt min/avg/max/mdev = 0.322/1.222/2.954/1.073 ms</span><br></pre></td></tr></table></figure>
<h4 id="b-Compute-节点-2"><a href="#b-Compute-节点-2" class="headerlink" title="b) Compute 节点"></a>b) Compute 节点</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# ping -c 4 openstack.org</span><br><span class="line">PING openstack.org (162.242.140.107) 56(84) bytes of data.</span><br><span class="line">64 bytes from 162.242.140.107 (162.242.140.107): icmp_seq=1 ttl=128 time=184 ms</span><br><span class="line">64 bytes from 162.242.140.107 (162.242.140.107): icmp_seq=2 ttl=128 time=184 ms</span><br><span class="line">64 bytes from 162.242.140.107 (162.242.140.107): icmp_seq=3 ttl=128 time=184 ms</span><br><span class="line">64 bytes from 162.242.140.107 (162.242.140.107): icmp_seq=4 ttl=128 time=184 ms</span><br><span class="line"></span><br><span class="line">--- openstack.org ping statistics ---</span><br><span class="line">4 packets transmitted, 4 received, 0% packet loss, time 6380ms</span><br><span class="line">rtt min/avg/max/mdev = 184.250/184.339/184.453/0.435 ms</span><br><span class="line">[root@openstack ~]# ping -c 4 controller</span><br><span class="line">PING openstack.controller (192.168.10.11) 56(84) bytes of data.</span><br><span class="line">64 bytes from openstack.controller (192.168.10.11): icmp_seq=1 ttl=64 time=0.781 ms</span><br><span class="line">64 bytes from openstack.controller (192.168.10.11): icmp_seq=2 ttl=64 time=0.537 ms</span><br><span class="line">64 bytes from openstack.controller (192.168.10.11): icmp_seq=3 ttl=64 time=0.376 ms</span><br><span class="line">64 bytes from openstack.controller (192.168.10.11): icmp_seq=4 ttl=64 time=0.349 ms</span><br><span class="line"></span><br><span class="line">--- openstack.controller ping statistics ---</span><br><span class="line">4 packets transmitted, 4 received, 0% packet loss, time 3002ms</span><br><span class="line">rtt min/avg/max/mdev = 0.349/0.510/0.781/0.174 ms</span><br></pre></td></tr></table></figure>
<h3 id="4-配置-Yum-源-全部节点都需要配置"><a href="#4-配置-Yum-源-全部节点都需要配置" class="headerlink" title="4. 配置 Yum 源 (全部节点都需要配置)"></a>4. 配置 Yum 源 <strong><em>(全部节点都需要配置)</em></strong></h3><p>共四步: 备份, 替换 AliYun 源, 清理所有 Yum 缓存, 重新生成缓存<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# mv /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo.backup</span><br><span class="line">[root@openstack ~]# wget -O /etc/yum.repos.d/epel.repo http://mirrors.aliyun.com/repo/epel-7.repo</span><br><span class="line">--2018-12-15 02:55:53--  http://mirrors.aliyun.com/repo/epel-7.repo</span><br><span class="line">Resolving mirrors.aliyun.com (mirrors.aliyun.com)... 175.6.29.217, 175.6.29.216, 175.6.29.213, ...</span><br><span class="line">Connecting to mirrors.aliyun.com (mirrors.aliyun.com)|175.6.29.217|:80... connected.</span><br><span class="line">HTTP request sent, awaiting response... 200 OK</span><br><span class="line">Length: 664 [application/octet-stream]</span><br><span class="line">Saving to: ‘/etc/yum.repos.d/epel.repo’</span><br><span class="line"></span><br><span class="line">100%[=================================================&gt;] 664         --.-K/s   in 0s      </span><br><span class="line"></span><br><span class="line">2018-12-15 02:55:54 (95.0 MB/s) - ‘/etc/yum.repos.d/epel.repo’ saved [664/664]</span><br><span class="line"></span><br><span class="line">[root@openstack ~]# wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo</span><br><span class="line">--2018-12-15 01:50:27--  http://mirrors.aliyun.com/repo/Centos-7.repo</span><br><span class="line">Resolving mirrors.aliyun.com (mirrors.aliyun.com)... 175.6.29.212, 175.6.29.213, 175.6.29.215, ...</span><br><span class="line">Connecting to mirrors.aliyun.com (mirrors.aliyun.com)|175.6.29.212|:80... connected.</span><br><span class="line">HTTP request sent, awaiting response... 200 OK</span><br><span class="line">Length: 2523 (2.5K) [application/octet-stream]</span><br><span class="line">Saving to: ‘/etc/yum.repos.d/CentOS-Base.repo’</span><br><span class="line"></span><br><span class="line">100%[=================================================&gt;] 2,523       --.-K/s   in 0s      </span><br><span class="line"></span><br><span class="line">2018-12-15 01:50:27 (226 MB/s) - ‘/etc/yum.repos.d/CentOS-Base.repo’ saved [2523/2523]</span><br><span class="line"></span><br><span class="line">[root@openstack ~]# yum clean all</span><br><span class="line">Loaded plugins: fastestmirror</span><br><span class="line">Repodata is over 2 weeks old. Install yum-cron? Or run: yum makecache fast</span><br><span class="line">Cleaning repos: base extras updates</span><br><span class="line">Cleaning up everything</span><br><span class="line">Maybe you want: rm -rf /var/cache/yum, to also free up space taken by orphaned data from disabled or removed repos</span><br><span class="line">Cleaning up list of fastest mirrors</span><br><span class="line">[root@openstack ~]# yum makecache</span><br><span class="line">Loaded plugins: fastestmirror</span><br><span class="line">Loading mirror speeds from cached hostfile</span><br><span class="line">...</span><br><span class="line">...</span><br><span class="line">epel                                                                           12748/12748</span><br><span class="line">Metadata Cache Created</span><br></pre></td></tr></table></figure></p>
<h3 id="5-升级软件和系统内核-全部节点都需要配置"><a href="#5-升级软件和系统内核-全部节点都需要配置" class="headerlink" title="5. 升级软件和系统内核 (全部节点都需要配置)"></a>5. 升级软件和系统内核 <strong><em>(全部节点都需要配置)</em></strong></h3><p>等待时间较长, 可以站起来做几个深呼吸, 毕竟安装才刚开始…疯狂狗头狗头<br><strong>升级完成后必须重启系统!!!</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# yum -y upgrade</span><br><span class="line">Loaded plugins: fastestmirror</span><br><span class="line">Loading mirror speeds from cached hostfile</span><br><span class="line">...</span><br><span class="line">...</span><br><span class="line">Replaced:</span><br><span class="line">  grub2.x86_64 1:2.02-0.65.el7.centos.2     grub2-tools.x86_64 1:2.02-0.65.el7.centos.2    </span><br><span class="line"></span><br><span class="line">Complete!</span><br><span class="line">[root@openstack ~]# reboot</span><br></pre></td></tr></table></figure></p>
<h3 id="6-关闭-Firewalld、SELinux-全部节点都需要配置"><a href="#6-关闭-Firewalld、SELinux-全部节点都需要配置" class="headerlink" title="6. 关闭 Firewalld、SELinux (全部节点都需要配置)"></a>6. 关闭 Firewalld、SELinux <strong><em>(全部节点都需要配置)</em></strong></h3><p>Firewalld</p>
<ul>
<li>停止 Firewalld 服务 (systemctl stop firewalld)</li>
<li>禁用 Firewalld 开机自启 (systemctl disable firewalld)</li>
<li>屏蔽 Firewalld 服务 (systemctl mask firewalld)<br>SELinux</li>
<li>停止 SELinux (setenforce 0)</li>
<li>禁用 SELinux (sed -i ‘s#SELINUX=enforcing#SELINUX=disabled#g’ /etc/sysconfig/selinux)<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# systemctl stop firewalld</span><br><span class="line">[root@openstack ~]# systemctl disable firewalld</span><br><span class="line">Removed symlink /etc/systemd/system/multi-user.target.wants/firewalld.service.</span><br><span class="line">Removed symlink /etc/systemd/system/dbus-org.fedoraproject.FirewallD1.service.</span><br><span class="line">[root@openstack ~]# systemctl mask firewalld</span><br><span class="line">Created symlink from /etc/systemd/system/firewalld.service to /dev/null.</span><br><span class="line">[root@openstack ~]# setenforce 0</span><br><span class="line">[root@openstack ~]# sed -i &apos;s#SELINUX=enforcing#SELINUX=disabled#g&apos; /etc/sysconfig/selinux</span><br><span class="line">[root@openstack ~]# cat /etc/sysconfig/selinux</span><br><span class="line"></span><br><span class="line"># This file controls the state of SELinux on the system.</span><br><span class="line"># SELINUX= can take one of these three values:</span><br><span class="line">#     enforcing - SELinux security policy is enforced.</span><br><span class="line">#     permissive - SELinux prints warnings instead of enforcing.</span><br><span class="line">#     disabled - No SELinux policy is loaded.</span><br><span class="line">SELINUX=disabled</span><br><span class="line"># SELINUXTYPE= can take one of three two values:</span><br><span class="line">#     targeted - Targeted processes are protected,</span><br><span class="line">#     minimum - Modification of targeted policy. Only selected processes are protected. </span><br><span class="line">#     mls - Multi Level Security protection.</span><br><span class="line">SELINUXTYPE=targeted</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="7-配置时间同步服务"><a href="#7-配置时间同步服务" class="headerlink" title="7. 配置时间同步服务"></a>7. 配置时间同步服务</h3><h4 id="a-Controller-节点-3"><a href="#a-Controller-节点-3" class="headerlink" title="a) Controller 节点"></a>a) Controller 节点</h4><p>设置时区 (timedatectl set-timezone Asia/Shanghai)<br>安装 chrony (yum install -y chrony)<br>配置 chrony</p>
<ul>
<li>设置 AliYun NTP 服务器 (server ntp1.aliyun.com iburst, server ntp2.aliyun.com iburst)</li>
<li>允许其他节点连接 (allow 192.168.10.0/24)</li>
<li>启用 chronyd 开机自启 (systemctl enable chronyd)</li>
<li>重启 chronyd 服务 (systemctl restart chronyd)<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# timedatectl set-timezone Asia/Shanghai</span><br><span class="line">[root@openstack ~]# yum install -y chrony</span><br><span class="line">...</span><br><span class="line">Nothing to do</span><br><span class="line">[root@openstack ~]# cat /etc/chrony.conf </span><br><span class="line">server ntp1.aliyun.com iburst</span><br><span class="line">server ntp2.aliyun.com iburst</span><br><span class="line">driftfile /var/lib/chrony/drift</span><br><span class="line">makestep 1.0 3</span><br><span class="line">rtcsync</span><br><span class="line">allow 192.168.10.0/24</span><br><span class="line">logdir /var/log/chrony</span><br><span class="line">[root@openstack ~]# systemctl enable chronyd</span><br><span class="line">[root@openstack ~]# systemctl restart chronyd</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="b-Compute-节点-3"><a href="#b-Compute-节点-3" class="headerlink" title="b) Compute 节点"></a>b) Compute 节点</h4><p>安装 chrony (yum install -y chrony)<br>配置 chrony</p>
<ul>
<li>设置 controller NTP 服务器 (server controller iburst)</li>
<li>启用 chronyd 开机自启 (systemctl enable chronyd)</li>
<li>重启 chronyd 服务 (systemctl restart chronyd)<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# yum install -y chrony</span><br><span class="line">...</span><br><span class="line">Nothing to do</span><br><span class="line">[root@openstack ~]# vim /etc/chrony.conf</span><br><span class="line">[root@openstack ~]# cat /etc/chrony.conf</span><br><span class="line">server controller iburst</span><br><span class="line">driftfile /var/lib/chrony/drift</span><br><span class="line">makestep 1.0 3</span><br><span class="line">rtcsync</span><br><span class="line">logdir /var/log/chrony</span><br><span class="line">[root@openstack ~]# systemctl enable chronyd</span><br><span class="line">[root@openstack ~]# systemctl restart chronyd</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="8-验证时间同步服务"><a href="#8-验证时间同步服务" class="headerlink" title="8. 验证时间同步服务"></a>8. 验证时间同步服务</h3><h4 id="a-Controller-节点-4"><a href="#a-Controller-节点-4" class="headerlink" title="a) Controller 节点"></a>a) Controller 节点</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# chronyc sources</span><br><span class="line">210 Number of sources = 2</span><br><span class="line">MS Name/IP address         Stratum Poll Reach LastRx Last sample               </span><br><span class="line">===============================================================================</span><br><span class="line">^* 120.25.115.20                 2   6   377     6    -31ms[  -40ms] +/- 5503us</span><br><span class="line">^- 203.107.6.88                  2   6   377     4    -34ms[  -34ms] +/-   33ms</span><br></pre></td></tr></table></figure>
<h4 id="b-Compute-节点-4"><a href="#b-Compute-节点-4" class="headerlink" title="b) Compute 节点"></a>b) Compute 节点</h4><p>Name/IP address 列显示为 Controller 节点域名即为设置完成<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# chronyc sources</span><br><span class="line">210 Number of sources = 1</span><br><span class="line">MS Name/IP address         Stratum Poll Reach LastRx Last sample               </span><br><span class="line">===============================================================================</span><br><span class="line">^* openstack.controller          3   6    17    56    -23us[+3387us] +/-   24ms</span><br></pre></td></tr></table></figure></p>
<h2 id="三、安装-Openstack-相关软件"><a href="#三、安装-Openstack-相关软件" class="headerlink" title="三、安装 Openstack 相关软件"></a>三、安装 Openstack 相关软件</h2><h3 id="1-安装-Openstack-软件仓库-全部节点都需要安装"><a href="#1-安装-Openstack-软件仓库-全部节点都需要安装" class="headerlink" title="1. 安装 Openstack 软件仓库 (全部节点都需要安装)"></a>1. 安装 Openstack 软件仓库 <strong><em>(全部节点都需要安装)</em></strong></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# yum install -y centos-release-openstack-rocky</span><br><span class="line">...</span><br><span class="line">Complete!</span><br><span class="line">[root@openstack ~]# yum clean all</span><br><span class="line">...</span><br><span class="line">Metadata Cache Created</span><br></pre></td></tr></table></figure>
<h3 id="2-安装-Openstack-相关软件-全部节点都需要安装"><a href="#2-安装-Openstack-相关软件-全部节点都需要安装" class="headerlink" title="2. 安装 Openstack 相关软件 (全部节点都需要安装)"></a>2. 安装 Openstack 相关软件 <strong><em>(全部节点都需要安装)</em></strong></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# yum install -y python-openstackclient openstack-selinux</span><br><span class="line">...</span><br><span class="line">Complete!</span><br></pre></td></tr></table></figure>
<p><strong><em>建议安装至此再为所有虚拟机拍摄一次快照, 以备不时之需</em></strong></p>
<h2 id="四、安装并配置-MariaDB-数据库-只需在-Controller-节点安装"><a href="#四、安装并配置-MariaDB-数据库-只需在-Controller-节点安装" class="headerlink" title="四、安装并配置 MariaDB 数据库 (!!!只需在 Controller 节点安装!!!)"></a>四、安装并配置 MariaDB 数据库 <strong><em>(!!!只需在 Controller 节点安装!!!)</em></strong></h2><h3 id="1-安装-MariaDB-相关软件包"><a href="#1-安装-MariaDB-相关软件包" class="headerlink" title="1. 安装 MariaDB 相关软件包"></a>1. 安装 MariaDB 相关软件包</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# yum install -y mariadb mariadb-server MySQL-python python2-PyMySQL</span><br><span class="line">...</span><br><span class="line">Complete!</span><br></pre></td></tr></table></figure>
<h3 id="2-创建-MariaDB-数据库的-Openstack-配置文件"><a href="#2-创建-MariaDB-数据库的-Openstack-配置文件" class="headerlink" title="2. 创建 MariaDB 数据库的 Openstack 配置文件"></a>2. 创建 MariaDB 数据库的 Openstack 配置文件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# vim /etc/my.cnf.d/mariadb-openstack.cnf</span><br><span class="line">[root@openstack ~]# cat /etc/my.cnf.d/mariadb-openstack.cnf </span><br><span class="line">[mysqld]</span><br><span class="line">bind-address = 192.168.10.11</span><br><span class="line">default-storage-engine = innodb</span><br><span class="line">innodb_file_per_table = on</span><br><span class="line">max_connections = 4096</span><br><span class="line">collation-server = utf8_general_ci</span><br><span class="line">character-set-server = utf8</span><br><span class="line">init-connect = &apos;SET NAMES utf8&apos;</span><br></pre></td></tr></table></figure>
<h3 id="3-重启-MariaDB-数据库并设置为开机自启"><a href="#3-重启-MariaDB-数据库并设置为开机自启" class="headerlink" title="3. 重启 MariaDB 数据库并设置为开机自启"></a>3. 重启 MariaDB 数据库并设置为开机自启</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# systemctl restart mariadb</span><br><span class="line">[root@openstack ~]# systemctl enable mariadb</span><br><span class="line">Created symlink from /etc/systemd/system/multi-user.target.wants/mariadb.service to /usr/lib/systemd/system/mariadb.service.</span><br></pre></td></tr></table></figure>
<h3 id="4-初始化-MariaDB-数据库后再次重新启动"><a href="#4-初始化-MariaDB-数据库后再次重新启动" class="headerlink" title="4. 初始化 MariaDB 数据库后再次重新启动"></a>4. 初始化 MariaDB 数据库后再次重新启动</h3><p>默认密码为空, 生产环境请用 openssl rand -hex 10 命令生成强密码<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# mysql_secure_installation </span><br><span class="line"></span><br><span class="line">NOTE: RUNNING ALL PARTS OF THIS SCRIPT IS RECOMMENDED FOR ALL MariaDB</span><br><span class="line">      SERVERS IN PRODUCTION USE!  PLEASE READ EACH STEP CAREFULLY!</span><br><span class="line"></span><br><span class="line">In order to log into MariaDB to secure it, we&apos;ll need the current</span><br><span class="line">password for the root user.  If you&apos;ve just installed MariaDB, and</span><br><span class="line">you haven&apos;t set the root password yet, the password will be blank,</span><br><span class="line">so you should just press enter here.</span><br><span class="line"></span><br><span class="line">Enter current password for root (enter for none): </span><br><span class="line">OK, successfully used password, moving on...</span><br><span class="line"></span><br><span class="line">Setting the root password ensures that nobody can log into the MariaDB</span><br><span class="line">root user without the proper authorisation.</span><br><span class="line"></span><br><span class="line">Set root password? [Y/n] Y</span><br><span class="line">New password: </span><br><span class="line">Re-enter new password: </span><br><span class="line">Password updated successfully!</span><br><span class="line">Reloading privilege tables..</span><br><span class="line"> ... Success!</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">By default, a MariaDB installation has an anonymous user, allowing anyone</span><br><span class="line">to log into MariaDB without having to have a user account created for</span><br><span class="line">them.  This is intended only for testing, and to make the installation</span><br><span class="line">go a bit smoother.  You should remove them before moving into a</span><br><span class="line">production environment.</span><br><span class="line"></span><br><span class="line">Remove anonymous users? [Y/n] Y</span><br><span class="line"> ... Success!</span><br><span class="line"></span><br><span class="line">Normally, root should only be allowed to connect from &apos;localhost&apos;.  This</span><br><span class="line">ensures that someone cannot guess at the root password from the network.</span><br><span class="line"></span><br><span class="line">Disallow root login remotely? [Y/n] Y</span><br><span class="line"> ... Success!</span><br><span class="line"></span><br><span class="line">By default, MariaDB comes with a database named &apos;test&apos; that anyone can</span><br><span class="line">access.  This is also intended only for testing, and should be removed</span><br><span class="line">before moving into a production environment.</span><br><span class="line"></span><br><span class="line">Remove test database and access to it? [Y/n] Y</span><br><span class="line"> - Dropping test database...</span><br><span class="line"> ... Success!</span><br><span class="line"> - Removing privileges on test database...</span><br><span class="line"> ... Success!</span><br><span class="line"></span><br><span class="line">Reloading the privilege tables will ensure that all changes made so far</span><br><span class="line">will take effect immediately.</span><br><span class="line"></span><br><span class="line">Reload privilege tables now? [Y/n] Y</span><br><span class="line"> ... Success!</span><br><span class="line"></span><br><span class="line">Cleaning up...</span><br><span class="line"></span><br><span class="line">All done!  If you&apos;ve completed all of the above steps, your MariaDB</span><br><span class="line">installation should now be secure.</span><br><span class="line"></span><br><span class="line">Thanks for using MariaDB!</span><br><span class="line">[root@openstack ~]# systemctl restart mariadb</span><br></pre></td></tr></table></figure></p>
<h3 id="5-测试-MariaDB-数据库"><a href="#5-测试-MariaDB-数据库" class="headerlink" title="5. 测试 MariaDB 数据库"></a>5. 测试 MariaDB 数据库</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# mysql -p123456</span><br><span class="line">Welcome to the MariaDB monitor.  Commands end with ; or \g.</span><br><span class="line">...</span><br><span class="line">...</span><br><span class="line">MariaDB [(none)]&gt; flush privileges;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; select user,host from mysql.user;</span><br><span class="line">+------+-----------+</span><br><span class="line">| user | host      |</span><br><span class="line">+------+-----------+</span><br><span class="line">| root | 127.0.0.1 |</span><br><span class="line">| root | ::1       |</span><br><span class="line">| root | localhost |</span><br><span class="line">+------+-----------+</span><br><span class="line">3 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; exit</span><br><span class="line">Bye</span><br></pre></td></tr></table></figure>
<h2 id="五、安装并配置-RabbitMQ-消息队列服务-只需在-Controller-节点安装"><a href="#五、安装并配置-RabbitMQ-消息队列服务-只需在-Controller-节点安装" class="headerlink" title="五、安装并配置 RabbitMQ 消息队列服务 (!!!只需在 Controller 节点安装!!!)"></a>五、安装并配置 RabbitMQ 消息队列服务 <strong><em>(!!!只需在 Controller 节点安装!!!)</em></strong></h2><h3 id="1-安装-RabbitMQ-相关软件包"><a href="#1-安装-RabbitMQ-相关软件包" class="headerlink" title="1. 安装 RabbitMQ 相关软件包"></a>1. 安装 RabbitMQ 相关软件包</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# yum install -y rabbitmq-server</span><br><span class="line">...</span><br><span class="line">Complete!</span><br></pre></td></tr></table></figure>
<h3 id="2-启动-RabbitMQ-服务并设置为开机自启"><a href="#2-启动-RabbitMQ-服务并设置为开机自启" class="headerlink" title="2. 启动 RabbitMQ 服务并设置为开机自启"></a>2. 启动 RabbitMQ 服务并设置为开机自启</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# systemctl start rabbitmq-server</span><br><span class="line">[root@openstack ~]# systemctl enable rabbitmq-server</span><br><span class="line">Created symlink from /etc/systemd/system/multi-user.target.wants/rabbitmq-server.service to /usr/lib/systemd/system/rabbitmq-server.service.</span><br></pre></td></tr></table></figure>
<h3 id="3-创建-RabbitMQ-服务的-Openstack-账号及分配权限"><a href="#3-创建-RabbitMQ-服务的-Openstack-账号及分配权限" class="headerlink" title="3. 创建 RabbitMQ 服务的 Openstack 账号及分配权限"></a>3. 创建 RabbitMQ 服务的 Openstack 账号及分配权限</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# rabbitmqctl add_user openstack 123456</span><br><span class="line">Creating user &quot;openstack&quot; ...</span><br><span class="line">[root@openstack ~]# rabbitmqctl set_permissions openstack &quot;.*&quot; &quot;.*&quot; &quot;.*&quot;</span><br><span class="line">Setting permissions for user &quot;openstack&quot; in vhost &quot;/&quot; ...</span><br></pre></td></tr></table></figure>
<h2 id="六、安装并配置-Memcached-缓存服务-只需在-Controller-节点安装"><a href="#六、安装并配置-Memcached-缓存服务-只需在-Controller-节点安装" class="headerlink" title="六、安装并配置 Memcached 缓存服务 (!!!只需在 Controller 节点安装!!!)"></a>六、安装并配置 Memcached 缓存服务 <strong><em>(!!!只需在 Controller 节点安装!!!)</em></strong></h2><h3 id="1-安装-Memcached-相关软件包"><a href="#1-安装-Memcached-相关软件包" class="headerlink" title="1. 安装 Memcached 相关软件包"></a>1. 安装 Memcached 相关软件包</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# yum install -y memcached python-memcached</span><br><span class="line">...</span><br><span class="line">Complete!</span><br></pre></td></tr></table></figure>
<h3 id="2-启动-Memcached-服务并设置为开机自启"><a href="#2-启动-Memcached-服务并设置为开机自启" class="headerlink" title="2. 启动 Memcached 服务并设置为开机自启"></a>2. 启动 Memcached 服务并设置为开机自启</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# systemctl start memcached</span><br><span class="line">[root@openstack ~]# systemctl enable memcached</span><br><span class="line">Created symlink from /etc/systemd/system/multi-user.target.wants/memcached.service to /usr/lib/systemd/system/memcached.service.</span><br></pre></td></tr></table></figure>
<h2 id="七、安装并配置-Etcd-系统发现服务-只需在-Controller-节点安装"><a href="#七、安装并配置-Etcd-系统发现服务-只需在-Controller-节点安装" class="headerlink" title="七、安装并配置 Etcd 系统发现服务 (!!!只需在 Controller 节点安装!!!)"></a>七、安装并配置 Etcd 系统发现服务 <strong><em>(!!!只需在 Controller 节点安装!!!)</em></strong></h2><h3 id="1-安装-Etcd-相关软件包"><a href="#1-安装-Etcd-相关软件包" class="headerlink" title="1. 安装 Etcd 相关软件包"></a>1. 安装 Etcd 相关软件包</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# yum install -y etcd</span><br><span class="line">...</span><br><span class="line">Complete!</span><br></pre></td></tr></table></figure>
<h3 id="2-修改-Etcd-的配置文件"><a href="#2-修改-Etcd-的配置文件" class="headerlink" title="2. 修改 Etcd 的配置文件"></a>2. 修改 Etcd 的配置文件</h3><p><strong><em>不能用 controller 取代 192.168.10.11, 无法解析</em></strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# vim /etc/etcd/etcd.conf</span><br><span class="line">[root@openstack ~]# cat /etc/etcd/etcd.conf </span><br><span class="line">#[Member]</span><br><span class="line">ETCD_DATA_DIR=&quot;/var/lib/etcd/default.etcd&quot;</span><br><span class="line">ETCD_LISTEN_PEER_URLS=&quot;http://192.168.10.11:2380&quot;</span><br><span class="line">ETCD_LISTEN_CLIENT_URLS=&quot;http://192.168.10.11:2379&quot;</span><br><span class="line">ETCD_NAME=&quot;controller&quot;</span><br><span class="line">#[Clustering]</span><br><span class="line">ETCD_INITIAL_ADVERTISE_PEER_URLS=&quot;http://192.168.10.11:2380&quot;</span><br><span class="line">ETCD_ADVERTISE_CLIENT_URLS=&quot;http://192.168.10.11:2379&quot;</span><br><span class="line">ETCD_INITIAL_CLUSTER=&quot;controller=http://192.168.10.11:2380&quot;</span><br><span class="line">ETCD_INITIAL_CLUSTER_TOKEN=&quot;etcd-cluster-01&quot;</span><br><span class="line">ETCD_INITIAL_CLUSTER_STATE=&quot;new&quot;</span><br></pre></td></tr></table></figure></p>
<h3 id="3-启动-Etcd-服务并设置为开机自启"><a href="#3-启动-Etcd-服务并设置为开机自启" class="headerlink" title="3. 启动 Etcd 服务并设置为开机自启"></a>3. 启动 Etcd 服务并设置为开机自启</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# systemctl start etcd</span><br><span class="line">[root@openstack ~]# systemctl enable etcd</span><br><span class="line">Created symlink from /etc/systemd/system/multi-user.target.wants/etcd.service to /usr/lib/systemd/system/etcd.service.</span><br></pre></td></tr></table></figure>
<p><strong><em>建议安装至此时, 为 controller 节点再次拍摄一个快照, 以备不时之需</em></strong></p>
<h2 id="八、安装并配置-KeyStone-认证服务-只需在-Controller-节点安装"><a href="#八、安装并配置-KeyStone-认证服务-只需在-Controller-节点安装" class="headerlink" title="八、安装并配置 KeyStone 认证服务 (!!!只需在 Controller 节点安装!!!)"></a>八、安装并配置 KeyStone 认证服务 <strong><em>(!!!只需在 Controller 节点安装!!!)</em></strong></h2><h3 id="1-创建-keystone-数据库"><a href="#1-创建-keystone-数据库" class="headerlink" title="1. 创建 keystone 数据库"></a>1. 创建 keystone 数据库</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">DATABASE</span> keystone;</span><br><span class="line"><span class="keyword">GRANT</span> ALL <span class="keyword">PRIVILEGES</span> <span class="keyword">ON</span> keystone.* <span class="keyword">TO</span> <span class="string">'keystone'</span>@<span class="string">'localhost'</span> <span class="keyword">IDENTIFIED</span> <span class="keyword">BY</span> <span class="string">'123456'</span>;</span><br><span class="line"><span class="keyword">GRANT</span> ALL <span class="keyword">PRIVILEGES</span> <span class="keyword">ON</span> keystone.* <span class="keyword">TO</span> <span class="string">'keystone'</span>@<span class="string">'%'</span> <span class="keyword">IDENTIFIED</span> <span class="keyword">BY</span> <span class="string">'123456'</span>;</span><br><span class="line"><span class="keyword">flush</span> <span class="keyword">privileges</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# mysql -p123456</span><br><span class="line">Welcome to the MariaDB monitor.  Commands end with ; or \g.</span><br><span class="line">...</span><br><span class="line">...</span><br><span class="line">MariaDB [(none)]&gt; CREATE DATABASE keystone;</span><br><span class="line">Query OK, 1 row affected (0.01 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; GRANT ALL PRIVILEGES ON keystone.* TO &apos;keystone&apos;@&apos;localhost&apos; IDENTIFIED BY &apos;123456&apos;;</span><br><span class="line">Query OK, 0 rows affected (0.01 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; GRANT ALL PRIVILEGES ON keystone.* TO &apos;keystone&apos;@&apos;%&apos; IDENTIFIED BY &apos;123456&apos;;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; flush privileges;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; exit</span><br><span class="line">Bye</span><br></pre></td></tr></table></figure>
<h3 id="2-安装-KeyStone-相关软件包"><a href="#2-安装-KeyStone-相关软件包" class="headerlink" title="2. 安装 KeyStone 相关软件包"></a>2. 安装 KeyStone 相关软件包</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# yum install -y openstack-keystone httpd mod_wsgi python-keystoneclient openstack-utils</span><br><span class="line">...</span><br><span class="line">Complete!</span><br></pre></td></tr></table></figure>
<h3 id="3-使用-openstack-utils-快速配置-KeyStone"><a href="#3-使用-openstack-utils-快速配置-KeyStone" class="headerlink" title="3. 使用 openstack-utils 快速配置 KeyStone"></a>3. 使用 openstack-utils 快速配置 KeyStone</h3><p><strong><em>必须确认配置是否正确</em></strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# openstack-config --set /etc/keystone/keystone.conf database connection &quot; mysql+pymysql://keystone:123456@controller/keystone&quot;</span><br><span class="line">[root@openstack ~]# openstack-config --set /etc/keystone/keystone.conf token provider fernet</span><br><span class="line">[root@openstack ~]# grep &apos;^[a-z]&apos; /etc/keystone/keystone.conf</span><br><span class="line">connection = mysql+pymysql://keystone:123456@controller/keystone</span><br><span class="line">provider = fernet</span><br></pre></td></tr></table></figure></p>
<h3 id="4-初始化-keystone-数据库"><a href="#4-初始化-keystone-数据库" class="headerlink" title="4. 初始化 keystone 数据库"></a>4. 初始化 keystone 数据库</h3><p><strong><em>必须确认数据库是否初始化正确</em></strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# su -s /bin/sh -c &quot;keystone-manage db_sync&quot; keystone</span><br><span class="line">[root@openstack ~]# mysql -ukeystone -p123456 -e &quot;use keystone;show tables;&quot; | wc -l</span><br><span class="line">45</span><br><span class="line">[root@openstack ~]# mysql -ukeystone -p123456 -e &quot;use keystone;show tables;&quot;</span><br><span class="line">+-----------------------------+</span><br><span class="line">| Tables_in_keystone          |</span><br><span class="line">+-----------------------------+</span><br><span class="line">| access_token                |</span><br><span class="line">| application_credential      |</span><br><span class="line">| application_credential_role |</span><br><span class="line">| assignment                  |</span><br><span class="line">| config_register             |</span><br><span class="line">| consumer                    |</span><br><span class="line">| credential                  |</span><br><span class="line">| endpoint                    |</span><br><span class="line">| endpoint_group              |</span><br><span class="line">| federated_user              |</span><br><span class="line">| federation_protocol         |</span><br><span class="line">| group                       |</span><br><span class="line">| id_mapping                  |</span><br><span class="line">| identity_provider           |</span><br><span class="line">| idp_remote_ids              |</span><br><span class="line">| implied_role                |</span><br><span class="line">| limit                       |</span><br><span class="line">| local_user                  |</span><br><span class="line">| mapping                     |</span><br><span class="line">| migrate_version             |</span><br><span class="line">| nonlocal_user               |</span><br><span class="line">| password                    |</span><br><span class="line">| policy                      |</span><br><span class="line">| policy_association          |</span><br><span class="line">| project                     |</span><br><span class="line">| project_endpoint            |</span><br><span class="line">| project_endpoint_group      |</span><br><span class="line">| project_tag                 |</span><br><span class="line">| region                      |</span><br><span class="line">| registered_limit            |</span><br><span class="line">| request_token               |</span><br><span class="line">| revocation_event            |</span><br><span class="line">| role                        |</span><br><span class="line">| sensitive_config            |</span><br><span class="line">| service                     |</span><br><span class="line">| service_provider            |</span><br><span class="line">| system_assignment           |</span><br><span class="line">| token                       |</span><br><span class="line">| trust                       |</span><br><span class="line">| trust_role                  |</span><br><span class="line">| user                        |</span><br><span class="line">| user_group_membership       |</span><br><span class="line">| user_option                 |</span><br><span class="line">| whitelisted_config          |</span><br><span class="line">+-----------------------------+</span><br></pre></td></tr></table></figure></p>
<h3 id="5-初始化-Fernet-令牌库"><a href="#5-初始化-Fernet-令牌库" class="headerlink" title="5. 初始化 Fernet 令牌库"></a>5. 初始化 Fernet 令牌库</h3><p>以下命令无输出<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# keystone-manage fernet_setup --keystone-user keystone --keystone-group keystone</span><br><span class="line">[root@openstack ~]# keystone-manage credential_setup --keystone-user keystone --keystone-group keystone</span><br></pre></td></tr></table></figure></p>
<h3 id="6-修改-Apache-Httpd-的主配置文件"><a href="#6-修改-Apache-Httpd-的主配置文件" class="headerlink" title="6. 修改 Apache (Httpd) 的主配置文件"></a>6. 修改 Apache (Httpd) 的主配置文件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# sed  -i  &quot;s/#ServerName www.example.com:80/ServerName controller/&quot; /etc/httpd/conf/httpd.conf</span><br><span class="line">[root@openstack ~]# grep ServerName /etc/httpd/conf/httpd.conf </span><br><span class="line"># ServerName gives the name and port that the server uses to identify itself.</span><br><span class="line">ServerName controller</span><br></pre></td></tr></table></figure>
<h3 id="7-修改-Apache-Httpd-的虚拟主机配置文件"><a href="#7-修改-Apache-Httpd-的虚拟主机配置文件" class="headerlink" title="7. 修改 Apache (Httpd) 的虚拟主机配置文件"></a>7. 修改 Apache (Httpd) 的虚拟主机配置文件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# ln -s /usr/share/keystone/wsgi-keystone.conf /etc/httpd/conf.d/</span><br><span class="line">[root@openstack ~]# cat /etc/httpd/conf.d/wsgi-keystone.conf </span><br><span class="line">Listen 5000</span><br><span class="line"></span><br><span class="line">&lt;VirtualHost *:5000&gt;</span><br><span class="line">    WSGIDaemonProcess keystone-public processes=5 threads=1 user=keystone group=keystone display-name=%&#123;GROUP&#125;</span><br><span class="line">    WSGIProcessGroup keystone-public</span><br><span class="line">    WSGIScriptAlias / /usr/bin/keystone-wsgi-public</span><br><span class="line">    WSGIApplicationGroup %&#123;GLOBAL&#125;</span><br><span class="line">    WSGIPassAuthorization On</span><br><span class="line">    LimitRequestBody 114688</span><br><span class="line">    &lt;IfVersion &gt;= 2.4&gt;</span><br><span class="line">      ErrorLogFormat &quot;%&#123;cu&#125;t %M&quot;</span><br><span class="line">    &lt;/IfVersion&gt;</span><br><span class="line">    ErrorLog /var/log/httpd/keystone.log</span><br><span class="line">    CustomLog /var/log/httpd/keystone_access.log combined</span><br><span class="line"></span><br><span class="line">    &lt;Directory /usr/bin&gt;</span><br><span class="line">        &lt;IfVersion &gt;= 2.4&gt;</span><br><span class="line">            Require all granted</span><br><span class="line">        &lt;/IfVersion&gt;</span><br><span class="line">        &lt;IfVersion &lt; 2.4&gt;</span><br><span class="line">            Order allow,deny</span><br><span class="line">            Allow from all</span><br><span class="line">        &lt;/IfVersion&gt;</span><br><span class="line">    &lt;/Directory&gt;</span><br><span class="line">&lt;/VirtualHost&gt;</span><br><span class="line"></span><br><span class="line">Alias /identity /usr/bin/keystone-wsgi-public</span><br><span class="line">&lt;Location /identity&gt;</span><br><span class="line">    SetHandler wsgi-script</span><br><span class="line">    Options +ExecCGI</span><br><span class="line"></span><br><span class="line">    WSGIProcessGroup keystone-public</span><br><span class="line">    WSGIApplicationGroup %&#123;GLOBAL&#125;</span><br><span class="line">    WSGIPassAuthorization On</span><br><span class="line">&lt;/Location&gt;</span><br></pre></td></tr></table></figure>
<h3 id="8-启动-Apache-Httpd-服务并设置为开机自启"><a href="#8-启动-Apache-Httpd-服务并设置为开机自启" class="headerlink" title="8. 启动 Apache (Httpd) 服务并设置为开机自启"></a>8. 启动 Apache (Httpd) 服务并设置为开机自启</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# systemctl start httpd</span><br><span class="line">[root@openstack ~]# systemctl enable httpd</span><br><span class="line">Created symlink from /etc/systemd/system/multi-user.target.wants/httpd.service to /usr/lib/systemd/system/httpd.service.</span><br></pre></td></tr></table></figure>
<h3 id="9-初始化-KeyStone-认证服务"><a href="#9-初始化-KeyStone-认证服务" class="headerlink" title="9. 初始化 KeyStone 认证服务"></a>9. 初始化 KeyStone 认证服务</h3><p>以下命令无输出<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">keystone-manage bootstrap --bootstrap-password 123456 --bootstrap-admin-url &quot;http://controller:5000/v3/&quot; --bootstrap-internal-url &quot;http://controller:5000/v3/&quot; --bootstrap-public-url &quot;http://controller:5000/v3/&quot; --bootstrap-region-id RegionOne</span><br></pre></td></tr></table></figure></p>
<h3 id="10-配置临时管理员账户的相关环境变量"><a href="#10-配置临时管理员账户的相关环境变量" class="headerlink" title="10. 配置临时管理员账户的相关环境变量"></a>10. 配置临时管理员账户的相关环境变量</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# export OS_PROJECT_DOMAIN_NAME=Default</span><br><span class="line">[root@openstack ~]# export OS_PROJECT_NAME=admin</span><br><span class="line">[root@openstack ~]# export OS_USER_DOMAIN_NAME=Default</span><br><span class="line">[root@openstack ~]# export OS_USERNAME=admin</span><br><span class="line">[root@openstack ~]# export OS_PASSWORD=123456</span><br><span class="line">[root@openstack ~]# export OS_AUTH_URL=http://controller:5000/v3</span><br><span class="line">[root@openstack ~]# export OS_IDENTITY_API_VERSION=3</span><br><span class="line">[root@openstack ~]# env | grep OS_</span><br><span class="line">OS_USER_DOMAIN_NAME=Default</span><br><span class="line">OS_PROJECT_NAME=admin</span><br><span class="line">OS_IDENTITY_API_VERSION=3</span><br><span class="line">OS_PASSWORD=123456</span><br><span class="line">OS_AUTH_URL=http://controller:5000/v3</span><br><span class="line">OS_USERNAME=admin</span><br><span class="line">OS_PROJECT_DOMAIN_NAME=Default</span><br></pre></td></tr></table></figure>
<h3 id="11-查看-KeyStone-相关实例信息"><a href="#11-查看-KeyStone-相关实例信息" class="headerlink" title="11. 查看 KeyStone 相关实例信息"></a>11. 查看 KeyStone 相关实例信息</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# openstack endpoint list</span><br><span class="line">+----------------------------------+-----------+--------------+--------------+---------+-----------+----------------------------+</span><br><span class="line">| ID                               | Region    | Service Name | Service Type | Enabled | Interface | URL                        |</span><br><span class="line">+----------------------------------+-----------+--------------+--------------+---------+-----------+----------------------------+</span><br><span class="line">| 498db99146dc43d982449b1c7c6ac16b | RegionOne | keystone     | identity     | True    | public    | http://controller:5000/v3/ |</span><br><span class="line">| 61af677340904813b4a5244da0a036ca | RegionOne | keystone     | identity     | True    | admin     | http://controller:5000/v3/ |</span><br><span class="line">| 9c6d59dfc5cc4f6c8dd55eb1c944e17c | RegionOne | keystone     | identity     | True    | internal  | http://controller:5000/v3/ |</span><br><span class="line">+----------------------------------+-----------+--------------+--------------+---------+-----------+----------------------------+</span><br><span class="line">[root@openstack ~]# openstack project list</span><br><span class="line">+----------------------------------+-------+</span><br><span class="line">| ID                               | Name  |</span><br><span class="line">+----------------------------------+-------+</span><br><span class="line">| 81ed22594f0d4148809e9c0e62e039a5 | admin |</span><br><span class="line">+----------------------------------+-------+</span><br><span class="line">[root@openstack ~]# openstack user list</span><br><span class="line">+----------------------------------+-------+</span><br><span class="line">| ID                               | Name  |</span><br><span class="line">+----------------------------------+-------+</span><br><span class="line">| 84e7e67f49ff4d13a7b7334134a13db2 | admin |</span><br><span class="line">+----------------------------------+-------+</span><br></pre></td></tr></table></figure>
<h3 id="12-创建-KeyStone-认证服务实例"><a href="#12-创建-KeyStone-认证服务实例" class="headerlink" title="12. 创建 KeyStone 认证服务实例"></a>12. 创建 KeyStone 认证服务实例</h3><h4 id="a-创建一个名为-example-的-KeyStone-域"><a href="#a-创建一个名为-example-的-KeyStone-域" class="headerlink" title="a) 创建一个名为 example 的 KeyStone 域"></a>a) 创建一个名为 example 的 KeyStone 域</h4><p>KeyStone 的默认域为 default<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# openstack domain create --description &quot;An Example Domain&quot; example</span><br><span class="line">+-------------+----------------------------------+</span><br><span class="line">| Field       | Value                            |</span><br><span class="line">+-------------+----------------------------------+</span><br><span class="line">| description | An Example Domain                |</span><br><span class="line">| enabled     | True                             |</span><br><span class="line">| id          | b10c71f8aebc42358be56b9783a5192d |</span><br><span class="line">| name        | example                          |</span><br><span class="line">| tags        | []                               |</span><br><span class="line">+-------------+----------------------------------+</span><br></pre></td></tr></table></figure></p>
<h4 id="b-创建一个名为-service-的-KeyStone-项目"><a href="#b-创建一个名为-service-的-KeyStone-项目" class="headerlink" title="b) 创建一个名为 service 的 KeyStone 项目"></a>b) 创建一个名为 service 的 KeyStone 项目</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# openstack project create --domain default --description &quot;Service Project&quot; service</span><br><span class="line">+-------------+----------------------------------+</span><br><span class="line">| Field       | Value                            |</span><br><span class="line">+-------------+----------------------------------+</span><br><span class="line">| description | Service Project                  |</span><br><span class="line">| domain_id   | default                          |</span><br><span class="line">| enabled     | True                             |</span><br><span class="line">| id          | c86eb3690d2442958aa8d3af93494969 |</span><br><span class="line">| is_domain   | False                            |</span><br><span class="line">| name        | service                          |</span><br><span class="line">| parent_id   | default                          |</span><br><span class="line">| tags        | []                               |</span><br><span class="line">+-------------+----------------------------------+</span><br></pre></td></tr></table></figure>
<h4 id="c-创建一个名为-myproject-的-KeyStone-项目"><a href="#c-创建一个名为-myproject-的-KeyStone-项目" class="headerlink" title="c) 创建一个名为 myproject 的 KeyStone 项目"></a>c) 创建一个名为 myproject 的 KeyStone 项目</h4><p>常规（非管理员）任务应使用非特权项目和用户<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# openstack project create --domain default --description &quot;Demo Project&quot; myproject</span><br><span class="line">+-------------+----------------------------------+</span><br><span class="line">| Field       | Value                            |</span><br><span class="line">+-------------+----------------------------------+</span><br><span class="line">| description | Demo Project                     |</span><br><span class="line">| domain_id   | default                          |</span><br><span class="line">| enabled     | True                             |</span><br><span class="line">| id          | fa610dc748fd4bbf9b6a75461a1bc81b |</span><br><span class="line">| is_domain   | False                            |</span><br><span class="line">| name        | myproject                        |</span><br><span class="line">| parent_id   | default                          |</span><br><span class="line">| tags        | []                               |</span><br><span class="line">+-------------+----------------------------------+</span><br></pre></td></tr></table></figure></p>
<h4 id="d-创建一个名为-myuser-的-KeyStone-用户"><a href="#d-创建一个名为-myuser-的-KeyStone-用户" class="headerlink" title="d) 创建一个名为 myuser 的 KeyStone 用户"></a>d) 创建一个名为 myuser 的 KeyStone 用户</h4><p>常规（非管理员）任务应使用非特权项目和用户<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# openstack user create --domain default  --password=123456 myuser</span><br><span class="line">+---------------------+----------------------------------+</span><br><span class="line">| Field               | Value                            |</span><br><span class="line">+---------------------+----------------------------------+</span><br><span class="line">| domain_id           | default                          |</span><br><span class="line">| enabled             | True                             |</span><br><span class="line">| id                  | a2750e3ab9144584962f1e28eaa496ee |</span><br><span class="line">| name                | myuser                           |</span><br><span class="line">| options             | &#123;&#125;                               |</span><br><span class="line">| password_expires_at | None                             |</span><br><span class="line">+---------------------+----------------------------------+</span><br></pre></td></tr></table></figure></p>
<h4 id="e-创建一个名为-myrole-的-KeyStone-角色"><a href="#e-创建一个名为-myrole-的-KeyStone-角色" class="headerlink" title="e) 创建一个名为 myrole 的 KeyStone 角色"></a>e) 创建一个名为 myrole 的 KeyStone 角色</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# openstack role create myrole</span><br><span class="line">+-----------+----------------------------------+</span><br><span class="line">| Field     | Value                            |</span><br><span class="line">+-----------+----------------------------------+</span><br><span class="line">| domain_id | None                             |</span><br><span class="line">| id        | 9d7131e5c67d4809ba1684ed7df33e38 |</span><br><span class="line">| name      | myrole                           |</span><br><span class="line">+-----------+----------------------------------+</span><br></pre></td></tr></table></figure>
<h4 id="f-将-myrole-角色添加到-myproject-项目和-myuser-用户"><a href="#f-将-myrole-角色添加到-myproject-项目和-myuser-用户" class="headerlink" title="f) 将 myrole 角色添加到 myproject 项目和 myuser 用户"></a>f) 将 myrole 角色添加到 myproject 项目和 myuser 用户</h4><p>以下命令无输出<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# openstack role add --project myproject --user myuser myrole</span><br></pre></td></tr></table></figure></p>
<h3 id="13-测试-KeyStone-认证服务"><a href="#13-测试-KeyStone-认证服务" class="headerlink" title="13. 测试 KeyStone 认证服务"></a>13. 测试 KeyStone 认证服务</h3><h4 id="a-清除临时管理员账户的相关环境变量"><a href="#a-清除临时管理员账户的相关环境变量" class="headerlink" title="a) 清除临时管理员账户的相关环境变量"></a>a) 清除临时管理员账户的相关环境变量</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# unset OS_AUTH_URL OS_PASSWORD</span><br><span class="line">[root@openstack ~]# env |grep OS_</span><br><span class="line">OS_USER_DOMAIN_NAME=Default</span><br><span class="line">OS_PROJECT_NAME=admin</span><br><span class="line">OS_IDENTITY_API_VERSION=3</span><br><span class="line">OS_USERNAME=admin</span><br><span class="line">OS_PROJECT_DOMAIN_NAME=Default</span><br></pre></td></tr></table></figure>
<h4 id="b-作为-admin-用户-请求身份验证令牌"><a href="#b-作为-admin-用户-请求身份验证令牌" class="headerlink" title="b) 作为 admin 用户, 请求身份验证令牌"></a>b) 作为 admin 用户, 请求身份验证令牌</h4><p>admin 用户的密码为 123456<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# openstack --os-auth-url http://controller:5000/v3 --os-project-domain-name Default --os-user-domain-name Default --os-project-name admin --os-username admin token issue</span><br><span class="line">Password: </span><br><span class="line">+------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">| Field      | Value                                                                                                                                                                                   |</span><br><span class="line">+------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">| expires    | 2018-12-15T08:34:03+0000                                                                                                                                                                |</span><br><span class="line">| id         | gAAAAABcFK5ruuw-ptLoJosAYVVgzOLL5vyTc2DJnkXDD5ay9QqLvpiu94TM55iZfgliLaYDclguiNWIDM1UznDg0uj8IxIxqWkBwcmmldRjM0wC9U8rEI7FvjBDoP5R3Oieny3xnVwko5sZvBApOY3_aQWXvSTh4Ou4Bf-6pZlMwNcre1UQ21c |</span><br><span class="line">| project_id | 81ed22594f0d4148809e9c0e62e039a5                                                                                                                                                        |</span><br><span class="line">| user_id    | 84e7e67f49ff4d13a7b7334134a13db2                                                                                                                                                        |</span><br><span class="line">+------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br></pre></td></tr></table></figure></p>
<h4 id="c-作为-myuser-用户-请求身份验证令牌"><a href="#c-作为-myuser-用户-请求身份验证令牌" class="headerlink" title="c) 作为 myuser 用户, 请求身份验证令牌"></a>c) 作为 myuser 用户, 请求身份验证令牌</h4><p>myuser 用户的密码为 123456<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# openstack --os-auth-url http://controller:5000/v3 --os-project-domain-name Default --os-user-domain-name Default --os-project-name myproject --os-username myuser token issue</span><br><span class="line">Password: </span><br><span class="line">+------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">| Field      | Value                                                                                                                                                                                   |</span><br><span class="line">+------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">| expires    | 2018-12-15T08:36:24+0000                                                                                                                                                                |</span><br><span class="line">| id         | gAAAAABcFK74SBqvGsSE1oh2MF0hzS-AKIQkPDX0cgFN6sJvcaj0TjiSzHNhbmV7SvuP3i_V1GRelXDK7-1N2w4QVGQ9LKr5auaQvQBpEdvdNMN3nDsQ3dLJpy2cbfBLC9Y3akx5MqB_Q3Ah8yNbD7PR0xt3cO28DmY4hR_wy_Wr3Z1BIXNuDa0 |</span><br><span class="line">| project_id | fa610dc748fd4bbf9b6a75461a1bc81b                                                                                                                                                        |</span><br><span class="line">| user_id    | a2750e3ab9144584962f1e28eaa496ee                                                                                                                                                        |</span><br><span class="line">+------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br></pre></td></tr></table></figure></p>
<h4 id="d-创建-admin-用户的-OpenStack-客户端环境变量脚本"><a href="#d-创建-admin-用户的-OpenStack-客户端环境变量脚本" class="headerlink" title="d) 创建 admin 用户的 OpenStack 客户端环境变量脚本"></a>d) 创建 admin 用户的 OpenStack 客户端环境变量脚本</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# vim admin-openrc</span><br><span class="line">[root@openstack ~]# cat admin-openrc</span><br><span class="line">export OS_PROJECT_DOMAIN_NAME=Default</span><br><span class="line">export OS_USER_DOMAIN_NAME=Default</span><br><span class="line">export OS_PROJECT_NAME=admin</span><br><span class="line">export OS_USERNAME=admin</span><br><span class="line">export OS_PASSWORD=123456</span><br><span class="line">export OS_AUTH_URL=http://controller:5000/v3</span><br><span class="line">export OS_IDENTITY_API_VERSION=3</span><br><span class="line">export OS_IMAGE_API_VERSION=2</span><br></pre></td></tr></table></figure>
<h4 id="e-创建-myuser-用户的-OpenStack-客户端环境变量脚本"><a href="#e-创建-myuser-用户的-OpenStack-客户端环境变量脚本" class="headerlink" title="e) 创建 myuser 用户的 OpenStack 客户端环境变量脚本"></a>e) 创建 myuser 用户的 OpenStack 客户端环境变量脚本</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# vim myuser-openrc</span><br><span class="line">[root@openstack ~]# cat myuser-openrc </span><br><span class="line">export OS_PROJECT_DOMAIN_NAME=Default</span><br><span class="line">export OS_USER_DOMAIN_NAME=Default</span><br><span class="line">export OS_PROJECT_NAME=myproject</span><br><span class="line">export OS_USERNAME=myuser</span><br><span class="line">export OS_PASSWORD=123456</span><br><span class="line">export OS_AUTH_URL=http://controller:5000/v3</span><br><span class="line">export OS_IDENTITY_API_VERSION=3</span><br><span class="line">export OS_IMAGE_API_VERSION=2</span><br></pre></td></tr></table></figure>
<h4 id="f-测试-OpenStack-客户端环境变量脚本-并请求身份验证令牌"><a href="#f-测试-OpenStack-客户端环境变量脚本-并请求身份验证令牌" class="headerlink" title="f) 测试 OpenStack 客户端环境变量脚本, 并请求身份验证令牌"></a>f) 测试 OpenStack 客户端环境变量脚本, 并请求身份验证令牌</h4><p><strong><em>与用命令获取的 user_id 相同即为配置成功</em></strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# . admin-openrc </span><br><span class="line">[root@openstack ~]# openstack token issue</span><br><span class="line">+------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">| Field      | Value                                                                                                                                                                                   |</span><br><span class="line">+------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">| expires    | 2018-12-15T08:44:35+0000                                                                                                                                                                |</span><br><span class="line">| id         | gAAAAABcFLDjV5xLhA5bPURW3CXC1SaOhCerCMsH2VyABhUWoWWaCR2hDfY3dbA4SpxHEqL_zlA5mUes8s8IXJjKr4B2NItmq-rk-zmtt1hEBqvb8Gix_tXB_mYiyaLVy23FoOVLZeUmIPfFutmYWoPhOG0JwY5m1ZQVDsPydYja81FVftOf6uk |</span><br><span class="line">| project_id | 81ed22594f0d4148809e9c0e62e039a5                                                                                                                                                        |</span><br><span class="line">| user_id    | 84e7e67f49ff4d13a7b7334134a13db2                                                                                                                                                        |</span><br><span class="line">+------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br></pre></td></tr></table></figure></p>
<h2 id="九、安装并配置-Glance-镜像服务-只需在-Controller-节点安装"><a href="#九、安装并配置-Glance-镜像服务-只需在-Controller-节点安装" class="headerlink" title="九、安装并配置 Glance 镜像服务 (!!!只需在 Controller 节点安装!!!)"></a>九、安装并配置 Glance 镜像服务 <strong><em>(!!!只需在 Controller 节点安装!!!)</em></strong></h2><h3 id="1-创建-glance-数据库"><a href="#1-创建-glance-数据库" class="headerlink" title="1. 创建 glance 数据库"></a>1. 创建 glance 数据库</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">DATABASE</span> glance;</span><br><span class="line"><span class="keyword">GRANT</span> ALL <span class="keyword">PRIVILEGES</span> <span class="keyword">ON</span> glance.* <span class="keyword">TO</span> <span class="string">'glance'</span>@<span class="string">'localhost'</span> <span class="keyword">IDENTIFIED</span> <span class="keyword">BY</span> <span class="string">'123456'</span>;</span><br><span class="line"><span class="keyword">GRANT</span> ALL <span class="keyword">PRIVILEGES</span> <span class="keyword">ON</span> glance.* <span class="keyword">TO</span> <span class="string">'glance'</span>@<span class="string">'%'</span> <span class="keyword">IDENTIFIED</span> <span class="keyword">BY</span> <span class="string">'123456'</span>;</span><br><span class="line"><span class="keyword">flush</span> <span class="keyword">privileges</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# mysql -p123456</span><br><span class="line">Welcome to the MariaDB monitor.  Commands end with ; or \g.</span><br><span class="line">...</span><br><span class="line">...</span><br><span class="line">MariaDB [(none)]&gt; CREATE DATABASE glance;</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; GRANT ALL PRIVILEGES ON glance.* TO &apos;glance&apos;@&apos;localhost&apos; IDENTIFIED BY &apos;123456&apos;;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; GRANT ALL PRIVILEGES ON glance.* TO &apos;glance&apos;@&apos;%&apos; IDENTIFIED BY &apos;123456&apos;;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; flush privileges;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; exit</span><br><span class="line">Bye</span><br></pre></td></tr></table></figure>
<h3 id="2-创建一个名为-glance-的-KeyStone-用户"><a href="#2-创建一个名为-glance-的-KeyStone-用户" class="headerlink" title="2. 创建一个名为 glance 的 KeyStone 用户"></a>2. 创建一个名为 glance 的 KeyStone 用户</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# . admin-openrc </span><br><span class="line">[root@openstack ~]# openstack user create --domain default --password=123456 glance</span><br><span class="line">+---------------------+----------------------------------+</span><br><span class="line">| Field               | Value                            |</span><br><span class="line">+---------------------+----------------------------------+</span><br><span class="line">| domain_id           | default                          |</span><br><span class="line">| enabled             | True                             |</span><br><span class="line">| id                  | 063e3004acc94429a6b2a2cec9776608 |</span><br><span class="line">| name                | glance                           |</span><br><span class="line">| options             | &#123;&#125;                               |</span><br><span class="line">| password_expires_at | None                             |</span><br><span class="line">+---------------------+----------------------------------+</span><br><span class="line">[root@openstack ~]# openstack user list</span><br><span class="line">+----------------------------------+--------+</span><br><span class="line">| ID                               | Name   |</span><br><span class="line">+----------------------------------+--------+</span><br><span class="line">| 063e3004acc94429a6b2a2cec9776608 | glance |</span><br><span class="line">| 84e7e67f49ff4d13a7b7334134a13db2 | admin  |</span><br><span class="line">| a2750e3ab9144584962f1e28eaa496ee | myuser |</span><br><span class="line">+----------------------------------+--------+</span><br></pre></td></tr></table></figure>
<h3 id="3-将-glance-用户添加到-service-项目的-admin-角色"><a href="#3-将-glance-用户添加到-service-项目的-admin-角色" class="headerlink" title="3. 将 glance 用户添加到 service 项目的 admin 角色"></a>3. 将 glance 用户添加到 service 项目的 admin 角色</h3><p>以下命令无输出<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# openstack role add --project service --user glance admin</span><br></pre></td></tr></table></figure></p>
<h3 id="4-创建-Glance-镜像服务实例"><a href="#4-创建-Glance-镜像服务实例" class="headerlink" title="4. 创建 Glance 镜像服务实例"></a>4. 创建 Glance 镜像服务实例</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# openstack service create --name glance --description &quot;OpenStack Image&quot; image</span><br><span class="line">+-------------+----------------------------------+</span><br><span class="line">| Field       | Value                            |</span><br><span class="line">+-------------+----------------------------------+</span><br><span class="line">| description | OpenStack Image                  |</span><br><span class="line">| enabled     | True                             |</span><br><span class="line">| id          | c9ed8738afa94a4abbe91144f2d67f45 |</span><br><span class="line">| name        | glance                           |</span><br><span class="line">| type        | image                            |</span><br><span class="line">+-------------+----------------------------------+</span><br><span class="line">[root@openstack ~]# openstack service list</span><br><span class="line">+----------------------------------+----------+----------+</span><br><span class="line">| ID                               | Name     | Type     |</span><br><span class="line">+----------------------------------+----------+----------+</span><br><span class="line">| 363f73076d45482c9a680f11193549e9 | keystone | identity |</span><br><span class="line">| c9ed8738afa94a4abbe91144f2d67f45 | glance   | image    |</span><br><span class="line">+----------------------------------+----------+----------+</span><br></pre></td></tr></table></figure>
<h3 id="5-创建-Glance-镜像服务的-API-端点-endpoint"><a href="#5-创建-Glance-镜像服务的-API-端点-endpoint" class="headerlink" title="5. 创建 Glance 镜像服务的 API 端点 (endpoint)"></a>5. 创建 Glance 镜像服务的 API 端点 (endpoint)</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# openstack endpoint create --region RegionOne image public http://controller:9292</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">| Field        | Value                            |</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">| enabled      | True                             |</span><br><span class="line">| id           | b02bf56e9c6f4ad6a54e513f23d333c7 |</span><br><span class="line">| interface    | public                           |</span><br><span class="line">| region       | RegionOne                        |</span><br><span class="line">| region_id    | RegionOne                        |</span><br><span class="line">| service_id   | c9ed8738afa94a4abbe91144f2d67f45 |</span><br><span class="line">| service_name | glance                           |</span><br><span class="line">| service_type | image                            |</span><br><span class="line">| url          | http://controller:9292           |</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">[root@openstack ~]# openstack endpoint create --region RegionOne image internal http://controller:9292</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">| Field        | Value                            |</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">| enabled      | True                             |</span><br><span class="line">| id           | 4c22aba83615477eaf5c42d935f882b8 |</span><br><span class="line">| interface    | internal                         |</span><br><span class="line">| region       | RegionOne                        |</span><br><span class="line">| region_id    | RegionOne                        |</span><br><span class="line">| service_id   | c9ed8738afa94a4abbe91144f2d67f45 |</span><br><span class="line">| service_name | glance                           |</span><br><span class="line">| service_type | image                            |</span><br><span class="line">| url          | http://controller:9292           |</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">[root@openstack ~]# openstack endpoint create --region RegionOne image admin http://controller:9292</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">| Field        | Value                            |</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">| enabled      | True                             |</span><br><span class="line">| id           | 54b25eea3f8a46c7af947adb4bff18ed |</span><br><span class="line">| interface    | admin                            |</span><br><span class="line">| region       | RegionOne                        |</span><br><span class="line">| region_id    | RegionOne                        |</span><br><span class="line">| service_id   | c9ed8738afa94a4abbe91144f2d67f45 |</span><br><span class="line">| service_name | glance                           |</span><br><span class="line">| service_type | image                            |</span><br><span class="line">| url          | http://controller:9292           |</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">[root@openstack ~]# openstack endpoint list</span><br><span class="line">+----------------------------------+-----------+--------------+--------------+---------+-----------+----------------------------+</span><br><span class="line">| ID                               | Region    | Service Name | Service Type | Enabled | Interface | URL                        |</span><br><span class="line">+----------------------------------+-----------+--------------+--------------+---------+-----------+----------------------------+</span><br><span class="line">| 498db99146dc43d982449b1c7c6ac16b | RegionOne | keystone     | identity     | True    | public    | http://controller:5000/v3/ |</span><br><span class="line">| 4c22aba83615477eaf5c42d935f882b8 | RegionOne | glance       | image        | True    | internal  | http://controller:9292     |</span><br><span class="line">| 54b25eea3f8a46c7af947adb4bff18ed | RegionOne | glance       | image        | True    | admin     | http://controller:9292     |</span><br><span class="line">| 61af677340904813b4a5244da0a036ca | RegionOne | keystone     | identity     | True    | admin     | http://controller:5000/v3/ |</span><br><span class="line">| 9c6d59dfc5cc4f6c8dd55eb1c944e17c | RegionOne | keystone     | identity     | True    | internal  | http://controller:5000/v3/ |</span><br><span class="line">| b02bf56e9c6f4ad6a54e513f23d333c7 | RegionOne | glance       | image        | True    | public    | http://controller:9292     |</span><br><span class="line">+----------------------------------+-----------+--------------+--------------+---------+-----------+----------------------------+</span><br></pre></td></tr></table></figure>
<h3 id="6-安装并配置-Glance-相关软件"><a href="#6-安装并配置-Glance-相关软件" class="headerlink" title="6. 安装并配置 Glance 相关软件"></a>6. 安装并配置 Glance 相关软件</h3><h4 id="a-确认-Python-版本"><a href="#a-确认-Python-版本" class="headerlink" title="a) 确认 Python 版本"></a>a) 确认 Python 版本</h4><p>在当前版本中有一个 bug 在 Python3.5 中可能会有 ssl 方面的问题, 详情参考<a href="https://docs.openstack.org/glance/rocky/install/get-started.html#running-glance-under-python3" target="_blank" rel="noopener">这里</a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# python --version</span><br><span class="line">Python 2.7.5</span><br></pre></td></tr></table></figure></p>
<h4 id="b-安装-Glance-相关软件"><a href="#b-安装-Glance-相关软件" class="headerlink" title="b) 安装 Glance 相关软件"></a>b) 安装 Glance 相关软件</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# yum install -y openstack-glance python-glance python-glanceclient</span><br><span class="line">...</span><br><span class="line">Complete!</span><br></pre></td></tr></table></figure>
<h4 id="c-修改-Glance-的配置文件-glance-api-conf"><a href="#c-修改-Glance-的配置文件-glance-api-conf" class="headerlink" title="c) 修改 Glance 的配置文件 (glance-api.conf)"></a>c) 修改 Glance 的配置文件 (glance-api.conf)</h4><p><strong><em>必须确认配置是否正确</em></strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# openstack-config --set /etc/glance/glance-api.conf database connection &quot;mysql+pymysql://glance:123456@controller/glance&quot;</span><br><span class="line">[root@openstack ~]# openstack-config --set /etc/glance/glance-api.conf keystone_authtoken www_authenticate_uri &quot;http://controller:5000&quot;</span><br><span class="line">[root@openstack ~]# openstack-config --set /etc/glance/glance-api.conf keystone_authtoken auth_url &quot;http://controller:5000&quot;</span><br><span class="line">[root@openstack ~]# openstack-config --set /etc/glance/glance-api.conf keystone_authtoken memcached_servers &quot;controller:11211&quot;</span><br><span class="line">[root@openstack ~]# openstack-config --set /etc/glance/glance-api.conf keystone_authtoken auth_type &quot;password&quot;</span><br><span class="line">[root@openstack ~]# openstack-config --set /etc/glance/glance-api.conf keystone_authtoken project_domain_name &quot;Default&quot;</span><br><span class="line">[root@openstack ~]# openstack-config --set /etc/glance/glance-api.conf keystone_authtoken user_domain_name &quot;Default&quot;</span><br><span class="line">[root@openstack ~]# openstack-config --set /etc/glance/glance-api.conf keystone_authtoken project_name &quot;service &quot;</span><br><span class="line">[root@openstack ~]# openstack-config --set /etc/glance/glance-api.conf keystone_authtoken username &quot;glance&quot;</span><br><span class="line">[root@openstack ~]# openstack-config --set /etc/glance/glance-api.conf keystone_authtoken password &quot;123456&quot;</span><br><span class="line">[root@openstack ~]# openstack-config --set /etc/glance/glance-api.conf paste_deploy flavor &quot;keystone&quot;</span><br><span class="line">[root@openstack ~]# openstack-config --set /etc/glance/glance-api.conf glance_store stores &quot;file,http&quot;</span><br><span class="line">[root@openstack ~]# openstack-config --set /etc/glance/glance-api.conf glance_store default_store &quot;file&quot;</span><br><span class="line">[root@openstack ~]# openstack-config --set /etc/glance/glance-api.conf glance_store filesystem_store_datadir &quot;/var/lib/glance/images/&quot;</span><br><span class="line">[root@openstack ~]# grep &apos;^[a-z]&apos; /etc/glance/glance-api.conf</span><br><span class="line">connection = mysql+pymysql://glance:123456@controller/glance</span><br><span class="line">stores = file,http</span><br><span class="line">default_store = file</span><br><span class="line">filesystem_store_datadir = /var/lib/glance/images/</span><br><span class="line">www_authenticate_uri = http://controller:5000</span><br><span class="line">auth_url = http://controller:5000</span><br><span class="line">memcached_servers = controller:11211</span><br><span class="line">auth_type = password</span><br><span class="line">project_domain_name = Default</span><br><span class="line">user_domain_name = Default</span><br><span class="line">project_name = service </span><br><span class="line">username = glance</span><br><span class="line">password = 123456</span><br><span class="line">flavor = keystone</span><br></pre></td></tr></table></figure></p>
<h4 id="d-修改-Glance-的配置文件-glance-registry-conf"><a href="#d-修改-Glance-的配置文件-glance-registry-conf" class="headerlink" title="d) 修改 Glance 的配置文件 (glance-registry.conf)"></a>d) 修改 Glance 的配置文件 (glance-registry.conf)</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# openstack-config --set /etc/glance/glance-registry.conf database connection &quot;mysql+pymysql://glance:123456@controller/glance&quot;</span><br><span class="line">[root@openstack ~]# openstack-config --set /etc/glance/glance-registry.conf keystone_authtoken www_authenticate_uri &quot;http://controller:5000&quot;</span><br><span class="line">[root@openstack ~]# openstack-config --set /etc/glance/glance-registry.conf keystone_authtoken auth_url &quot;http://controller:5000&quot;</span><br><span class="line">[root@openstack ~]# openstack-config --set /etc/glance/glance-registry.conf keystone_authtoken memcached_servers &quot;controller:11211&quot;</span><br><span class="line">[root@openstack ~]# openstack-config --set /etc/glance/glance-registry.conf keystone_authtoken auth_type &quot;password&quot;</span><br><span class="line">[root@openstack ~]# openstack-config --set /etc/glance/glance-registry.conf keystone_authtoken project_domain_name &quot;Default&quot;</span><br><span class="line">[root@openstack ~]# openstack-config --set /etc/glance/glance-registry.conf keystone_authtoken user_domain_name &quot;Default&quot;</span><br><span class="line">[root@openstack ~]# openstack-config --set /etc/glance/glance-registry.conf keystone_authtoken project_name &quot;service&quot;</span><br><span class="line">[root@openstack ~]# openstack-config --set /etc/glance/glance-registry.conf keystone_authtoken username &quot;glance&quot;</span><br><span class="line">[root@openstack ~]# openstack-config --set /etc/glance/glance-registry.conf keystone_authtoken password &quot;123456&quot;</span><br><span class="line">[root@openstack ~]# openstack-config --set /etc/glance/glance-registry.conf paste_deploy flavor &quot;keystone&quot;</span><br><span class="line">[root@openstack ~]# grep &apos;^[a-z]&apos; /etc/glance/glance-registry.conf</span><br><span class="line">connection = mysql+pymysql://glance:123456@controller/glance</span><br><span class="line">www_authenticate_uri = http://controller:5000</span><br><span class="line">auth_url = http://controller:5000</span><br><span class="line">memcached_servers = controller:11211</span><br><span class="line">auth_type = password</span><br><span class="line">project_domain_name = Default</span><br><span class="line">user_domain_name = Default</span><br><span class="line">project_name = service</span><br><span class="line">username = glance</span><br><span class="line">password = 123456</span><br><span class="line">flavor = keystone</span><br></pre></td></tr></table></figure>
<h3 id="7-初始化-glance-数据库"><a href="#7-初始化-glance-数据库" class="headerlink" title="7. 初始化 glance 数据库"></a>7. 初始化 glance 数据库</h3><p><strong><em>必须确认数据库是否初始化正确</em></strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# su -s /bin/sh -c &quot;glance-manage db_sync&quot; glance</span><br><span class="line">/usr/lib/python2.7/site-packages/oslo_db/sqlalchemy/enginefacade.py:1352: OsloDBDeprecationWarning: EngineFacade is deprecated; please use oslo_db.sqlalchemy.enginefacade</span><br><span class="line">  expire_on_commit=expire_on_commit, _conf=conf)</span><br><span class="line">INFO  [alembic.runtime.migration] Context impl MySQLImpl.</span><br><span class="line">INFO  [alembic.runtime.migration] Will assume non-transactional DDL.</span><br><span class="line">INFO  [alembic.runtime.migration] Running upgrade  -&gt; liberty, liberty initial</span><br><span class="line">INFO  [alembic.runtime.migration] Running upgrade liberty -&gt; mitaka01, add index on created_at and updated_at columns of &apos;images&apos; table</span><br><span class="line">INFO  [alembic.runtime.migration] Running upgrade mitaka01 -&gt; mitaka02, update metadef os_nova_server</span><br><span class="line">INFO  [alembic.runtime.migration] Running upgrade mitaka02 -&gt; ocata_expand01, add visibility to images</span><br><span class="line">INFO  [alembic.runtime.migration] Running upgrade ocata_expand01 -&gt; pike_expand01, empty expand for symmetry with pike_contract01</span><br><span class="line">INFO  [alembic.runtime.migration] Running upgrade pike_expand01 -&gt; queens_expand01</span><br><span class="line">INFO  [alembic.runtime.migration] Running upgrade queens_expand01 -&gt; rocky_expand01, add os_hidden column to images table</span><br><span class="line">INFO  [alembic.runtime.migration] Running upgrade rocky_expand01 -&gt; rocky_expand02, add os_hash_algo and os_hash_value columns to images table</span><br><span class="line">INFO  [alembic.runtime.migration] Context impl MySQLImpl.</span><br><span class="line">INFO  [alembic.runtime.migration] Will assume non-transactional DDL.</span><br><span class="line">Upgraded database to: rocky_expand02, current revision(s): rocky_expand02</span><br><span class="line">INFO  [alembic.runtime.migration] Context impl MySQLImpl.</span><br><span class="line">INFO  [alembic.runtime.migration] Will assume non-transactional DDL.</span><br><span class="line">INFO  [alembic.runtime.migration] Context impl MySQLImpl.</span><br><span class="line">INFO  [alembic.runtime.migration] Will assume non-transactional DDL.</span><br><span class="line">Database migration is up to date. No migration needed.</span><br><span class="line">INFO  [alembic.runtime.migration] Context impl MySQLImpl.</span><br><span class="line">INFO  [alembic.runtime.migration] Will assume non-transactional DDL.</span><br><span class="line">INFO  [alembic.runtime.migration] Context impl MySQLImpl.</span><br><span class="line">INFO  [alembic.runtime.migration] Will assume non-transactional DDL.</span><br><span class="line">INFO  [alembic.runtime.migration] Running upgrade mitaka02 -&gt; ocata_contract01, remove is_public from images</span><br><span class="line">INFO  [alembic.runtime.migration] Running upgrade ocata_contract01 -&gt; pike_contract01, drop glare artifacts tables</span><br><span class="line">INFO  [alembic.runtime.migration] Running upgrade pike_contract01 -&gt; queens_contract01</span><br><span class="line">INFO  [alembic.runtime.migration] Running upgrade queens_contract01 -&gt; rocky_contract01</span><br><span class="line">INFO  [alembic.runtime.migration] Running upgrade rocky_contract01 -&gt; rocky_contract02</span><br><span class="line">INFO  [alembic.runtime.migration] Context impl MySQLImpl.</span><br><span class="line">INFO  [alembic.runtime.migration] Will assume non-transactional DDL.</span><br><span class="line">Upgraded database to: rocky_contract02, current revision(s): rocky_contract02</span><br><span class="line">INFO  [alembic.runtime.migration] Context impl MySQLImpl.</span><br><span class="line">INFO  [alembic.runtime.migration] Will assume non-transactional DDL.</span><br><span class="line">Database is synced successfully.</span><br><span class="line">[root@openstack ~]# mysql -uglance -p123456 -e &quot;use glance;show tables;&quot; | wc -l</span><br><span class="line">16</span><br><span class="line">[root@openstack ~]# mysql -uglance -p123456 -e &quot;use glance;show tables;&quot;</span><br><span class="line">+----------------------------------+</span><br><span class="line">| Tables_in_glance                 |</span><br><span class="line">+----------------------------------+</span><br><span class="line">| alembic_version                  |</span><br><span class="line">| image_locations                  |</span><br><span class="line">| image_members                    |</span><br><span class="line">| image_properties                 |</span><br><span class="line">| image_tags                       |</span><br><span class="line">| images                           |</span><br><span class="line">| metadef_namespace_resource_types |</span><br><span class="line">| metadef_namespaces               |</span><br><span class="line">| metadef_objects                  |</span><br><span class="line">| metadef_properties               |</span><br><span class="line">| metadef_resource_types           |</span><br><span class="line">| metadef_tags                     |</span><br><span class="line">| migrate_version                  |</span><br><span class="line">| task_info                        |</span><br><span class="line">| tasks                            |</span><br><span class="line">+----------------------------------+</span><br></pre></td></tr></table></figure></p>
<h3 id="7-启动-Glance-服务并设置为开机自启"><a href="#7-启动-Glance-服务并设置为开机自启" class="headerlink" title="7. 启动 Glance 服务并设置为开机自启"></a>7. 启动 Glance 服务并设置为开机自启</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# systemctl start openstack-glance-api openstack-glance-registry</span><br><span class="line">[root@openstack ~]# systemctl enable openstack-glance-api openstack-glance-registry</span><br><span class="line">Created symlink from /etc/systemd/system/multi-user.target.wants/openstack-glance-api.service to /usr/lib/systemd/system/openstack-glance-api.service.</span><br><span class="line">Created symlink from /etc/systemd/system/multi-user.target.wants/openstack-glance-registry.service to /usr/lib/systemd/system/openstack-glance-registry.service.</span><br></pre></td></tr></table></figure>
<h3 id="8-测试-Glance-镜像服务"><a href="#8-测试-Glance-镜像服务" class="headerlink" title="8. 测试 Glance 镜像服务"></a>8. 测试 Glance 镜像服务</h3><h4 id="a-下载镜像"><a href="#a-下载镜像" class="headerlink" title="a) 下载镜像"></a>a) 下载镜像</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# wget http://download.cirros-cloud.net/0.4.0/cirros-0.4.0-x86_64-disk.img</span><br><span class="line">--2018-12-15 16:32:33--  http://download.cirros-cloud.net/0.4.0/cirros-0.4.0-x86_64-disk.img</span><br><span class="line">Resolving download.cirros-cloud.net (download.cirros-cloud.net)... 64.90.42.85, 2607:f298:6:a036::bd6:a72a</span><br><span class="line">Connecting to download.cirros-cloud.net (download.cirros-cloud.net)|64.90.42.85|:80... connected.</span><br><span class="line">HTTP request sent, awaiting response... 200 OK</span><br><span class="line">Length: 12716032 (12M) [text/plain]</span><br><span class="line">Saving to: ‘cirros-0.4.0-x86_64-disk.img’</span><br><span class="line"></span><br><span class="line">100%[==========================================&gt;] 12,716,032  77.0KB/s   in 2m 13s </span><br><span class="line"></span><br><span class="line">2018-12-15 16:34:50 (93.3 KB/s) - ‘cirros-0.4.0-x86_64-disk.img’ saved [12716032/12716032]</span><br></pre></td></tr></table></figure>
<h4 id="b-上传镜像到-Glance"><a href="#b-上传镜像到-Glance" class="headerlink" title="b) 上传镜像到 Glance"></a>b) 上传镜像到 Glance</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# . admin-openrc</span><br><span class="line">[root@openstack ~]# openstack image create &quot;cirros&quot; --file cirros-0.4.0-x86_64-disk.img --disk-format qcow2 --container-format bare --public</span><br><span class="line">+------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">| Field            | Value                                                                                                                                                                                      |</span><br><span class="line">+------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">| checksum         | 443b7623e27ecf03dc9e01ee93f67afe                                                                                                                                                           |</span><br><span class="line">| container_format | bare                                                                                                                                                                                       |</span><br><span class="line">| created_at       | 2018-12-15T08:43:13Z                                                                                                                                                                       |</span><br><span class="line">| disk_format      | qcow2                                                                                                                                                                                      |</span><br><span class="line">| file             | /v2/images/28be57c8-8f04-407b-8a32-41d953a4a131/file                                                                                                                                       |</span><br><span class="line">| id               | 28be57c8-8f04-407b-8a32-41d953a4a131                                                                                                                                                       |</span><br><span class="line">| min_disk         | 0                                                                                                                                                                                          |</span><br><span class="line">| min_ram          | 0                                                                                                                                                                                          |</span><br><span class="line">| name             | cirros                                                                                                                                                                                     |</span><br><span class="line">| owner            | 81ed22594f0d4148809e9c0e62e039a5                                                                                                                                                           |</span><br><span class="line">| properties       | os_hash_algo=&apos;sha512&apos;, os_hash_value=&apos;6513f21e44aa3da349f248188a44bc304a3653a04122d8fb4535423c8e1d14cd6a153f735bb0982e2161b5b5186106570c17a9e58b64dd39390617cd5a350f78&apos;, os_hidden=&apos;False&apos; |</span><br><span class="line">| protected        | False                                                                                                                                                                                      |</span><br><span class="line">| schema           | /v2/schemas/image                                                                                                                                                                          |</span><br><span class="line">| size             | 12716032                                                                                                                                                                                   |</span><br><span class="line">| status           | active                                                                                                                                                                                     |</span><br><span class="line">| tags             |                                                                                                                                                                                            |</span><br><span class="line">| updated_at       | 2018-12-15T08:43:15Z                                                                                                                                                                       |</span><br><span class="line">| virtual_size     | None                                                                                                                                                                                       |</span><br><span class="line">| visibility       | public                                                                                                                                                                                     |</span><br><span class="line">+------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br></pre></td></tr></table></figure>
<h4 id="c-查看镜像"><a href="#c-查看镜像" class="headerlink" title="c) 查看镜像"></a>c) 查看镜像</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# openstack image list</span><br><span class="line">+--------------------------------------+--------+--------+</span><br><span class="line">| ID                                   | Name   | Status |</span><br><span class="line">+--------------------------------------+--------+--------+</span><br><span class="line">| 28be57c8-8f04-407b-8a32-41d953a4a131 | cirros | active |</span><br><span class="line">+--------------------------------------+--------+--------+</span><br></pre></td></tr></table></figure>
<h2 id="十、安装并配置-Nova-计算服务-只需在-Controller-节点安装"><a href="#十、安装并配置-Nova-计算服务-只需在-Controller-节点安装" class="headerlink" title="十、安装并配置 Nova 计算服务 (!!!只需在 Controller 节点安装!!!)"></a>十、安装并配置 Nova 计算服务 <strong><em>(!!!只需在 Controller 节点安装!!!)</em></strong></h2><h3 id="1-创建-nova-数据库"><a href="#1-创建-nova-数据库" class="headerlink" title="1. 创建 nova 数据库"></a>1. 创建 nova 数据库</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">DATABASE</span> nova_api;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">DATABASE</span> nova;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">DATABASE</span> nova_cell0;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">DATABASE</span> placement;</span><br><span class="line"><span class="keyword">GRANT</span> ALL <span class="keyword">PRIVILEGES</span> <span class="keyword">ON</span> nova_api.* <span class="keyword">TO</span> <span class="string">'nova'</span>@<span class="string">'localhost'</span> <span class="keyword">IDENTIFIED</span> <span class="keyword">BY</span> <span class="string">'123456'</span>;</span><br><span class="line"><span class="keyword">GRANT</span> ALL <span class="keyword">PRIVILEGES</span> <span class="keyword">ON</span> nova_api.* <span class="keyword">TO</span> <span class="string">'nova'</span>@<span class="string">'%'</span> <span class="keyword">IDENTIFIED</span> <span class="keyword">BY</span> <span class="string">'123456'</span>;</span><br><span class="line"><span class="keyword">GRANT</span> ALL <span class="keyword">PRIVILEGES</span> <span class="keyword">ON</span> nova.* <span class="keyword">TO</span> <span class="string">'nova'</span>@<span class="string">'localhost'</span> <span class="keyword">IDENTIFIED</span> <span class="keyword">BY</span> <span class="string">'123456'</span>;</span><br><span class="line"><span class="keyword">GRANT</span> ALL <span class="keyword">PRIVILEGES</span> <span class="keyword">ON</span> nova.* <span class="keyword">TO</span> <span class="string">'nova'</span>@<span class="string">'%'</span> <span class="keyword">IDENTIFIED</span> <span class="keyword">BY</span> <span class="string">'123456'</span>;</span><br><span class="line"><span class="keyword">GRANT</span> ALL <span class="keyword">PRIVILEGES</span> <span class="keyword">ON</span> nova_cell0.* <span class="keyword">TO</span> <span class="string">'nova'</span>@<span class="string">'localhost'</span> <span class="keyword">IDENTIFIED</span> <span class="keyword">BY</span> <span class="string">'123456'</span>;</span><br><span class="line"><span class="keyword">GRANT</span> ALL <span class="keyword">PRIVILEGES</span> <span class="keyword">ON</span> nova_cell0.* <span class="keyword">TO</span> <span class="string">'nova'</span>@<span class="string">'%'</span> <span class="keyword">IDENTIFIED</span> <span class="keyword">BY</span> <span class="string">'123456'</span>;</span><br><span class="line"><span class="keyword">GRANT</span> ALL <span class="keyword">PRIVILEGES</span> <span class="keyword">ON</span> placement.* <span class="keyword">TO</span> <span class="string">'placement'</span>@<span class="string">'localhost'</span> <span class="keyword">IDENTIFIED</span> <span class="keyword">BY</span> <span class="string">'123456'</span>;</span><br><span class="line"><span class="keyword">GRANT</span> ALL <span class="keyword">PRIVILEGES</span> <span class="keyword">ON</span> placement.* <span class="keyword">TO</span> <span class="string">'placement'</span>@<span class="string">'%'</span> <span class="keyword">IDENTIFIED</span> <span class="keyword">BY</span> <span class="string">'123456'</span>;</span><br><span class="line"><span class="keyword">flush</span> <span class="keyword">privileges</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# mysql -p123456</span><br><span class="line">Welcome to the MariaDB monitor.  Commands end with ; or \g.</span><br><span class="line">...</span><br><span class="line">...</span><br><span class="line">MariaDB [(none)]&gt; CREATE DATABASE nova_api;</span><br><span class="line">Query OK, 1 row affected (0.01 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; CREATE DATABASE nova;</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; CREATE DATABASE nova_cell0;</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; CREATE DATABASE placement;</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; GRANT ALL PRIVILEGES ON nova_api.* TO &apos;nova&apos;@&apos;localhost&apos; IDENTIFIED BY &apos;123456&apos;;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; GRANT ALL PRIVILEGES ON nova_api.* TO &apos;nova&apos;@&apos;%&apos; IDENTIFIED BY &apos;123456&apos;;</span><br><span class="line">Query OK, 0 rows affected (0.01 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; GRANT ALL PRIVILEGES ON nova.* TO &apos;nova&apos;@&apos;localhost&apos; IDENTIFIED BY &apos;123456&apos;;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; GRANT ALL PRIVILEGES ON nova.* TO &apos;nova&apos;@&apos;%&apos; IDENTIFIED BY &apos;123456&apos;;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; GRANT ALL PRIVILEGES ON nova_cell0.* TO &apos;nova&apos;@&apos;localhost&apos; IDENTIFIED BY &apos;123456&apos;;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; GRANT ALL PRIVILEGES ON nova_cell0.* TO &apos;nova&apos;@&apos;%&apos; IDENTIFIED BY &apos;123456&apos;;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; GRANT ALL PRIVILEGES ON placement.* TO &apos;placement&apos;@&apos;localhost&apos; IDENTIFIED BY &apos;123456&apos;;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; GRANT ALL PRIVILEGES ON placement.* TO &apos;placement&apos;@&apos;%&apos; IDENTIFIED BY &apos;123456&apos;;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; flush privileges;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; exit</span><br><span class="line">Bye</span><br></pre></td></tr></table></figure>
<h3 id="2-创建一个名为-nova-的-KeyStone-用户"><a href="#2-创建一个名为-nova-的-KeyStone-用户" class="headerlink" title="2. 创建一个名为 nova 的 KeyStone 用户"></a>2. 创建一个名为 nova 的 KeyStone 用户</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# . admin-openrc </span><br><span class="line">[root@openstack ~]# openstack user create --domain default --password=123456 nova</span><br><span class="line">+---------------------+----------------------------------+</span><br><span class="line">| Field               | Value                            |</span><br><span class="line">+---------------------+----------------------------------+</span><br><span class="line">| domain_id           | default                          |</span><br><span class="line">| enabled             | True                             |</span><br><span class="line">| id                  | 50f123bb0cc640b7bc2603a3c5757b51 |</span><br><span class="line">| name                | nova                             |</span><br><span class="line">| options             | &#123;&#125;                               |</span><br><span class="line">| password_expires_at | None                             |</span><br><span class="line">+---------------------+----------------------------------+</span><br><span class="line">[root@openstack ~]# openstack user list</span><br><span class="line">+----------------------------------+--------+</span><br><span class="line">| ID                               | Name   |</span><br><span class="line">+----------------------------------+--------+</span><br><span class="line">| 063e3004acc94429a6b2a2cec9776608 | glance |</span><br><span class="line">| 50f123bb0cc640b7bc2603a3c5757b51 | nova   |</span><br><span class="line">| 84e7e67f49ff4d13a7b7334134a13db2 | admin  |</span><br><span class="line">| a2750e3ab9144584962f1e28eaa496ee | myuser |</span><br><span class="line">+----------------------------------+--------+</span><br></pre></td></tr></table></figure>
<h3 id="3-将-nova-用户添加到-service-项目的-admin-角色"><a href="#3-将-nova-用户添加到-service-项目的-admin-角色" class="headerlink" title="3. 将 nova 用户添加到 service 项目的 admin 角色"></a>3. 将 nova 用户添加到 service 项目的 admin 角色</h3><p>以下命令无输出<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# openstack role add --project service --user nova admin</span><br></pre></td></tr></table></figure></p>
<h3 id="4-创建-Nova-镜像服务实例"><a href="#4-创建-Nova-镜像服务实例" class="headerlink" title="4. 创建 Nova 镜像服务实例"></a>4. 创建 Nova 镜像服务实例</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# openstack service create --name nova --description &quot;OpenStack Compute&quot; compute</span><br><span class="line">+-------------+----------------------------------+</span><br><span class="line">| Field       | Value                            |</span><br><span class="line">+-------------+----------------------------------+</span><br><span class="line">| description | OpenStack Compute                |</span><br><span class="line">| enabled     | True                             |</span><br><span class="line">| id          | 70155ce6ff3f41348cafa6e498d96e99 |</span><br><span class="line">| name        | nova                             |</span><br><span class="line">| type        | compute                          |</span><br><span class="line">+-------------+----------------------------------+</span><br><span class="line">[root@openstack ~]# openstack service list</span><br><span class="line">+----------------------------------+----------+----------+</span><br><span class="line">| ID                               | Name     | Type     |</span><br><span class="line">+----------------------------------+----------+----------+</span><br><span class="line">| 363f73076d45482c9a680f11193549e9 | keystone | identity |</span><br><span class="line">| 70155ce6ff3f41348cafa6e498d96e99 | nova     | compute  |</span><br><span class="line">| c9ed8738afa94a4abbe91144f2d67f45 | glance   | image    |</span><br><span class="line">+----------------------------------+----------+----------+</span><br></pre></td></tr></table></figure>
<h3 id="5-创建-Nova-镜像服务的-API-端点-endpoint"><a href="#5-创建-Nova-镜像服务的-API-端点-endpoint" class="headerlink" title="5. 创建 Nova 镜像服务的 API 端点 (endpoint)"></a>5. 创建 Nova 镜像服务的 API 端点 (endpoint)</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# openstack endpoint create --region RegionOne compute public http://controller:8774/v2.1</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">| Field        | Value                            |</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">| enabled      | True                             |</span><br><span class="line">| id           | dd00497083f94f8b8bae6fac7735f2f7 |</span><br><span class="line">| interface    | public                           |</span><br><span class="line">| region       | RegionOne                        |</span><br><span class="line">| region_id    | RegionOne                        |</span><br><span class="line">| service_id   | 70155ce6ff3f41348cafa6e498d96e99 |</span><br><span class="line">| service_name | nova                             |</span><br><span class="line">| service_type | compute                          |</span><br><span class="line">| url          | http://controller:8774/v2.1      |</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">[root@openstack ~]# openstack endpoint create --region RegionOne compute internal http://controller:8774/v2.1</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">| Field        | Value                            |</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">| enabled      | True                             |</span><br><span class="line">| id           | 1640b8023b96498ba283d645573acbf5 |</span><br><span class="line">| interface    | internal                         |</span><br><span class="line">| region       | RegionOne                        |</span><br><span class="line">| region_id    | RegionOne                        |</span><br><span class="line">| service_id   | 70155ce6ff3f41348cafa6e498d96e99 |</span><br><span class="line">| service_name | nova                             |</span><br><span class="line">| service_type | compute                          |</span><br><span class="line">| url          | http://controller:8774/v2.1      |</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">[root@openstack ~]# openstack endpoint create --region RegionOne compute admin http://controller:8774/v2.1</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">| Field        | Value                            |</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">| enabled      | True                             |</span><br><span class="line">| id           | 232c4a99a3fd46bca2bfc092a4ff0705 |</span><br><span class="line">| interface    | admin                            |</span><br><span class="line">| region       | RegionOne                        |</span><br><span class="line">| region_id    | RegionOne                        |</span><br><span class="line">| service_id   | 70155ce6ff3f41348cafa6e498d96e99 |</span><br><span class="line">| service_name | nova                             |</span><br><span class="line">| service_type | compute                          |</span><br><span class="line">| url          | http://controller:8774/v2.1      |</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">[root@openstack ~]# openstack endpoint list</span><br><span class="line">+----------------------------------+-----------+--------------+--------------+---------+-----------+-----------------------------+</span><br><span class="line">| ID                               | Region    | Service Name | Service Type | Enabled | Interface | URL                         |</span><br><span class="line">+----------------------------------+-----------+--------------+--------------+---------+-----------+-----------------------------+</span><br><span class="line">| 1640b8023b96498ba283d645573acbf5 | RegionOne | nova         | compute      | True    | internal  | http://controller:8774/v2.1 |</span><br><span class="line">| 232c4a99a3fd46bca2bfc092a4ff0705 | RegionOne | nova         | compute      | True    | admin     | http://controller:8774/v2.1 |</span><br><span class="line">| 498db99146dc43d982449b1c7c6ac16b | RegionOne | keystone     | identity     | True    | public    | http://controller:5000/v3/  |</span><br><span class="line">| 4c22aba83615477eaf5c42d935f882b8 | RegionOne | glance       | image        | True    | internal  | http://controller:9292      |</span><br><span class="line">| 54b25eea3f8a46c7af947adb4bff18ed | RegionOne | glance       | image        | True    | admin     | http://controller:9292      |</span><br><span class="line">| 61af677340904813b4a5244da0a036ca | RegionOne | keystone     | identity     | True    | admin     | http://controller:5000/v3/  |</span><br><span class="line">| 9c6d59dfc5cc4f6c8dd55eb1c944e17c | RegionOne | keystone     | identity     | True    | internal  | http://controller:5000/v3/  |</span><br><span class="line">| b02bf56e9c6f4ad6a54e513f23d333c7 | RegionOne | glance       | image        | True    | public    | http://controller:9292      |</span><br><span class="line">| dd00497083f94f8b8bae6fac7735f2f7 | RegionOne | nova         | compute      | True    | public    | http://controller:8774/v2.1 |</span><br><span class="line">+----------------------------------+-----------+--------------+--------------+---------+-----------+-----------------------------+</span><br></pre></td></tr></table></figure>
<h3 id="6-创建一个名为-placement-的-KeyStone-用户"><a href="#6-创建一个名为-placement-的-KeyStone-用户" class="headerlink" title="6. 创建一个名为 placement 的 KeyStone 用户"></a>6. 创建一个名为 placement 的 KeyStone 用户</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# . admin-openrc </span><br><span class="line">[root@openstack ~]# openstack user create --domain default --password=123456 placement</span><br><span class="line">+---------------------+----------------------------------+</span><br><span class="line">| Field               | Value                            |</span><br><span class="line">+---------------------+----------------------------------+</span><br><span class="line">| domain_id           | default                          |</span><br><span class="line">| enabled             | True                             |</span><br><span class="line">| id                  | 99f1f663e39f47c99b5bf59706541fc4 |</span><br><span class="line">| name                | placement                        |</span><br><span class="line">| options             | &#123;&#125;                               |</span><br><span class="line">| password_expires_at | None                             |</span><br><span class="line">+---------------------+----------------------------------+</span><br><span class="line">[root@openstack ~]# openstack user list</span><br><span class="line">+----------------------------------+-----------+</span><br><span class="line">| ID                               | Name      |</span><br><span class="line">+----------------------------------+-----------+</span><br><span class="line">| 063e3004acc94429a6b2a2cec9776608 | glance    |</span><br><span class="line">| 50f123bb0cc640b7bc2603a3c5757b51 | nova      |</span><br><span class="line">| 84e7e67f49ff4d13a7b7334134a13db2 | admin     |</span><br><span class="line">| 99f1f663e39f47c99b5bf59706541fc4 | placement |</span><br><span class="line">| a2750e3ab9144584962f1e28eaa496ee | myuser    |</span><br><span class="line">+----------------------------------+-----------+</span><br></pre></td></tr></table></figure>
<h3 id="7-将-placement-用户添加到-service-项目的-admin-角色"><a href="#7-将-placement-用户添加到-service-项目的-admin-角色" class="headerlink" title="7. 将 placement 用户添加到 service 项目的 admin 角色"></a>7. 将 placement 用户添加到 service 项目的 admin 角色</h3><p>以下命令无输出<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# openstack role add --project service --user placement admin</span><br></pre></td></tr></table></figure></p>
<h3 id="8-创建-Placement-项目实例"><a href="#8-创建-Placement-项目实例" class="headerlink" title="8. 创建 Placement 项目实例"></a>8. 创建 Placement 项目实例</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# openstack service create --name placement --description &quot;Placement API&quot; placement</span><br><span class="line">+-------------+----------------------------------+</span><br><span class="line">| Field       | Value                            |</span><br><span class="line">+-------------+----------------------------------+</span><br><span class="line">| description | Placement API                    |</span><br><span class="line">| enabled     | True                             |</span><br><span class="line">| id          | a47516d9fae94cbd85f43a994ac2f4b4 |</span><br><span class="line">| name        | placement                        |</span><br><span class="line">| type        | placement                        |</span><br><span class="line">+-------------+----------------------------------+</span><br><span class="line">[root@openstack ~]# openstack service list</span><br><span class="line">+----------------------------------+-----------+-----------+</span><br><span class="line">| ID                               | Name      | Type      |</span><br><span class="line">+----------------------------------+-----------+-----------+</span><br><span class="line">| 363f73076d45482c9a680f11193549e9 | keystone  | identity  |</span><br><span class="line">| 70155ce6ff3f41348cafa6e498d96e99 | nova      | compute   |</span><br><span class="line">| a47516d9fae94cbd85f43a994ac2f4b4 | placement | placement |</span><br><span class="line">| c9ed8738afa94a4abbe91144f2d67f45 | glance    | image     |</span><br><span class="line">+----------------------------------+-----------+-----------+</span><br></pre></td></tr></table></figure>
<h3 id="9-创建-Nova-镜像服务的-API-端点-endpoint"><a href="#9-创建-Nova-镜像服务的-API-端点-endpoint" class="headerlink" title="9. 创建 Nova 镜像服务的 API 端点 (endpoint)"></a>9. 创建 Nova 镜像服务的 API 端点 (endpoint)</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# openstack endpoint create --region RegionOne placement public http://controller:8778</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">| Field        | Value                            |</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">| enabled      | True                             |</span><br><span class="line">| id           | 1f24214b544b4804a1f5e3fbe3438a2c |</span><br><span class="line">| interface    | public                           |</span><br><span class="line">| region       | RegionOne                        |</span><br><span class="line">| region_id    | RegionOne                        |</span><br><span class="line">| service_id   | a47516d9fae94cbd85f43a994ac2f4b4 |</span><br><span class="line">| service_name | placement                        |</span><br><span class="line">| service_type | placement                        |</span><br><span class="line">| url          | http://controller:8778           |</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">[root@openstack ~]# openstack endpoint create --region RegionOne placement internal http://controller:8778</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">| Field        | Value                            |</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">| enabled      | True                             |</span><br><span class="line">| id           | 842e55cc821b4a74b9093072a02184fc |</span><br><span class="line">| interface    | internal                         |</span><br><span class="line">| region       | RegionOne                        |</span><br><span class="line">| region_id    | RegionOne                        |</span><br><span class="line">| service_id   | a47516d9fae94cbd85f43a994ac2f4b4 |</span><br><span class="line">| service_name | placement                        |</span><br><span class="line">| service_type | placement                        |</span><br><span class="line">| url          | http://controller:8778           |</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">[root@openstack ~]# openstack endpoint create --region RegionOne placement admin http://controller:8778</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">| Field        | Value                            |</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">| enabled      | True                             |</span><br><span class="line">| id           | ddd75210cbcf4d9294c6ddfcb1bb1927 |</span><br><span class="line">| interface    | admin                            |</span><br><span class="line">| region       | RegionOne                        |</span><br><span class="line">| region_id    | RegionOne                        |</span><br><span class="line">| service_id   | a47516d9fae94cbd85f43a994ac2f4b4 |</span><br><span class="line">| service_name | placement                        |</span><br><span class="line">| service_type | placement                        |</span><br><span class="line">| url          | http://controller:8778           |</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">[root@openstack ~]# openstack endpoint list</span><br><span class="line">+----------------------------------+-----------+--------------+--------------+---------+-----------+-----------------------------+</span><br><span class="line">| ID                               | Region    | Service Name | Service Type | Enabled | Interface | URL                         |</span><br><span class="line">+----------------------------------+-----------+--------------+--------------+---------+-----------+-----------------------------+</span><br><span class="line">| 1640b8023b96498ba283d645573acbf5 | RegionOne | nova         | compute      | True    | internal  | http://controller:8774/v2.1 |</span><br><span class="line">| 1f24214b544b4804a1f5e3fbe3438a2c | RegionOne | placement    | placement    | True    | public    | http://controller:8778      |</span><br><span class="line">| 232c4a99a3fd46bca2bfc092a4ff0705 | RegionOne | nova         | compute      | True    | admin     | http://controller:8774/v2.1 |</span><br><span class="line">| 498db99146dc43d982449b1c7c6ac16b | RegionOne | keystone     | identity     | True    | public    | http://controller:5000/v3/  |</span><br><span class="line">| 4c22aba83615477eaf5c42d935f882b8 | RegionOne | glance       | image        | True    | internal  | http://controller:9292      |</span><br><span class="line">| 54b25eea3f8a46c7af947adb4bff18ed | RegionOne | glance       | image        | True    | admin     | http://controller:9292      |</span><br><span class="line">| 61af677340904813b4a5244da0a036ca | RegionOne | keystone     | identity     | True    | admin     | http://controller:5000/v3/  |</span><br><span class="line">| 842e55cc821b4a74b9093072a02184fc | RegionOne | placement    | placement    | True    | internal  | http://controller:8778      |</span><br><span class="line">| 9c6d59dfc5cc4f6c8dd55eb1c944e17c | RegionOne | keystone     | identity     | True    | internal  | http://controller:5000/v3/  |</span><br><span class="line">| b02bf56e9c6f4ad6a54e513f23d333c7 | RegionOne | glance       | image        | True    | public    | http://controller:9292      |</span><br><span class="line">| dd00497083f94f8b8bae6fac7735f2f7 | RegionOne | nova         | compute      | True    | public    | http://controller:8774/v2.1 |</span><br><span class="line">| ddd75210cbcf4d9294c6ddfcb1bb1927 | RegionOne | placement    | placement    | True    | admin     | http://controller:8778      |</span><br><span class="line">+----------------------------------+-----------+--------------+--------------+---------+-----------+-----------------------------+</span><br></pre></td></tr></table></figure>
<h3 id="10-安装并配置-Nova-相关软件"><a href="#10-安装并配置-Nova-相关软件" class="headerlink" title="10. 安装并配置 Nova 相关软件"></a>10. 安装并配置 Nova 相关软件</h3><h4 id="a-安装-Nova-相关软件"><a href="#a-安装-Nova-相关软件" class="headerlink" title="a) 安装 Nova 相关软件"></a>a) 安装 Nova 相关软件</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# yum install -y openstack-nova-api openstack-nova-conductor openstack-nova-console openstack-nova-novncproxy openstack-nova-scheduler openstack-nova-placement-api</span><br><span class="line">...</span><br><span class="line">Complete!</span><br></pre></td></tr></table></figure>
<h4 id="b-修改-Glance-的配置文件-nova-conf"><a href="#b-修改-Glance-的配置文件-nova-conf" class="headerlink" title="b) 修改 Glance 的配置文件 (nova.conf)"></a>b) 修改 Glance 的配置文件 (nova.conf)</h4><p><strong><em>必须确认配置是否正确</em></strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# openstack-config --set /etc/nova/nova.conf DEFAULT enabled_apis &quot;osapi_compute,metadata&quot;</span><br><span class="line">[root@openstack ~]# openstack-config --set /etc/nova/nova.conf DEFAULT my_ip &quot;192.168.10.11&quot;</span><br><span class="line">[root@openstack ~]# openstack-config --set /etc/nova/nova.conf DEFAULT use_neutron &quot;true&quot;</span><br><span class="line">[root@openstack ~]# openstack-config --set /etc/nova/nova.conf DEFAULT firewall_driver &quot;nova.virt.firewall.NoopFirewallDriver&quot;</span><br><span class="line">[root@openstack ~]# openstack-config --set /etc/nova/nova.conf DEFAULT transport_url &quot;rabbit://openstack:123456@controller&quot;</span><br><span class="line">[root@openstack ~]# openstack-config --set /etc/nova/nova.conf api_database connection &quot;mysql+pymysql://nova:123456@controller/nova_api&quot;</span><br><span class="line">[root@openstack ~]# openstack-config --set /etc/nova/nova.conf database connection &quot;mysql+pymysql://nova:123456@controller/nova&quot;</span><br><span class="line">[root@openstack ~]# openstack-config --set /etc/nova/nova.conf placement_database connection &quot;mysql+pymysql://placement:123456@controller/placement&quot;</span><br><span class="line">[root@openstack ~]# openstack-config --set /etc/nova/nova.conf api auth_strategy &quot;keystone&quot; </span><br><span class="line">[root@openstack ~]# openstack-config --set /etc/nova/nova.conf keystone_authtoken auth_url &quot;http://controller:5000/v3&quot;</span><br><span class="line">[root@openstack ~]# openstack-config --set /etc/nova/nova.conf keystone_authtoken memcached_servers &quot;controller:11211&quot;</span><br><span class="line">[root@openstack ~]# openstack-config --set /etc/nova/nova.conf keystone_authtoken auth_type &quot;password&quot;</span><br><span class="line">[root@openstack ~]# openstack-config --set /etc/nova/nova.conf keystone_authtoken project_domain_name &quot;default&quot;</span><br><span class="line">[root@openstack ~]# openstack-config --set /etc/nova/nova.conf keystone_authtoken user_domain_name &quot;default&quot;</span><br><span class="line">[root@openstack ~]# openstack-config --set /etc/nova/nova.conf keystone_authtoken project_name &quot;service&quot; </span><br><span class="line">[root@openstack ~]# openstack-config --set /etc/nova/nova.conf keystone_authtoken username &quot;nova&quot; </span><br><span class="line">[root@openstack ~]# openstack-config --set /etc/nova/nova.conf keystone_authtoken password &quot;123456&quot;</span><br><span class="line">[root@openstack ~]# openstack-config --set /etc/nova/nova.conf vnc enabled &quot;true&quot;</span><br><span class="line">[root@openstack ~]# openstack-config --set /etc/nova/nova.conf vnc server_listen &quot;\$my_ip&quot;</span><br><span class="line">[root@openstack ~]# openstack-config --set /etc/nova/nova.conf vnc server_proxyclient_address &quot;\$my_ip&quot;</span><br><span class="line">[root@openstack ~]# openstack-config --set /etc/nova/nova.conf glance api_servers &quot;http://controller:9292&quot;</span><br><span class="line">[root@openstack ~]# openstack-config --set /etc/nova/nova.conf oslo_concurrency lock_path &quot;/var/lib/nova/tmp &quot;</span><br><span class="line">[root@openstack ~]# openstack-config --set /etc/nova/nova.conf placement region_name &quot;RegionOne&quot;</span><br><span class="line">[root@openstack ~]# openstack-config --set /etc/nova/nova.conf placement project_domain_name &quot;Default&quot;</span><br><span class="line">[root@openstack ~]# openstack-config --set /etc/nova/nova.conf placement project_name &quot;service&quot;</span><br><span class="line">[root@openstack ~]# openstack-config --set /etc/nova/nova.conf placement auth_type &quot;password&quot;</span><br><span class="line">[root@openstack ~]# openstack-config --set /etc/nova/nova.conf placement user_domain_name &quot;Default&quot;</span><br><span class="line">[root@openstack ~]# openstack-config --set /etc/nova/nova.conf placement auth_url &quot;http://controller:5000/v3&quot;</span><br><span class="line">[root@openstack ~]# openstack-config --set /etc/nova/nova.conf placement username &quot;placement&quot;</span><br><span class="line">[root@openstack ~]# openstack-config --set /etc/nova/nova.conf placement password &quot;123456&quot;</span><br><span class="line">[root@openstack ~]# openstack-config --set /etc/nova/nova.conf scheduler discover_hosts_in_cells_interval &quot;300&quot;</span><br><span class="line">[root@openstack ~]# grep &apos;^[a-z]&apos; /etc/nova/nova.conf</span><br><span class="line">enabled_apis = osapi_compute,metadata</span><br><span class="line">my_ip = 192.168.10.11</span><br><span class="line">use_neutron = true</span><br><span class="line">firewall_driver = nova.virt.firewall.NoopFirewallDriver</span><br><span class="line">transport_url = rabbit://openstack:123456@controller</span><br><span class="line">auth_strategy = keystone</span><br><span class="line">connection = mysql+pymysql://nova:123456@controller/nova_api</span><br><span class="line">connection = mysql+pymysql://nova:123456@controller/nova</span><br><span class="line">api_servers = http://controller:9292</span><br><span class="line">auth_url = http://controller:5000/v3</span><br><span class="line">memcached_servers = controller:11211</span><br><span class="line">auth_type = password</span><br><span class="line">project_domain_name = default</span><br><span class="line">user_domain_name = default</span><br><span class="line">project_name = service</span><br><span class="line">username = nova</span><br><span class="line">password = 123456</span><br><span class="line">lock_path = /var/lib/nova/tmp </span><br><span class="line">region_name = RegionOne</span><br><span class="line">project_domain_name = Default</span><br><span class="line">project_name = service</span><br><span class="line">auth_type = password</span><br><span class="line">user_domain_name = Default</span><br><span class="line">auth_url = http://controller:5000/v3</span><br><span class="line">username = placement</span><br><span class="line">password = 123456</span><br><span class="line">connection = mysql+pymysql://placement:123456@controller/placement</span><br><span class="line">discover_hosts_in_cells_interval = 300</span><br><span class="line">enabled = true</span><br><span class="line">server_listen = $my_ip</span><br><span class="line">server_proxyclient_address = $my_ip</span><br></pre></td></tr></table></figure></p>
<h4 id="d-修改-Apache-Httpd-的虚拟主机配置文件-00-nova-placement-api-conf"><a href="#d-修改-Apache-Httpd-的虚拟主机配置文件-00-nova-placement-api-conf" class="headerlink" title="d) 修改 Apache (Httpd) 的虚拟主机配置文件 (00-nova-placement-api.conf)"></a>d) 修改 Apache (Httpd) 的虚拟主机配置文件 (00-nova-placement-api.conf)</h4><p>添加最后一段配置以修复 bug<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# vim /etc/httpd/conf.d/00-nova-placement-api.conf </span><br><span class="line">[root@openstack ~]# cat /etc/httpd/conf.d/00-nova-placement-api.conf </span><br><span class="line">Listen 8778</span><br><span class="line"></span><br><span class="line">&lt;VirtualHost *:8778&gt;</span><br><span class="line">  WSGIProcessGroup nova-placement-api</span><br><span class="line">  WSGIApplicationGroup %&#123;GLOBAL&#125;</span><br><span class="line">  WSGIPassAuthorization On</span><br><span class="line">  WSGIDaemonProcess nova-placement-api processes=3 threads=1 user=nova group=nova</span><br><span class="line">  WSGIScriptAlias / /usr/bin/nova-placement-api</span><br><span class="line">  &lt;IfVersion &gt;= 2.4&gt;</span><br><span class="line">    ErrorLogFormat &quot;%M&quot;</span><br><span class="line">  &lt;/IfVersion&gt;</span><br><span class="line">  ErrorLog /var/log/nova/nova-placement-api.log</span><br><span class="line">  #SSLEngine On</span><br><span class="line">  #SSLCertificateFile ...</span><br><span class="line">  #SSLCertificateKeyFile ...</span><br><span class="line">&lt;/VirtualHost&gt;</span><br><span class="line"></span><br><span class="line">Alias /nova-placement-api /usr/bin/nova-placement-api</span><br><span class="line">&lt;Location /nova-placement-api&gt;</span><br><span class="line">  SetHandler wsgi-script</span><br><span class="line">  Options +ExecCGI</span><br><span class="line">  WSGIProcessGroup nova-placement-api</span><br><span class="line">  WSGIApplicationGroup %&#123;GLOBAL&#125;</span><br><span class="line">  WSGIPassAuthorization On</span><br><span class="line">&lt;/Location&gt;</span><br><span class="line"></span><br><span class="line"># ADD - make by zhaoshuai</span><br><span class="line">&lt;Directory /usr/bin&gt;</span><br><span class="line">   &lt;IfVersion &gt;= 2.4&gt;</span><br><span class="line">      Require all granted</span><br><span class="line">   &lt;/IfVersion&gt;</span><br><span class="line">   &lt;IfVersion &lt; 2.4&gt;</span><br><span class="line">      Order allow,deny</span><br><span class="line">      Allow from all</span><br><span class="line">   &lt;/IfVersion&gt;</span><br><span class="line">&lt;/Directory&gt;</span><br></pre></td></tr></table></figure></p>
<h3 id="11-重启-Apache-Httpd-服务"><a href="#11-重启-Apache-Httpd-服务" class="headerlink" title="11. 重启 Apache (Httpd) 服务"></a>11. 重启 Apache (Httpd) 服务</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# systemctl restart httpd</span><br></pre></td></tr></table></figure>
<h3 id="12-初始化-nova-api-placement-数据库-请按顺序执行"><a href="#12-初始化-nova-api-placement-数据库-请按顺序执行" class="headerlink" title="12. 初始化 nova-api, placement 数据库 (请按顺序执行)"></a>12. 初始化 nova-api, placement 数据库 <strong><em>(请按顺序执行)</em></strong></h3><p><strong><em>必须确认数据库是否初始化正确</em></strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# su -s /bin/sh -c &quot;nova-manage api_db sync&quot; nova</span><br><span class="line">[root@openstack ~]# mysql -unova -p123456 -e &quot;use nova_api;show tables;&quot; | wc -l</span><br><span class="line">33</span><br><span class="line">[root@openstack ~]# mysql -unova -p123456 -e &quot;use nova_api;show tables;&quot;</span><br><span class="line">+------------------------------+</span><br><span class="line">| Tables_in_nova_api           |</span><br><span class="line">+------------------------------+</span><br><span class="line">| aggregate_hosts              |</span><br><span class="line">| aggregate_metadata           |</span><br><span class="line">| aggregates                   |</span><br><span class="line">| allocations                  |</span><br><span class="line">| build_requests               |</span><br><span class="line">| cell_mappings                |</span><br><span class="line">| consumers                    |</span><br><span class="line">| flavor_extra_specs           |</span><br><span class="line">| flavor_projects              |</span><br><span class="line">| flavors                      |</span><br><span class="line">| host_mappings                |</span><br><span class="line">| instance_group_member        |</span><br><span class="line">| instance_group_policy        |</span><br><span class="line">| instance_groups              |</span><br><span class="line">| instance_mappings            |</span><br><span class="line">| inventories                  |</span><br><span class="line">| key_pairs                    |</span><br><span class="line">| migrate_version              |</span><br><span class="line">| placement_aggregates         |</span><br><span class="line">| project_user_quotas          |</span><br><span class="line">| projects                     |</span><br><span class="line">| quota_classes                |</span><br><span class="line">| quota_usages                 |</span><br><span class="line">| quotas                       |</span><br><span class="line">| request_specs                |</span><br><span class="line">| reservations                 |</span><br><span class="line">| resource_classes             |</span><br><span class="line">| resource_provider_aggregates |</span><br><span class="line">| resource_provider_traits     |</span><br><span class="line">| resource_providers           |</span><br><span class="line">| traits                       |</span><br><span class="line">| users                        |</span><br><span class="line">+------------------------------+</span><br><span class="line">[root@openstack ~]# mysql -uplacement -p123456 -e &quot;use placement;show tables;&quot; | wc -l</span><br><span class="line">33</span><br><span class="line">[root@openstack ~]# mysql -uplacement -p123456 -e &quot;use placement;show tables;&quot;</span><br><span class="line">+------------------------------+</span><br><span class="line">| Tables_in_placement          |</span><br><span class="line">+------------------------------+</span><br><span class="line">| aggregate_hosts              |</span><br><span class="line">| aggregate_metadata           |</span><br><span class="line">| aggregates                   |</span><br><span class="line">| allocations                  |</span><br><span class="line">| build_requests               |</span><br><span class="line">| cell_mappings                |</span><br><span class="line">| consumers                    |</span><br><span class="line">| flavor_extra_specs           |</span><br><span class="line">| flavor_projects              |</span><br><span class="line">| flavors                      |</span><br><span class="line">| host_mappings                |</span><br><span class="line">| instance_group_member        |</span><br><span class="line">| instance_group_policy        |</span><br><span class="line">| instance_groups              |</span><br><span class="line">| instance_mappings            |</span><br><span class="line">| inventories                  |</span><br><span class="line">| key_pairs                    |</span><br><span class="line">| migrate_version              |</span><br><span class="line">| placement_aggregates         |</span><br><span class="line">| project_user_quotas          |</span><br><span class="line">| projects                     |</span><br><span class="line">| quota_classes                |</span><br><span class="line">| quota_usages                 |</span><br><span class="line">| quotas                       |</span><br><span class="line">| request_specs                |</span><br><span class="line">| reservations                 |</span><br><span class="line">| resource_classes             |</span><br><span class="line">| resource_provider_aggregates |</span><br><span class="line">| resource_provider_traits     |</span><br><span class="line">| resource_providers           |</span><br><span class="line">| traits                       |</span><br><span class="line">| users                        |</span><br><span class="line">+------------------------------+</span><br></pre></td></tr></table></figure></p>
<h3 id="13-初始化-nova-cell0-nova-数据库-请按顺序执行"><a href="#13-初始化-nova-cell0-nova-数据库-请按顺序执行" class="headerlink" title="13. 初始化 nova_cell0, nova 数据库 (请按顺序执行)"></a>13. 初始化 nova_cell0, nova 数据库 <strong><em>(请按顺序执行)</em></strong></h3><p><strong><em>必须确认数据库是否初始化正确</em></strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# su -s /bin/sh -c &quot;nova-manage cell_v2 map_cell0&quot; nova</span><br><span class="line">[root@openstack ~]# su -s /bin/sh -c &quot;nova-manage cell_v2 create_cell --name=cell1 --verbose&quot; nova</span><br><span class="line">9edf7b72-1607-432d-8529-30f07576da4a</span><br><span class="line">[root@openstack ~]# su -s /bin/sh -c &quot;nova-manage db sync&quot; nova</span><br><span class="line">/usr/lib/python2.7/site-packages/pymysql/cursors.py:170: Warning: (1831, u&apos;Duplicate index `block_device_mapping_instance_uuid_virtual_name_device_name_idx`. This is deprecated and will be disallowed in a future release.&apos;)</span><br><span class="line">  result = self._query(query)</span><br><span class="line">/usr/lib/python2.7/site-packages/pymysql/cursors.py:170: Warning: (1831, u&apos;Duplicate index `uniq_instances0uuid`. This is deprecated and will be disallowed in a future release.&apos;)</span><br><span class="line">  result = self._query(query)</span><br><span class="line">[root@openstack ~]# su -s /bin/sh -c &quot;nova-manage cell_v2 list_cells&quot; nova</span><br><span class="line">+-------+--------------------------------------+------------------------------------+-------------------------------------------------+----------+</span><br><span class="line">|  Name |                 UUID                 |           Transport URL            |               Database Connection               | Disabled |</span><br><span class="line">+-------+--------------------------------------+------------------------------------+-------------------------------------------------+----------+</span><br><span class="line">| cell0 | 00000000-0000-0000-0000-000000000000 |               none:/               | mysql+pymysql://nova:****@controller/nova_cell0 |  False   |</span><br><span class="line">| cell1 | 9edf7b72-1607-432d-8529-30f07576da4a | rabbit://openstack:****@controller |    mysql+pymysql://nova:****@controller/nova    |  False   |</span><br><span class="line">+-------+--------------------------------------+------------------------------------+-------------------------------------------------+----------+</span><br><span class="line">[root@openstack ~]# mysql -unova -p123456 -e &quot;use nova_cell0;show tables;&quot; | wc -l</span><br><span class="line">111</span><br><span class="line">[root@openstack ~]# mysql -unova -p123456 -e &quot;use nova_cell0;show tables;&quot;</span><br><span class="line">+--------------------------------------------+</span><br><span class="line">| Tables_in_nova_cell0                       |</span><br><span class="line">+--------------------------------------------+</span><br><span class="line">| agent_builds                               |</span><br><span class="line">| aggregate_hosts                            |</span><br><span class="line">| aggregate_metadata                         |</span><br><span class="line">| aggregates                                 |</span><br><span class="line">| allocations                                |</span><br><span class="line">| block_device_mapping                       |</span><br><span class="line">| bw_usage_cache                             |</span><br><span class="line">| cells                                      |</span><br><span class="line">| certificates                               |</span><br><span class="line">| compute_nodes                              |</span><br><span class="line">| console_auth_tokens                        |</span><br><span class="line">| console_pools                              |</span><br><span class="line">| consoles                                   |</span><br><span class="line">| dns_domains                                |</span><br><span class="line">| fixed_ips                                  |</span><br><span class="line">| floating_ips                               |</span><br><span class="line">| instance_actions                           |</span><br><span class="line">| instance_actions_events                    |</span><br><span class="line">| instance_extra                             |</span><br><span class="line">| instance_faults                            |</span><br><span class="line">| instance_group_member                      |</span><br><span class="line">| instance_group_policy                      |</span><br><span class="line">| instance_groups                            |</span><br><span class="line">| instance_id_mappings                       |</span><br><span class="line">| instance_info_caches                       |</span><br><span class="line">| instance_metadata                          |</span><br><span class="line">| instance_system_metadata                   |</span><br><span class="line">| instance_type_extra_specs                  |</span><br><span class="line">| instance_type_projects                     |</span><br><span class="line">| instance_types                             |</span><br><span class="line">| instances                                  |</span><br><span class="line">| inventories                                |</span><br><span class="line">| key_pairs                                  |</span><br><span class="line">| migrate_version                            |</span><br><span class="line">| migrations                                 |</span><br><span class="line">| networks                                   |</span><br><span class="line">| pci_devices                                |</span><br><span class="line">| project_user_quotas                        |</span><br><span class="line">| provider_fw_rules                          |</span><br><span class="line">| quota_classes                              |</span><br><span class="line">| quota_usages                               |</span><br><span class="line">| quotas                                     |</span><br><span class="line">| reservations                               |</span><br><span class="line">| resource_provider_aggregates               |</span><br><span class="line">| resource_providers                         |</span><br><span class="line">| s3_images                                  |</span><br><span class="line">| security_group_default_rules               |</span><br><span class="line">| security_group_instance_association        |</span><br><span class="line">| security_group_rules                       |</span><br><span class="line">| security_groups                            |</span><br><span class="line">| services                                   |</span><br><span class="line">| shadow_agent_builds                        |</span><br><span class="line">| shadow_aggregate_hosts                     |</span><br><span class="line">| shadow_aggregate_metadata                  |</span><br><span class="line">| shadow_aggregates                          |</span><br><span class="line">| shadow_block_device_mapping                |</span><br><span class="line">| shadow_bw_usage_cache                      |</span><br><span class="line">| shadow_cells                               |</span><br><span class="line">| shadow_certificates                        |</span><br><span class="line">| shadow_compute_nodes                       |</span><br><span class="line">| shadow_console_pools                       |</span><br><span class="line">| shadow_consoles                            |</span><br><span class="line">| shadow_dns_domains                         |</span><br><span class="line">| shadow_fixed_ips                           |</span><br><span class="line">| shadow_floating_ips                        |</span><br><span class="line">| shadow_instance_actions                    |</span><br><span class="line">| shadow_instance_actions_events             |</span><br><span class="line">| shadow_instance_extra                      |</span><br><span class="line">| shadow_instance_faults                     |</span><br><span class="line">| shadow_instance_group_member               |</span><br><span class="line">| shadow_instance_group_policy               |</span><br><span class="line">| shadow_instance_groups                     |</span><br><span class="line">| shadow_instance_id_mappings                |</span><br><span class="line">| shadow_instance_info_caches                |</span><br><span class="line">| shadow_instance_metadata                   |</span><br><span class="line">| shadow_instance_system_metadata            |</span><br><span class="line">| shadow_instance_type_extra_specs           |</span><br><span class="line">| shadow_instance_type_projects              |</span><br><span class="line">| shadow_instance_types                      |</span><br><span class="line">| shadow_instances                           |</span><br><span class="line">| shadow_key_pairs                           |</span><br><span class="line">| shadow_migrate_version                     |</span><br><span class="line">| shadow_migrations                          |</span><br><span class="line">| shadow_networks                            |</span><br><span class="line">| shadow_pci_devices                         |</span><br><span class="line">| shadow_project_user_quotas                 |</span><br><span class="line">| shadow_provider_fw_rules                   |</span><br><span class="line">| shadow_quota_classes                       |</span><br><span class="line">| shadow_quota_usages                        |</span><br><span class="line">| shadow_quotas                              |</span><br><span class="line">| shadow_reservations                        |</span><br><span class="line">| shadow_s3_images                           |</span><br><span class="line">| shadow_security_group_default_rules        |</span><br><span class="line">| shadow_security_group_instance_association |</span><br><span class="line">| shadow_security_group_rules                |</span><br><span class="line">| shadow_security_groups                     |</span><br><span class="line">| shadow_services                            |</span><br><span class="line">| shadow_snapshot_id_mappings                |</span><br><span class="line">| shadow_snapshots                           |</span><br><span class="line">| shadow_task_log                            |</span><br><span class="line">| shadow_virtual_interfaces                  |</span><br><span class="line">| shadow_volume_id_mappings                  |</span><br><span class="line">| shadow_volume_usage_cache                  |</span><br><span class="line">| snapshot_id_mappings                       |</span><br><span class="line">| snapshots                                  |</span><br><span class="line">| tags                                       |</span><br><span class="line">| task_log                                   |</span><br><span class="line">| virtual_interfaces                         |</span><br><span class="line">| volume_id_mappings                         |</span><br><span class="line">| volume_usage_cache                         |</span><br><span class="line">+--------------------------------------------+</span><br><span class="line">[root@openstack ~]# mysql -unova -p123456 -e &quot;use nova;show tables;&quot; | wc -l</span><br><span class="line">111</span><br><span class="line">[root@openstack ~]# mysql -unova -p123456 -e &quot;use nova;show tables;&quot;</span><br><span class="line">+--------------------------------------------+</span><br><span class="line">| Tables_in_nova                             |</span><br><span class="line">+--------------------------------------------+</span><br><span class="line">| agent_builds                               |</span><br><span class="line">| aggregate_hosts                            |</span><br><span class="line">| aggregate_metadata                         |</span><br><span class="line">| aggregates                                 |</span><br><span class="line">| allocations                                |</span><br><span class="line">| block_device_mapping                       |</span><br><span class="line">| bw_usage_cache                             |</span><br><span class="line">| cells                                      |</span><br><span class="line">| certificates                               |</span><br><span class="line">| compute_nodes                              |</span><br><span class="line">| console_auth_tokens                        |</span><br><span class="line">| console_pools                              |</span><br><span class="line">| consoles                                   |</span><br><span class="line">| dns_domains                                |</span><br><span class="line">| fixed_ips                                  |</span><br><span class="line">| floating_ips                               |</span><br><span class="line">| instance_actions                           |</span><br><span class="line">| instance_actions_events                    |</span><br><span class="line">| instance_extra                             |</span><br><span class="line">| instance_faults                            |</span><br><span class="line">| instance_group_member                      |</span><br><span class="line">| instance_group_policy                      |</span><br><span class="line">| instance_groups                            |</span><br><span class="line">| instance_id_mappings                       |</span><br><span class="line">| instance_info_caches                       |</span><br><span class="line">| instance_metadata                          |</span><br><span class="line">| instance_system_metadata                   |</span><br><span class="line">| instance_type_extra_specs                  |</span><br><span class="line">| instance_type_projects                     |</span><br><span class="line">| instance_types                             |</span><br><span class="line">| instances                                  |</span><br><span class="line">| inventories                                |</span><br><span class="line">| key_pairs                                  |</span><br><span class="line">| migrate_version                            |</span><br><span class="line">| migrations                                 |</span><br><span class="line">| networks                                   |</span><br><span class="line">| pci_devices                                |</span><br><span class="line">| project_user_quotas                        |</span><br><span class="line">| provider_fw_rules                          |</span><br><span class="line">| quota_classes                              |</span><br><span class="line">| quota_usages                               |</span><br><span class="line">| quotas                                     |</span><br><span class="line">| reservations                               |</span><br><span class="line">| resource_provider_aggregates               |</span><br><span class="line">| resource_providers                         |</span><br><span class="line">| s3_images                                  |</span><br><span class="line">| security_group_default_rules               |</span><br><span class="line">| security_group_instance_association        |</span><br><span class="line">| security_group_rules                       |</span><br><span class="line">| security_groups                            |</span><br><span class="line">| services                                   |</span><br><span class="line">| shadow_agent_builds                        |</span><br><span class="line">| shadow_aggregate_hosts                     |</span><br><span class="line">| shadow_aggregate_metadata                  |</span><br><span class="line">| shadow_aggregates                          |</span><br><span class="line">| shadow_block_device_mapping                |</span><br><span class="line">| shadow_bw_usage_cache                      |</span><br><span class="line">| shadow_cells                               |</span><br><span class="line">| shadow_certificates                        |</span><br><span class="line">| shadow_compute_nodes                       |</span><br><span class="line">| shadow_console_pools                       |</span><br><span class="line">| shadow_consoles                            |</span><br><span class="line">| shadow_dns_domains                         |</span><br><span class="line">| shadow_fixed_ips                           |</span><br><span class="line">| shadow_floating_ips                        |</span><br><span class="line">| shadow_instance_actions                    |</span><br><span class="line">| shadow_instance_actions_events             |</span><br><span class="line">| shadow_instance_extra                      |</span><br><span class="line">| shadow_instance_faults                     |</span><br><span class="line">| shadow_instance_group_member               |</span><br><span class="line">| shadow_instance_group_policy               |</span><br><span class="line">| shadow_instance_groups                     |</span><br><span class="line">| shadow_instance_id_mappings                |</span><br><span class="line">| shadow_instance_info_caches                |</span><br><span class="line">| shadow_instance_metadata                   |</span><br><span class="line">| shadow_instance_system_metadata            |</span><br><span class="line">| shadow_instance_type_extra_specs           |</span><br><span class="line">| shadow_instance_type_projects              |</span><br><span class="line">| shadow_instance_types                      |</span><br><span class="line">| shadow_instances                           |</span><br><span class="line">| shadow_key_pairs                           |</span><br><span class="line">| shadow_migrate_version                     |</span><br><span class="line">| shadow_migrations                          |</span><br><span class="line">| shadow_networks                            |</span><br><span class="line">| shadow_pci_devices                         |</span><br><span class="line">| shadow_project_user_quotas                 |</span><br><span class="line">| shadow_provider_fw_rules                   |</span><br><span class="line">| shadow_quota_classes                       |</span><br><span class="line">| shadow_quota_usages                        |</span><br><span class="line">| shadow_quotas                              |</span><br><span class="line">| shadow_reservations                        |</span><br><span class="line">| shadow_s3_images                           |</span><br><span class="line">| shadow_security_group_default_rules        |</span><br><span class="line">| shadow_security_group_instance_association |</span><br><span class="line">| shadow_security_group_rules                |</span><br><span class="line">| shadow_security_groups                     |</span><br><span class="line">| shadow_services                            |</span><br><span class="line">| shadow_snapshot_id_mappings                |</span><br><span class="line">| shadow_snapshots                           |</span><br><span class="line">| shadow_task_log                            |</span><br><span class="line">| shadow_virtual_interfaces                  |</span><br><span class="line">| shadow_volume_id_mappings                  |</span><br><span class="line">| shadow_volume_usage_cache                  |</span><br><span class="line">| snapshot_id_mappings                       |</span><br><span class="line">| snapshots                                  |</span><br><span class="line">| tags                                       |</span><br><span class="line">| task_log                                   |</span><br><span class="line">| virtual_interfaces                         |</span><br><span class="line">| volume_id_mappings                         |</span><br><span class="line">| volume_usage_cache                         |</span><br><span class="line">+--------------------------------------------+</span><br></pre></td></tr></table></figure></p>
<h3 id="14-确认-cell0-cell1-注册成功"><a href="#14-确认-cell0-cell1-注册成功" class="headerlink" title="14. 确认 cell0, cell1 注册成功"></a>14. 确认 cell0, cell1 注册成功</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# su -s /bin/sh -c &quot;nova-manage cell_v2 list_cells&quot; nova</span><br><span class="line">+-------+--------------------------------------+------------------------------------+-------------------------------------------------+----------+</span><br><span class="line">|  Name |                 UUID                 |           Transport URL            |               Database Connection               | Disabled |</span><br><span class="line">+-------+--------------------------------------+------------------------------------+-------------------------------------------------+----------+</span><br><span class="line">| cell0 | 00000000-0000-0000-0000-000000000000 |               none:/               | mysql+pymysql://nova:****@controller/nova_cell0 |  False   |</span><br><span class="line">| cell1 | 9edf7b72-1607-432d-8529-30f07576da4a | rabbit://openstack:****@controller |    mysql+pymysql://nova:****@controller/nova    |  False   |</span><br><span class="line">+-------+--------------------------------------+------------------------------------+-------------------------------------------------+----------+</span><br></pre></td></tr></table></figure>
<h3 id="15-启动-Nova-服务并设置为开机自启"><a href="#15-启动-Nova-服务并设置为开机自启" class="headerlink" title="15. 启动 Nova 服务并设置为开机自启"></a>15. 启动 Nova 服务并设置为开机自启</h3><p><strong><em>需要确认5个服务全部启动成功</em></strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# systemctl start openstack-nova-api openstack-nova-consoleauth openstack-nova-scheduler openstack-nova-conductor openstack-nova-novncproxy</span><br><span class="line">[root@openstack ~]# systemctl enable openstack-nova-api openstack-nova-consoleauth openstack-nova-scheduler openstack-nova-conductor openstack-nova-novncproxy</span><br><span class="line">Created symlink from /etc/systemd/system/multi-user.target.wants/openstack-nova-api.service to /usr/lib/systemd/system/openstack-nova-api.service.</span><br><span class="line">Created symlink from /etc/systemd/system/multi-user.target.wants/openstack-nova-consoleauth.service to /usr/lib/systemd/system/openstack-nova-consoleauth.service.</span><br><span class="line">Created symlink from /etc/systemd/system/multi-user.target.wants/openstack-nova-scheduler.service to /usr/lib/systemd/system/openstack-nova-scheduler.service.</span><br><span class="line">Created symlink from /etc/systemd/system/multi-user.target.wants/openstack-nova-conductor.service to /usr/lib/systemd/system/openstack-nova-conductor.service.</span><br><span class="line">Created symlink from /etc/systemd/system/multi-user.target.wants/openstack-nova-novncproxy.service to /usr/lib/systemd/system/openstack-nova-novncproxy.service.</span><br><span class="line">[root@openstack ~]# systemctl status openstack-nova-api openstack-nova-consoleauth openstack-nova-scheduler openstack-nova-conductor openstack-nova-novncproxy</span><br><span class="line">● openstack-nova-api.service - OpenStack Nova API Server</span><br><span class="line">   Loaded: loaded (/usr/lib/systemd/system/openstack-nova-api.service; enabled; vendor preset: disabled)</span><br><span class="line">   Active: active (running) since Sat 2018-12-15 17:28:02 CST; 2min 17s ago</span><br><span class="line"> Main PID: 24930 (nova-api)</span><br><span class="line">   CGroup: /system.slice/openstack-nova-api.service</span><br><span class="line">           ├─24930 /usr/bin/python2 /usr/bin/nova-api</span><br><span class="line">           ├─24998 /usr/bin/python2 /usr/bin/nova-api</span><br><span class="line">           └─24999 /usr/bin/python2 /usr/bin/nova-api</span><br><span class="line"></span><br><span class="line">Dec 15 17:27:21 openstack.controller systemd[1]: Starting OpenStack Nova API Ser....</span><br><span class="line">Dec 15 17:28:02 openstack.controller systemd[1]: Started OpenStack Nova API Server.</span><br><span class="line"></span><br><span class="line">● openstack-nova-consoleauth.service - OpenStack Nova VNC console auth Server</span><br><span class="line">   Loaded: loaded (/usr/lib/systemd/system/openstack-nova-consoleauth.service; enabled; vendor preset: disabled)</span><br><span class="line">   Active: active (running) since Sat 2018-12-15 17:27:55 CST; 2min 24s ago</span><br><span class="line"> Main PID: 24931 (nova-consoleaut)</span><br><span class="line">   CGroup: /system.slice/openstack-nova-consoleauth.service</span><br><span class="line">           └─24931 /usr/bin/python2 /usr/bin/nova-consoleauth</span><br><span class="line"></span><br><span class="line">Dec 15 17:27:21 openstack.controller systemd[1]: Starting OpenStack Nova VNC con....</span><br><span class="line">Dec 15 17:27:55 openstack.controller systemd[1]: Started OpenStack Nova VNC cons....</span><br><span class="line"></span><br><span class="line">● openstack-nova-scheduler.service - OpenStack Nova Scheduler Server</span><br><span class="line">   Loaded: loaded (/usr/lib/systemd/system/openstack-nova-scheduler.service; enabled; vendor preset: disabled)</span><br><span class="line">   Active: active (running) since Sat 2018-12-15 17:28:00 CST; 2min 20s ago</span><br><span class="line"> Main PID: 24932 (nova-scheduler)</span><br><span class="line">   CGroup: /system.slice/openstack-nova-scheduler.service</span><br><span class="line">           └─24932 /usr/bin/python2 /usr/bin/nova-scheduler</span><br><span class="line"></span><br><span class="line">Dec 15 17:27:21 openstack.controller systemd[1]: Starting OpenStack Nova Schedul....</span><br><span class="line">Dec 15 17:28:00 openstack.controller systemd[1]: Started OpenStack Nova Schedule....</span><br><span class="line"></span><br><span class="line">● openstack-nova-conductor.service - OpenStack Nova Conductor Server</span><br><span class="line">   Loaded: loaded (/usr/lib/systemd/system/openstack-nova-conductor.service; enabled; vendor preset: disabled)</span><br><span class="line">   Active: active (running) since Sat 2018-12-15 17:27:57 CST; 2min 23s ago</span><br><span class="line"> Main PID: 24933 (nova-conductor)</span><br><span class="line">   CGroup: /system.slice/openstack-nova-conductor.service</span><br><span class="line">           └─24933 /usr/bin/python2 /usr/bin/nova-conductor</span><br><span class="line"></span><br><span class="line">Dec 15 17:27:21 openstack.controller systemd[1]: Starting OpenStack Nova Conduct....</span><br><span class="line">Dec 15 17:27:57 openstack.controller systemd[1]: Started OpenStack Nova Conducto....</span><br><span class="line"></span><br><span class="line">● openstack-nova-novncproxy.service - OpenStack Nova NoVNC Proxy Server</span><br><span class="line">   Loaded: loaded (/usr/lib/systemd/system/openstack-nova-novncproxy.service; enabled; vendor preset: disabled)</span><br><span class="line">   Active: active (running) since Sat 2018-12-15 17:27:21 CST; 2min 58s ago</span><br><span class="line"> Main PID: 24934 (nova-novncproxy)</span><br><span class="line">   CGroup: /system.slice/openstack-nova-novncproxy.service</span><br><span class="line">           └─24934 /usr/bin/python2 /usr/bin/nova-novncproxy --web /usr/share/nov...</span><br><span class="line"></span><br><span class="line">Dec 15 17:27:21 openstack.controller systemd[1]: Started OpenStack Nova NoVNC Pr....</span><br><span class="line">Hint: Some lines were ellipsized, use -l to show in full.</span><br></pre></td></tr></table></figure></p>
<p><strong><em>恭喜你配置完成了 controller 节点, 为 controller 节点再再次拍摄一个快照, 以备不时之需</em></strong></p>
<h2 id="十一、安装并部署-Compute-节点到-Openstack-集群-默认情况下在-Compute-节点操作-请留意说明"><a href="#十一、安装并部署-Compute-节点到-Openstack-集群-默认情况下在-Compute-节点操作-请留意说明" class="headerlink" title="十一、安装并部署 Compute 节点到 Openstack 集群 (!!!默认情况下在 Compute 节点操作, 请留意说明!!!)"></a>十一、安装并部署 Compute 节点到 Openstack 集群 <strong><em>(!!!默认情况下在 Compute 节点操作, 请留意说明!!!)</em></strong></h2><h3 id="1-安装-Nova-相关软件包"><a href="#1-安装-Nova-相关软件包" class="headerlink" title="1. 安装 Nova 相关软件包"></a>1. 安装 Nova 相关软件包</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# yum install -y openstack-nova-compute python-openstackclient openstack-utils</span><br><span class="line">...</span><br><span class="line">Complete!</span><br></pre></td></tr></table></figure>
<h3 id="2-使用-openstack-utils-快速配置-Nova"><a href="#2-使用-openstack-utils-快速配置-Nova" class="headerlink" title="2. 使用 openstack-utils 快速配置 Nova"></a>2. 使用 openstack-utils 快速配置 Nova</h3><p><strong><em>必须确认配置是否正确</em></strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# openstack-config --set /etc/nova/nova.conf DEFAULT my_ip &quot;192.168.10.31&quot;</span><br><span class="line">[root@openstack ~]# openstack-config --set /etc/nova/nova.conf DEFAULT use_neutron &quot;True&quot;</span><br><span class="line">[root@openstack ~]# openstack-config --set /etc/nova/nova.conf DEFAULT firewall_driver &quot;nova.virt.firewall.NoopFirewallDriver&quot;</span><br><span class="line">[root@openstack ~]# openstack-config --set /etc/nova/nova.conf DEFAULT enabled_apis &quot;osapi_compute,metadata&quot;</span><br><span class="line">[root@openstack ~]# openstack-config --set /etc/nova/nova.conf DEFAULT transport_url &quot;rabbit://openstack:123456@controller&quot;</span><br><span class="line">[root@openstack ~]# openstack-config --set /etc/nova/nova.conf api auth_strategy &quot;keystone&quot; </span><br><span class="line">[root@openstack ~]# openstack-config --set /etc/nova/nova.conf keystone_authtoken auth_url &quot;http://controller:5000/v3&quot;</span><br><span class="line">[root@openstack ~]# openstack-config --set /etc/nova/nova.conf keystone_authtoken memcached_servers &quot;controller:11211&quot;</span><br><span class="line">[root@openstack ~]# openstack-config --set /etc/nova/nova.conf keystone_authtoken auth_type &quot;password&quot;</span><br><span class="line">[root@openstack ~]# openstack-config --set /etc/nova/nova.conf keystone_authtoken project_domain_name &quot;default&quot;</span><br><span class="line">[root@openstack ~]# openstack-config --set /etc/nova/nova.conf keystone_authtoken user_domain_name &quot;default&quot;</span><br><span class="line">[root@openstack ~]# openstack-config --set /etc/nova/nova.conf keystone_authtoken project_name &quot;service&quot;</span><br><span class="line">[root@openstack ~]# openstack-config --set /etc/nova/nova.conf keystone_authtoken username &quot;nova&quot;</span><br><span class="line">[root@openstack ~]# openstack-config --set /etc/nova/nova.conf keystone_authtoken password &quot;123456&quot;</span><br><span class="line">[root@openstack ~]# openstack-config --set /etc/nova/nova.conf vnc enabled &quot;True&quot;</span><br><span class="line">[root@openstack ~]# openstack-config --set /etc/nova/nova.conf vnc server_listen &quot;0.0.0.0&quot;</span><br><span class="line">[root@openstack ~]# openstack-config --set /etc/nova/nova.conf vnc server_proxyclient_address &quot;\$my_ip&quot;</span><br><span class="line">[root@openstack ~]# openstack-config --set /etc/nova/nova.conf vnc novncproxy_base_url &quot;http://controller:6080/vnc_auto.html&quot;</span><br><span class="line">[root@openstack ~]# openstack-config --set /etc/nova/nova.conf glance api_servers &quot;http://controller:9292&quot;</span><br><span class="line">[root@openstack ~]# openstack-config --set /etc/nova/nova.conf oslo_concurrency lock_path &quot;/var/lib/nova/tmp&quot;</span><br><span class="line">[root@openstack ~]# openstack-config --set /etc/nova/nova.conf placement region_name &quot;RegionOne&quot;</span><br><span class="line">[root@openstack ~]# openstack-config --set /etc/nova/nova.conf placement project_domain_name &quot;Default&quot;</span><br><span class="line">[root@openstack ~]# openstack-config --set /etc/nova/nova.conf placement project_name &quot;service&quot;</span><br><span class="line">[root@openstack ~]# openstack-config --set /etc/nova/nova.conf placement auth_type &quot;password&quot;</span><br><span class="line">[root@openstack ~]# openstack-config --set /etc/nova/nova.conf placement user_domain_name &quot;Default&quot;</span><br><span class="line">[root@openstack ~]# openstack-config --set /etc/nova/nova.conf placement auth_url &quot;http://controller:5000/v3&quot;</span><br><span class="line">[root@openstack ~]# openstack-config --set /etc/nova/nova.conf placement username &quot;placement&quot;</span><br><span class="line">[root@openstack ~]# openstack-config --set /etc/nova/nova.conf placement password &quot;123456&quot;</span><br><span class="line">[root@openstack ~]# grep &apos;^[a-z]&apos; /etc/nova/nova.conf</span><br><span class="line">my_ip = 192.168.10.31</span><br><span class="line">use_neutron = True</span><br><span class="line">firewall_driver = nova.virt.firewall.NoopFirewallDriver</span><br><span class="line">enabled_apis = osapi_compute,metadata</span><br><span class="line">transport_url = rabbit://openstack:123456@controller</span><br><span class="line">auth_strategy = keystone</span><br><span class="line">api_servers = http://controller:9292</span><br><span class="line">auth_url = http://controller:5000/v3</span><br><span class="line">memcached_servers = controller:11211</span><br><span class="line">auth_type = password</span><br><span class="line">project_domain_name = default</span><br><span class="line">user_domain_name = default</span><br><span class="line">project_name = service</span><br><span class="line">username = nova</span><br><span class="line">password = 123456</span><br><span class="line">lock_path = /var/lib/nova/tmp</span><br><span class="line">region_name = RegionOne</span><br><span class="line">project_domain_name = Default</span><br><span class="line">project_name = service</span><br><span class="line">auth_type = password</span><br><span class="line">user_domain_name = Default</span><br><span class="line">auth_url = http://controller:5000/v3</span><br><span class="line">username = placement</span><br><span class="line">password = 123456</span><br><span class="line">enabled = True</span><br><span class="line">server_listen = 0.0.0.0</span><br><span class="line">server_proxyclient_address = $my_ip</span><br><span class="line">novncproxy_base_url = http://controller:6080/vnc_auto.html</span><br></pre></td></tr></table></figure></p>
<h3 id="3-配置虚拟机的硬件加速"><a href="#3-配置虚拟机的硬件加速" class="headerlink" title="3. 配置虚拟机的硬件加速"></a>3. 配置虚拟机的硬件加速</h3><h4 id="a-确认计算节点是否支持虚拟机的硬件加速"><a href="#a-确认计算节点是否支持虚拟机的硬件加速" class="headerlink" title="a) 确认计算节点是否支持虚拟机的硬件加速"></a>a) 确认计算节点是否支持虚拟机的硬件加速</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# egrep -c &apos;(vmx|svm)&apos; /proc/cpuinfo</span><br><span class="line">1</span><br></pre></td></tr></table></figure>
<h4 id="b1-如果返回0-表示计算节点不支持硬件加速-需要配置-libvirt-使用-QEMU-方式管理虚拟机-使用以下命令"><a href="#b1-如果返回0-表示计算节点不支持硬件加速-需要配置-libvirt-使用-QEMU-方式管理虚拟机-使用以下命令" class="headerlink" title="b1) 如果返回0, 表示计算节点不支持硬件加速, 需要配置 libvirt 使用 QEMU 方式管理虚拟机, 使用以下命令:"></a>b1) 如果返回0, 表示计算节点不支持硬件加速, 需要配置 libvirt 使用 QEMU 方式管理虚拟机, 使用以下命令:</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# openstack-config --set /etc/nova/nova.conf libvirt virt_type &quot;qemu&quot;</span><br><span class="line">[root@openstack ~]# egrep -v &quot;^#|^$&quot; /etc/nova/nova.conf | grep &apos;virt_type&apos;</span><br><span class="line">virt_type = qemu</span><br></pre></td></tr></table></figure>
<h4 id="b2-如果返回其他值-表示计算节点支持硬件加速且不需要额外的配置-使用以下命令"><a href="#b2-如果返回其他值-表示计算节点支持硬件加速且不需要额外的配置-使用以下命令" class="headerlink" title="b2) 如果返回其他值, 表示计算节点支持硬件加速且不需要额外的配置, 使用以下命令:"></a>b2) 如果返回其他值, 表示计算节点支持硬件加速且不需要额外的配置, 使用以下命令:</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# openstack-config --set /etc/nova/nova.conf libvirt virt_type &quot;kvm&quot;</span><br><span class="line">[root@openstack ~]# egrep -v &quot;^#|^$&quot; /etc/nova/nova.conf | grep &apos;virt_type&apos;</span><br><span class="line">virt_type = kvm</span><br></pre></td></tr></table></figure>
<h3 id="4-启动-Nova-服务并设置为开机自启"><a href="#4-启动-Nova-服务并设置为开机自启" class="headerlink" title="4. 启动 Nova 服务并设置为开机自启"></a>4. 启动 Nova 服务并设置为开机自启</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# systemctl start libvirtd openstack-nova-compute</span><br><span class="line">[root@openstack ~]# systemctl enable libvirtd openstack-nova-compute</span><br><span class="line">Created symlink from /etc/systemd/system/multi-user.target.wants/openstack-nova-compute.service to /usr/lib/systemd/system/openstack-nova-compute.service.</span><br></pre></td></tr></table></figure>
<h3 id="5-将-Compute-节点增加到-cell-数据库"><a href="#5-将-Compute-节点增加到-cell-数据库" class="headerlink" title="5. 将 Compute 节点增加到 cell 数据库"></a>5. 将 Compute 节点增加到 cell 数据库</h3><p><strong><em>!!!以下命令在 Controller 节点运行!!!</em></strong></p>
<h4 id="a-确认数据库中有新的-Compute-节点"><a href="#a-确认数据库中有新的-Compute-节点" class="headerlink" title="a) 确认数据库中有新的 Compute 节点"></a>a) 确认数据库中有新的 Compute 节点</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# . admin-openrc </span><br><span class="line">[root@openstack ~]# openstack compute service list --service nova-compute</span><br><span class="line">+----+--------------+--------------------+------+---------+-------+----------------------------+</span><br><span class="line">| ID | Binary       | Host               | Zone | Status  | State | Updated At                 |</span><br><span class="line">+----+--------------+--------------------+------+---------+-------+----------------------------+</span><br><span class="line">|  6 | nova-compute | openstack.compute1 | nova | enabled | up    | 2018-12-15T10:00:46.000000 |</span><br><span class="line">+----+--------------+--------------------+------+---------+-------+----------------------------+</span><br></pre></td></tr></table></figure>
<h4 id="b-手动添加新的-Compute-节点到-Openstack-集群"><a href="#b-手动添加新的-Compute-节点到-Openstack-集群" class="headerlink" title="b) 手动添加新的 Compute 节点到 Openstack 集群"></a>b) 手动添加新的 Compute 节点到 Openstack 集群</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# su -s /bin/sh -c &quot;nova-manage cell_v2 discover_hosts --verbose&quot; nova</span><br><span class="line">Found 2 cell mappings.</span><br><span class="line">Skipping cell0 since it does not contain hosts.</span><br><span class="line">Getting computes from cell &apos;cell1&apos;: 9edf7b72-1607-432d-8529-30f07576da4a</span><br><span class="line">Found 0 unmapped computes in cell: 9edf7b72-1607-432d-8529-30f07576da4a</span><br></pre></td></tr></table></figure>
<h3 id="6-验证-Computer-节点"><a href="#6-验证-Computer-节点" class="headerlink" title="6. 验证 Computer 节点"></a>6. 验证 Computer 节点</h3><p><strong><em>!!!以下命令在 Controller 节点运行!!!</em></strong><br>列出 Nova 服务组件 (openstack compute service list)<br>列出 KeyStone 服务中 API 端点 (openstack catalog list)<br>列出 Glance 服务中已有镜像 (openstack image list)<br>检查 Nova 服务各组件的状态 (nova-status upgrade check)<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# . admin-openrc </span><br><span class="line">[root@openstack ~]# openstack compute service list</span><br><span class="line">+----+------------------+----------------------+----------+---------+-------+----------------------------+</span><br><span class="line">| ID | Binary           | Host                 | Zone     | Status  | State | Updated At                 |</span><br><span class="line">+----+------------------+----------------------+----------+---------+-------+----------------------------+</span><br><span class="line">|  1 | nova-consoleauth | openstack.controller | internal | enabled | up    | 2018-12-15T10:07:03.000000 |</span><br><span class="line">|  2 | nova-conductor   | openstack.controller | internal | enabled | up    | 2018-12-15T10:07:03.000000 |</span><br><span class="line">|  3 | nova-scheduler   | openstack.controller | internal | enabled | up    | 2018-12-15T10:07:03.000000 |</span><br><span class="line">|  6 | nova-compute     | openstack.compute1   | nova     | enabled | up    | 2018-12-15T10:06:59.000000 |</span><br><span class="line">+----+------------------+----------------------+----------+---------+-------+----------------------------+</span><br><span class="line">[root@openstack ~]# openstack catalog list</span><br><span class="line">+-----------+-----------+-----------------------------------------+</span><br><span class="line">| Name      | Type      | Endpoints                               |</span><br><span class="line">+-----------+-----------+-----------------------------------------+</span><br><span class="line">| keystone  | identity  | RegionOne                               |</span><br><span class="line">|           |           |   public: http://controller:5000/v3/    |</span><br><span class="line">|           |           | RegionOne                               |</span><br><span class="line">|           |           |   admin: http://controller:5000/v3/     |</span><br><span class="line">|           |           | RegionOne                               |</span><br><span class="line">|           |           |   internal: http://controller:5000/v3/  |</span><br><span class="line">|           |           |                                         |</span><br><span class="line">| nova      | compute   | RegionOne                               |</span><br><span class="line">|           |           |   internal: http://controller:8774/v2.1 |</span><br><span class="line">|           |           | RegionOne                               |</span><br><span class="line">|           |           |   admin: http://controller:8774/v2.1    |</span><br><span class="line">|           |           | RegionOne                               |</span><br><span class="line">|           |           |   public: http://controller:8774/v2.1   |</span><br><span class="line">|           |           |                                         |</span><br><span class="line">| placement | placement | RegionOne                               |</span><br><span class="line">|           |           |   public: http://controller:8778        |</span><br><span class="line">|           |           | RegionOne                               |</span><br><span class="line">|           |           |   internal: http://controller:8778      |</span><br><span class="line">|           |           | RegionOne                               |</span><br><span class="line">|           |           |   admin: http://controller:8778         |</span><br><span class="line">|           |           |                                         |</span><br><span class="line">| glance    | image     | RegionOne                               |</span><br><span class="line">|           |           |   internal: http://controller:9292      |</span><br><span class="line">|           |           | RegionOne                               |</span><br><span class="line">|           |           |   admin: http://controller:9292         |</span><br><span class="line">|           |           | RegionOne                               |</span><br><span class="line">|           |           |   public: http://controller:9292        |</span><br><span class="line">|           |           |                                         |</span><br><span class="line">+-----------+-----------+-----------------------------------------+</span><br><span class="line">[root@openstack ~]# openstack image list</span><br><span class="line">+--------------------------------------+--------+--------+</span><br><span class="line">| ID                                   | Name   | Status |</span><br><span class="line">+--------------------------------------+--------+--------+</span><br><span class="line">| 28be57c8-8f04-407b-8a32-41d953a4a131 | cirros | active |</span><br><span class="line">+--------------------------------------+--------+--------+</span><br><span class="line">[root@openstack ~]# nova-status upgrade check</span><br><span class="line">+--------------------------------+</span><br><span class="line">| Upgrade Check Results          |</span><br><span class="line">+--------------------------------+</span><br><span class="line">| Check: Cells v2                |</span><br><span class="line">| Result: Success                |</span><br><span class="line">| Details: None                  |</span><br><span class="line">+--------------------------------+</span><br><span class="line">| Check: Placement API           |</span><br><span class="line">| Result: Success                |</span><br><span class="line">| Details: None                  |</span><br><span class="line">+--------------------------------+</span><br><span class="line">| Check: Resource Providers      |</span><br><span class="line">| Result: Success                |</span><br><span class="line">| Details: None                  |</span><br><span class="line">+--------------------------------+</span><br><span class="line">| Check: Ironic Flavor Migration |</span><br><span class="line">| Result: Success                |</span><br><span class="line">| Details: None                  |</span><br><span class="line">+--------------------------------+</span><br><span class="line">| Check: API Service Version     |</span><br><span class="line">| Result: Success                |</span><br><span class="line">| Details: None                  |</span><br><span class="line">+--------------------------------+</span><br><span class="line">| Check: Request Spec Migration  |</span><br><span class="line">| Result: Success                |</span><br><span class="line">| Details: None                  |</span><br><span class="line">+--------------------------------+</span><br><span class="line">| Check: Console Auths           |</span><br><span class="line">| Result: Success                |</span><br><span class="line">| Details: None                  |</span><br><span class="line">+--------------------------------+</span><br></pre></td></tr></table></figure></p>
<h2 id="十、安装并配置-Dashboard-计算服务-只需在-Controller-节点安装"><a href="#十、安装并配置-Dashboard-计算服务-只需在-Controller-节点安装" class="headerlink" title="十、安装并配置 Dashboard 计算服务 (!!!只需在 Controller 节点安装!!!)"></a>十、安装并配置 Dashboard 计算服务 <strong><em>(!!!只需在 Controller 节点安装!!!)</em></strong></h2><h3 id="1-安装并配置-Dashboard-相关软件"><a href="#1-安装并配置-Dashboard-相关软件" class="headerlink" title="1. 安装并配置 Dashboard 相关软件"></a>1. 安装并配置 Dashboard 相关软件</h3><h4 id="a-安装-Dashboard-相关软件"><a href="#a-安装-Dashboard-相关软件" class="headerlink" title="a) 安装 Dashboard 相关软件"></a>a) 安装 Dashboard 相关软件</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# yum install -y openstack-dashboard</span><br><span class="line">...</span><br><span class="line">Complete!</span><br></pre></td></tr></table></figure>
<h4 id="b-修改-Dashboard-的配置文件-local-settings"><a href="#b-修改-Dashboard-的配置文件-local-settings" class="headerlink" title="b) 修改 Dashboard 的配置文件 (local_settings)"></a>b) 修改 Dashboard 的配置文件 (local_settings)</h4><p><strong><em>必须确认配置是否正确</em></strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">OPENSTACK_HOST = &quot;controller&quot;</span><br><span class="line">ALLOWED_HOSTS = [&apos;*&apos;, ]</span><br><span class="line">SESSION_ENGINE = &apos;django.contrib.sessions.backends.file&apos;</span><br><span class="line">CACHES = &#123;</span><br><span class="line">    &apos;default&apos;: &#123;</span><br><span class="line">         &apos;BACKEND&apos;: &apos;django.core.cache.backends.memcached.MemcachedCache&apos;,</span><br><span class="line">         &apos;LOCATION&apos;: &apos;192.168.10.11:11211&apos;,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">OPENSTACK_KEYSTONE_URL = &quot;http://%s:5000/v3&quot; % OPENSTACK_HOST</span><br><span class="line">OPENSTACK_KEYSTONE_MULTIDOMAIN_SUPPORT = True</span><br><span class="line">OPENSTACK_API_VERSIONS = &#123;</span><br><span class="line">    &quot;identity&quot;: 3,</span><br><span class="line">    &quot;image&quot;: 2,</span><br><span class="line">    &quot;volume&quot;: 2,</span><br><span class="line">&#125;</span><br><span class="line">OPENSTACK_KEYSTONE_DEFAULT_DOMAIN = &quot;default&quot;</span><br><span class="line">OPENSTACK_KEYSTONE_DEFAULT_ROLE = &quot;user&quot;</span><br><span class="line">OPENSTACK_NEUTRON_NETWORK = &#123;</span><br><span class="line">    &apos;enable_router&apos;: False,</span><br><span class="line">    &apos;enable_quotas&apos;: False,</span><br><span class="line">    &apos;enable_distributed_router&apos;: False,</span><br><span class="line">    &apos;enable_ha_router&apos;: False,</span><br><span class="line">    &apos;enable_lb&apos;: False,</span><br><span class="line">    &apos;enable_firewall&apos;: False,</span><br><span class="line">    &apos;enable_vpn&apos;: False,</span><br><span class="line">    &apos;enable_fip_topology_check&apos;: False,</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line">TIME_ZONE = &quot;TIME_ZONE&quot;</span><br></pre></td></tr></table></figure></p>
<h4 id="d-修改-Apache-Httpd-的虚拟主机配置文件-openstack-dashboard-conf"><a href="#d-修改-Apache-Httpd-的虚拟主机配置文件-openstack-dashboard-conf" class="headerlink" title="d) 修改 Apache (Httpd) 的虚拟主机配置文件 (openstack-dashboard.conf)"></a>d) 修改 Apache (Httpd) 的虚拟主机配置文件 (openstack-dashboard.conf)</h4><p><strong><em>必须确认配置是否正确</em></strong><br>增加第一行即可<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# cat /etc/httpd/conf.d/openstack-dashboard.conf </span><br><span class="line">WSGIApplicationGroup %&#123;GLOBAL&#125;</span><br><span class="line">WSGIDaemonProcess dashboard</span><br><span class="line">WSGIProcessGroup dashboard</span><br><span class="line">WSGISocketPrefix run/wsgi</span><br><span class="line"></span><br><span class="line">WSGIScriptAlias /dashboard /usr/share/openstack-dashboard/openstack_dashboard/wsgi/django.wsgi</span><br><span class="line">Alias /dashboard/static /usr/share/openstack-dashboard/static</span><br><span class="line"></span><br><span class="line">&lt;Directory /usr/share/openstack-dashboard/openstack_dashboard/wsgi&gt;</span><br><span class="line">  Options All</span><br><span class="line">  AllowOverride All</span><br><span class="line">  Require all granted</span><br><span class="line">&lt;/Directory&gt;</span><br><span class="line"></span><br><span class="line">&lt;Directory /usr/share/openstack-dashboard/static&gt;</span><br><span class="line">  Options All</span><br><span class="line">  AllowOverride All</span><br><span class="line">  Require all granted</span><br><span class="line">&lt;/Directory&gt;</span><br></pre></td></tr></table></figure></p>
<h3 id="2-重启-Apache-Httpd-服务-会话存储服务"><a href="#2-重启-Apache-Httpd-服务-会话存储服务" class="headerlink" title="2. 重启 Apache (Httpd)服务, 会话存储服务"></a>2. 重启 Apache (Httpd)服务, 会话存储服务</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# systemctl restart httpd memcached</span><br></pre></td></tr></table></figure>
<h3 id="3-访问-Openstack-的-web-界面"><a href="#3-访问-Openstack-的-web-界面" class="headerlink" title="3. 访问 Openstack 的 web 界面"></a>3. 访问 Openstack 的 web 界面</h3><p>URL: <a href="http://192.168.10.11/dashboard" target="_blank" rel="noopener">http://192.168.10.11/dashboard</a><br>域: default<br>用户名: admin<br>密码: 123456</p>
<p><strong><em>Openstack Rocky 最小化安装到此结束</em></strong></p>

            <!--[if lt IE 9]><script>document.createElement('audio');</script><![endif]-->
            <audio id="audio" loop="1" preload="auto" controls="controls" data-autoplay="false">
                <source type="audio/mpeg" src="">
            </audio>
            
                <ul id="audio-list" style="display:none">
                    
                        <li title='0' data-url='http://link.hhtjim.com/163/35032211.mp3'></li>
                    
                        <li title='1' data-url='http://link.hhtjim.com/163/41500546.mp3'></li>
                    
                        <li title='2' data-url='http://link.hhtjim.com/163/555557845.mp3'></li>
                    
                        <li title='3' data-url='http://link.hhtjim.com/163/493041272.mp3'></li>
                    
                        <li title='4' data-url='http://link.hhtjim.com/163/493041272.mp3'></li>
                    
                        <li title='5' data-url='http://link.hhtjim.com/163/409650440.mp3'></li>
                    
                        <li title='6' data-url='http://link.hhtjim.com/163/409654855.mp3'></li>
                    
                        <li title='7' data-url='http://link.hhtjim.com/163/407761545.mp3'></li>
                    
                        <li title='8' data-url='http://link.hhtjim.com/163/409654856.mp3'></li>
                    
                        <li title='9' data-url='http://link.hhtjim.com/163/466327445.mp3'></li>
                    
                        <li title='10' data-url='http://link.hhtjim.com/163/409654857.mp3'></li>
                    
                        <li title='11' data-url='http://link.hhtjim.com/163/405987145.mp3'></li>
                    
                        <li title='12' data-url='http://link.hhtjim.com/163/474945732.mp3'></li>
                    
                        <li title='13' data-url='http://link.hhtjim.com/163/409654858.mp3'></li>
                    
                        <li title='14' data-url='http://link.hhtjim.com/163/452578261.mp3'></li>
                    
                        <li title='15' data-url='http://link.hhtjim.com/163/409654859.mp3'></li>
                    
                        <li title='16' data-url='http://link.hhtjim.com/163/435307781.mp3'></li>
                    
                        <li title='17' data-url='http://link.hhtjim.com/163/477145631.mp3'></li>
                    
                        <li title='18' data-url='http://link.hhtjim.com/163/456175343.mp3'></li>
                    
                        <li title='19' data-url='http://link.hhtjim.com/163/409654860.mp3'></li>
                    
                        <li title='20' data-url='http://link.hhtjim.com/163/408250066.mp3'></li>
                    
                        <li title='21' data-url='http://link.hhtjim.com/163/537262197.mp3'></li>
                    
                        <li title='22' data-url='http://link.hhtjim.com/163/447978200.mp3'></li>
                    
                        <li title='23' data-url='http://link.hhtjim.com/163/439625573.mp3'></li>
                    
                        <li title='24' data-url='http://link.hhtjim.com/163/457840567.mp3'></li>
                    
                        <li title='25' data-url='http://link.hhtjim.com/163/452575951.mp3'></li>
                    
                        <li title='26' data-url='http://link.hhtjim.com/163/454966416.mp3'></li>
                    
                        <li title='27' data-url='http://link.hhtjim.com/163/419375942.mp3'></li>
                    
                        <li title='28' data-url='http://link.hhtjim.com/163/411988718.mp3'></li>
                    
                        <li title='29' data-url='http://link.hhtjim.com/163/418279656.mp3'></li>
                    
                        <li title='30' data-url='http://link.hhtjim.com/163/417594827.mp3'></li>
                    
                        <li title='31' data-url='http://link.hhtjim.com/163/423104116.mp3'></li>
                    
                        <li title='32' data-url='http://link.hhtjim.com/163/452577615.mp3'></li>
                    
                        <li title='33' data-url='http://link.hhtjim.com/163/436675327.mp3'></li>
                    
                        <li title='34' data-url='http://link.hhtjim.com/163/413074476.mp3'></li>
                    
                </ul>
            
        </div>
        
    <div id='gitalk-container' class="comment link"
        data-ae='false'
        data-ci='6f2ced5993cec2abfdc0'
        data-cs='53941abd6c61cb31c982bddf0394826699a4b9a7'
        data-r='YongJie-Xie.github.io'
        data-o='YongJie-Xie'
        data-a='YongJie-Xie'
        data-d='false'
    >查看评论</div>


    </div>
    
</div>


    </div>
</div>
</body>
<script src="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
<script src="//lib.baomitu.com/jquery/1.8.3/jquery.min.js"></script>
<script src="/js/plugin.js"></script>
<script src="/js/diaspora.js"></script>
<link rel="stylesheet" href="/photoswipe/photoswipe.css">
<link rel="stylesheet" href="/photoswipe/default-skin/default-skin.css">
<script src="/photoswipe/photoswipe.min.js"></script>
<script src="/photoswipe/photoswipe-ui-default.min.js"></script>

<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">
    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>
    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">
        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>
        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">
            <div class="pswp__top-bar">
                <!--  Controls are self-explanatory. Order can be changed. -->
                <div class="pswp__counter"></div>
                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
                <button class="pswp__button pswp__button--share" title="Share"></button>
                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>
            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div> 
            </div>
            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>
            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>
            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>
        </div>
    </div>
</div>




</html>